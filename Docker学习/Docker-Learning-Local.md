å¤§å®¶å­¦ä¹ ä¸­å¦‚æœç¢°åˆ°å›°éš¾ï¼Œå¯ä»¥åŠ å…¥**[é»‘é©¬æ™ºå­¦ä¼´ä¾£](https://b11et3un53m.feishu.cn/wiki/M9LKwYAlHiZoyhkB5iKcgOh1nmc)**å¯»æ±‚å¸®åŠ©ï¼Œæœ‰å­¦ä¹ äº¤æµç¾¤ï¼Œè€å¸ˆã€åŒå­¦åœ¨çº¿ç­”ç–‘ã€‚è¿˜æœ‰ç‹¬äº«çš„ä¼ä¸šçº§é¡¹ç›®ï¼Œé¿å…ä¸äººæ’è½¦ã€‚



åŒå­¦ä»¬ï¼Œåœ¨å‰ä¸¤å¤©æˆ‘ä»¬å­¦ä¹ äº†Linuxæ“ä½œç³»ç»Ÿçš„å¸¸è§å‘½ä»¤ä»¥åŠå¦‚ä½•åœ¨Linuxä¸Šéƒ¨ç½²ä¸€ä¸ªå•ä½“é¡¹ç›®ã€‚å¤§å®¶æƒ³ä¸€æƒ³è‡ªå·±æœ€å¤§çš„æ„Ÿå—æ˜¯ä»€ä¹ˆï¼Ÿ

æˆ‘ç›¸ä¿¡ï¼Œé™¤äº†ä¸ªåˆ«å¤©èµ‹å¼‚ç¦€çš„åŒå­¦ä»¥å¤–ï¼Œå¤§å¤šæ•°åŒå­¦éƒ½ä¼šæœ‰ç›¸åŒçš„æ„Ÿå—ï¼Œé‚£å°±æ˜¯éº»çƒ¦ã€‚æ ¸å¿ƒä½“ç°åœ¨ä¸‰ç‚¹ï¼š

- å‘½ä»¤å¤ªå¤šäº†ï¼Œè®°ä¸ä½
- è½¯ä»¶å®‰è£…åŒ…åå­—å¤æ‚ï¼Œä¸çŸ¥é“å»å“ªé‡Œæ‰¾
- å®‰è£…å’Œéƒ¨ç½²æ­¥éª¤å¤æ‚ï¼Œå®¹æ˜“å‡ºé”™

å…¶å®ä¸Šè¿°é—®é¢˜ä¸ä»…ä»…æ˜¯æ–°æ‰‹ï¼Œå³ä¾¿æ˜¯è¿ç»´åœ¨å®‰è£…ã€éƒ¨ç½²çš„æ—¶å€™ä¸€æ ·ä¼šè§‰å¾—éº»çƒ¦ã€å®¹æ˜“å‡ºé”™ã€‚

ç‰¹åˆ«æ˜¯æˆ‘ä»¬å³å°†è¿›å…¥å¾®æœåŠ¡é˜¶æ®µå­¦ä¹ ï¼Œå¾®æœåŠ¡é¡¹ç›®åŠ¨è¾„å°±æ˜¯å‡ åå°ã€ä¸Šç™¾å°æœåŠ¡éœ€è¦éƒ¨ç½²ï¼Œæœ‰äº›å¤§å‹é¡¹ç›®ç”šè‡³è¾¾åˆ°æ•°ä¸‡å°æœåŠ¡ã€‚è€Œ**ç”±äºæ¯å°æœåŠ¡å™¨çš„è¿è¡Œç¯å¢ƒä¸åŒï¼Œä½ å†™å¥½çš„å®‰è£…æµç¨‹ã€éƒ¨ç½²è„šæœ¬å¹¶ä¸ä¸€å®šåœ¨æ¯ä¸ªæœåŠ¡å™¨éƒ½èƒ½æ­£å¸¸è¿è¡Œ**ï¼Œç»å¸¸ä¼šå‡ºé”™ã€‚è¿™å°±ç»™ç³»ç»Ÿçš„éƒ¨ç½²è¿ç»´å¸¦æ¥äº†å¾ˆå¤šå›°éš¾ã€‚

é‚£ä¹ˆï¼Œæœ‰æ²¡æœ‰ä¸€ç§æŠ€æœ¯èƒ½å¤Ÿé¿å…éƒ¨ç½²å¯¹æœåŠ¡å™¨ç¯å¢ƒçš„ä¾èµ–ï¼Œå‡å°‘å¤æ‚çš„éƒ¨ç½²æµç¨‹å‘¢ï¼Ÿ

ç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬ä»Šå¤©è¦å­¦ä¹ çš„**Docker**æŠ€æœ¯ã€‚ä½ ä¼šå‘ç°ï¼Œæœ‰äº†Dockerä»¥åé¡¹ç›®çš„éƒ¨ç½²å¦‚ä¸èˆ¬é¡ºæ»‘ï¼Œå¤§å¤§å‡å°‘äº†è¿ç»´å·¥ä½œé‡ã€‚

å³ä¾¿ä½ å¯¹Linuxä¸ç†Ÿæ‚‰ï¼Œä½ ä¹Ÿèƒ½**è½»æ¾éƒ¨ç½²å„ç§å¸¸è§è½¯ä»¶ã€Javaé¡¹ç›®**ã€‚

é€šè¿‡ä»Šå¤©çš„å­¦ä¹ ï¼Œå¸Œæœ›å¤§å®¶èƒ½è¾¾æˆä¸‹é¢çš„å­¦ä¹ ç›®æ ‡ï¼š

- èƒ½åˆ©ç”¨Dockeréƒ¨ç½²å¸¸è§è½¯ä»¶
- èƒ½åˆ©ç”¨Dockeræ‰“åŒ…å¹¶éƒ¨ç½²Javaåº”ç”¨
- ç†è§£Dockeræ•°æ®å·çš„åŸºæœ¬ä½œç”¨
- èƒ½çœ‹æ‡‚DockerComposeæ–‡ä»¶



# é•œåƒå’Œå®¹å™¨çš„åŒºåˆ«

![image-20241125172008073](./Docker-Learning-Local.assets/image-20241125172008073.png)

åœ¨Dockerä¸­ï¼Œ**é•œåƒ**å’Œ**å®¹å™¨**æ˜¯ä¸¤ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼Œå®ƒä»¬ç›¸äº’å…³è”ä½†æœ‰ä¸åŒçš„ç”¨é€”å’Œç‰¹æ€§ã€‚å¯ä»¥ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢æ¥ç†è§£è¿™ä¸¤ä¸ªæ¦‚å¿µï¼š

### 1. **Dockeré•œåƒ (Image)**
- **å®šä¹‰**ï¼šé•œåƒæ˜¯ä¸€ä¸ª**é™æ€çš„**ã€**åªè¯»çš„**æ¨¡æ¿ï¼ŒåŒ…å«äº†è¿è¡Œåº”ç”¨æ‰€éœ€çš„æ‰€æœ‰ä¾èµ–ã€åº“æ–‡ä»¶ã€é…ç½®ä»¥åŠæ–‡ä»¶ç³»ç»Ÿç­‰ã€‚å®ƒæ˜¯ç”¨äºåˆ›å»ºDockerå®¹å™¨çš„åŸºç¡€ã€‚
- **ä½œç”¨**ï¼šé•œåƒç±»ä¼¼äºè™šæ‹Ÿæœºçš„å¿«ç…§æˆ–ISOæ–‡ä»¶ï¼Œå®ƒå°è£…äº†æ“ä½œç³»ç»Ÿç¯å¢ƒå’Œåº”ç”¨ç¨‹åºçš„è¿è¡Œç¯å¢ƒï¼Œå¯ä»¥è·¨å¹³å°è¿è¡Œã€‚é•œåƒåŒ…å«äº†å¯åŠ¨å®¹å™¨æ—¶æ‰€éœ€è¦çš„æ‰€æœ‰ä¿¡æ¯ã€‚
- **ä¸å¯å˜æ€§**ï¼šé•œåƒä¸€æ—¦åˆ›å»ºå°±æ— æ³•æ›´æ”¹ï¼Œé™¤éé€šè¿‡åˆ›å»ºæ–°çš„é•œåƒå±‚è¿›è¡Œä¿®æ”¹ã€‚å› æ­¤ï¼Œæ¯æ¬¡ä¿®æ”¹ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„é•œåƒç‰ˆæœ¬ã€‚
- **å±‚æ¬¡ç»“æ„**ï¼šDockeré•œåƒç”±å¤šä¸ªå±‚ï¼ˆlayerï¼‰æ„æˆï¼Œè¿™äº›å±‚æ˜¯æ–‡ä»¶ç³»ç»Ÿçš„å¢é‡å˜åŒ–ï¼Œæ¯ä¸€å±‚éƒ½å¯ä»¥å¤ç”¨ï¼Œä¼˜åŒ–äº†å­˜å‚¨ç©ºé—´å’ŒåŠ è½½é€Ÿåº¦ã€‚

### 2. **Dockerå®¹å™¨ (Container)**
- **å®šä¹‰**ï¼šå®¹å™¨æ˜¯é•œåƒçš„ä¸€ä¸ª**è¿è¡Œå®ä¾‹**ã€‚å®ƒæ˜¯ä¸€ä¸ªè½»é‡çº§çš„ã€ç‹¬ç«‹çš„æ‰§è¡Œç¯å¢ƒï¼Œå¯ä»¥çœ‹ä½œæ˜¯è¿è¡Œæ—¶çš„Dockeré•œåƒã€‚å®¹å™¨è¿è¡Œæ—¶ä¼šæœ‰ä¸€ä¸ªå¯è¯»å†™çš„å±‚ï¼Œå…è®¸åœ¨å…¶ä¸­è¿›è¡Œæ“ä½œã€‚
- **ä½œç”¨**ï¼šå®¹å™¨æä¾›äº†ä¸€ä¸ªéš”ç¦»çš„è¿è¡Œç¯å¢ƒï¼Œé‡Œé¢è¿è¡Œç€åº”ç”¨ç¨‹åºå’Œæ‰€æœ‰ä¾èµ–ã€‚é€šè¿‡å®¹å™¨ï¼Œå¯ä»¥ç¡®ä¿åº”ç”¨ç¨‹åºåœ¨ä¸åŒçš„ç¯å¢ƒï¼ˆå¦‚å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ï¼‰ä¸‹çš„è¡Œä¸ºä¸€è‡´æ€§ã€‚
- **åŠ¨æ€æ€§**ï¼šå®¹å™¨æ˜¯åŠ¨æ€çš„ï¼Œå¯ä»¥åˆ›å»ºã€å¯åŠ¨ã€åœæ­¢ã€é”€æ¯ã€‚å½“ä¸€ä¸ªå®¹å™¨è¿è¡Œæ—¶ï¼Œå®ƒå¯ä»¥è¿›è¡Œä¿®æ”¹å’Œæ“ä½œï¼Œä½†è¿™äº›ä¿®æ”¹ä¸ä¼šå½±å“åˆ°é•œåƒæœ¬èº«ã€‚å®¹å™¨åœæ­¢åï¼Œæ‰€æœ‰å¯¹å®¹å™¨çš„æ›´æ”¹å¯ä»¥ä¿å­˜ä¸ºæ–°çš„é•œåƒï¼Œä¹Ÿå¯ä»¥ä¸¢å¼ƒã€‚
- **éš”ç¦»æ€§**ï¼šå®¹å™¨ä¸å®¿ä¸»ç³»ç»Ÿä»¥åŠå…¶ä»–å®¹å™¨ä¹‹é—´ç›¸äº’éš”ç¦»ï¼Œè¿™ç§éš”ç¦»ä¸ä»…ä½“ç°åœ¨æ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œè¿˜åŒ…æ‹¬ç½‘ç»œã€è¿›ç¨‹ç­‰èµ„æºã€‚

### 3. **é•œåƒä¸å®¹å™¨çš„å…³ç³»**
- **é™æ€ vs. åŠ¨æ€**ï¼šé•œåƒæ˜¯é™æ€çš„ï¼Œåªè¯»çš„ï¼Œä½œä¸ºåˆ›å»ºå®¹å™¨çš„æ¨¡æ¿ï¼›å®¹å™¨æ˜¯åŠ¨æ€çš„ï¼Œå¯ä»¥åœ¨å…¶ä¸­è¿è¡Œåº”ç”¨ï¼Œè¯»å†™æ•°æ®ã€‚
- **åˆ›å»ºå…³ç³»**ï¼šå®¹å™¨æ˜¯ä»é•œåƒåˆ›å»ºå‡ºæ¥çš„ã€‚ä½ å¯ä»¥å°†é•œåƒçœ‹ä½œæ˜¯è“å›¾ï¼Œè€Œå®¹å™¨æ˜¯æ ¹æ®è“å›¾æ„å»ºå‡ºçš„å®ä¾‹ã€‚ä¸€ä¸ªé•œåƒå¯ä»¥åˆ›å»ºå¤šä¸ªå®¹å™¨ã€‚
- **æŒä¹…åŒ– vs. ä¸´æ—¶è¿è¡Œ**ï¼šé•œåƒæ˜¯é•¿æœŸä¿å­˜çš„ï¼Œè€Œå®¹å™¨å¯ä»¥æ˜¯çŸ­æš‚çš„ï¼ˆæ¯”å¦‚è¿è¡ŒæŸä¸ªä»»åŠ¡åè¢«é”€æ¯ï¼‰ï¼Œä¹Ÿå¯ä»¥è¿è¡Œå¾ˆé•¿æ—¶é—´ã€‚

### 4. **å®ä¾‹åŒ–è¿‡ç¨‹**
- åˆ›å»ºä¸€ä¸ªå®¹å™¨æ—¶ï¼ŒDockerä¼šï¼š
  1. ä»é•œåƒä¸­å¤åˆ¶æ‰€æœ‰æ–‡ä»¶å±‚ã€‚
  2. ä¸ºè¯¥å®¹å™¨åˆ›å»ºä¸€ä¸ªæ–°çš„å¯å†™å±‚ï¼Œå…è®¸å¯¹å®¹å™¨å†…çš„æ–‡ä»¶è¿›è¡Œä¿®æ”¹ã€‚
  3. å¯åŠ¨è¯¥å®¹å™¨å¹¶å¼€å§‹æ‰§è¡Œé•œåƒä¸­çš„åº”ç”¨ã€‚

### ä¸¾ä¾‹è¯´æ˜
- **é•œåƒ**å¯ä»¥ç±»æ¯”ä¸ºåº”ç”¨ç¨‹åºçš„å®‰è£…åŒ…ï¼ˆå¦‚ISOæ–‡ä»¶ï¼‰ï¼Œå®ƒåŒ…å«äº†æ“ä½œç³»ç»Ÿã€åº”ç”¨ä»¥åŠå…¶ä¾èµ–é¡¹ã€‚
- **å®¹å™¨**åˆ™ç±»ä¼¼äºä»è¯¥å®‰è£…åŒ…å®‰è£…å¹¶è¿è¡Œçš„åº”ç”¨ç¨‹åºå®ä¾‹ï¼Œå®ƒæ˜¯é•œåƒçš„å®é™…è¿è¡Œä½“ã€‚ä½ å¯ä»¥åŒæ—¶è¿è¡Œå¤šä¸ªå®¹å™¨ï¼Œè€Œæ¯ä¸ªå®¹å™¨éƒ½æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼ŒåŸºäºåŒä¸€ä¸ªé•œåƒæ„å»ºã€‚

### æ€»ç»“ 
- **é•œåƒ**æ˜¯åº”ç”¨çš„é™æ€æ¨¡æ¿ï¼Œæä¾›å®¹å™¨è¿è¡Œæ‰€éœ€çš„ç¯å¢ƒå’Œä¾èµ–ã€‚
- **å®¹å™¨**æ˜¯é•œåƒçš„è¿è¡Œå®ä¾‹ï¼ŒåŠ¨æ€åœ°è¿è¡Œåº”ç”¨ç¨‹åºå¹¶æä¾›éš”ç¦»ç¯å¢ƒã€‚





# å‡†å¤‡Linuxç¯å¢ƒ

é¦–å…ˆï¼Œæˆ‘ä»¬è¦å‡†å¤‡ä¸€ä¸ªLinuxçš„ç³»ç»Ÿï¼Œæˆæœ¬æœ€ä½çš„æ–¹å¼å°±æ˜¯åœ¨æœ¬åœ°å®‰è£…ä¸€å°è™šæ‹Ÿæœºã€‚ä¸ºäº†ç»Ÿä¸€å­¦ä¹ ç¯å¢ƒï¼Œä¸ç®¡æ˜¯ä½¿ç”¨MacOSè¿˜æ˜¯Windowsç³»ç»Ÿçš„åŒå­¦ï¼Œéƒ½å»ºè®®å®‰è£…ä¸€å°è™šæ‹Ÿæœºã€‚

windowsé‡‡ç”¨VMwareï¼ŒMacåˆ™é‡‡ç”¨Fusion

## 1.1.å®‰è£…VMware

VMwareæ˜¯ä¸šç•Œæœ€å¥½ç”¨çš„è™šæ‹Ÿæœºè½¯ä»¶ä¹‹ä¸€ã€‚

windowsç‰ˆæœ¬çš„ç½‘ç«™å¦‚ä¸‹ï¼š

https://www.vmware.com/cn/products/workstation-pro/workstation-pro-evaluation.html

Macä¸‹ä¹Ÿæœ‰å¯¹åº”ç‰ˆæœ¬ï¼Œå«åšVMware Fusionï¼š

https://www.vmware.com/cn/products/fusion.html

ç‰¹åˆ«æ³¨æ„ï¼ŒWindows10ä»¥ä¸Šç‰ˆæœ¬æ“ä½œç³»ç»Ÿéœ€è¦ä¸‹è½½å®‰è£…VMware Workstation Pro16åŠä»¥ä¸Šç‰ˆæœ¬ï¼Œå®‰è£…æ–¹å¼æ­¤å¤„ç•¥ã€‚

å¦‚æœè‡ªå·±ç”µè„‘ä¸Šå·²ç»æœ‰äº†ä½ç‰ˆæœ¬çš„VMwareï¼Œåˆ™éœ€è¦å…ˆå¸è½½ï¼Œå†é‡æ–°å®‰è£…ã€‚å¸è½½è¿‡ç¨‹æ¯”è¾ƒéº»çƒ¦ã€‚

### 1.1.1.å¸è½½æ—§ç‰ˆVMwareï¼ˆå¯é€‰ï¼‰

é¦–å…ˆï¼Œåœ¨æ§åˆ¶é¢æ¿æ‰¾åˆ°ç¨‹åºå’ŒåŠŸèƒ½é€‰é¡¹ï¼Œæ‰¾åˆ°VMwareï¼Œè¿›è¡Œå¸è½½æ“ä½œï¼š

![img](./Docker-Learning-Local.assets/1732518736069-59-1732518818910-312.png)

å¼¹å‡ºç¡®è®¤æ¡†, ç‚¹å‡»"ä¸‹ä¸€æ­¥":

![img](./Docker-Learning-Local.assets/1732518736065-1-1732518818911-313.png)

ä¸‹ä¸€æ­¥ä¹‹å, é€‰æ‹©åˆ é™¤:

![img](./Docker-Learning-Local.assets/1732518736065-2-1732518818911-314.png)

æ¥ä¸‹æ¥ï¼ŒæŒ‰ç…§æç¤ºå®Œæˆå¸è½½æ“ä½œå³å¯ã€‚

å¸è½½å®Œæˆåï¼Œè¿˜éœ€è¦çœ‹çœ‹VMwareçš„å®‰è£…ç›®å½•æ˜¯å¦æœ‰æ—§æ•°æ®ï¼Œä¸€å¹¶æ¸…ç†æ‰ã€‚

æ¯”å¦‚å®‰è£…åœ¨**Cç›˜çš„****Program Files****(****x86****)**ï¼š

![img](./Docker-Learning-Local.assets/1732518736066-3-1732518818911-316.png)

åˆ™éœ€è¦ç›´æ¥åˆ é™¤æ•´ä¸ªVMwareç›®å½•ï¼š

![img](./Docker-Learning-Local.assets/1732518736066-4-1732518818911-315.png)

æ¥ä¸‹æ¥è¦æ¸…ç†æ³¨å†Œè¡¨ï¼š

é¦–å…ˆï¼ŒæŒ‰ä½Windows + R , åœ¨å¼¹å‡ºæ¡†ä¸­è¾“å…¥ "regedit" è°ƒå‡ºæ³¨å†Œè¡¨ï¼š

![img](./Docker-Learning-Local.assets/1732518736066-5-1732518818911-317.png)

è¿›å…¥æ³¨å†Œè¡¨ç¼–è¾‘å™¨ï¼Œå¦‚å›¾ï¼š

![img](./Docker-Learning-Local.assets/1732518736066-6-1732518818911-320.png)

æ‰“å¼€**`HKEY_CURRENT_USER`**æ–‡ä»¶å¤¹ï¼Œæ‰¾åˆ°**`Software`**æ–‡ä»¶å¤¹å¹¶æ‰“å¼€

![img](./Docker-Learning-Local.assets/1732518736066-7-1732518818911-326.png)

æ‰¾åˆ°â€œVMware.Incâ€ï¼Œå³é”®åˆ é™¤ï¼š

![img](./Docker-Learning-Local.assets/1732518736066-8-1732518818911-318.png)

### 1.1.2.å®‰è£…VMware

å®‰è£…æ­¥éª¤ç•¥ã€‚ã€‚

å®‰è£…ä»¥åå¯ä»¥å…è´¹è¯•ç”¨ï¼Œå¤§å®¶å¯ä»¥å»å®˜ç½‘è´­ä¹°æ­£ç‰ˆè®¸å¯è¯ï¼Œæˆ–è€…å»ç½‘ä¸Šçœ‹çœ‹æœ‰æ²¡æœ‰å¥½å¿ƒäººèµ é€ä½ ä¸€ä¸ªè®¸å¯è¯ã€‚å¯åŠ¨åçš„ç•Œé¢å¦‚å›¾æ‰€ç¤ºï¼š

![img](./Docker-Learning-Local.assets/1732518736066-9-1732518818911-319.png)

### 1.1.3.å¸¸è§é”™è¯¯

å¦‚æœVMwareè™šæ‹Ÿæœºè¿è¡ŒæŠ¥é”™ï¼Œä¾‹å¦‚ï¼š

![img](./Docker-Learning-Local.assets/1732518736066-10-1732518818911-321.png)

è¿™ä¸ªæ˜¯ç”±äºè‹±ç‰¹å°”çš„è™šæ‹ŸåŒ–æŠ€æœ¯, æ²¡æœ‰å¼€å¯, éœ€è¦è¿›å…¥ç³»ç»Ÿçš„BIOSç•Œé¢ , å¼€å¯è‹±ç‰¹å°”çš„è™šæ‹ŸåŒ–æŠ€æœ¯ ; ä¸åŒçš„ç”µè„‘å‹å· , è¿›å…¥BIOSç•Œé¢çš„æ–¹å¼ä¸åŒ, éœ€è¦ç™¾åº¦æŸ¥è¯¢ä¸€ä¸‹è‡ªå·±ç”µè„‘çš„å‹å· , å¦‚ä½•è¿›BIOS ;

windows10ç³»ç»Ÿå¯ä»¥å‚è€ƒ: https://blog.csdn.net/biu_code/article/details/107504627

ä»¥ThinkPadä¸ºä¾‹ï¼Œå¦‚å›¾ï¼š

![img](./Docker-Learning-Local.assets/1732518736066-11-1732518818911-324.png)

## 1.2.åˆ›å»ºè™šæ‹Ÿæœº

Centos7æ˜¯æ¯”è¾ƒå¸¸ç”¨çš„ä¸€ä¸ªLinuxå‘è¡Œç‰ˆæœ¬ï¼Œåœ¨å›½å†…çš„ä½¿ç”¨æ¯”ä¾‹è¿˜æ˜¯æ¯”è¾ƒé«˜çš„ã€‚

å¤§å®¶é¦–å…ˆè¦ä¸‹è½½ä¸€ä¸ªCentos7çš„isoæ–‡ä»¶ï¼Œæˆ‘åœ¨èµ„æ–™ä¸­ç»™å¤§å®¶å‡†å¤‡äº†ä¸€ä¸ªminiçš„ç‰ˆæœ¬ï¼Œä½“ç§¯ä¸åˆ°1Gï¼Œæ¨èå¤§å®¶ä½¿ç”¨ï¼š

![img](./Docker-Learning-Local.assets/1732518736066-12-1732518818911-323.png)

æˆ‘ä»¬åœ¨VMwareã€Šä¸»é¡µã€‹ç•Œé¢ä¸­ç‚¹å‡»ã€Šåˆ›å»ºæ–°çš„è™šæ‹Ÿæœºã€‹æŒ‰é’®ï¼š

![img](./Docker-Learning-Local.assets/1732518736066-13-1732518818911-322.png)

ç„¶åä¼šå¼¹å‡ºä¸€ä¸ªçª—å£ï¼Œæˆ‘ä»¬ç›´æ¥ç‚¹å‡»ä¸‹ä¸€æ­¥ï¼š

![img](./Docker-Learning-Local.assets/1732518736066-14-1732518818911-325.png)

ç„¶åé¡µé¢ä¸­é€‰æ‹©ä½ å‡†å¤‡å¥½çš„ISOæ–‡ä»¶ï¼Œç»§ç»­ç‚¹å‡»ä¸‹ä¸€æ­¥ï¼š

![img](./Docker-Learning-Local.assets/1732518736066-15-1732518818911-327.png)

ç„¶åå¡«å†™`è™šæ‹Ÿæœºçš„åç§°`ä»¥åŠè™šæ‹Ÿæœºå°†æ¥`ä¿å­˜çš„ä½ç½®`ï¼š

![img](./Docker-Learning-Local.assets/1732518736066-16-1732518818911-328.png)

å†æ¬¡ä¸‹ä¸€æ­¥ï¼Œå¡«å†™è™šæ‹Ÿæœºç£ç›˜å¤§å°ã€‚è¿™é‡Œå»ºè®®ç»™å¤§ä¸€ç‚¹ï¼Œå¦åˆ™å°†æ¥ä¸å¤Ÿç”¨è°ƒæ•´èµ·æ¥éº»çƒ¦ã€‚è€Œä¸”è¿™é‡Œè®¾ç½®å¤§å°å¹¶ä¸æ˜¯ç«‹åˆ»å ç”¨è¿™ä¹ˆå¤šï¼Œè€Œæ˜¯è®¾ç½®ä¸€ä¸ªä¸Šé™ï¼š

![img](./Docker-Learning-Local.assets/1732518736066-17-1732518818911-329.png)

ç»§ç»­ä¸‹ä¸€æ­¥ï¼Œç„¶åé€‰æ‹©è™šæ‹Ÿæœºç¡¬ä»¶è®¾ç½®ï¼š

![img](./Docker-Learning-Local.assets/1732518736066-18-1732518818911-330.png)

åœ¨å¼¹å‡ºçš„çª—å£ä¸­è®¾ç½®è™šæ‹Ÿæœºç¡¬ä»¶ï¼Œå»ºè®®CPUç»™åˆ°4æ ¸ï¼Œå†…å­˜ç»™åˆ°8Gï¼š

![img](./Docker-Learning-Local.assets/1732518736066-19-1732518818911-331.png)

é…ç½®å®Œæˆåï¼Œç‚¹å‡»`å…³é—­`ï¼Œå›åˆ°ä¸Šä¸€é¡µé¢ï¼Œç»§ç»­ç‚¹å‡»`å®Œæˆ`ï¼š

![img](./Docker-Learning-Local.assets/1732518736066-20-1732518818911-334.png)

è™šæ‹Ÿæœºå°±åˆ›å»ºå®Œæ¯•äº†ï¼š

![img](./Docker-Learning-Local.assets/1732518736066-21-1732518818911-333.png)

## 1.3.å®‰è£…Centos7

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯åŠ¨åˆšåˆšåˆ›å»ºçš„è™šæ‹Ÿæœºï¼Œå¼€å§‹å®‰è£…Centos7ç³»ç»Ÿï¼š

![img](./Docker-Learning-Local.assets/1732518736066-22-1732518818911-332.png)

å¯åŠ¨åéœ€è¦é€‰æ‹©å®‰è£…èœå•ï¼Œå°†é¼ æ ‡ç§»å…¥é»‘çª—å£ä¸­åï¼Œå°†æ— æ³•å†ä½¿ç”¨é¼ æ ‡ï¼Œéœ€è¦æŒ‰ä¸Šä¸‹é”®é€‰æ‹©èœå•ã€‚é€‰ä¸­Install Centos 7 åæŒ‰ä¸‹å›è½¦ï¼š

![img](./Docker-Learning-Local.assets/1732518736066-23-1732518818911-335.png)

ç„¶åä¼šæç¤ºæˆ‘ä»¬æŒ‰ä¸‹enteré”®ç»§ç»­ï¼š

![img](./Docker-Learning-Local.assets/1732518736066-24-1732518818911-336.png)

è¿‡ä¸€ä¼šå„¿åï¼Œä¼šè¿›å…¥è¯­è¨€é€‰æ‹©èœå•ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨é¼ æ ‡é€‰æ‹©ã€‚é€‰æ‹©ä¸­æ–‡-ç®€ä½“ä¸­æ–‡ï¼Œç„¶åç»§ç»­ï¼š

![img](./Docker-Learning-Local.assets/1732518736066-25-1732518818911-337.png)

æ¥ä¸‹æ¥ï¼Œä¼šè¿›å…¥å®‰è£…é…ç½®é¡µé¢ï¼š

![img](./Docker-Learning-Local.assets/1732518736067-26-1732518818911-339.png)

é¼ æ ‡å‘ä¸‹æ»šåŠ¨åï¼Œæ‰¾åˆ°ç³»ç»Ÿ-å®‰è£…ä½ç½®é…ç½®ï¼Œç‚¹å‡»ï¼š

![img](./Docker-Learning-Local.assets/1732518736067-27-1732518818911-338.png)

é€‰æ‹©åˆšåˆšæ·»åŠ çš„ç£ç›˜ï¼Œå¹¶ç‚¹å‡»å®Œæˆï¼š

![img](./Docker-Learning-Local.assets/1732518736067-28-1732518818911-340.png)

ç„¶åå›åˆ°é…ç½®é¡µé¢ï¼Œè¿™æ¬¡ç‚¹å‡»ã€Šç½‘ç»œå’Œä¸»æœºåã€‹ï¼š

![img](./Docker-Learning-Local.assets/1732518736067-29-1732518818911-343.png)

åœ¨ç½‘ç»œé¡µé¢åšä¸‹é¢çš„å‡ ä»¶äº‹æƒ…ï¼š

1. ä¿®æ”¹ä¸»æœºåä¸ºè‡ªå·±å–œæ¬¢çš„ä¸»æœºåï¼Œä¸è¦å‡ºç°ä¸­æ–‡å’Œç‰¹æ®Šå­—ç¬¦ï¼Œå»ºè®®ç”¨localhost
2. ç‚¹å‡»åº”ç”¨
3. å°†ç½‘ç»œè¿æ¥æ‰“å¼€
4. ç‚¹å‡»é…ç½®ï¼Œè®¾ç½®è¯¦ç»†ç½‘ç»œä¿¡æ¯

![img](./Docker-Learning-Local.assets/1732518736067-30-1732518818911-341.png)

æœ€å¥½ç”¨ä¸€ä¸ªæˆªå›¾è½¯ä»¶ï¼Œè®°ä½ä¸Šå›¾ä¸­çš„ç½‘ç»œè¯¦ç»†ä¿¡æ¯ï¼Œæ¥ä¸‹æ¥çš„é…ç½®è¦å‚è€ƒï¼š

![img](./Docker-Learning-Local.assets/1732518736067-31-1732518818911-342.png)

ç‚¹å‡»é…ç½®æŒ‰é’®åï¼Œæˆ‘ä»¬éœ€è¦æŠŠç½‘å¡åœ°å€æ”¹ä¸ºé™æ€IPï¼Œè¿™æ ·å¯ä»¥é¿å…æ¯æ¬¡å¯åŠ¨è™šæ‹ŸæœºIPéƒ½å˜åŒ–ã€‚æ‰€æœ‰é…ç½®ç…§æ¬ä½ è‡ªå·±æˆªå›¾çš„ç½‘ç»œä¿¡æ¯å¡«å†™ï¼Œä¸è¦ç…§æŠ„æˆ‘çš„ï¼š

![img](./Docker-Learning-Local.assets/1732518736067-32-1732518818912-344.png)

ä¸Šå›¾ä¸­çš„å››ä¸ªä¿¡æ¯å‚è€ƒä¹‹å‰çš„**ä»¥å¤ªç½‘****(ens33)****ç½‘å¡**çš„æˆªå›¾ï¼Œä¸è¦ç…§æ¬æˆ‘çš„æ¥å†™ã€‚

æœ€åï¼Œç‚¹å‡»å®ŒæˆæŒ‰é’®ï¼š

![img](./Docker-Learning-Local.assets/1732518736067-33-1732518818912-345.png)

å›åˆ°é…ç½®ç•Œé¢åï¼Œç‚¹å‡»`å¼€å§‹å®‰è£…`ï¼š

![img](./Docker-Learning-Local.assets/1732518736067-34-1732518818912-347.png)

æ¥ä¸‹æ¥éœ€è¦è®¾ç½®rootå¯†ç ï¼š

![img](./Docker-Learning-Local.assets/1732518736067-35-1732518818912-346.png)

å¡«å†™ä½ è¦ä½¿ç”¨çš„rootå¯†ç ï¼Œç„¶åç‚¹å‡»å®Œæˆï¼š

![img](./Docker-Learning-Local.assets/1732518736067-36-1732518818912-348.png)

æ¥ä¸‹æ¥ï¼Œè€å¿ƒç­‰å¾…å®‰è£…å³å¯ã€‚

![img](./Docker-Learning-Local.assets/1732518736067-37-1732518818912-353.png)

ç­‰å¾…å®‰è£…å®Œæˆåï¼Œç‚¹å‡»**é‡å¯**ï¼š

![img](./Docker-Learning-Local.assets/1732518736067-38-1732518818912-349.png)

è€å¿ƒç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œä¸è¦åšä»»ä½•æ“ä½œï¼Œè™šæ‹Ÿæœºå³å¯å¯åŠ¨å®Œæ¯•ï¼š

![img](./Docker-Learning-Local.assets/1732518736067-39-1732518818912-350.png)

è¾“å…¥ç”¨æˆ·årootï¼Œç„¶åç‚¹å‡»å›è½¦ï¼Œä¼šè¦æ±‚ä½ è¾“å…¥å¯†ç ï¼š

![img](./Docker-Learning-Local.assets/1732518736067-40-1732518818912-351.png)

æ­¤æ—¶ä½ è¦è¾“å…¥å¯†ç ï¼Œä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯å¯†ç æ˜¯**éšè—**çš„ï¼Œè¾“å…¥äº†ä¹Ÿçœ‹ä¸è§ã€‚æ‰€ä»¥æ”¾å¿ƒè¾“å…¥ï¼Œå®Œæˆåå›è½¦å³å¯ï¼š

![img](./Docker-Learning-Local.assets/1732518736067-41-1732518818912-352.png)

åªè¦å¯†ç è¾“å…¥æ­£ç¡®ï¼Œå°±å¯ä»¥æ­£å¸¸ç™»å½•ã€‚æ­¤æ—¶å¯ä»¥ç”¨å‘½ä»¤æµ‹è¯•è™šæ‹Ÿæœºç½‘ç»œæ˜¯å¦ç•…é€šï¼š

```Bash
ping www.baidu.com
```

å¦‚æœçœ‹åˆ°è¿™æ ·çš„ç»“æœä»£è¡¨ç½‘ç»œç•…é€šï¼š

![img](./Docker-Learning-Local.assets/1732518736067-42-1732518818912-355.png)

é»˜è®¤pingå‘½ä»¤ä¼šæŒç»­æ‰§è¡Œï¼ŒæŒ‰ä¸‹`CTRL `+ `C`åå‘½ä»¤å³å¯åœæ­¢ã€‚

## 1.4.è®¾ç½®è™šæ‹Ÿæœºå¿«ç…§

åœ¨è™šæ‹Ÿæœºå®‰è£…å®Œæˆåï¼Œæœ€å¥½ç«‹åˆ»è®¾ç½®ä¸€ä¸ªå¿«ç…§ï¼Œè¿™æ ·ä¸€æ—¦å°†æ¥è™šæ‹Ÿæœºå‡ºç°é—®é¢˜ï¼Œå¯ä»¥å¿«é€Ÿæ¢å¤ã€‚

æˆ‘ä»¬å…ˆåœæ­¢è™šæ‹Ÿæœºï¼Œç‚¹å‡»VMwareé¡¶éƒ¨èœå•ä¸­çš„`æš‚åœ`**`ä¸‹æ‹‰é€‰æ¡†`**ï¼Œé€‰æ‹©`å…³é—­å®¢æˆ·æœº`ï¼š

![img](./Docker-Learning-Local.assets/1732518736067-43-1732518818912-354.png)

æ¥ç€ï¼Œç‚¹å‡»VMwareèœå•ä¸­çš„ğŸ”§æŒ‰é’®:

![img](./Docker-Learning-Local.assets/1732518736067-44-1732518818912-356.png)

ç„¶ååœ¨å¼¹å‡ºçš„å¿«ç…§ç®¡ç†çª—å£ä¸­ï¼Œç‚¹å‡»**æ‹æ‘„å¿«ç…§**ï¼Œå¡«å†™æ–°çš„å¿«ç…§ä¿¡æ¯ï¼š

![img](./Docker-Learning-Local.assets/1732518736067-45-1732518818912-357.png)

å¿«ç…§æ‹æ‘„å®Œæˆäº†ï¼è€Œä¸”æˆ‘ä»¬å¯ä»¥åœ¨ä¸åŒé˜¶æ®µæ‹æ‘„å¤šä¸ªä¸åŒå¿«ç…§ä½œä¸ºå¤‡ä»½ï¼Œæ–¹ä¾¿åæœŸæ¢å¤æ•°æ®ã€‚

å‡å¦‚ä»¥åè™šæ‹Ÿæœºæ–‡ä»¶å—æŸï¼Œéœ€è¦æ¢å¤åˆ°åˆå§‹çŠ¶æ€çš„è¯ï¼Œå¯ä»¥é€‰ä¸­è¦æ¢å¤çš„å¿«ç…§ï¼Œç‚¹å‡»è½¬åˆ°å³å¯ï¼š

![img](./Docker-Learning-Local.assets/1732518736067-46-1732518818912-358.png)



# SSHå®¢æˆ·ç«¯-MobarXterm

åœ¨VMwareç•Œé¢ä¸­æ“ä½œè™šæ‹Ÿæœºéå¸¸ä¸å‹å¥½ï¼Œæ‰€ä»¥ä¸€èˆ¬æ¨èä½¿ç”¨ä¸“é—¨çš„SSHå®¢æˆ·ç«¯ã€‚å¸‚é¢ä¸Šå¸¸è§çš„æœ‰ï¼š

- Xshellï¼šä¸ªäººå…è´¹ï¼Œå•†ä¸šæ”¶è´¹ï¼Œä¹‹å‰çˆ†å‡ºè¿‡æœ‰éšè—åé—¨ã€‚ä¸æ¨è
- Finshellï¼šåŸºç¡€åŠŸèƒ½å…è´¹ï¼Œé«˜çº§åŠŸèƒ½æ”¶è´¹ï¼ŒåŸºäºJavaï¼Œå†…å­˜å ç”¨è¾ƒé«˜ï¼ˆåœ¨1ä¸ªGå·¦å³ï¼‰ã€‚ä¸æ¨è
- MobarXtermï¼šåŸºç¡€åŠŸèƒ½å…è´¹ã€é«˜çº§åŠŸèƒ½æ”¶è´¹ã€‚å¼€æºã€åŠŸèƒ½å¼ºå¤§ã€å†…å­˜å ç”¨ä½ï¼ˆåªæœ‰10må·¦å³ï¼‰ï¼Œä½†æ˜¯ç•Œé¢ä¸å¤ªæ¼‚äº®ã€‚æ¨èä½¿ç”¨

## 2.1.å®‰è£…MobarXterm

è¿™é‡Œæˆ‘ä»¬ä¼šé€‰æ‹©å†…å­˜å ç”¨è¾ƒä½çš„MobarXtermä½œä¸ºSSHå®¢æˆ·ç«¯ï¼Œå…¶å®˜ç½‘åœ°å€ï¼š

https://mobaxterm.mobatek.net/

å®‰è£…å®Œæˆåç•Œé¢å¦‚å›¾æ‰€ç¤ºï¼š

![img](./Docker-Learning-Local.assets/1732518736067-47-1732518818912-359.png)

ç‚¹å‡»sessionæŒ‰é’®ï¼Œè¿›å…¥ä¼šè¯ç®¡ç†ï¼š

![img](./Docker-Learning-Local.assets/1732518736067-48-1732518818912-360.png)

åœ¨å¼¹å‡ºçš„sessionç®¡ç†é¡µé¢ä¸­ï¼ŒæŒ‰ç…§ä¸‹å›¾å¡«å†™ä¿¡æ¯å¹¶ä¿å­˜ï¼š

![img](./Docker-Learning-Local.assets/1732518736067-49-1732518818912-361.png)

ç‚¹å‡»OKåä¼šæç¤ºä½ æ˜¯ç¬¬ä¸€æ¬¡è¿æ¥ï¼Œè¯¢é—®ä½ æ˜¯ä¿¡ä»»è¿æ¥çš„æœåŠ¡ï¼š

![img](./Docker-Learning-Local.assets/1732518736067-50-1732518818912-362.png)

é€‰æ‹©acceptä¹‹åï¼Œä¼šè¯¢é—®ä½ æ˜¯å¦è¦è®°ä½å¯†ç ï¼Œé€‰æ‹©yesï¼š

![img](./Docker-Learning-Local.assets/1732518736067-51-1732518818912-363.png)

ç´§æ¥ç€éœ€è¦ä½ è®¾ç½®ä¸€ä¸ªMobarXtermçš„å…¨å±€å¯†ç ç”¨äºåšå¯†ç ç®¡ç†ï¼Œå»ºè®®è®¾ç½®ä¸€ä¸ªä¸è™šæ‹Ÿæœºå¯†ç ä¸åŒçš„ï¼š

è¾“å…¥å¯†ç ï¼š

![img](./Docker-Learning-Local.assets/1732518736067-52-1732518818912-365.png)

è¾“å…¥æˆåŠŸåï¼Œå°±ä¼šè¿æ¥æˆåŠŸï¼Œå¹¶è¿›å…¥æ“ä½œç•Œé¢äº†ï¼š

![img](./Docker-Learning-Local.assets/1732518736067-53-1732518818912-364.png)

è¿™é‡Œéœ€è¦åšä¸€äº›åŸºç¡€çš„é…ç½®ï¼š

![img](./Docker-Learning-Local.assets/1732518736067-54-1732518818912-366.png)

## 2.2.é…ç½®é»˜è®¤ç¼–è¾‘å™¨

é¦–å…ˆå»ºè®®è®¾ç½®ä¸€ä¸‹é»˜è®¤ç¼–è¾‘å™¨ï¼Œè¿™æ ·æˆ‘ä»¬é€šè¿‡MobarXtermçš„FTPå·¥å…·æ‰“å¼€æ–‡ä»¶æ—¶ä¼šä»¥æŒ‡å®šçš„ç¼–è¾‘å™¨æ‰“å¼€ï¼Œæ–¹ä¾¿ä¿®æ”¹ã€‚æˆ‘è¿™é‡Œé…ç½®çš„æ˜¯vscodeï¼š

![img](./Docker-Learning-Local.assets/1732518736067-55-1732518818912-367.png)

## 2.3.é…ç½®å³é”®ç²˜è´´

å¤åˆ¶ç²˜è´´æ˜¯å¾ˆå¸¸ç”¨çš„é…ç½®ï¼ŒMobarXtermé»˜è®¤å·¦é”®é€‰ä¸­å³**å¤åˆ¶**ï¼Œä½†æ˜¯éœ€è¦é…ç½®å³é”®ç‚¹å‡»ä¸º**ç²˜è´´ï¼š**

![img](./Docker-Learning-Local.assets/1732518736067-56-1732518818912-368.png)

è¿™æ ·ï¼Œå¤åˆ¶å’Œç²˜è´´å¯ä»¥å…¨éƒ¨é€šè¿‡é¼ æ ‡æ“ä½œï¼Œæ— éœ€æŒ‰é”®ã€‚

## 2.4.SSHé…ç½®

æ¥ä¸‹æ¥è¿˜æœ‰å‡ ä¸ªsshé…ç½®ï¼š

![img](./Docker-Learning-Local.assets/1732518736067-57-1732518818912-369.png)

åˆ†åˆ«æ˜¯ï¼š

- é»˜è®¤çš„ç™»å½•ç”¨æˆ·
- sshä¿æŒè¿æ¥
- å–æ¶ˆè¿æ¥æˆåŠŸåçš„æ¬¢è¿banner

## 2.5.å…³é—­X-ServeræœåŠ¡

å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ²¡æœ‰x-serverçš„éœ€æ±‚ï¼Œå› æ­¤å¯ä»¥é€‰æ‹©ä¸è¦è‡ªå¯åŠ¨ï¼š

![img](./Docker-Learning-Local.assets/1732518736067-58-1732518818912-370.png)



# å®‰è£…Docker

æœ¬å®‰è£…æ•™ç¨‹å‚è€ƒDockerå®˜æ–¹æ–‡æ¡£ï¼Œåœ°å€å¦‚ä¸‹ï¼š

https://docs.docker.com/engine/install/centos/

## 1.å¸è½½æ—§ç‰ˆ

é¦–å…ˆå¦‚æœç³»ç»Ÿä¸­å·²ç»å­˜åœ¨æ—§çš„Dockerï¼Œåˆ™å…ˆå¸è½½ï¼š

```Shell
yum remove docker \
    docker-client \
    docker-client-latest \
    docker-common \
    docker-latest \
    docker-latest-logrotate \
    docker-logrotate \
    docker-engine \
    docker-selinux 
```

## 2.é…ç½®Dockerçš„yumåº“

é¦–å…ˆè¦å®‰è£…ä¸€ä¸ªyumå·¥å…·

```Bash
sudo yum install -y yum-utils device-mapper-persistent-data lvm2
```

#### 	æ³¨æ„ï¼š==yumå‘½ä»¤é”™è¯¯==

##### **CentOS7æ‰§è¡Œyumå‘½ä»¤é‡åˆ°â€œCould not resolve host: mirrorlist.centos.orgï¼› æœªçŸ¥çš„é”™è¯¯â€å¦‚ä½•è§£å†³**

**åŸå› æ˜¯å›½å†…ç½‘ç»œä¸èƒ½è®¿é—®å¤–ç½‘ã€‚æ‰€ä»¥éœ€è¦å°†mirrorlist.centos.orgæ›¿æ¢ä¸ºå›½å†…å¯ä»¥è®¿é—®çš„é•œåƒæºã€‚**

```shell
 curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo
```

**ç„¶åå†æ¸…é™¤yumç¼“å­˜**

```shell
yum clean all
```

**ç„¶åé‡æ–°ç”Ÿæˆç¼“å­˜**

```shell
yum makecache
```



------

**å®‰è£…æˆåŠŸåï¼Œæ‰§è¡Œå‘½ä»¤**ï¼Œ**é…ç½®Dockerçš„yumæº**ï¼ˆå·²æ›´æ–°ä¸ºé˜¿é‡Œäº‘æºï¼‰ï¼š

```Bash
sudo yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo

sudo sed -i 's+download.docker.com+mirrors.aliyun.com/docker-ce+' /etc/yum.repos.d/docker-ce.repo
```

**ç¬¬ä¸€æ¡å‘½ä»¤**ï¼šæ·»åŠ é˜¿é‡Œäº‘çš„ Docker Yum æºé…ç½®ã€‚

**ç¬¬äºŒæ¡å‘½ä»¤**ï¼ˆå¯ä¸æ‰§è¡Œï¼‰ï¼šå°†æ·»åŠ çš„ Yum æºä¸­çš„é»˜è®¤åœ°å€æ›¿æ¢ä¸ºæ›´å¿«çš„é˜¿é‡Œäº‘åœ°å€ï¼Œä»è€Œè¿›ä¸€æ­¥ä¼˜åŒ–ä¸‹è½½å’Œå®‰è£…ä½“éªŒã€‚

æ›´æ–°yumï¼Œå»ºç«‹ç¼“å­˜



```Bash
sudo yum makecache fast
```



## 3.å®‰è£…Docker

æœ€åï¼Œæ‰§è¡Œå‘½ä»¤ï¼Œå®‰è£…Docker

```Bash
yum install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
```

## 4.å¯åŠ¨å’Œæ ¡éªŒ

```Bash
# å¯åŠ¨Docker
systemctl start docker

# åœæ­¢Docker
systemctl stop docker

# é‡å¯
systemctl restart docker

# è®¾ç½®å¼€æœºè‡ªå¯
systemctl enable docker

# æ‰§è¡Œdocker pså‘½ä»¤ï¼Œå¦‚æœä¸æŠ¥é”™ï¼Œè¯´æ˜å®‰è£…å¯åŠ¨æˆåŠŸ
docker ps
```

## 5.==é…ç½®é•œåƒåŠ é€Ÿ==

å¦‚æœ**æœªé…ç½®é•œåƒåŠ é€Ÿ**,åœ¨å½•å–é•œåƒæ—¶åˆ™ä¼š**==æŠ¥é”™==**ï¼š

```bash
 Unable to find image 'mysql:latest' locally docker: Error response from daemon: Get "https://registry-1.docker.io/v2/": net/http: request canceled while waiting for connection (Client.Timeout exceeded while awaiting headers). See 'docker run --help'.
```

é•œåƒåœ°å€å¯èƒ½ä¼šå˜æ›´ï¼Œå¦‚æœå¤±æ•ˆå¯ä»¥ç™¾åº¦æ‰¾æœ€æ–°çš„dockeré•œåƒã€‚

#### **æ³¨æ„**ï¼š**é…ç½®é•œåƒ**æ­¥éª¤å¦‚ä¸‹ï¼š

```Bash
# åˆ›å»ºç›®å½•
mkdir -p /etc/docker

# å¤åˆ¶å†…å®¹
tee /etc/docker/daemon.json <<-'EOF'
{
    "registry-mirrors": [
        "http://hub-mirror.c.163.com",
        "https://mirrors.tuna.tsinghua.edu.cn",
        "http://mirrors.sohu.com",
        "https://ustc-edu-cn.mirror.aliyuncs.com",
        "https://ccr.ccs.tencentyun.com",
        "https://docker.m.daocloud.io",
        "https://docker.awsl9527.cn"
    ]
}
EOF

# é‡æ–°åŠ è½½é…ç½®
systemctl daemon-reload

# é‡å¯Docker
systemctl restart docker
```



## 6.é…ç½®é•œåƒåŠ é€Ÿ(é˜¿é‡Œäº‘å·²åœç”¨ï¼‰

è¿™é‡Œä»¥é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿä¸ºä¾‹ã€‚

### 5.1.æ³¨å†Œé˜¿é‡Œäº‘è´¦å·

é¦–å…ˆè®¿é—®é˜¿é‡Œäº‘ç½‘ç«™:

https://www.aliyun.com/

æ³¨å†Œä¸€ä¸ªè´¦å·ã€‚

### 5.2.å¼€é€šé•œåƒæœåŠ¡

åœ¨é¦–é¡µçš„äº§å“ä¸­ï¼Œæ‰¾åˆ°é˜¿é‡Œäº‘çš„**å®¹å™¨é•œåƒæœåŠ¡**ï¼š

![img](./Docker-Learning-Local.assets/1732518818905-281.png)

ç‚¹å‡»åè¿›å…¥æ§åˆ¶å°ï¼š

![img](./Docker-Learning-Local.assets/1732518818905-282.png)

é¦–æ¬¡å¯èƒ½éœ€è¦é€‰æ‹©ç«‹åˆ»å¼€é€šï¼Œç„¶åè¿›å…¥æ§åˆ¶å°ã€‚

### 5.3.é…ç½®é•œåƒåŠ é€Ÿ

æ‰¾åˆ°**é•œåƒå·¥å…·**ä¸‹çš„**é•œåƒ****åŠ é€Ÿå™¨**ï¼š

![img](./Docker-Learning-Local.assets/1732518818906-283.png)

é¡µé¢å‘ä¸‹æ»šåŠ¨ï¼Œå³å¯æ‰¾åˆ°é…ç½®çš„æ–‡æ¡£è¯´æ˜ï¼š

![img](./Docker-Learning-Local.assets/1732518818906-284.png)

å…·ä½“å‘½ä»¤å¦‚ä¸‹ï¼š

```Bash
# åˆ›å»ºç›®å½•
mkdir -p /etc/docker

# å¤åˆ¶å†…å®¹ï¼Œæ³¨æ„æŠŠå…¶ä¸­çš„é•œåƒåŠ é€Ÿåœ°å€æ”¹æˆä½ è‡ªå·±çš„
tee /etc/docker/daemon.json <<-'EOF'
{
  "registry-mirrors": ["https://xxxx.mirror.aliyuncs.com"]
}
EOF

# é‡æ–°åŠ è½½é…ç½®
systemctl daemon-reload

# é‡å¯Docker
systemctl restart docker
```







# ä¸€ã€å¿«é€Ÿå…¥é—¨

è¦æƒ³è®©Dockerå¸®æˆ‘ä»¬å®‰è£…å’Œéƒ¨ç½²è½¯ä»¶ï¼Œè‚¯å®šè¦ä¿è¯ä½ çš„æœºå™¨ä¸Šæœ‰Docker. ç”±äºå¤§å®¶çš„æ“ä½œç³»ç»Ÿå„ä¸ç›¸åŒï¼Œå®‰è£…æ–¹å¼ä¹Ÿä¸åŒã€‚ä¸ºäº†ä¾¿äºå¤§å®¶å­¦ä¹ ï¼Œæˆ‘ä»¬ç»Ÿä¸€åœ¨CentOSçš„è™šæ‹Ÿæœºä¸­å®‰è£…Dockerï¼Œç»Ÿä¸€å­¦ä¹ ç¯å¢ƒã€‚

æ³¨æ„ï¼šä½¿ç”¨MacBookçš„åŒå­¦ä¹Ÿè¯·åˆ©ç”¨ VMwareFusionæ¥å®‰è£…è™šæ‹Ÿæœºï¼Œå¹¶åœ¨è™šæ‹Ÿæœºä¸­å­¦ä¹ Dockerä½¿ç”¨ã€‚

å®‰è£…æ–¹å¼å‚è€ƒæ–‡æ¡£ï¼šã€Šå®‰è£…Dockerã€‹

## 1.1.éƒ¨ç½²MySQL

é¦–å…ˆï¼Œæˆ‘ä»¬åˆ©ç”¨Dockeræ¥å®‰è£…ä¸€ä¸ªMySQLè½¯ä»¶ï¼Œå¤§å®¶å¯ä»¥å¯¹æ¯”ä¸€ä¸‹ä¹‹å‰ä¼ ç»Ÿçš„å®‰è£…æ–¹å¼ï¼Œçœ‹çœ‹å“ªä¸ªæ•ˆç‡æ›´é«˜ä¸€äº›ã€‚

å¦‚æœæ˜¯åˆ©ç”¨ä¼ ç»Ÿæ–¹å¼éƒ¨ç½²MySQLï¼Œå¤§æ¦‚çš„æ­¥éª¤æœ‰ï¼š

- æœç´¢å¹¶ä¸‹è½½MySQLå®‰è£…åŒ…
- ä¸Šä¼ è‡³Linuxç¯å¢ƒ
- ç¼–è¯‘å’Œé…ç½®ç¯å¢ƒ
- å®‰è£…

è€Œä½¿ç”¨Dockerå®‰è£…ï¼Œä»…ä»…éœ€è¦ä¸€æ­¥å³å¯ï¼Œåœ¨å‘½ä»¤è¡Œè¾“å…¥ä¸‹é¢çš„å‘½ä»¤ï¼ˆå»ºè®®é‡‡ç”¨CVå¤§æ³•ï¼‰ï¼š

```PowerShell
docker run -d \
  --name mysql \
  -p 3306:3306 \
  -e TZ=Asia/Shanghai \
  -e MYSQL_ROOT_PASSWORD=123 \
  mysql
```

å¦‚æœ**æœªé…ç½®é•œåƒåŠ é€Ÿ**,åœ¨å½•å–é•œåƒæ—¶åˆ™ä¼š**æŠ¥é”™**ï¼š

```bash
 Unable to find image 'mysql:latest' locally docker: Error response from daemon: Get "https://registry-1.docker.io/v2/": net/http: request canceled while waiting for connection (Client.Timeout exceeded while awaiting headers). See 'docker run --help'.
```

è¿è¡Œæ•ˆæœå¦‚å›¾ï¼šip

![img](./Docker-Learning-Local.assets/1725890609194-19-1732518736071-119-1732518818912-371.png)

MySQLå®‰è£…å®Œæ¯•ï¼é€šè¿‡ä»»æ„å®¢æˆ·ç«¯å·¥å…·å³å¯è¿æ¥åˆ°MySQL.

å¤§å®¶å¯ä»¥å‘ç°ï¼Œå½“æˆ‘ä»¬æ‰§è¡Œå‘½ä»¤åï¼ŒDockeråšçš„ç¬¬ä¸€ä»¶äº‹æƒ…ï¼Œæ˜¯å»è‡ªåŠ¨æœç´¢å¹¶ä¸‹è½½äº†MySQLï¼Œç„¶åä¼šè‡ªåŠ¨è¿è¡ŒMySQLï¼Œæˆ‘ä»¬å®Œå…¨ä¸ç”¨æ’æ‰‹ï¼Œæ˜¯ä¸æ˜¯éå¸¸æ–¹ä¾¿ã€‚

è€Œä¸”ï¼Œè¿™ç§å®‰è£…æ–¹å¼ä½ å®Œå…¨ä¸ç”¨è€ƒè™‘è¿è¡Œçš„æ“ä½œç³»ç»Ÿç¯å¢ƒï¼Œå®ƒä¸ä»…ä»…åœ¨CentOSç³»ç»Ÿæ˜¯è¿™æ ·ï¼Œåœ¨Ubuntuç³»ç»Ÿã€macOSç³»ç»Ÿã€ç”šè‡³æ˜¯è£…äº†WSLçš„Windowsä¸‹ï¼Œéƒ½å¯ä»¥ä½¿ç”¨è¿™æ¡å‘½ä»¤æ¥å®‰è£…MySQLã€‚

è¦çŸ¥é“ï¼Œ**ä¸åŒæ“ä½œç³»ç»Ÿä¸‹å…¶å®‰è£…åŒ…ã€è¿è¡Œç¯å¢ƒæ˜¯éƒ½ä¸ç›¸åŒçš„**ï¼å¦‚æœæ˜¯**æ‰‹åŠ¨å®‰è£…ï¼Œå¿…é¡»æ‰‹åŠ¨è§£å†³å®‰è£…åŒ…ä¸åŒã€ç¯å¢ƒä¸åŒçš„ã€é…ç½®ä¸åŒçš„é—®é¢˜**ï¼

è€Œä½¿ç”¨Dockerï¼Œè¿™äº›å®Œå…¨ä¸ç”¨è€ƒè™‘ã€‚å°±æ˜¯å› ä¸ºDockerä¼šè‡ªåŠ¨æœç´¢å¹¶ä¸‹è½½MySQLã€‚æ³¨æ„ï¼šè¿™é‡Œä¸‹è½½çš„ä¸æ˜¯å®‰è£…åŒ…ï¼Œè€Œæ˜¯**é•œåƒã€‚**é•œåƒä¸­ä¸ä»…åŒ…å«äº†MySQLæœ¬èº«ï¼Œè¿˜åŒ…å«äº†å…¶è¿è¡Œæ‰€éœ€è¦çš„ç¯å¢ƒã€é…ç½®ã€ç³»ç»Ÿçº§å‡½æ•°åº“ã€‚å› æ­¤å®ƒåœ¨è¿è¡Œæ—¶å°±æœ‰è‡ªå·±ç‹¬ç«‹çš„ç¯å¢ƒï¼Œå°±å¯ä»¥è·¨ç³»ç»Ÿè¿è¡Œï¼Œä¹Ÿä¸éœ€è¦æ‰‹åŠ¨å†æ¬¡é…ç½®ç¯å¢ƒäº†ã€‚è¿™å¥—ç‹¬ç«‹è¿è¡Œçš„éš”ç¦»ç¯å¢ƒæˆ‘ä»¬ç§°ä¸º**å®¹å™¨**ã€‚

è¯´æ˜ï¼š

- é•œåƒï¼šè‹±æ–‡æ˜¯image
- å®¹å™¨ï¼šè‹±æ–‡æ˜¯container

> å› æ­¤ï¼ŒDockerå®‰è£…è½¯ä»¶çš„è¿‡ç¨‹ï¼Œå°±æ˜¯==è‡ªåŠ¨æœç´¢ä¸‹è½½é•œåƒï¼Œç„¶ååˆ›å»ºå¹¶è¿è¡Œå®¹å™¨çš„è¿‡ç¨‹==ã€‚

Dockerä¼šæ ¹æ®å‘½ä»¤ä¸­çš„é•œåƒåç§°è‡ªåŠ¨æœç´¢å¹¶ä¸‹è½½é•œåƒï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå®ƒæ˜¯å»å“ªé‡Œæœç´¢å’Œä¸‹è½½é•œåƒçš„å‘¢ï¼Ÿè¿™äº›é•œåƒåˆæ˜¯è°åˆ¶ä½œçš„å‘¢ï¼Ÿ

Dockerå®˜æ–¹æä¾›äº†ä¸€ä¸ªä¸“é—¨ç®¡ç†ã€å­˜å‚¨é•œåƒçš„ç½‘ç«™ï¼Œå¹¶å¯¹å¤–å¼€æ”¾äº†é•œåƒä¸Šä¼ ã€ä¸‹è½½çš„æƒåˆ©ã€‚Dockerå®˜æ–¹æä¾›äº†ä¸€äº›åŸºç¡€é•œåƒï¼Œç„¶åå„å¤§è½¯ä»¶å…¬å¸åˆåœ¨åŸºç¡€é•œåƒåŸºç¡€ä¸Šï¼Œåˆ¶ä½œäº†è‡ªå®¶è½¯ä»¶çš„é•œåƒï¼Œå…¨éƒ¨éƒ½å­˜æ”¾åœ¨è¿™ä¸ªç½‘ç«™ã€‚è¿™ä¸ªç½‘ç«™å°±æˆäº†Dockeré•œåƒäº¤æµçš„ç¤¾åŒºï¼š

https://hub.docker.com/

åŸºæœ¬ä¸Šæˆ‘ä»¬å¸¸ç”¨çš„å„ç§è½¯ä»¶éƒ½èƒ½åœ¨è¿™ä¸ªç½‘ç«™ä¸Šæ‰¾åˆ°ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥è‡ªå·±åˆ¶ä½œé•œåƒä¸Šä¼ ä¸Šå»ã€‚

åƒè¿™ç§æä¾›å­˜å‚¨ã€ç®¡ç†Dockeré•œåƒçš„æœåŠ¡å™¨ï¼Œè¢«ç§°ä¸ºDockerRegistryï¼Œå¯ä»¥ç¿»è¯‘ä¸ºé•œåƒä»“åº“ã€‚DockerHubç½‘ç«™æ˜¯å®˜æ–¹ä»“åº“ï¼Œé˜¿é‡Œäº‘ã€åä¸ºäº‘ä¼šæä¾›ä¸€äº›ç¬¬ä¸‰æ–¹ä»“åº“ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå·±æ­å»ºç§æœ‰çš„é•œåƒä»“åº“ã€‚

å®˜æ–¹ä»“åº“åœ¨å›½å¤–ï¼Œä¸‹è½½é€Ÿåº¦è¾ƒæ…¢ï¼Œä¸€èˆ¬æˆ‘ä»¬éƒ½ä¼šä½¿ç”¨ç¬¬ä¸‰æ–¹ä»“åº“æä¾›çš„é•œåƒåŠ é€ŸåŠŸèƒ½ï¼Œæé«˜ä¸‹è½½é€Ÿåº¦ã€‚è€Œä¼ä¸šå†…éƒ¨çš„æœºå¯†é¡¹ç›®ï¼Œå¾€å¾€ä¼šé‡‡ç”¨ç§æœ‰é•œåƒä»“åº“ã€‚

æ€»ä¹‹ï¼Œé•œåƒçš„æ¥æºæœ‰ä¸¤ç§ï¼š

- åŸºäºå®˜æ–¹åŸºç¡€é•œåƒè‡ªå·±åˆ¶ä½œ
- ç›´æ¥å»DockerRegistryä¸‹è½½

**æ€»ç»“ä¸€ä¸‹**ï¼š

Dockeræœ¬èº«åŒ…å«ä¸€ä¸ªåå°æœåŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨Dockerå‘½ä»¤å‘Šè¯‰DockeræœåŠ¡ï¼Œå¸®åŠ©æˆ‘ä»¬å¿«é€Ÿéƒ¨ç½²æŒ‡å®šçš„åº”ç”¨ã€‚DockeræœåŠ¡éƒ¨ç½²åº”ç”¨æ—¶ï¼Œé¦–å…ˆè¦å»æœç´¢å¹¶ä¸‹è½½åº”ç”¨å¯¹åº”çš„é•œåƒï¼Œç„¶åæ ¹æ®é•œåƒåˆ›å»ºå¹¶å…è®¸å®¹å™¨ï¼Œåº”ç”¨å°±éƒ¨ç½²å®Œæˆäº†ã€‚

ç”¨ä¸€å¹…å›¾æ ‡ç¤ºå¦‚ä¸‹ï¼š

æš‚æ—¶æ— æ³•åœ¨é£ä¹¦æ–‡æ¡£å¤–å±•ç¤ºæ­¤å†…å®¹

## 1.2.å‘½ä»¤è§£è¯»

åˆ©ç”¨Dockerå¿«é€Ÿçš„å®‰è£…äº†MySQLï¼Œéå¸¸çš„æ–¹ä¾¿ï¼Œä¸è¿‡æˆ‘ä»¬æ‰§è¡Œçš„å‘½ä»¤åˆ°åº•æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ

```PowerShell
docker run -d \
  --name mysql \
  -p 3306:3306 \
  -e TZ=Asia/Shanghai \
  -e MYSQL_ROOT_PASSWORD=123 \
  mysql
  
 #å…¶ä¸­ \ åªæ˜¯ç”¨æ¥æ¢è¡Œçš„
```

> ![image-20241125185146934](./Docker-Learning-Local.assets/image-20241125185146934.png)
>
> è§£è¯»ï¼š
>
> - `docker run -d` ï¼šåˆ›å»ºå¹¶è¿è¡Œä¸€ä¸ªå®¹å™¨ï¼Œ==`-d`==åˆ™æ˜¯è®©å®¹å™¨ä»¥==åå°è¿›ç¨‹è¿è¡Œ==
> - `--name`` mysql ` : ç»™å®¹å™¨èµ·ä¸ª==åå­—==å«`mysql`ï¼Œä½ å¯ä»¥å«åˆ«çš„
> - `-p 3306:3306` : è®¾ç½®==ç«¯å£æ˜ å°„==ã€‚
>   - **å®¹å™¨æ˜¯éš”ç¦»ç¯å¢ƒ**ï¼Œå¤–ç•Œä¸å¯è®¿é—®ã€‚ä½†æ˜¯å¯ä»¥**å°†å®¿ä¸»æœºç«¯å£æ˜ å°„å®¹å™¨å†…åˆ°ç«¯å£**ï¼Œå½“è®¿é—®å®¿ä¸»æœºæŒ‡å®šç«¯å£æ—¶ï¼Œå°±æ˜¯åœ¨è®¿é—®å®¹å™¨å†…çš„ç«¯å£äº†ã€‚
>   - å®¹å™¨å†…ç«¯å£å¾€å¾€æ˜¯ç”±å®¹å™¨å†…çš„è¿›ç¨‹å†³å®šï¼Œä¾‹å¦‚MySQLè¿›ç¨‹é»˜è®¤ç«¯å£æ˜¯3306ï¼Œå› æ­¤å®¹å™¨å†…ç«¯å£ä¸€å®šæ˜¯3306ï¼›è€Œå®¿ä¸»æœºç«¯å£åˆ™å¯ä»¥ä»»æ„æŒ‡å®šï¼Œä¸€èˆ¬ä¸å®¹å™¨å†…ä¿æŒä¸€è‡´ã€‚
>   - æ ¼å¼ï¼š `-p å®¿ä¸»æœºç«¯å£:å®¹å™¨å†…ç«¯å£`ï¼Œç¤ºä¾‹ä¸­å°±æ˜¯å°†å®¿ä¸»æœºçš„3306æ˜ å°„åˆ°å®¹å™¨å†…çš„3306ç«¯å£
> - `-``e`` TZ=Asia/Shanghai` : é…ç½®å®¹å™¨å†…è¿›ç¨‹è¿è¡Œæ—¶çš„ä¸€äº›å‚æ•°
>   - æ ¼å¼ï¼š`-e KEY=VALUE`ï¼ŒKEYå’ŒVALUEéƒ½ç”±==å®¹å™¨å†…è¿›ç¨‹å†³å®š==
>   - æ¡ˆä¾‹ä¸­ï¼Œ`TZ``=Asia/Shanghai`æ˜¯è®¾ç½®æ—¶åŒºï¼›`MYSQL_ROOT_PASSWORD=123`æ˜¯==è®¾ç½®MySQLé»˜è®¤å¯†ç ==
> - `mysql` : è®¾ç½®**é•œåƒ**åç§°ï¼ŒDockerä¼šæ ¹æ®è¿™ä¸ªåå­—æœç´¢å¹¶ä¸‹è½½é•œåƒ
>   - æ ¼å¼ï¼š`REPOSITORY:TAG`ï¼Œä¾‹å¦‚`mysql:8.0`ï¼Œå…¶ä¸­`REPOSITORY`å¯ä»¥ç†è§£ä¸ºé•œåƒåï¼Œ`TAG`æ˜¯ç‰ˆæœ¬å·
>   - åœ¨æœªæŒ‡å®š`TAG`çš„æƒ…å†µä¸‹ï¼Œ==é»˜è®¤æ˜¯æœ€æ–°ç‰ˆæœ¬==ï¼Œä¹Ÿå°±æ˜¯`mysql:latest`

é•œåƒçš„åç§°ä¸æ˜¯éšæ„çš„ï¼Œè€Œæ˜¯è¦åˆ°DockerRegistryä¸­å¯»æ‰¾ï¼Œé•œåƒè¿è¡Œæ—¶çš„é…ç½®ä¹Ÿä¸æ˜¯éšæ„çš„ï¼Œè¦å‚è€ƒé•œåƒçš„å¸®åŠ©æ–‡æ¡£ï¼Œè¿™äº›åœ¨DockerHubç½‘ç«™æˆ–è€…è½¯ä»¶çš„å®˜æ–¹ç½‘ç«™ä¸­éƒ½èƒ½æ‰¾åˆ°ã€‚

å¦‚æœæˆ‘ä»¬è¦å®‰è£…å…¶å®ƒè½¯ä»¶ï¼Œä¹Ÿå¯ä»¥åˆ°DockerRegistryä¸­å¯»æ‰¾å¯¹åº”çš„é•œåƒåç§°å’Œç‰ˆæœ¬ï¼Œé˜…è¯»ç›¸å…³é…ç½®å³å¯ã€‚

![image-20241125185122974](./Docker-Learning-Local.assets/image-20241125185122974.png)



# äºŒã€DockeråŸºç¡€

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥å­¦ä¹ Dockerä½¿ç”¨çš„ä¸€äº›åŸºç¡€çŸ¥è¯†ï¼Œä¸ºå°†æ¥éƒ¨ç½²é¡¹ç›®æ‰“ä¸‹åŸºç¡€ã€‚å…·ä½“ç”¨æ³•å¯ä»¥å‚è€ƒDockerå®˜æ–¹æ–‡æ¡£ï¼š

https://docs.docker.com/

## 2.1.å¸¸è§å‘½ä»¤

![image-20241125185753847](./Docker-Learning-Local.assets/image-20241125185753847.png)

é¦–å…ˆæˆ‘ä»¬æ¥å­¦ä¹ Dockerä¸­çš„å¸¸è§å‘½ä»¤ï¼Œå¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š

https://docs.docker.com/engine/reference/commandline/cli/

### 2.1.1.å¸¸ç”¨å‘½ä»¤ä»‹ç»

å…¶ä¸­ï¼Œæ¯”è¾ƒå¸¸è§çš„å‘½ä»¤æœ‰ï¼š

| **å‘½ä»¤**       | **è¯´æ˜**                       | **æ–‡æ¡£åœ°å€**                                                 |
| :------------- | :----------------------------- | :----------------------------------------------------------- |
| docker build   | ä»Dockerfileæ„å»ºé•œåƒ           | [docker build](https://docs.docker.com/reference/cli/docker/build-legacy/) |
| docker pull    | æ‹‰å–é•œåƒ                       | [docker pull](https://docs.docker.com/engine/reference/commandline/pull/) |
| docker push    | æ¨é€é•œåƒåˆ°DockerRegistry       | [docker push](https://docs.docker.com/engine/reference/commandline/push/) |
| docker images  | æŸ¥çœ‹æœ¬åœ°é•œåƒ                   | [docker images](https://docs.docker.com/engine/reference/commandline/images/) |
| docker rmi     | åˆ é™¤æœ¬åœ°é•œåƒ                   | [docker rmi](https://docs.docker.com/engine/reference/commandline/rmi/) |
| docker run     | åˆ›å»ºå¹¶è¿è¡Œå®¹å™¨ï¼ˆä¸èƒ½é‡å¤åˆ›å»ºï¼‰ | [docker run](https://docs.docker.com/engine/reference/commandline/run/) |
| docker stop    | åœæ­¢æŒ‡å®šå®¹å™¨                   | [docker stop](https://docs.docker.com/engine/reference/commandline/stop/) |
| docker start   | å¯åŠ¨æŒ‡å®šå®¹å™¨                   | [docker start](https://docs.docker.com/engine/reference/commandline/start/) |
| docker restart | é‡æ–°å¯åŠ¨å®¹å™¨                   | [docker restart](https://docs.docker.com/engine/reference/commandline/restart/) |
| docker rm      | åˆ é™¤æŒ‡å®šå®¹å™¨                   | [docs.docker.com](https://docs.docker.com/engine/reference/commandline/rm/) |
| docker ps      | æŸ¥çœ‹å®¹å™¨                       | [docker ps](https://docs.docker.com/engine/reference/commandline/ps/) |
| docker logs    | æŸ¥çœ‹å®¹å™¨è¿è¡Œæ—¥å¿—               | [docker logs](https://docs.docker.com/engine/reference/commandline/logs/) |
| docker exec    | è¿›å…¥å®¹å™¨                       | [docker exec](https://docs.docker.com/engine/reference/commandline/exec/) |
| docker save    | ä¿å­˜é•œåƒåˆ°æœ¬åœ°å‹ç¼©æ–‡ä»¶         | [docker save](https://docs.docker.com/engine/reference/commandline/save/) |
| docker load    | åŠ è½½æœ¬åœ°å‹ç¼©æ–‡ä»¶åˆ°é•œåƒ         | [docker load](https://docs.docker.com/engine/reference/commandline/load/) |
| docker inspect | æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯               | [docker inspect](https://docs.docker.com/engine/reference/commandline/inspect/) |

ç”¨ä¸€å‰¯å›¾æ¥è¡¨ç¤ºè¿™äº›å‘½ä»¤çš„å…³ç³»ï¼š

![image-20240910173142127](./Docker-Learning-Local.assets/image-20240910173142127-1732518818907-285.png)

è¡¥å……ï¼š

é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯æ¬¡é‡å¯è™šæ‹Ÿæœºæˆ‘ä»¬éƒ½éœ€è¦æ‰‹åŠ¨å¯åŠ¨Dockerå’ŒDockerä¸­çš„å®¹å™¨ã€‚é€šè¿‡å‘½ä»¤å¯ä»¥å®ç°å¼€æœºè‡ªå¯ï¼š

```PowerShell
# Dockerå¼€æœºè‡ªå¯
systemctl enable docker

# Dockerå®¹å™¨å¼€æœºè‡ªå¯
docker update --restart=always [å®¹å™¨å/å®¹å™¨id]
```

#### ï¼ˆ1ï¼‰==docker build==-ä»Dockerfileæ„å»ºé•œåƒ



#### ï¼ˆ2ï¼‰==docker pull==-  æ‹‰å–é•œåƒ

  [docker pull](https://docs.docker.com/engine/reference/commandline/pull/)

**docker pull å®¹å™¨å**

```powershell
#æ‹‰å–Nginxé•œåƒ
docker pull nginx
```



#### ï¼ˆ3ï¼‰==docker push==-  æ¨é€é•œåƒåˆ°DockerRegistry

  [docker push](https://docs.docker.com/engine/reference/commandline/push/)



#### ï¼ˆ4ï¼‰==docker images==-æŸ¥çœ‹æœ¬åœ°é•œåƒ

  [docker images](https://docs.docker.com/engine/reference/commandline/images/)

```powershell
# æŸ¥çœ‹é•œåƒ
docker images

# ç»“æœå¦‚ä¸‹ï¼š
REPOSITORY   TAG       IMAGE ID       CREATED         SIZE
nginx        latest    605c77e624dd   16 months ago   141MB
mysql        latest    3218b38490ce   17 months ago   516MB
```



#### ï¼ˆ5ï¼‰==docker rmi==-åˆ é™¤æœ¬åœ°é•œåƒ  

[docker rmi](https://docs.docker.com/engine/reference/commandline/rmi/)



#### ï¼ˆ6ï¼‰==docker run==åˆ›å»ºå¹¶è¿è¡Œå®¹å™¨ï¼ˆä¸èƒ½é‡å¤åˆ›å»ºï¼‰  

[docker run](https://docs.docker.com/engine/reference/commandline/run/)

```powershell
#éƒ¨ç½²MySQL
docker run -d \
  --name mysql \
  -p 3306:3306 \
  -e TZ=Asia/Shanghai \
  -e MYSQL_ROOT_PASSWORD=123 \
  mysql

# å»ºå¹¶å…è®¸Nginxå®¹å™¨
docker run -d --name nginx -p 80:80 nginx
```

> è§£è¯»ï¼š
>
> - `docker run -d` ï¼šåˆ›å»ºå¹¶è¿è¡Œä¸€ä¸ªå®¹å™¨ï¼Œ==`-d`==åˆ™æ˜¯è®©å®¹å™¨ä»¥==åå°è¿›ç¨‹è¿è¡Œ==
> - `--name`` mysql ` : ç»™å®¹å™¨èµ·ä¸ª==åå­—==å«`mysql`ï¼Œä½ å¯ä»¥å«åˆ«çš„
> - `-p 3306:3306` : è®¾ç½®==ç«¯å£æ˜ å°„==ã€‚
>   - **å®¹å™¨æ˜¯éš”ç¦»ç¯å¢ƒ**ï¼Œå¤–ç•Œä¸å¯è®¿é—®ã€‚ä½†æ˜¯å¯ä»¥**å°†å®¿ä¸»æœºç«¯å£æ˜ å°„å®¹å™¨å†…åˆ°ç«¯å£**ï¼Œå½“è®¿é—®å®¿ä¸»æœºæŒ‡å®šç«¯å£æ—¶ï¼Œå°±æ˜¯åœ¨è®¿é—®å®¹å™¨å†…çš„ç«¯å£äº†ã€‚
>   - å®¹å™¨å†…ç«¯å£å¾€å¾€æ˜¯ç”±å®¹å™¨å†…çš„è¿›ç¨‹å†³å®šï¼Œä¾‹å¦‚MySQLè¿›ç¨‹é»˜è®¤ç«¯å£æ˜¯3306ï¼Œå› æ­¤å®¹å™¨å†…ç«¯å£ä¸€å®šæ˜¯3306ï¼›è€Œå®¿ä¸»æœºç«¯å£åˆ™å¯ä»¥ä»»æ„æŒ‡å®šï¼Œä¸€èˆ¬ä¸å®¹å™¨å†…ä¿æŒä¸€è‡´ã€‚
>   - æ ¼å¼ï¼š `-p å®¿ä¸»æœºç«¯å£:å®¹å™¨å†…ç«¯å£`ï¼Œç¤ºä¾‹ä¸­å°±æ˜¯å°†å®¿ä¸»æœºçš„3306æ˜ å°„åˆ°å®¹å™¨å†…çš„3306ç«¯å£
> - `-``e`` TZ=Asia/Shanghai` : é…ç½®å®¹å™¨å†…è¿›ç¨‹è¿è¡Œæ—¶çš„ä¸€äº›å‚æ•°
>   - æ ¼å¼ï¼š`-e KEY=VALUE`ï¼ŒKEYå’ŒVALUEéƒ½ç”±==å®¹å™¨å†…è¿›ç¨‹å†³å®š==
>   - æ¡ˆä¾‹ä¸­ï¼Œ`TZ``=Asia/Shanghai`æ˜¯è®¾ç½®æ—¶åŒºï¼›`MYSQL_ROOT_PASSWORD=123`æ˜¯==è®¾ç½®MySQLé»˜è®¤å¯†ç ==
> - `mysql` : è®¾ç½®**é•œåƒ**åç§°ï¼ŒDockerä¼šæ ¹æ®è¿™ä¸ªåå­—æœç´¢å¹¶ä¸‹è½½é•œåƒ
>   - æ ¼å¼ï¼š`REPOSITORY:TAG`ï¼Œä¾‹å¦‚`mysql:8.0`ï¼Œå…¶ä¸­`REPOSITORY`å¯ä»¥ç†è§£ä¸ºé•œåƒåï¼Œ`TAG`æ˜¯ç‰ˆæœ¬å·
>   - åœ¨æœªæŒ‡å®š`TAG`çš„æƒ…å†µä¸‹ï¼Œ==é»˜è®¤æ˜¯æœ€æ–°ç‰ˆæœ¬==ï¼Œä¹Ÿå°±æ˜¯`mysql`

é•œåƒçš„åç§°ä¸æ˜¯éšæ„çš„ï¼Œè€Œæ˜¯è¦åˆ°DockerRegistryä¸­å¯»æ‰¾ï¼Œé•œåƒè¿è¡Œæ—¶çš„é…ç½®ä¹Ÿä¸æ˜¯éšæ„çš„ï¼Œè¦å‚è€ƒé•œåƒçš„å¸®åŠ©æ–‡æ¡£ï¼Œè¿™äº›åœ¨DockerHubç½‘ç«™æˆ–è€…è½¯ä»¶çš„å®˜æ–¹ç½‘ç«™ä¸­éƒ½èƒ½æ‰¾åˆ°ã€‚

å¦‚æœæˆ‘ä»¬è¦å®‰è£…å…¶å®ƒè½¯ä»¶ï¼Œä¹Ÿå¯ä»¥åˆ°DockerRegistryä¸­å¯»æ‰¾å¯¹åº”çš„é•œåƒåç§°å’Œç‰ˆæœ¬ï¼Œé˜…è¯»ç›¸å…³é…ç½®å³å¯ã€‚



#### ï¼ˆ7ï¼‰==docker stop== -åœæ­¢æŒ‡å®šå®¹å™¨ 

 [docker stop](https://docs.docker.com/engine/reference/commandline/stop/)

**docker stop å®¹å™¨å**

```powershell
# ç¬¬7æ­¥ï¼Œåœæ­¢å®¹å™¨
docker stop nginx
```



#### ï¼ˆ8ï¼‰==docker start== -å¯åŠ¨æŒ‡å®šå®¹å™¨  

[docker start](https://docs.docker.com/engine/reference/commandline/start/)

**docker start å®¹å™¨å**

```powershell
# ç¬¬9æ­¥ï¼Œå†æ¬¡å¯åŠ¨nginxå®¹å™¨
docker start nginx
```



#### ï¼ˆ9ï¼‰==docker restart)== -é‡æ–°å¯åŠ¨å®¹å™¨ 

 [docker restart](https://docs.docker.com/engine/reference/commandline/restart/)



#### ï¼ˆ10ï¼‰ ==docker rm== -åˆ é™¤æŒ‡å®šå®¹å™¨  

[docs.docker.com](https://docs.docker.com/engine/reference/commandline/rm/)

**docker rm [-f] å®¹å™¨å**

```powershell
# ç¬¬13æ­¥ï¼Œåˆ é™¤å®¹å™¨
docker rm nginx

# å‘ç°æ— æ³•åˆ é™¤ï¼Œå› ä¸ºå®¹å™¨è¿è¡Œä¸­
#1ã€å¼ºåˆ¶åˆ é™¤å®¹å™¨
docker rm -f nginx

#2ã€å…ˆæš‚åœå®¹å™¨ï¼Œå†åˆ é™¤
docker stop nginx
docker rm nginx
```



#### ï¼ˆ11ï¼‰==docker ps== -æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨  

[docker ps](https://docs.docker.com/engine/reference/commandline/ps/)

**docker ps [-a] [--format]**

```powershell
# ç¬¬5æ­¥ï¼ŒæŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨
docker ps

# ä¹Ÿå¯ä»¥åŠ æ ¼å¼åŒ–æ–¹å¼è®¿é—®ï¼Œæ ¼å¼ä¼šæ›´åŠ æ¸…çˆ½
docker ps --format "table {{.ID}}\t{{.Image}}\t{{.Ports}}\t{{.Status}}\t{{.Names}}"

# 1ã€æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨
docker ps --format "table {{.ID}}\t{{.Image}}\t{{.Ports}}\t{{.Status}}\t{{.Names}}"
# 2ã€æŸ¥çœ‹æ‰€æœ‰å®¹å™¨
docker ps -a --format "table {{.ID}}\t{{.Image}}\t{{.Ports}}\t{{.Status}}\t{{.Names}}"
```



#### ï¼ˆ12ï¼‰==docker logs== -æŸ¥çœ‹å®¹å™¨è¿è¡Œæ—¥å¿—  

[docker logs](https://docs.docker.com/engine/reference/commandline/logs/)

**docker logs [-f] å®¹å™¨å**

```powershell
#æŸ¥çœ‹æ—¥å¿—
docker logs nginx

#å®æ—¶è·Ÿè¸ªæ—¥å¿—æ–‡ä»¶ä¿¡æ¯
docker logs nginx -f 
```



#### ï¼ˆ13ï¼‰==docker exec== -è¿›å…¥å®¹å™¨  

[docker exec](https://docs.docker.com/engine/reference/commandline/exec/)

**docker exec -it å®¹å™¨å bash**

```powershell
# ç¬¬12æ­¥ï¼Œè¿›å…¥å®¹å™¨,æŸ¥çœ‹å®¹å™¨å†…ç›®å½•
# -itï¼Œè¡¨ç¤ºæ·»åŠ ä¸€ä¸ªå¯äº¤äº’çš„ç»ˆç«¯
docker exec -it nginx bash

# æˆ–è€…ï¼Œå¯ä»¥è¿›å…¥MySQL
docker exec -it mysql mysql -uroot -p

#é€€å‡º
exit
```

![image-20240910220628321-1732518818907-286](Docker-Learning-Local.assets/image-20240910220628321-1732518818907-286.png)



#### ï¼ˆ14ï¼‰==docker save== -ä¿å­˜é•œåƒåˆ°æœ¬åœ°å‹ç¼©æ–‡ä»¶  

[docker save](https://docs.docker.com/engine/reference/commandline/save/)



#### ï¼ˆ15ï¼‰==docker  load== -åŠ è½½æœ¬åœ°å‹ç¼©æ–‡ä»¶åˆ°é•œåƒ  

[docker load](https://docs.docker.com/engine/reference/commandline/load/)



#### ï¼ˆ16ï¼‰==docker inspect== -æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯  

[docker inspect](https://docs.docker.com/engine/reference/commandline/inspect/)

**docker inspect å®¹å™¨å**

```powershell
# ç¬¬11æ­¥ï¼ŒæŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯
docker inspect nginx
```

https://docs.docker.com/engine/reference/commandline/inspect/)



#### ï¼ˆ17ï¼‰==systemctl restart docker== -é‡å¯DockeræœåŠ¡ 

```powershell
#é‡å¯DockeræœåŠ¡ 
systemctl restart docker
```





### 2.1.2.å‘½ä»¤

#### ï¼ˆ1ï¼‰==save==ä¿å­˜é•œåƒåˆ°æœ¬åœ°å‹ç¼©æ–‡ä»¶

**docker save -o æ–‡ä»¶å å®¹å™¨å:ç‰ˆæœ¬**

```powershell
docker save -o nginx.tar nginx:latest
```



#### ï¼ˆ2ï¼‰==load==åŠ è½½æœ¬åœ°å‹ç¼©æ–‡ä»¶åˆ°é•œåƒ

**docker load -i æ–‡ä»¶å**

```powershell
docker load -i nginx.tar
```

![image-20240910213521835-1732518818907-287](Docker-Learning-Local.assets/image-20240910213521835-1732518818907-287.png)





### 2.1.3.æ¼”ç¤ºæ¡ˆä¾‹

![image-20241125185858333](./Docker-Learning-Local.assets/image-20241125185858333.png)

æ•™å­¦ç¯èŠ‚è¯´æ˜ï¼šæˆ‘ä»¬ä»¥Nginxä¸ºä¾‹ç»™å¤§å®¶æ¼”ç¤ºä¸Šè¿°å‘½ä»¤ã€‚

```PowerShell
# ç¬¬1æ­¥ï¼Œå»DockerHubæŸ¥çœ‹nginxé•œåƒä»“åº“åŠç›¸å…³ä¿¡æ¯

# ç¬¬2æ­¥ï¼Œæ‹‰å–Nginxé•œåƒ
docker pull nginx

# ç¬¬3æ­¥ï¼ŒæŸ¥çœ‹é•œåƒ
docker images
# ç»“æœå¦‚ä¸‹ï¼š
REPOSITORY   TAG       IMAGE ID       CREATED         SIZE
nginx        latest    605c77e624dd   16 months ago   141MB
mysql        latest    3218b38490ce   17 months ago   516MB

# ç¬¬4æ­¥ï¼Œåˆ›å»ºå¹¶å…è®¸Nginxå®¹å™¨
docker run -d --name nginx -p 80:80 nginx
#ç­‰ä»·äº
docker run -d --name nginx -p 80:80 nginx:latest

# ç¬¬5æ­¥ï¼ŒæŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨
docker ps
# ä¹Ÿå¯ä»¥åŠ æ ¼å¼åŒ–æ–¹å¼è®¿é—®ï¼Œæ ¼å¼ä¼šæ›´åŠ æ¸…çˆ½
docker ps --format "table {{.ID}}\t{{.Image}}\t{{.Ports}}\t{{.Status}}\t{{.Names}}"

# ç¬¬6æ­¥ï¼Œè®¿é—®ç½‘é¡µï¼Œåœ°å€ï¼šhttp://è™šæ‹Ÿæœºåœ°å€

# ç¬¬7æ­¥ï¼Œåœæ­¢å®¹å™¨
docker stop nginx

# ç¬¬8æ­¥ï¼Œ
# 1ã€æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨
docker ps --format "table {{.ID}}\t{{.Image}}\t{{.Ports}}\t{{.Status}}\t{{.Names}}"
# 2ã€æŸ¥çœ‹æ‰€æœ‰å®¹å™¨
docker ps -a --format "table {{.ID}}\t{{.Image}}\t{{.Ports}}\t{{.Status}}\t{{.Names}}"

#æŸ¥çœ‹æ—¥å¿—
docker logs nginx
#-f è¡¨ç¤ºfollowï¼ŒæŒç»­ç›‘å¬æ—¥å¿—ä¿¡æ¯å˜åŒ–
docker logs -f nginx 


# ç¬¬9æ­¥ï¼Œå†æ¬¡å¯åŠ¨nginxå®¹å™¨
docker start nginx

# ç¬¬10æ­¥ï¼Œå†æ¬¡æŸ¥çœ‹å®¹å™¨
docker ps --format "table {{.ID}}\t{{.Image}}\t{{.Ports}}\t{{.Status}}\t{{.Names}}"

# ç¬¬11æ­¥ï¼ŒæŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯
docker inspect nginx

# ç¬¬12æ­¥ï¼Œè¿›å…¥å®¹å™¨,æŸ¥çœ‹å®¹å™¨å†…ç›®å½•
docker exec -it nginx bash
# æˆ–è€…ï¼Œå¯ä»¥è¿›å…¥MySQL
docker exec -it mysql bash
docker exec -it mysql mysql -uroot -p

# ç¬¬13æ­¥ï¼Œåˆ é™¤å®¹å™¨
docker rm nginx
# å‘ç°æ— æ³•åˆ é™¤ï¼Œå› ä¸ºå®¹å™¨è¿è¡Œä¸­ï¼Œå¼ºåˆ¶åˆ é™¤å®¹å™¨
docker rm -f nginx
```



### 2.1.4.==å‘½ä»¤åˆ«å==

ç»™å¸¸ç”¨Dockerå‘½ä»¤èµ·åˆ«åï¼Œæ–¹ä¾¿æˆ‘ä»¬è®¿é—®ï¼š

```PowerShell
# ä¿®æ”¹/root/.bashrcæ–‡ä»¶
vi /root/.bashrc
å†…å®¹å¦‚ä¸‹ï¼š
# .bashrc

# User specific aliases and functions

alias rm='rm -i'
alias cp='cp -i'
alias mv='mv -i'
alias dps='docker ps --format "table {{.ID}}\t{{.Image}}\t{{.Ports}}\t{{.Status}}\t{{.Names}}"'
alias dis='docker images'

# Source global definitions
if [ -f /etc/bashrc ]; then
        . /etc/bashrc
fi
```

ç„¶åï¼Œ**æ‰§è¡Œå‘½ä»¤ä½¿åˆ«åç”Ÿæ•ˆ**

```PowerShell
source /root/.bashrc
```

æ¥ä¸‹æ¥ï¼Œè¯•è¯•çœ‹æ–°çš„å‘½ä»¤å§ã€‚



## 2.2.æ•°æ®å·

å®¹å™¨æ˜¯éš”ç¦»ç¯å¢ƒï¼Œå®¹å™¨å†…ç¨‹åºçš„æ–‡ä»¶ã€é…ç½®ã€è¿è¡Œæ—¶äº§ç”Ÿçš„å®¹å™¨éƒ½åœ¨å®¹å™¨å†…éƒ¨ï¼Œæˆ‘ä»¬è¦è¯»å†™å®¹å™¨å†…çš„æ–‡ä»¶éå¸¸ä¸æ–¹ä¾¿ã€‚å¤§å®¶æ€è€ƒå‡ ä¸ªé—®é¢˜ï¼š

- å¦‚æœè¦å‡çº§MySQLç‰ˆæœ¬ï¼Œéœ€è¦é”€æ¯æ—§å®¹å™¨ï¼Œé‚£ä¹ˆæ•°æ®å²‚ä¸æ˜¯è·Ÿç€è¢«é”€æ¯äº†ï¼Ÿ
- MySQLã€Nginxå®¹å™¨è¿è¡Œåï¼Œå¦‚æœæˆ‘è¦ä¿®æ”¹å…¶ä¸­çš„æŸäº›é…ç½®è¯¥æ€ä¹ˆåŠï¼Ÿ
- æˆ‘æƒ³è¦è®©Nginxä»£ç†æˆ‘çš„é™æ€èµ„æºæ€ä¹ˆåŠï¼Ÿ

å› æ­¤ï¼Œå®¹å™¨æä¾›ç¨‹åºçš„è¿è¡Œç¯å¢ƒï¼Œä½†æ˜¯**ç¨‹åºè¿è¡Œäº§ç”Ÿçš„æ•°æ®ã€ç¨‹åºè¿è¡Œä¾èµ–çš„é…ç½®éƒ½åº”è¯¥==ä¸å®¹å™¨è§£è€¦==**ã€‚

![image-20241125193229748](./Docker-Learning-Local.assets/image-20241125193229748.png)

### 2.2.1.ä»€ä¹ˆæ˜¯æ•°æ®å·

**æ•°æ®å·ï¼ˆvolumeï¼‰**æ˜¯ä¸€ä¸ªè™šæ‹Ÿç›®å½•ï¼Œæ˜¯**å®¹å™¨å†…ç›®å½•**ä¸**å®¿ä¸»æœº**ç›®å½•ä¹‹é—´**==æ˜ å°„==**çš„æ¡¥æ¢ã€‚

ä»¥Nginxä¸ºä¾‹ï¼Œæˆ‘ä»¬çŸ¥é“Nginxä¸­æœ‰ä¸¤ä¸ªå…³é”®çš„ç›®å½•ï¼š

- `html`ï¼šæ”¾ç½®ä¸€äº›é™æ€èµ„æº
- `conf`ï¼šæ”¾ç½®é…ç½®æ–‡ä»¶

å¦‚æœæˆ‘ä»¬è¦è®©Nginxä»£ç†æˆ‘ä»¬çš„é™æ€èµ„æºï¼Œæœ€å¥½æ˜¯æ”¾åˆ°`html`ç›®å½•ï¼›å¦‚æœæˆ‘ä»¬è¦ä¿®æ”¹Nginxçš„é…ç½®ï¼Œæœ€å¥½æ˜¯æ‰¾åˆ°`conf`ä¸‹çš„`nginx.conf`æ–‡ä»¶ã€‚

ä½†é—æ†¾çš„æ˜¯ï¼Œå®¹å™¨è¿è¡Œçš„Nginxæ‰€æœ‰çš„æ–‡ä»¶éƒ½åœ¨å®¹å™¨å†…éƒ¨ã€‚æ‰€ä»¥æˆ‘ä»¬å¿…é¡»åˆ©ç”¨æ•°æ®å·å°†ä¸¤ä¸ªç›®å½•ä¸å®¿ä¸»æœºç›®å½•å…³è”ï¼Œæ–¹ä¾¿æˆ‘ä»¬æ“ä½œã€‚å¦‚å›¾ï¼š

![image-20240910180104074](./Docker-Learning-Local.assets/image-20240910180104074-1732518818907-288.png)

åœ¨ä¸Šå›¾ä¸­ï¼š

- æˆ‘ä»¬åˆ›å»ºäº†ä¸¤ä¸ªæ•°æ®å·ï¼š`conf`ã€`html`
- Nginxå®¹å™¨å†…éƒ¨çš„`conf`ç›®å½•å’Œ`html`ç›®å½•åˆ†åˆ«ä¸**ä¸¤ä¸ªæ•°æ®å·å…³è”**ã€‚
- è€Œæ•°æ®å·confå’Œhtmlåˆ†åˆ«æŒ‡å‘äº†å®¿ä¸»æœºçš„`/var/lib/docker/volumes/conf/_data`ç›®å½•å’Œ`/var/lib/docker/volumes/html/_data`ç›®å½•

è¿™æ ·ä»¥æ¥ï¼Œå®¹å™¨å†…çš„`conf`å’Œ`html`ç›®å½•å°± ä¸å®¿ä¸»æœºçš„`conf`å’Œ`html`ç›®å½•å…³è”èµ·æ¥ï¼Œæˆ‘ä»¬ç§°ä¸º**==æŒ‚è½½==**ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬æ“ä½œå®¿ä¸»æœºçš„`/var/lib/docker/volumes/html/_data`å°±æ˜¯åœ¨æ“ä½œå®¹å™¨å†…çš„`/usr/share/nginx/html/_data`ç›®å½•ã€‚åªè¦æˆ‘ä»¬**å°†é™æ€èµ„æºæ”¾å…¥å®¿ä¸»æœºå¯¹åº”ç›®å½•ï¼Œå°±å¯ä»¥è¢«Nginxä»£ç†äº†**ã€‚

**å°æç¤º**ï¼š

`/var/lib/docker/volumes`è¿™ä¸ªç›®å½•å°±æ˜¯==é»˜è®¤çš„å­˜æ”¾**æ‰€æœ‰å®¹å™¨æ•°æ®å·çš„ç›®å½•**==ï¼Œå…¶ä¸‹å†æ ¹æ®æ•°æ®å·åç§°åˆ›å»ºæ–°ç›®å½•ï¼Œæ ¼å¼ä¸º`/æ•°æ®å·å/_data`ã€‚

**ä¸ºä»€ä¹ˆä¸è®©å®¹å™¨ç›®å½•ç›´æ¥æŒ‡å‘**å®¿ä¸»æœºç›®å½•å‘¢ï¼Ÿ

- å› ä¸ºç›´æ¥æŒ‡å‘å®¿ä¸»æœºç›®å½•å°±ä¸å®¿ä¸»æœº**å¼ºè€¦åˆ**äº†ï¼Œå¦‚æœåˆ‡æ¢äº†ç¯å¢ƒï¼Œå®¿ä¸»æœºç›®å½•å°±å¯èƒ½å‘ç”Ÿæ”¹å˜äº†ã€‚ç”±äºå®¹å™¨ä¸€æ—¦åˆ›å»ºï¼Œç›®å½•æŒ‚è½½å°±æ— æ³•ä¿®æ”¹ï¼Œè¿™æ ·å®¹å™¨å°±æ— æ³•æ­£å¸¸å·¥ä½œäº†ã€‚
- ä½†æ˜¯å®¹å™¨æŒ‡å‘æ•°æ®å·ï¼Œä¸€ä¸ª**é€»è¾‘åç§°**ï¼Œè€Œæ•°æ®å·å†æŒ‡å‘å®¿ä¸»æœºç›®å½•ï¼Œå°±ä¸å­˜åœ¨å¼ºè€¦åˆã€‚å¦‚æœå®¿ä¸»æœºç›®å½•å‘ç”Ÿæ”¹å˜ï¼Œåªè¦æ”¹å˜æ•°æ®å·ä¸å®¿ä¸»æœºç›®å½•ä¹‹é—´çš„**æ˜ å°„å…³ç³»**å³å¯ã€‚

**ä¸è¿‡**ï¼Œæˆ‘ä»¬é€šè¿‡ç”±äºæ•°æ®å·ç›®å½•æ¯”è¾ƒæ·±ï¼Œä¸å¥½å¯»æ‰¾ï¼Œé€šå¸¸æˆ‘ä»¬ä¹Ÿ**å…è®¸è®©å®¹å™¨==ç›´æ¥==ä¸å®¿ä¸»æœºç›®å½•==æŒ‚è½½==è€Œä¸ä½¿ç”¨æ•°æ®å·**ï¼Œå…·ä½“å‚è€ƒ2.2.3å°èŠ‚ã€‚

### 2.2.2.æ•°æ®å·==å‘½ä»¤==

æ•°æ®å·çš„ç›¸å…³å‘½ä»¤æœ‰ï¼š

| **å‘½ä»¤**                | **è¯´æ˜**                             | **æ–‡æ¡£åœ°å€**                                                 |
| :---------------------- | :----------------------------------- | :----------------------------------------------------------- |
| docker volume create    | åˆ›å»ºæ•°æ®å·                           | [docker volume create](https://docs.docker.com/engine/reference/commandline/volume_create/) |
| docker volume ls        | æŸ¥çœ‹æ‰€æœ‰æ•°æ®å·                       | [docs.docker.com](https://docs.docker.com/engine/reference/commandline/volume_ls/) |
| docker volume rm        | åˆ é™¤æŒ‡å®šæ•°æ®å·                       | [docs.docker.com](https://docs.docker.com/engine/reference/commandline/volume_prune/) |
| docker volume inspect   | æŸ¥çœ‹æŸä¸ªæ•°æ®å·çš„è¯¦æƒ…                 | [docs.docker.com](https://docs.docker.com/engine/reference/commandline/volume_inspect/) |
| docker volume ==prune== | **æ¸…é™¤æ‰€æœ‰==æœªè¿è¡Œ==çš„å®¹å™¨çš„æ•°æ®å·** | [docker volume prune](https://docs.docker.com/engine/reference/commandline/volume_prune/) |

æ³¨æ„ï¼šå®¹å™¨ä¸æ•°æ®å·çš„**==æŒ‚è½½==**è¦åœ¨åˆ›å»ºå®¹å™¨æ—¶é…ç½®ï¼Œ**å¯¹äºåˆ›å»ºå¥½çš„å®¹å™¨ï¼Œæ˜¯==ä¸èƒ½è®¾ç½®æ•°æ®å·==çš„**ã€‚è€Œä¸”**åˆ›å»ºå®¹å™¨çš„è¿‡ç¨‹ä¸­ï¼Œæ•°æ®å·ä¼šè‡ªåŠ¨åˆ›å»º**ã€‚

![image-20240910223131421-1732518818907-289](Docker-Learning-Local.assets/image-20240910223131421-1732518818907-289.png)

æ•™å­¦**æ¼”ç¤ºç¯èŠ‚**ï¼šæ¼”ç¤ºä¸€ä¸‹nginxçš„htmlç›®å½•æŒ‚è½½

#### ï¼ˆ1ï¼‰==docker volume create== -åˆ›å»ºæ•°æ®å·  

[docker volume create](https://docs.docker.com/engine/reference/commandline/volume_create/)



#### ï¼ˆ2ï¼‰==docker volume ls==  -æŸ¥çœ‹æ‰€æœ‰æ•°æ®å·  

[docs.docker.com](https://docs.docker.com/engine/reference/commandline/volume_ls/)



#### ï¼ˆ3ï¼‰==docker volume rm==  -åˆ é™¤æŒ‡å®šæ•°æ®å·  

[docs.docker.com](https://docs.docker.com/engine/reference/commandline/volume_prune/)



#### ï¼ˆ4ï¼‰==docker volume inspect==  -æŸ¥çœ‹æŸä¸ªæ•°æ®å·çš„è¯¦æƒ…  

**ä¸»è¦æ˜¯ä¸ºäº†æ‰¾æŒ‚è½½çš„å®¿ä¸»æœºçš„ä½ç½®**

[docs.docker.com](https://docs.docker.com/engine/reference/commandline/volume_inspect/)

```powershell
# 3ã€æŸ¥çœ‹æ•°æ®å·è¯¦æƒ…
docker volume inspect html
# ç»“æœ
[
    {
        "CreatedAt": "2024-05-17T19:57:08+08:00",
        "Driver": "local",
        "Labels": null,
        "Mountpoint": "/var/lib/docker/volumes/html/_data", #æŒ‚è½½çš„å®¿ä¸»æœºçš„ä½ç½®
        "Name": "html",
        "Options": null,
        "Scope": "local"
    }
]
```



#### ï¼ˆ5ï¼‰==docker volume prune==  -æ¸…é™¤æ•°æ®å·  

[docker volume prune](https://docs.docker.com/engine/reference/commandline/volume_prune/)

**æ¸…é™¤æ‰€æœ‰==æœªè¿è¡Œ==çš„å®¹å™¨çš„æ•°æ®å·**



#### ï¼ˆ6ï¼‰==run-ç›®å½•æŒ‚è½½==

```powershell
#å¯¹äºåˆ›å»ºå¥½çš„å®¹å™¨ï¼Œæ˜¯ä¸èƒ½è®¾ç½®æ•°æ®å·çš„ï¼Œéœ€è¦å…ˆåˆ é™¤è¯¥å®¹å™¨
docker rm -f nginx

# 1ã€é¦–å…ˆåˆ›å»ºå®¹å™¨å¹¶æŒ‡å®šæ•°æ®å·ï¼Œæ³¨æ„é€šè¿‡ -v å‚æ•°æ¥æŒ‡å®šæ•°æ®å·
#/usr/share/nginx/html nginxä¸ºå®¹å™¨å†…çš„ç›®å½•ï¼›htmlä¸ºå®¿ä¸»æœºä¸­æ•°æ®å·çš„åç§°
docker run -d --name nginx -p 80:80 -v html:/usr/share/nginx/html nginx


# 2ã€ç„¶åæŸ¥çœ‹æ•°æ®å·
docker volume ls

# 3ã€æŸ¥çœ‹æ•°æ®å·è¯¦æƒ…
docker volume inspect html
# ç»“æœ
[
    {
        "CreatedAt": "2024-05-17T19:57:08+08:00",
        "Driver": "local",
        "Labels": null,
        "Mountpoint": "/var/lib/docker/volumes/html/_data", #æŒ‚è½½çš„å®¿ä¸»æœºçš„ä½ç½®
        "Name": "html",
        "Options": null,
        "Scope": "local"
    }
]

# 4.æŸ¥çœ‹/var/lib/docker/volumes/html/_dataç›®å½•
ll /var/lib/docker/volumes/html/_data
# å¯ä»¥çœ‹åˆ°ä¸nginxçš„htmlç›®å½•å†…å®¹ä¸€æ ·ï¼Œç»“æœå¦‚ä¸‹ï¼š
æ€»ç”¨é‡ 8
-rw-r--r--. 1 root root 497 12æœˆ 28 2021 50x.html
-rw-r--r--. 1 root root 615 12æœˆ 28 2021 index.html

# 5.è¿›å…¥è¯¥ç›®å½•ï¼Œå¹¶éšæ„ä¿®æ”¹index.htmlå†…å®¹
cd /var/lib/docker/volumes/html/_data
vi index.html

# 6.æ‰“å¼€é¡µé¢ï¼ŒæŸ¥çœ‹æ•ˆæœ

# 7.è¿›å…¥å®¹å™¨å†…éƒ¨ï¼ŒæŸ¥çœ‹/usr/share/nginx/htmlç›®å½•å†…çš„æ–‡ä»¶æ˜¯å¦å˜åŒ–
docker exec -it nginx bash
```



### 2.2.3.åŒ¿åæ•°æ®å·

**åˆ›å»ºå®¹å™¨æ—¶ï¼Œæ²¡æœ‰é€šè¿‡-vçš„æ–¹å¼æŒ‡å®šæ•°æ®å·çš„åç§°ï¼Œå®¹å™¨ä¼šè‡ªåŠ¨ç”Ÿæˆå¯¹åº”çš„åŒ¿åå·**

**==åŒ¿åå·==ï¼š**è‹¥è¯¥å®¹å™¨ï¼Œ**éœ€è¦æŒ‚è½½æ•°æ®å·**ï¼Œä½†æ˜¯**æ•°æ®å·æœªå®šä¹‰**ã€‚å®¹å™¨ä¼šè‡ªåŠ¨ç”Ÿæˆå¯¹åº”çš„**åŒ¿åå·**ã€‚



æ•™å­¦**æ¼”ç¤ºç¯èŠ‚**ï¼šæ¼”ç¤ºä¸€ä¸‹MySQLçš„==åŒ¿åæ•°æ®å·==

```PowerShell
# 1.æŸ¥çœ‹MySQLå®¹å™¨è¯¦ç»†ä¿¡æ¯
docker inspect mysql
# å…³æ³¨å…¶ä¸­.Config.Volumeséƒ¨åˆ†å’Œ.Mountséƒ¨åˆ†
```

æˆ‘ä»¬å…³æ³¨ä¸¤éƒ¨åˆ†å†…å®¹ï¼Œç¬¬ä¸€æ˜¯`.Config.Volumes`éƒ¨åˆ†ï¼š

```JSON
{
  "Config": {
    // ... ç•¥
    "Volumes": {
      "/var/lib/mysql": {}
    }
    // ... ç•¥
  }
}
```

å¯ä»¥å‘ç°è¿™ä¸ªmysqlå®¹å™¨å£°æ˜äº†ä¸€ä¸ªè‡ªå·±çš„æœ¬åœ°ç›®å½•ï¼Œ**éœ€è¦æŒ‚è½½æ•°æ®å·**ï¼Œä½†æ˜¯**æ•°æ®å·æœªå®šä¹‰**ã€‚è¿™å°±æ˜¯==åŒ¿åå·==ã€‚

ç„¶åï¼Œæˆ‘ä»¬å†çœ‹ç»“æœä¸­çš„`.Mounts`éƒ¨åˆ†ï¼š

```JSON
{
  "Mounts": [
    {
      "Type": "volume",
      "Name": "29524ff09715d3688eae3f99803a2796558dbd00ca584a25a4bbc193ca82459f", //æ•°æ®å·åå­—
      "Source": "/var/lib/docker/volumes/29524ff09715d3688eae3f99803a2796558dbd00ca584a25a4bbc193ca82459f/_data", 
        //æ•°æ®å·æ‰€åœ¨ç›®å½•
        
      "Destination": "/var/lib/mysql", //å¯¹åº”åœ¨å®¹å™¨å†…çš„ç›®å½•
      "Driver": "local",
    }
  ]
}
```

å¯ä»¥å‘ç°ï¼Œå…¶ä¸­æœ‰å‡ ä¸ªå…³é”®å±æ€§ï¼š

- Nameï¼šæ•°æ®å·åç§°ã€‚**ç”±äºå®šä¹‰å®¹å™¨æœªè®¾ç½®å®¹å™¨åï¼Œè¿™é‡Œçš„å°±æ˜¯åŒ¿åå·è‡ªåŠ¨ç”Ÿæˆçš„åå­—ï¼Œ==ä¸€ä¸²hash==å€¼**ã€‚
- Sourceï¼š**å®¿ä¸»æœºç›®å½•**
- Destination : **å®¹å™¨å†…çš„ç›®å½•**ï¼Œ==ä¹Ÿå°±æ˜¯æ•°æ®åº“çš„æ•°æ®ç›®å½•==

ä¸Šè¿°é…ç½®æ˜¯å°†å®¹å™¨å†…çš„`/var/lib/mysql`è¿™ä¸ªç›®å½•ï¼Œä¸æ•°æ®å·`29524ff09715d3688eae3f99803a2796558dbd00ca584a25a4bbc193ca82459f`**æŒ‚è½½**ã€‚äºæ˜¯åœ¨å®¿ä¸»æœºä¸­å°±æœ‰äº†`/var/lib/docker/volumes/29524ff09715d3688eae3f99803a2796558dbd00ca584a25a4bbc193ca82459f/_data`è¿™ä¸ªç›®å½•ã€‚è¿™å°±æ˜¯**åŒ¿åæ•°æ®å·å¯¹åº”çš„ç›®å½•**ï¼Œå…¶ä½¿ç”¨æ–¹å¼ä¸æ™®é€šæ•°æ®å·æ²¡æœ‰å·®åˆ«ã€‚

æ¥ä¸‹æ¥ï¼Œå¯ä»¥æŸ¥çœ‹è¯¥ç›®å½•ä¸‹çš„MySQLçš„dataæ–‡ä»¶ï¼š

```Bash
ls -l /var/lib/docker/volumes/29524ff09715d3688eae3f99803a2796558dbd00ca584a25a4bbc193ca82459f/_data
```

æ³¨æ„ï¼šæ¯ä¸€ä¸ªä¸åŒçš„é•œåƒï¼Œå°†æ¥**åˆ›å»ºå®¹å™¨åå†…éƒ¨æœ‰å“ªäº›ç›®å½•å¯ä»¥æŒ‚è½½**ï¼Œå¯ä»¥å‚è€ƒ**[DockerHub](https://hub.docker.com/)**å¯¹åº”çš„é¡µé¢





### 2.2.4.==æŒ‚è½½æœ¬åœ°==ç›®å½•æˆ–æ–‡ä»¶

![image-20241125200014314](./Docker-Learning-Local.assets/image-20241125200014314.png)

å¯ä»¥å‘ç°ï¼Œ**æ•°æ®å·çš„ç›®å½•ç»“æ„è¾ƒæ·±**ï¼Œå¦‚æœæˆ‘ä»¬å»æ“ä½œæ•°æ®å·ç›®å½•ä¼šä¸å¤ªæ–¹ä¾¿ã€‚åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼š**ç›´æ¥å°†å®¹å™¨ç›®å½•ä¸==å®¿ä¸»æœºæŒ‡å®šç›®å½•==æŒ‚è½½**ã€‚æŒ‚è½½è¯­æ³•ä¸æ•°æ®å·ç±»ä¼¼ï¼š

```Bash
# æŒ‚è½½æœ¬åœ°ç›®å½•
-v æœ¬åœ°ç›®å½•:å®¹å™¨å†…ç›®å½•
# æŒ‚è½½æœ¬åœ°æ–‡ä»¶
-v æœ¬åœ°æ–‡ä»¶:å®¹å™¨å†…æ–‡ä»¶
```

**æ³¨æ„**ï¼šæœ¬åœ°ç›®å½•æˆ–æ–‡ä»¶==å¿…é¡»ä»¥ `/` æˆ– `./`å¼€å¤´==ï¼Œå¦‚æœç›´æ¥ä»¥åå­—å¼€å¤´ï¼Œ**==ä¼šè¢«è¯†åˆ«ä¸ºæ•°æ®å·å==è€Œéæœ¬åœ°ç›®å½•å**ã€‚

![image-20240910225225237-1732518818907-290](Docker-Learning-Local.assets/image-20240910225225237-1732518818907-290.png)

ä¾‹å¦‚ï¼š

```Bash
-v mysql:/var/lib/mysql # ä¼šè¢«è¯†åˆ«ä¸ºä¸€ä¸ªæ•°æ®å·å«mysqlï¼Œè¿è¡Œæ—¶ä¼šè‡ªåŠ¨åˆ›å»ºè¿™ä¸ªæ•°æ®å·
-v ./mysql:/var/lib/mysql # ä¼šè¢«è¯†åˆ«ä¸ºå½“å‰ç›®å½•ä¸‹çš„mysqlç›®å½•ï¼Œè¿è¡Œæ—¶å¦‚æœä¸å­˜åœ¨ä¼šåˆ›å»ºç›®å½•
```

**==æŸ¥çœ‹DockerHubç½‘ç«™ï¼ŒæŸ¥è¯¢MySQLå®¹å™¨å¯ä»¥æŒ‚è½½é‚£äº›ç›®å½•==**

**æ•™å­¦æ¼”ç¤º**ï¼Œåˆ é™¤å¹¶é‡æ–°åˆ›å»ºmysqlå®¹å™¨ï¼Œå¹¶å®Œæˆæœ¬åœ°ç›®å½•æŒ‚è½½ï¼š

- æŒ‚è½½`/root/mysql/data`åˆ°å®¹å™¨å†…çš„`/var/lib/mysql`ç›®å½• ï¼ˆä¿å­˜å„ä¸ªæ•°æ®åº“çš„ç›®å½•ï¼‰
- æŒ‚è½½`/root/mysql/init`åˆ°å®¹å™¨å†…çš„`/docker-entrypoint-initdb.d`ç›®å½•ï¼ˆ**åˆå§‹åŒ–çš„SQLè„šæœ¬ç›®å½•**ï¼‰
- æŒ‚è½½`/root/mysql/conf`åˆ°å®¹å™¨å†…çš„`/etc/mysql/conf.d`ç›®å½•ï¼ˆè¿™ä¸ªæ˜¯**MySQLé…ç½®æ–‡ä»¶ç›®å½•**ï¼‰

åœ¨è¯¾å‰èµ„æ–™ä¸­å·²ç»å‡†å¤‡å¥½äº†mysqlçš„`init`ç›®å½•å’Œ`conf`ç›®å½•ï¼š

![img](./Docker-Learning-Local.assets/1725890609193-1-1732518736071-127-1732518818912-372.png)

ä»¥åŠå¯¹åº”çš„åˆå§‹åŒ–SQLè„šæœ¬å’Œé…ç½®æ–‡ä»¶ï¼š

![img](./Docker-Learning-Local.assets/1725890609193-2-1732518736071-129-1732518818912-373.png)

```shell
#hm.cnf é…ç½®æ–‡ä»¶ä¸»è¦æ˜¯é…ç½®äº†MySQLçš„é»˜è®¤ç¼–ç ï¼Œæ”¹ä¸º utf8mb4
[client]
default_character_set=utf8mb4
[mysql]
default_character_set=utf8mb4
[mysqld]
character_set_server=utf8mb4
collation_server=utf8mb4_unicode_ci
init_connect='SET NAMES utf8mb4'
```



![img](./Docker-Learning-Local.assets/1725890609193-3-1732518736071-131-1732518818912-374.png)

```sql
# xxx.sqlåˆ™æ˜¯åé¢æˆ‘ä»¬è¦åˆ›å»ºæ•°æ®åº“ï¼Œç”¨åˆ°çš„é¡¹ç›®çš„åˆå§‹åŒ–SQLè„šæœ¬ã€‚
...
```

å…¶ä¸­ï¼Œhm.cnfä¸»è¦æ˜¯é…ç½®äº†MySQLçš„é»˜è®¤ç¼–ç ï¼Œæ”¹ä¸º**utf8mb4**ï¼›è€Œhmall.sqlåˆ™æ˜¯åé¢æˆ‘ä»¬è¦ç”¨åˆ°çš„é»‘é©¬å•†åŸé¡¹ç›®çš„**åˆå§‹åŒ–SQLè„šæœ¬ã€‚**

æˆ‘ä»¬ç›´æ¥å°†æ•´ä¸ªmysqlç›®å½•ä¸Šä¼ è‡³è™šæ‹Ÿæœºçš„`/root`ç›®å½•ä¸‹ï¼š

![img](./Docker-Learning-Local.assets/1725890609193-4-1732518736071-133-1732518818912-375.png)

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¼”ç¤º**==æœ¬åœ°ç›®å½•æŒ‚è½½==**ï¼š

```Bash
# 1.åˆ é™¤åŸæ¥çš„MySQLå®¹å™¨
docker rm -f mysql

# 2.è¿›å…¥rootç›®å½•
cd ~

# åœ¨å®¿ä¸»æœºä¸Šåˆ›å»ºå¾…æŒ‚è½½çš„ç›®å½•ï¼›
#ä¹Ÿå¯ä»¥ä¸åˆ›å»ºï¼Œåˆ›å»ºå®¹å™¨æ—¶ï¼š-v ./mysql/data:/var/lib/mysql 
#ä¼šè¢«è¯†åˆ«ä¸ºå½“å‰ç›®å½•ä¸‹çš„mysqlç›®å½•ï¼Œè¿è¡Œæ—¶å¦‚æœä¸å­˜åœ¨ä¼šåˆ›å»ºç›®å½•
mkdir /mysql
cd mysql/
mkdir data
mkdir conf
mkdir init

#å°†hm.cnfé…ç½®æ–‡ä»¶å’Œåˆå§‹åŒ–SQLè„šæœ¬xx.sqlæ”¾å…¥å¯¹åº”ç›®å½•
#	hm.cnfé…ç½®æ–‡ä»¶ --> conf
#	xx.sql --> init

# 3.åˆ›å»ºå¹¶è¿è¡Œæ–°mysqlå®¹å™¨ï¼ŒæŒ‚è½½æœ¬åœ°ç›®å½•
 #ä¼šè¢«è¯†åˆ«ä¸ºå½“å‰ç›®å½•ä¸‹çš„mysqlç›®å½•ï¼Œè¿è¡Œæ—¶å¦‚æœä¸å­˜åœ¨ä¼šåˆ›å»ºç›®å½•
docker run -d \
  --name mysql \
  -p 3306:3306 \
  -e TZ=Asia/Shanghai \
  -e MYSQL_ROOT_PASSWORD=123 \
  -v /root/mysql/data:/var/lib/mysql \ 
  -v /root/mysql/conf:/etc/mysql/conf.d \
  -v /root/mysql/init:/docker-entrypoint-initdb.d \
  mysql
  
 å³
  
  docker run -d --name mysql -p 3306:3306 -e TZ=Asia/Shanghai -e MYSQL_ROOT_PASSWORD=123 -v /root/mysql/data:/var/lib/mysql -v /root/mysql/conf:/etc/mysql/conf.d -v /root/mysql/init:/docker-entrypoint-initdb.d mysql
  

# 4.æŸ¥çœ‹rootç›®å½•ï¼Œå¯ä»¥å‘ç°~/mysql/dataç›®å½•å·²ç»è‡ªåŠ¨åˆ›å»ºå¥½äº†
ls -l mysql
# ç»“æœï¼š
æ€»ç”¨é‡ 4
drwxr-xr-x. 2 root    root   20 5æœˆ  19 15:11 conf
drwxr-xr-x. 7 polkitd root 4096 5æœˆ  19 15:11 data
drwxr-xr-x. 2 root    root   23 5æœˆ  19 15:11 init

# æŸ¥çœ‹dataç›®å½•ï¼Œä¼šå‘ç°é‡Œé¢æœ‰å¤§é‡æ•°æ®åº“æ•°æ®ï¼Œè¯´æ˜æ•°æ®åº“å®Œæˆäº†åˆå§‹åŒ–
ls -l data

# 5.æŸ¥çœ‹MySQLå®¹å™¨å†…æ•°æ®
# 5.1.è¿›å…¥MySQL
docker exec -it mysql mysql -uroot -p123
# 5.2.æŸ¥çœ‹ç¼–ç è¡¨
show variables like "%char%";
# 5.3.ç»“æœï¼Œå‘ç°ç¼–ç æ˜¯utf8mb4æ²¡æœ‰é—®é¢˜
+--------------------------+--------------------------------+
| Variable_name            | Value                          |
+--------------------------+--------------------------------+
| character_set_client     | utf8mb4                        |
| character_set_connection | utf8mb4                        |
| character_set_database   | utf8mb4                        |
| character_set_filesystem | binary                         |
| character_set_results    | utf8mb4                        |
| character_set_server     | utf8mb4                        |
| character_set_system     | utf8mb3                        |
| character_sets_dir       | /usr/share/mysql-8.0/charsets/ |
+--------------------------+--------------------------------+

# 6.æŸ¥çœ‹æ•°æ®
# 6.1.æŸ¥çœ‹æ•°æ®åº“
show databases;
# ç»“æœï¼Œhmallæ˜¯é»‘é©¬å•†åŸæ•°æ®åº“
+--------------------+
| Database           |
+--------------------+
| hmall              |
| information_schema |
| mysql              |
| performance_schema |
| sys                |
+--------------------+
5 rows in set (0.00 sec)
# 6.2.åˆ‡æ¢åˆ°hmallæ•°æ®åº“
use hmall;
# 6.3.æŸ¥çœ‹è¡¨
show tables;
# ç»“æœï¼š
+-----------------+
| Tables_in_hmall |
+-----------------+
| address         |
| cart            |
| item            |
| order           |
| order_detail    |
| order_logistics |
| pay_order       |
| user            |
+-----------------+
# 6.4.æŸ¥çœ‹addressè¡¨æ•°æ®
+----+---------+----------+--------+----------+-------------+---------------+-----------+------------+-------+
| id | user_id | province | city   | town     | mobile      | street        | contact   | is_default | notes |
+----+---------+----------+--------+----------+-------------+---------------+-----------+------------+-------+
| 59 |       1 | åŒ—äº¬     | åŒ—äº¬   | æœé˜³åŒº    | 13900112222 | é‡‘ç‡•é¾™åŠå…¬æ¥¼   | æä½³è¯š    | 0          | NULL  |
| 60 |       1 | åŒ—äº¬     | åŒ—äº¬   | æœé˜³åŒº    | 13700221122 | ä¿®æ­£å¤§å¦       | æä½³çº¢    | 0          | NULL  |
| 61 |       1 | ä¸Šæµ·     | ä¸Šæµ·   | æµ¦ä¸œæ–°åŒº  | 13301212233 | èˆªå¤´é•‡èˆªå¤´è·¯   | æä½³æ˜Ÿ    | 1          | NULL  |
| 63 |       1 | å¹¿ä¸œ     | ä½›å±±   | æ°¸æ˜¥      | 13301212233 | æ°¸æ˜¥æ­¦é¦†       | ææ™“é¾™    | 0          | NULL  |
+----+---------+----------+--------+----------+-------------+---------------+-----------+------------+-------+
4 rows in set (0.00 sec)
```







## 2.3.==è‡ªå®šä¹‰é•œåƒ==

å‰é¢æˆ‘ä»¬ä¸€ç›´åœ¨ä½¿ç”¨åˆ«äººå‡†å¤‡å¥½çš„é•œåƒï¼Œé‚£å¦‚æœæˆ‘è¦éƒ¨ç½²ä¸€ä¸ªJavaé¡¹ç›®ï¼ŒæŠŠå®ƒæ‰“åŒ…ä¸ºä¸€ä¸ªé•œåƒè¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ

![image-20241125203548452](./Docker-Learning-Local.assets/image-20241125203548452.png)

### 2.3.1.é•œåƒç»“æ„

è¦æƒ³è‡ªå·±æ„å»ºé•œåƒï¼Œå¿…é¡»å…ˆäº†è§£é•œåƒçš„ç»“æ„ã€‚

ä¹‹å‰æˆ‘ä»¬è¯´è¿‡ï¼Œé•œåƒä¹‹æ‰€ä»¥èƒ½è®©æˆ‘ä»¬å¿«é€Ÿè·¨æ“ä½œç³»ç»Ÿéƒ¨ç½²åº”ç”¨è€Œ**å¿½ç•¥å…¶è¿è¡Œç¯å¢ƒã€é…ç½®**ï¼Œå°±æ˜¯å› ä¸º**é•œåƒä¸­åŒ…å«äº†ç¨‹åºè¿è¡Œéœ€è¦çš„ç³»ç»Ÿå‡½æ•°åº“ã€ç¯å¢ƒã€é…ç½®ã€ä¾èµ–ã€‚**

å› æ­¤ï¼Œ**==è‡ªå®šä¹‰é•œåƒæœ¬è´¨==**å°±æ˜¯**ä¾æ¬¡å‡†å¤‡å¥½ç¨‹åºè¿è¡Œçš„åŸºç¡€ç¯å¢ƒã€ä¾èµ–ã€åº”ç”¨æœ¬èº«ã€è¿è¡Œé…ç½®ç­‰æ–‡ä»¶ï¼Œå¹¶ä¸”æ‰“åŒ…è€Œæˆ**ã€‚

ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬è¦ä»0éƒ¨ç½²ä¸€ä¸ªJavaåº”ç”¨ï¼Œå¤§æ¦‚æµç¨‹æ˜¯è¿™æ ·ï¼š

- å‡†å¤‡ä¸€ä¸ªlinuxæœåŠ¡ï¼ˆCentOSæˆ–è€…Ubuntuå‡å¯ï¼‰
- å®‰è£…å¹¶é…ç½®JDK
- ä¸Šä¼ JaråŒ…
- è¿è¡ŒjaråŒ…

é‚£å› æ­¤ï¼Œæˆ‘ä»¬æ‰“åŒ…é•œåƒä¹Ÿæ˜¯åˆ†æˆè¿™ä¹ˆå‡ æ­¥ï¼š

- å‡†å¤‡Linuxè¿è¡Œç¯å¢ƒï¼ˆjavaé¡¹ç›®å¹¶ä¸éœ€è¦å®Œæ•´çš„æ“ä½œç³»ç»Ÿï¼Œä»…ä»…æ˜¯åŸºç¡€è¿è¡Œç¯å¢ƒå³å¯ï¼‰
- å®‰è£…å¹¶é…ç½®JDK
- æ‹· è´jaråŒ…
- **é…ç½®å¯åŠ¨è„šæœ¬**

ä¸Šè¿°æ­¥éª¤ä¸­çš„æ¯ä¸€æ¬¡æ“ä½œå…¶å®éƒ½æ˜¯åœ¨ç”Ÿäº§ä¸€äº›æ–‡ä»¶ï¼ˆç³»ç»Ÿè¿è¡Œç¯å¢ƒã€å‡½æ•°åº“ã€é…ç½®æœ€ç»ˆéƒ½æ˜¯ç£ç›˜æ–‡ä»¶ï¼‰ï¼Œæ‰€ä»¥**é•œåƒå°±æ˜¯==ä¸€å †æ–‡ä»¶çš„é›†åˆ==**ã€‚

ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé•œåƒæ–‡ä»¶ä¸æ˜¯éšæ„å †æ”¾çš„ï¼Œè€Œæ˜¯æŒ‰ç…§æ“ä½œçš„æ­¥éª¤åˆ†å±‚å åŠ è€Œæˆï¼Œæ¯ä¸€å±‚å½¢æˆçš„æ–‡ä»¶éƒ½ä¼šå•ç‹¬æ‰“åŒ…å¹¶æ ‡è®°ä¸€ä¸ªå”¯ä¸€idï¼Œç§°ä¸º**Layer**ï¼ˆ**å±‚**ï¼‰ã€‚è¿™æ ·ï¼Œ**å¦‚æœæˆ‘ä»¬æ„å»ºæ—¶ç”¨åˆ°çš„æŸäº›å±‚å…¶ä»–äººå·²ç»åˆ¶ä½œè¿‡ï¼Œå°±å¯ä»¥ç›´æ¥æ‹·è´ä½¿ç”¨è¿™äº›å±‚ï¼Œè€Œä¸ç”¨é‡å¤åˆ¶ä½œ**ã€‚

ä¾‹å¦‚ï¼Œç¬¬ä¸€æ­¥ä¸­éœ€è¦çš„Linuxè¿è¡Œç¯å¢ƒï¼Œé€šç”¨æ€§å°±å¾ˆå¼ºï¼Œæ‰€ä»¥Dockerå®˜æ–¹å°±åˆ¶ä½œäº†è¿™æ ·çš„**åªåŒ…å«Linuxè¿è¡Œç¯å¢ƒçš„é•œåƒ**ã€‚æˆ‘ä»¬åœ¨åˆ¶ä½œjavaé•œåƒæ—¶ï¼Œå°±æ— éœ€é‡å¤åˆ¶ä½œï¼Œç›´æ¥ä½¿ç”¨Dockerå®˜æ–¹æä¾›çš„CentOSæˆ–Ubuntué•œåƒä½œä¸º**åŸºç¡€é•œåƒ**ã€‚ç„¶å**å†æ­å»ºå…¶å®ƒå±‚**å³å¯ï¼Œè¿™æ ·é€å±‚æ­å»ºï¼Œæœ€ç»ˆæ•´ä¸ªJavaé¡¹ç›®çš„é•œåƒç»“æ„å¦‚å›¾æ‰€ç¤ºï¼š

![img](./Docker-Learning-Local.assets/1725890609193-5-1732518736071-135-1732518818912-376.png)

### 2.3.2.==Dockerfile==

ç”±äºåˆ¶ä½œé•œåƒçš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦é€å±‚å¤„ç†å’Œæ‰“åŒ…ï¼Œæ¯”è¾ƒå¤æ‚ï¼Œæ‰€ä»¥Dockerå°±æä¾›äº†**è‡ªåŠ¨æ‰“åŒ…é•œåƒçš„åŠŸèƒ½**ã€‚æˆ‘ä»¬åªéœ€è¦å°†æ‰“åŒ…çš„è¿‡ç¨‹ï¼Œæ¯ä¸€å±‚è¦åšçš„äº‹æƒ…**ç”¨å›ºå®šçš„è¯­æ³•å†™ä¸‹æ¥ï¼Œäº¤ç»™Dockerå»æ‰§è¡Œå³å¯**ã€‚

![image-20240911160643507-1732518818907-291](Docker-Learning-Local.assets/image-20240911160643507-1732518818907-291.png)

è€Œè¿™ç§è®°å½•é•œåƒç»“æ„çš„æ–‡ä»¶å°±ç§°ä¸º**Dockerfile**ï¼Œå…¶å¯¹åº”çš„**è¯­æ³•**å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š

https://docs.docker.com/engine/reference/builder/

å…¶ä¸­çš„è¯­æ³•æ¯”è¾ƒå¤šï¼Œæ¯”è¾ƒå¸¸ç”¨çš„æœ‰ï¼š

| **æŒ‡ä»¤**       | **è¯´æ˜**                                                     | **ç¤ºä¾‹**                     |
| :------------- | :----------------------------------------------------------- | :--------------------------- |
| **FROM**       | æŒ‡å®š==åŸºç¡€é•œåƒ==                                             | `FROM centos:6`              |
| **ENV**        | è®¾ç½®==ç¯å¢ƒå˜é‡==ï¼Œå¯åœ¨åé¢æŒ‡ä»¤ä½¿ç”¨                           | `ENV key value`              |
| **COPY**       | ==æ‹·è´==æœ¬åœ°æ–‡ä»¶åˆ°==é•œåƒ==çš„æŒ‡å®šç›®å½•                         | `COPY ./xx.jar /tmp/app.jar` |
| **RUN**        | æ‰§è¡ŒLinuxçš„shellå‘½ä»¤ï¼Œä¸€èˆ¬æ˜¯==å®‰è£…==è¿‡ç¨‹çš„å‘½ä»¤               | `RUN yum install gcc`        |
| **EXPOSE**     | æŒ‡å®š==å®¹å™¨è¿è¡Œæ—¶ç›‘å¬çš„ç«¯å£==ï¼Œæ˜¯ç»™==é•œåƒä½¿ç”¨è€…çœ‹çš„==(åªæ˜¯ä¸€ä¸ªè¯´æ˜) | EXPOSE 8080                  |
| **ENTRYPOINT** | é•œåƒä¸­åº”ç”¨çš„å¯åŠ¨å‘½ä»¤ï¼Œå®¹å™¨è¿è¡Œæ—¶è°ƒç”¨                         | ENTRYPOINT java -jar xx.jar  |

ä¾‹å¦‚ï¼Œè¦åŸºäºUbuntué•œåƒæ¥æ„å»ºä¸€ä¸ªJavaåº”ç”¨ï¼Œå…¶Dockerfileå†…å®¹å¦‚ä¸‹ï¼š

![image-20241125203828404](./Docker-Learning-Local.assets/image-20241125203828404.png)

```Dockerfile
 # æŒ‡å®šåŸºç¡€é•œåƒ
FROM ubuntu:16.04
# é…ç½®ç¯å¢ƒå˜é‡ï¼ŒJDKçš„å®‰è£…ç›®å½•ã€å®¹å™¨å†…æ—¶åŒº
ENV JAVA_DIR=/usr/local
ENV TZ=Asia/Shanghai
# æ‹·è´jdkå’Œjavaé¡¹ç›®çš„åŒ…
COPY ./jdk8.tar.gz $JAVA_DIR/
COPY ./docker-demo.jar /tmp/app.jar
# è®¾å®šæ—¶åŒº
RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone
# å®‰è£…JDK
RUN cd $JAVA_DIR \
 && tar -xf ./jdk8.tar.gz \
 && mv ./jdk1.8.0_144 ./java8
# é…ç½®ç¯å¢ƒå˜é‡
ENV JAVA_HOME=$JAVA_DIR/java8
ENV PATH=$PATH:$JAVA_HOME/bin
# æŒ‡å®šé¡¹ç›®ç›‘å¬çš„ç«¯å£ 
EXPOSE 8080
# å…¥å£ï¼Œjavaé¡¹ç›®çš„å¯åŠ¨å‘½ä»¤
ENTRYPOINT ["java", "-jar", "/app.jar"]
```

åŒå­¦ä»¬æ€è€ƒä¸€ä¸‹ï¼šä»¥åæˆ‘ä»¬ä¼šæœ‰å¾ˆå¤šå¾ˆå¤šjavaé¡¹ç›®éœ€è¦æ‰“åŒ…ä¸ºé•œåƒï¼Œä»–ä»¬**éƒ½éœ€è¦Linuxç³»ç»Ÿç¯å¢ƒã€JDKç¯å¢ƒè¿™ä¸¤å±‚**ï¼Œåªæœ‰ä¸Šé¢çš„3å±‚ä¸åŒï¼ˆå› ä¸ºjaråŒ…ä¸åŒï¼‰ã€‚å¦‚æœæ¯æ¬¡åˆ¶ä½œjavaé•œåƒéƒ½é‡å¤åˆ¶ä½œå‰ä¸¤å±‚é•œåƒï¼Œæ˜¯ä¸æ˜¯å¾ˆéº»çƒ¦ã€‚

æ‰€ä»¥ï¼Œå°±æœ‰äººæä¾›äº†**åŸºç¡€çš„ç³»ç»ŸåŠ JDKç¯å¢ƒ**ï¼Œæˆ‘ä»¬åœ¨æ­¤åŸºç¡€ä¸Šåˆ¶ä½œjavaé•œåƒï¼Œå°±å¯ä»¥**çœå»JDK**çš„é…ç½®äº†ï¼š

**==DockerFile==æ–‡ä»¶ï¼Œå…¶ä¸­çš„docker-demoéœ€è¦æŒ‰ç…§è‡ªå·±çš„é¡¹ç›®jaråŒ…å»ä¿®æ”¹**

```Dockerfile
# åŸºç¡€é•œåƒ
FROM openjdk:11.0-jre-buster
# è®¾å®šæ—¶åŒº
ENV TZ=Asia/Shanghai
RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone
# æ‹·è´jaråŒ…
COPY docker-demo.jar /app.jar
# å…¥å£
ENTRYPOINT ["java", "-jar", "/app.jar"]
```

æ˜¯ä¸æ˜¯ç®€å•å¤šäº†ã€‚ 

### 2.3.3.æ„å»ºé•œåƒ

![image-20241125204014045](./Docker-Learning-Local.assets/image-20241125204014045.png)

å½“Dockerfileæ–‡ä»¶å†™å¥½ä»¥åï¼Œå°±å¯ä»¥åˆ©ç”¨å‘½ä»¤æ¥æ„å»ºé•œåƒäº†ã€‚

åœ¨è¯¾å‰èµ„æ–™ä¸­ï¼Œæˆ‘ä»¬å‡†å¤‡å¥½äº†ä¸€ä¸ªdemoé¡¹ç›®åŠå¯¹åº”çš„Dockerfileï¼š

![img](./Docker-Learning-Local.assets/1725890609193-6-1732518736071-138-1732518818912-377.png)

é¦–å…ˆï¼Œæˆ‘ä»¬å°†è¯¾å‰èµ„æ–™æä¾›çš„`docker-demo.jar`åŒ…ä»¥åŠ`Dockerfile`æ‹·è´åˆ°è™šæ‹Ÿæœºçš„`/root/demo`ç›®å½•ï¼š

![img](./Docker-Learning-Local.assets/1725890609193-7-1732518736072-140-1732518818912-378.png)

ç„¶åï¼Œæ‰§è¡Œå‘½ä»¤ï¼Œæ„å»ºé•œåƒï¼š

```Bash
# è¿›å…¥é•œåƒç›®å½•
cd /root/demo
# å¼€å§‹æ„å»º
docker build -t docker-demo:1.0 .
```

å‘½ä»¤è¯´æ˜ï¼š

- `docker build `: å°±æ˜¯**æ„å»ºä¸€ä¸ªdockeré•œåƒ**
- `-t docker-demo:1.0` ï¼š`-t`å‚æ•°æ˜¯æŒ‡å®šé•œåƒçš„åç§°ï¼ˆ`repository`å’Œ`tag`ï¼‰
- `.` : æœ€åçš„ç‚¹æ˜¯æŒ‡**æ„å»ºæ—¶Dockerfileæ‰€åœ¨è·¯å¾„**ï¼Œç”±äºæˆ‘ä»¬è¿›å…¥äº†demoç›®å½•ï¼Œæ‰€ä»¥æŒ‡å®šçš„æ˜¯`.`ä»£è¡¨å½“å‰ç›®å½•ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æŒ‡å®šDockerfileç›®å½•ï¼š
  
  - ```Bash
    # ç›´æ¥æŒ‡å®šDockerfileç›®å½•
    docker build -t docker-demo:1.0 /root/demo
    ```

ç»“æœï¼š

![img](./Docker-Learning-Local.assets/1725890609193-8-1732518736072-142-1732518818912-379.png)

æŸ¥çœ‹é•œåƒåˆ—è¡¨ï¼š

```Bash
# æŸ¥çœ‹é•œåƒåˆ—è¡¨ï¼š
docker images
# ç»“æœ
REPOSITORY    TAG       IMAGE ID       CREATED          SIZE
docker-demo   1.0       d6ab0b9e64b9   27 minutes ago   327MB
nginx         latest    605c77e624dd   16 months ago    141MB
mysql         latest    3218b38490ce   17 months ago    516MB
```

ç„¶åå°è¯•è¿è¡Œè¯¥é•œåƒï¼š

```Bash
# 1.åˆ›å»ºå¹¶è¿è¡Œå®¹å™¨
docker run -d --name dd -p 8080:8080 docker-demo:1.0
# 2.æŸ¥çœ‹å®¹å™¨
dps
# ç»“æœ
CONTAINER ID   IMAGE             PORTS                                                  STATUS         NAMES
78a000447b49   docker-demo:1.0   0.0.0.0:8080->8080/tcp, :::8090->8090/tcp              Up 2 seconds   dd
f63cfead8502   mysql             0.0.0.0:3306->3306/tcp, :::3306->3306/tcp, 33060/tcp   Up 2 hours     mysql

# 3.è®¿é—®
curl localhost:8080/hello/count
# ç»“æœï¼š
<h5>>æ¬¢è¿è®¿é—®é»‘é©¬å•†åŸ, è¿™æ˜¯æ‚¨ç¬¬1æ¬¡è®¿é—®<h5>>
```



## 2.4.ç½‘ç»œ

ä¸ŠèŠ‚è¯¾æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªJavaé¡¹ç›®çš„å®¹å™¨ï¼Œè€ŒJavaé¡¹ç›®å¾€å¾€éœ€è¦è®¿é—®å…¶å®ƒå„ç§**ä¸­é—´ä»¶**ï¼Œä¾‹å¦‚**MySQLã€Redis**ç­‰ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬çš„**å®¹å™¨ä¹‹é—´èƒ½å¦äº’ç›¸è®¿é—®**å‘¢ï¼Ÿæˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹

é¦–å…ˆï¼Œæˆ‘ä»¬æŸ¥çœ‹ä¸‹MySQLå®¹å™¨çš„è¯¦ç»†ä¿¡æ¯ï¼Œé‡ç‚¹å…³æ³¨å…¶ä¸­çš„ç½‘ç»œIPåœ°å€ï¼š

```Bash
# 1.ç”¨åŸºæœ¬å‘½ä»¤ï¼Œå¯»æ‰¾Networks.bridge.IPAddresså±æ€§
docker inspect mysql
# ä¹Ÿå¯ä»¥ä½¿ç”¨formatè¿‡æ»¤ç»“æœ
docker inspect --format='{{range .NetworkSettings.Networks}}{{println .IPAddress}}{{end}}' mysql
# å¾—åˆ°IPåœ°å€å¦‚ä¸‹ï¼š
172.17.0.2

# 2.ç„¶åé€šè¿‡å‘½ä»¤è¿›å…¥ddå®¹å™¨
docker exec -it dd bash

# 3.åœ¨å®¹å™¨å†…ï¼Œé€šè¿‡pingå‘½ä»¤æµ‹è¯•ç½‘ç»œ
ping 172.17.0.2
# ç»“æœ
PING 172.17.0.2 (172.17.0.2) 56(84) bytes of data.
64 bytes from 172.17.0.2: icmp_seq=1 ttl=64 time=0.053 ms
64 bytes from 172.17.0.2: icmp_seq=2 ttl=64 time=0.059 ms
64 bytes from 172.17.0.2: icmp_seq=3 ttl=64 time=0.058 ms
```

å‘ç°å¯ä»¥äº’è”ï¼Œæ²¡æœ‰é—®é¢˜ã€‚

ä½†æ˜¯ï¼Œå®¹å™¨çš„ç½‘ç»œIPå…¶å®æ˜¯ä¸€ä¸ª**è™šæ‹Ÿçš„IP**ï¼Œ**å…¶å€¼å¹¶ä¸å›ºå®šä¸æŸä¸€ä¸ªå®¹å™¨ç»‘å®š**ï¼Œå¦‚æœæˆ‘ä»¬åœ¨**å¼€å‘æ—¶å†™æ­»æŸä¸ªIP**ï¼Œè€Œåœ¨éƒ¨ç½²æ—¶å¾ˆå¯èƒ½**MySQLå®¹å™¨çš„==IPä¼šå‘ç”Ÿå˜åŒ–==**ï¼Œè¿æ¥ä¼šå¤±è´¥ã€‚

![image-20240911162706892-1732518818907-292](Docker-Learning-Local.assets/image-20240911162706892-1732518818907-292.png)

![image-20240911165127797-1732518818907-293](Docker-Learning-Local.assets/image-20240911165127797-1732518818907-293.png)



- **1.è‹¥dockerå®¹å™¨æ„å»ºæ—¶ï¼Œä¸é€šè¿‡ ''==--network ç½‘æ¡¥å=='' çš„æ–¹å¼æ¥æŒ‡å®šéœ€è¦åŠ å…¥çš„ç½‘æ¡¥,ä¼šé»˜è®¤å°†æ–°æ„å»ºçš„å®¹å™¨åŠ å…¥é»˜è®¤çš„ç½‘å…³(ç½‘æ¡¥)ã€‚**

  - ```shell
    # ä¹Ÿå¯ä»¥åœ¨é€šè¿‡é•œåƒæ„å»ºå®¹å™¨æ—¶ï¼Œç›´æ¥åŠ å…¥æ–°çš„ç½‘æ¡¥,è€Œä¸åŠ å…¥é»˜è®¤çš„ç½‘æ¡¥
    docker run -d --name dd -p 8080:8080 --network hmall docker-demo:1.0 #ç›´æ¥å°†è¯¥å®¹å™¨åŠ å…¥åˆ°è‡ªå·±åˆ›å»ºçš„ç½‘ç»œ(ç½‘æ¡¥)hmall
    ```

- **2.å½“æ„å»ºæ—¶æŒ‡å®šäº†è‡ªå®šä¹‰çš„ç½‘æ¡¥ï¼Œè¯¥å®¹å™¨åªä¼šæœ‰è‡ªå®šä¹‰çš„ç½‘æ¡¥ï¼Œ**é»˜è®¤çš„ä¼šè¢«æ›¿ä»£

- **3.ä¸åŒçš„è™šæ‹Ÿç½‘æ¡¥ä¹‹é—´ï¼Œä¸èƒ½è¿›è¡Œé€šä¿¡ã€‚**

- **4.å®¹å™¨çš„ç½‘ç»œIP**å…¶å®æ˜¯ä¸€ä¸ª**è™šæ‹Ÿçš„IP**ï¼Œ**å…¶å€¼å¹¶ä¸å›ºå®š==ä¸æŸä¸€ä¸ªå®¹å™¨ç»‘å®š==**ï¼Œå¦‚æœæˆ‘ä»¬åœ¨**å¼€å‘æ—¶å†™æ­»æŸä¸ªIP**ï¼Œè€Œåœ¨éƒ¨ç½²æ—¶å¾ˆå¯èƒ½**MySQLå®¹å™¨çš„==IPä¼šå‘ç”Ÿå˜åŒ–==**ï¼Œè¿æ¥ä¼šå¤±è´¥ã€‚

  



æ‰€ä»¥ï¼Œæˆ‘ä»¬å¿…é¡»å€ŸåŠ©äº**dockerçš„ç½‘ç»œåŠŸèƒ½**æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå®˜æ–¹æ–‡æ¡£ï¼š

https://docs.docker.com/engine/reference/commandline/network/

å¸¸è§å‘½ä»¤ æœ‰ï¼š

| **å‘½ä»¤**                  | **è¯´æ˜**                             | **æ–‡æ¡£åœ°å€**                                                 |
| :------------------------ | :----------------------------------- | :----------------------------------------------------------- |
| docker network create     | åˆ›å»ºä¸€ä¸ªç½‘ç»œï¼Œ(åˆ›å»ºä¸€ä¸ª**==ç½‘æ¡¥==**) | [docker network create](https://docs.docker.com/engine/reference/commandline/network_create/) |
| docker network ls         | æŸ¥çœ‹æ‰€æœ‰ç½‘ç»œ                         | [docs.docker.com](https://docs.docker.com/engine/reference/commandline/network_ls/) |
| docker network rm         | åˆ é™¤æŒ‡å®šç½‘ç»œ                         | [docs.docker.com](https://docs.docker.com/engine/reference/commandline/network_rm/) |
| docker network prune      | **æ¸…é™¤æœªä½¿ç”¨**çš„ç½‘ç»œ                 | [docs.docker.com](https://docs.docker.com/engine/reference/commandline/network_prune/) |
| docker network connect    | **ä½¿æŒ‡å®šå®¹å™¨è¿æ¥åŠ å…¥æŸç½‘ç»œ**         | [docs.docker.com](https://docs.docker.com/engine/reference/commandline/network_connect/) |
| docker network disconnect | **ä½¿æŒ‡å®šå®¹å™¨è¿æ¥ç¦»å¼€æŸç½‘ç»œ**         | [docker network disconnect](https://docs.docker.com/engine/reference/commandline/network_disconnect/) |
| docker network inspect    | æŸ¥çœ‹ç½‘ç»œè¯¦ç»†ä¿¡æ¯                     | [docker network inspect](https://docs.docker.com/engine/reference/commandline/network_inspect/) |

### **è‡ªå®šä¹‰ç½‘ç»œ(==ç½‘æ¡¥==)**

æ•™å­¦æ¼”ç¤ºï¼š

```Bash
# 1.é¦–å…ˆé€šè¿‡å‘½ä»¤åˆ›å»ºä¸€ä¸ªç½‘ç»œ
docker network create hmall

# 2.ç„¶åæŸ¥çœ‹ç½‘ç»œ
docker network ls
# ç»“æœï¼š
NETWORK ID     NAME      DRIVER    SCOPE
639bc44d0a87   bridge    bridge    local
403f16ec62a2   hmall     bridge    local
0dc0f72a0fbb   host      host      local
cd8d3e8df47b   none      null      local
# å…¶ä¸­ï¼Œé™¤äº†hmallä»¥å¤–ï¼Œå…¶å®ƒéƒ½æ˜¯é»˜è®¤çš„ç½‘ç»œ

# 3.è®©ddå’Œmysqléƒ½åŠ å…¥è¯¥ç½‘ç»œï¼Œæ³¨æ„ï¼Œåœ¨åŠ å…¥ç½‘ç»œæ—¶å¯ä»¥é€šè¿‡--aliasç»™å®¹å™¨èµ·åˆ«å
# è¿™æ ·è¯¥ç½‘ç»œå†…çš„å…¶å®ƒå®¹å™¨å¯ä»¥ç”¨åˆ«åäº’ç›¸è®¿é—®ï¼
# 3.1.mysqlå®¹å™¨ï¼ŒæŒ‡å®šåˆ«åä¸ºdbï¼Œå¦å¤–æ¯ä¸€ä¸ªå®¹å™¨éƒ½æœ‰ä¸€ä¸ªåˆ«åæ˜¯å®¹å™¨å
docker network connect hmall mysql --alias db
# 3.2.ddå®¹å™¨ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„javaé¡¹ç›®
docker network connect hmall dd

# ä¹Ÿå¯ä»¥åœ¨é€šè¿‡é•œåƒæ„å»ºå®¹å™¨æ—¶ï¼Œç›´æ¥åŠ å…¥æ–°çš„ç½‘æ¡¥,è€Œä¸åŠ å…¥é»˜è®¤çš„ç½‘æ¡¥
docker run -d --name dd -p 8080:8080 --network hmall docker-demo:1.0 #ç›´æ¥å°†è¯¥å®¹å™¨åŠ å…¥åˆ°è‡ªå·±åˆ›å»ºçš„ç½‘ç»œ(ç½‘æ¡¥)hmall

# 4.è¿›å…¥ddå®¹å™¨ï¼Œå°è¯•åˆ©ç”¨åˆ«åè®¿é—®db
# 4.1.è¿›å…¥å®¹å™¨
docker exec -it dd bash
# 4.2.ç”¨dbåˆ«åè®¿é—®
ping db
# ç»“æœ
PING db (172.18.0.2) 56(84) bytes of data.
64 bytes from mysql.hmall (172.18.0.2): icmp_seq=1 ttl=64 time=0.070 ms
64 bytes from mysql.hmall (172.18.0.2): icmp_seq=2 ttl=64 time=0.056 ms
# 4.3.ç”¨å®¹å™¨åè®¿é—®
ping mysql
# ç»“æœï¼š
PING mysql (172.18.0.2) 56(84) bytes of data.
64 bytes from mysql.hmall (172.18.0.2): icmp_seq=1 ttl=64 time=0.044 ms
64 bytes from mysql.hmall (172.18.0.2): icmp_seq=2 ttl=64 time=0.054 ms
```

OKï¼Œç°åœ¨æ— éœ€è®°ä½IPåœ°å€ä¹Ÿå¯ä»¥å®ç°å®¹å™¨äº’è”äº†ã€‚

**æ€»ç»“**ï¼š

- åœ¨è‡ªå®šä¹‰ç½‘ç»œä¸­ï¼Œå¯ä»¥**ç»™å®¹å™¨èµ·å¤šä¸ªåˆ«å**ï¼Œé»˜è®¤çš„åˆ«åæ˜¯å®¹å™¨åæœ¬èº«
- **åœ¨åŒä¸€ä¸ªè‡ªå®šä¹‰ç½‘ç»œä¸­çš„å®¹å™¨ï¼Œå¯ä»¥é€šè¿‡åˆ«åäº’ç›¸è®¿é—®**





# ä¸‰ã€é¡¹ç›®éƒ¨ç½²

å¥½äº†ï¼Œæˆ‘ä»¬å·²ç»ç†Ÿæ‚‰äº†Dockerçš„åŸºæœ¬ç”¨æ³•ï¼Œæ¥ä¸‹æ¥å¯ä»¥å°è¯•éƒ¨ç½²é¡¹ç›®äº†ã€‚

åœ¨è¯¾å‰èµ„æ–™ä¸­å·²ç»æä¾›äº†ä¸€ä¸ªé»‘é©¬å•†åŸé¡¹ç›®ç»™å¤§å®¶ï¼Œå¦‚å›¾ï¼š

é¡¹ç›®è¯´æ˜ï¼š

- hmallï¼šå•†åŸçš„åç«¯ä»£ç 
- hmall-portalï¼šå•†åŸç”¨æˆ·ç«¯çš„å‰ç«¯ä»£ç 
- hmall-adminï¼šå•†åŸç®¡ç†ç«¯çš„å‰ç«¯ä»£ç 

éƒ¨ç½²çš„å®¹å™¨åŠç«¯å£è¯´æ˜ï¼š

| **é¡¹ç›®**     | **å®¹å™¨å** | **ç«¯å£**           | **å¤‡æ³¨**            |
| :----------- | :--------- | :----------------- | :------------------ |
| hmall        | hmall      | 8080               | é»‘é©¬å•†åŸåç«¯APIå…¥å£ |
| hmall-portal | nginx      | 18080              | é»‘é©¬å•†åŸç”¨æˆ·ç«¯å…¥å£  |
| hmall-admin  | 18081      | é»‘é©¬å•†åŸç®¡ç†ç«¯å…¥å£ |                     |
| mysql        | mysql      | 3306               | æ•°æ®åº“              |

åœ¨æ­£å¼éƒ¨ç½²å‰ï¼Œæˆ‘ä»¬å…ˆåˆ é™¤ä¹‹å‰çš„nginxã€ddä¸¤ä¸ªå®¹å™¨ï¼š

```Bash
docker rm -f nginx dd
```

mysqlå®¹å™¨ä¸­å·²ç»å‡†å¤‡å¥½äº†å•†åŸçš„æ•°æ®ï¼Œæ‰€ä»¥å°±ä¸å†åˆ é™¤äº†ã€‚

## 3.1.éƒ¨ç½²==Javaé¡¹ç›®==

`hmall`é¡¹ç›®æ˜¯ä¸€ä¸ªmavenèšåˆé¡¹ç›®ï¼Œä½¿ç”¨IDEAæ‰“å¼€`hmall`é¡¹ç›®ï¼ŒæŸ¥çœ‹é¡¹ç›®ç»“æ„å¦‚å›¾ï¼š

![img](./Docker-Learning-Local.assets/1725890609194-9-1732518736072-146-1732518818912-380.png)

æˆ‘ä»¬è¦éƒ¨ç½²çš„å°±æ˜¯å…¶ä¸­çš„`hm-service`ï¼Œå…¶ä¸­çš„é…ç½®æ–‡ä»¶é‡‡ç”¨äº†å¤šç¯å¢ƒçš„æ–¹å¼ï¼š

![img](./Docker-Learning-Local.assets/1725890609194-10-1732518736072-148-1732518818912-381.png)

å…¶ä¸­çš„`application-dev.yaml`æ˜¯**éƒ¨ç½²åˆ°å¼€å‘ç¯å¢ƒçš„é…ç½®**ï¼Œ`application-local.yaml`æ˜¯**æœ¬åœ°è¿è¡Œæ—¶**çš„é…ç½®ã€‚

æŸ¥çœ‹application.yamlï¼Œä½ ä¼šå‘ç°å…¶ä¸­çš„JDBCåœ°å€å¹¶æœªå†™æ­»ï¼Œè€Œæ˜¯è¯»å–å˜é‡ï¼š

![img](./Docker-Learning-Local.assets/1725890609194-11-1732518736072-150-1732518818912-382.png)

è¿™ä¸¤ä¸ªå˜é‡åœ¨`application-dev.yaml`å’Œ`application-local.yaml`ä¸­å¹¶ä¸ç›¸åŒï¼š

![img](./Docker-Learning-Local.assets/1725890609194-12-1732518736072-152-1732518818912-383.png)

åœ¨devå¼€å‘ç¯å¢ƒï¼ˆä¹Ÿå°±æ˜¯**==Dockeréƒ¨ç½²==**æ—¶ï¼‰é‡‡ç”¨äº†mysqlä½œä¸ºåœ°å€ï¼Œåˆšå¥½æ˜¯æˆ‘ä»¬çš„**mysqlå®¹å™¨å**ï¼Œåªè¦**ä¸¤è€…åœ¨ä¸€ä¸ªç½‘ç»œï¼Œå°±ä¸€å®šèƒ½äº’ç›¸è®¿é—®ã€‚**

æˆ‘ä»¬å°†é¡¹ç›®æ‰“åŒ…ï¼š

![img](./Docker-Learning-Local.assets/1725890609194-13-1732518736072-154-1732518818912-384.png)

ç»“æœï¼š

![img](./Docker-Learning-Local.assets/1725890609194-14-1732518736072-156-1732518818912-385.png)

å°†`hm-service`ç›®å½•ä¸‹çš„`Dockerfile`å’Œ`hm-service/target`ç›®å½•ä¸‹çš„`hm-service.jar`ä¸€èµ·ä¸Šä¼ åˆ°**è™šæ‹Ÿæœºçš„`root`ç›®å½•**ï¼š

![img](./Docker-Learning-Local.assets/1725890609194-15-1732518736072-158-1732518818912-386.png)

```dockerfile
# åŸºç¡€é•œåƒ
FROM openjdk:11.0-jre-buster
# è®¾å®šæ—¶åŒº
ENV TZ=Asia/Shanghai
RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone
# æ‹·è´jaråŒ…
COPY sky-take-out.jar /app.jar
# å…¥å£
ENTRYPOINT ["java", "-jar", "/app.jar"]
```



**==éƒ¨ç½²é¡¹ç›®==**ï¼š

```Bash
# 1.æ„å»ºé¡¹ç›®é•œåƒï¼Œä¸æŒ‡å®štagï¼Œåˆ™é»˜è®¤ä¸ºlatest
docker build -t hmall . 

# 2.æŸ¥çœ‹é•œåƒ
docker images
# ç»“æœ
REPOSITORY    TAG       IMAGE ID       CREATED          SIZE
hmall         latest    0bb07b2c34b9   43 seconds ago   362MB
docker-demo   1.0       49743484da68   24 hours ago     327MB
nginx         latest    605c77e624dd   16 months ago    141MB
mysql         latest    3218b38490ce   17 months ago    516MB

# 3.åˆ›å»ºå¹¶è¿è¡Œå®¹å™¨ï¼Œå¹¶é€šè¿‡--networkå°†å…¶åŠ å…¥hmallç½‘ç»œï¼Œè¿™æ ·æ‰èƒ½é€šè¿‡å®¹å™¨åè®¿é—®mysql

docker run -d --name hmall --network hmall -p 8080:8080 hmall
```

å‘½ä»¤è¯´æ˜ï¼š

- `docker build `: å°±æ˜¯**æ„å»ºä¸€ä¸ªdockeré•œåƒ**

- `-t docker-demo:1.0` ï¼š`-t`å‚æ•°æ˜¯æŒ‡å®šé•œåƒçš„åç§°ï¼ˆ`repository`å’Œ`tag`ï¼‰

- `.` : æœ€åçš„ç‚¹æ˜¯æŒ‡**æ„å»ºæ—¶Dockerfileæ‰€åœ¨è·¯å¾„**ï¼Œç”±äºæˆ‘ä»¬è¿›å…¥äº†demoç›®å½•ï¼Œæ‰€ä»¥æŒ‡å®šçš„æ˜¯`.`ä»£è¡¨å½“å‰ç›®å½•ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æŒ‡å®šDockerfileç›®å½•ï¼š

  - ```Bash
    # ç›´æ¥æŒ‡å®šDockerfileç›®å½•
    docker build -t docker-demo:1.0 /root/dem
    ```

- `docker run -d --name å®¹å™¨å --network ç½‘ç»œå -p 8080:8080 é•œåƒå `

  

æµ‹è¯•ï¼Œé€šè¿‡æµè§ˆå™¨è®¿é—®ï¼šhttp://ä½ çš„è™šæ‹Ÿæœºåœ°å€:8080/search/list

## 3.2.éƒ¨ç½²==å‰ç«¯==

`hmall-portal`å’Œ`hmall-admin`æ˜¯å‰ç«¯ä»£ç ï¼Œéœ€è¦åŸºäºnginxéƒ¨ç½²ã€‚åœ¨è¯¾å‰èµ„æ–™ä¸­å·²ç»ç»™å¤§å®¶æä¾›äº†nginxçš„éƒ¨ç½²ç›®å½•ï¼š

![img](./Docker-Learning-Local.assets/1725890609194-16-1732518736072-160-1732518818912-387.png)

å…¶ä¸­ï¼š

- `html`æ˜¯é™æ€èµ„æºç›®å½•ï¼Œæˆ‘ä»¬éœ€è¦æŠŠ`hmall-portal`ä»¥åŠ`hmall-admin`éƒ½å¤åˆ¶è¿›å»
- `nginx.conf`æ˜¯**nginxçš„==é…ç½®æ–‡ä»¶==**ï¼Œä¸»è¦æ˜¯å®Œæˆå¯¹`html`ä¸‹çš„**ä¸¤ä¸ªé™æ€èµ„æºç›®å½•åšä»£ç†**

æˆ‘ä»¬ç°åœ¨è¦åšçš„å°±æ˜¯æŠŠæ•´ä¸ªnginxç›®å½•ä¸Šä¼ åˆ°è™šæ‹Ÿæœºçš„`/root`ç›®å½•ä¸‹ï¼š

![img](./Docker-Learning-Local.assets/1725890609194-17-1732518736072-162-1732518818912-388.png)

ç„¶ååˆ›å»ºnginxå®¹å™¨å¹¶**å®Œæˆä¸¤ä¸ªæŒ‚è½½**ï¼š

- æŠŠ`/root/nginx/nginx.conf`æŒ‚è½½åˆ°`/etc/nginx/ng``inx.conf`
- æŠŠ`/root/nginx/html`æŒ‚è½½åˆ°`/usr/share/nginx/html`

ç”±äºéœ€è¦è®©**nginxåŒæ—¶ä»£ç†hmall-portalå’Œhmall-admin==ä¸¤å¥—å‰ç«¯èµ„æº==**ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦**æš´éœ²ä¸¤ä¸ªç«¯å£**ï¼š

- 18080ï¼šå¯¹åº”hmall-portal
- 18081ï¼šå¯¹åº”hmall-admin

å‘½ä»¤å¦‚ä¸‹ï¼š

```Bash
docker run -d \
  --name nginx \
  -p 18080:18080 \
  -p 18081:18081 \
  -v /root/nginx/html:/usr/share/nginx/html \
  -v /root/nginx/nginx.conf:/etc/nginx/nginx.conf \
  --network hmall \
  nginx
```

æµ‹è¯•ï¼Œé€šè¿‡æµè§ˆå™¨è®¿é—®ï¼šhttp://ä½ çš„è™šæ‹Ÿæœºip:18080

![img](./Docker-Learning-Local.assets/1725890609194-18-1732518736072-164-1732518818912-389.png)



## 3.3.==DockerCompose==

`<a>` id="DockerCompose">`</a>`

å¤§å®¶å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬éƒ¨ç½²ä¸€ä¸ªç®€å•çš„javaé¡¹ç›®ï¼Œå…¶ä¸­åŒ…å«3ä¸ªå®¹å™¨ï¼š

- MySQL
- Nginx
- Javaé¡¹ç›®

è€Œç¨å¾®å¤æ‚çš„é¡¹ç›®ï¼Œå…¶ä¸­è¿˜ä¼šæœ‰å„ç§å„æ ·çš„å…¶å®ƒä¸­é—´ä»¶ï¼Œéœ€è¦éƒ¨ç½²çš„ä¸œè¥¿è¿œä¸æ­¢3ä¸ªã€‚å¦‚æœè¿˜åƒä¹‹å‰é‚£æ ·æ‰‹åŠ¨çš„é€ä¸€éƒ¨ç½²ï¼Œå°±å¤ªéº»çƒ¦äº†ã€‚

è€ŒDocker Composeå°±å¯ä»¥å¸®åŠ©æˆ‘ä»¬å®ç°**==å¤šä¸ªç›¸äº’å…³è”==çš„Dockerå®¹å™¨çš„==å¿«é€Ÿéƒ¨ç½²==**ã€‚å®ƒå…è®¸ç”¨æˆ·é€šè¿‡ä¸€ä¸ªå•ç‹¬çš„ docker-compose.yml **==æ¨¡æ¿æ–‡ä»¶==**ï¼ˆYAML æ ¼å¼ï¼‰æ¥å®šä¹‰ä¸€ç»„ç›¸å…³è”çš„åº”ç”¨å®¹å™¨ã€‚

### 3.3.1.åŸºæœ¬è¯­æ³•

![image-20241125213754283](./Docker-Learning-Local.assets/image-20241125213754283.png)

**docker-compose.yml**æ–‡ä»¶çš„åŸºæœ¬è¯­æ³•å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š

https://docs.docker.com/compose/compose-file/compose-file-v3/

docker-composeæ–‡ä»¶ä¸­**å¯ä»¥å®šä¹‰å¤šä¸ªç›¸äº’å…³è”çš„åº”ç”¨å®¹å™¨**ï¼Œæ¯ä¸€ä¸ªåº”ç”¨å®¹å™¨è¢«ç§°ä¸ºä¸€ä¸ª**æœåŠ¡ï¼ˆserviceï¼‰**ã€‚ç”±äºserviceå°±æ˜¯åœ¨**å®šä¹‰æŸä¸ªåº”ç”¨çš„è¿è¡Œæ—¶å‚æ•°**ï¼Œå› æ­¤ä¸`docker run`å‚æ•°éå¸¸ç›¸ä¼¼ã€‚

ä¸¾ä¾‹æ¥è¯´ï¼Œç”¨docker runéƒ¨ç½²MySQLçš„å‘½ä»¤å¦‚ä¸‹ï¼š

```Bash
docker run -d \
  --name mysql \
  -p 3306:3306 \
  -e TZ=Asia/Shanghai \
  -e MYSQL_ROOT_PASSWORD=123 \
  -v ./mysql/data:/var/lib/mysql \
  -v ./mysql/conf:/etc/mysql/conf.d \
  -v ./mysql/init:/docker-entrypoint-initdb.d \
  --network hmall
  mysql
```

å¦‚æœç”¨`docker-compose.yml`æ–‡ä»¶æ¥å®šä¹‰ï¼Œå°±æ˜¯è¿™æ ·ï¼š

```YAML
version: "3.8"

services:
  mysql:
    image: mysql
    container_name: mysql
    ports:
      - "3306:3306"
    environment:
      TZ: Asia/Shanghai
      MYSQL_ROOT_PASSWORD: 123
    volumes:
      - "./mysql/conf:/etc/mysql/conf.d"
      - "./mysql/data:/var/lib/mysql"
    networks:
      - new
networks:
  new:
    name: hmall
```

å¯¹æ¯”å¦‚ä¸‹ï¼š

| **docker run å‚æ•°** | **docker compose æŒ‡ä»¤** | **è¯´æ˜**   |
| :------------------ | :---------------------- | :--------- |
| --name              | container_name          | å®¹å™¨åç§°   |
| -p                  | ports                   | ç«¯å£æ˜ å°„   |
| -e                  | environment             | ç¯å¢ƒå˜é‡   |
| -v                  | volumes                 | æ•°æ®å·é…ç½® |
| --network           | networks                | ç½‘ç»œ       |

æ˜ç™½äº†å…¶ä¸­çš„å¯¹åº”å…³ç³»ï¼Œç›¸ä¿¡ç¼–å†™`docker-compose`æ–‡ä»¶åº”è¯¥éš¾ä¸å€’å¤§å®¶ã€‚

é»‘é©¬å•†åŸéƒ¨ç½²æ–‡ä»¶ï¼š

```YAML
version: "3.8"

services:
  mysql:
    image: mysql
    container_name: mysql
    ports:
      - "3306:3306"
    environment:
      TZ: Asia/Shanghai
      MYSQL_ROOT_PASSWORD: 123
    volumes:
      - "/root/mysql/conf:/etc/mysql/conf.d"
      - "/root/mysql/data:/var/lib/mysql"
      - "/root/mysql/init:/docker-entrypoint-initdb.d"
    networks:
      - hm-net
  hmall:
    build: #é€šè¿‡buildæ„å»ºè‡ªå®šä¹‰çš„é•œåƒ
      context: .
      dockerfile: Dockerfile
    container_name: hmall
    ports:
      - "8080:8080"
    networks:
      - hm-net
    depends_on: #ä¾èµ–ä¸mysqlå®¹å™¨ï¼Œåˆ›å»ºæ—¶ä¼šå…ˆåˆ›å»ºmysqå®¹å™¨
      - mysql
  nginx:
    image: nginx
    container_name: nginx
    ports:
      - "18080:18080"
      - "18081:18081"
    volumes:
      - "/root/nginx/nginx.conf:/etc/nginx/nginx.conf"
      - "/root/nginx/html:/usr/share/nginx/html"
    depends_on:
      - hmall
    networks: #ç½‘æ®µ
      - hm-net
      
networks: #åˆ›å»ºè‡ªå®šä¹‰ç½‘ç»œ
  hm-net:
    name: hmall
```

### 3.3.2.åŸºç¡€å‘½ä»¤

ç¼–å†™å¥½docker-compose.ymlæ–‡ä»¶ï¼Œå°±å¯ä»¥**éƒ¨ç½²é¡¹ç›®**äº†ã€‚å¸¸è§çš„å‘½ä»¤ï¼š

https://docs.docker.com/compose/reference/

åŸºæœ¬è¯­æ³•å¦‚ä¸‹ï¼š

```Bash
docker compose [OPTIONS] [COMMAND]
```

å…¶ä¸­ï¼ŒOPTIONSå’ŒCOMMANDéƒ½æ˜¯å¯é€‰å‚æ•°ï¼Œæ¯”è¾ƒå¸¸è§çš„æœ‰ï¼š

| **ç±»å‹** | **å‚æ•°æˆ–æŒ‡ä»¤**                                               | **è¯´æ˜**                    |
| :------- | :----------------------------------------------------------- | :-------------------------- |
| Options  | -f                                                           | æŒ‡å®šcomposeæ–‡ä»¶çš„è·¯å¾„å’Œåç§° |
| -p       | æŒ‡å®šprojectåç§°ã€‚projectå°±æ˜¯å½“å‰composeæ–‡ä»¶ä¸­è®¾ç½®çš„å¤šä¸ªserviceçš„é›†åˆï¼Œæ˜¯é€»è¾‘æ¦‚å¿µ |                             |
| Commands | **up**                                                       | åˆ›å»ºå¹¶å¯åŠ¨æ‰€æœ‰serviceå®¹å™¨   |
| down     | åœæ­¢å¹¶ç§»é™¤æ‰€æœ‰å®¹å™¨ã€ç½‘ç»œ                                     |                             |
| ps       | åˆ—å‡ºæ‰€æœ‰å¯åŠ¨çš„å®¹å™¨                                           |                             |
| logs     | æŸ¥çœ‹æŒ‡å®šå®¹å™¨çš„æ—¥å¿—                                           |                             |
| stop     | åœæ­¢å®¹å™¨                                                     |                             |
| start    | å¯åŠ¨å®¹å™¨                                                     |                             |
| restart  | é‡å¯å®¹å™¨                                                     |                             |
| top      | æŸ¥çœ‹è¿è¡Œçš„è¿›ç¨‹                                               |                             |
| exec     | åœ¨æŒ‡å®šçš„è¿è¡Œä¸­å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤                                 |                             |

æ•™å­¦æ¼”ç¤ºï¼š

```Bash
# 1.è¿›å…¥rootç›®å½•
cd /root

# 2.åˆ é™¤æ—§å®¹å™¨
docker rm -f $(docker ps -qa)

# 3.åˆ é™¤hmallé•œåƒ
docker rmi hmall

# 4.æ¸…ç©ºMySQLæ•°æ®
rm -rf mysql/data

# 5.å¯åŠ¨æ‰€æœ‰, -d å‚æ•°æ˜¯åå°å¯åŠ¨
docker compose up -d
# ç»“æœï¼š
[+] Building 15.5s (8/8) FINISHED
 => [internal] load build definition from Dockerfile                                    0.0s
 => => transferring dockerfile: 358B                                                    0.0s
 => [internal] load .dockerignore                                                       0.0s
 => => transferring context: 2B                                                         0.0s
 => [internal] load metadata for docker.io/library/openjdk:11.0-jre-buster             15.4s
 => [1/3] FROM docker.io/library/openjdk:11.0-jre-buster@sha256:3546a17e6fb4ff4fa681c3  0.0s
 => [internal] load build context                                                       0.0s
 => => transferring context: 98B                                                        0.0s
 => CACHED [2/3] RUN ln -snf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime && echo   0.0s
 => CACHED [3/3] COPY hm-service.jar /app.jar                                           0.0s
 => exporting to image                                                                  0.0s
 => => exporting layers                                                                 0.0s
 => => writing image sha256:32eebee16acde22550232f2eb80c69d2ce813ed099640e4cfed2193f71  0.0s
 => => naming to docker.io/library/root-hmall                                           0.0s
[+] Running 4/4
 âœ” Network hmall    Created                                                             0.2s
 âœ” Container mysql  Started                                                             0.5s
 âœ” Container hmall  Started                                                             0.9s
 âœ” Container nginx  Started                                                             1.5s

# 6.æŸ¥çœ‹é•œåƒ
docker compose images
# ç»“æœ
CONTAINER           REPOSITORY          TAG                 IMAGE ID            SIZE
hmall               root-hmall          latest              32eebee16acd        362MB
mysql               mysql               latest              3218b38490ce        516MB
nginx               nginx               latest              605c77e624dd        141MB

# 7.æŸ¥çœ‹å®¹å™¨
docker compose ps
# ç»“æœ
NAME                IMAGE               COMMAND                  SERVICE             CREATED             STATUS              PORTS
hmall               root-hmall          "java -jar /app.jar"     hmall               54 seconds ago      Up 52 seconds       0.0.0.0:8080->8080/tcp, :::8080->8080/tcp
mysql               mysql               "docker-entrypoint.sâ€¦"   mysql               54 seconds ago      Up 53 seconds       0.0.0.0:3306->3306/tcp, :::3306->3306/tcp, 33060/tcp
nginx               nginx               "/docker-entrypoint.â€¦"   nginx               54 seconds ago      Up 52 seconds       80/tcp, 0.0.0.0:18080-18081->18080-18081/tcp, :::18080-18081->18080-18081/tcp
```

æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®ï¼šhttp://yourIp:8080



### 3.3.3 å¸¸è§é”™è¯¯

#### â‘  docker composeå¯åŠ¨å®¹å™¨æ—¶æŠ¥é”™ï¼š==iptables==: No chain/target/match by that name

![image-20240912131342245](./Docker-Learning-Local.assets/image-20240912131342245-1732518818908-294.png)

##### æ ¹æœ¬åŸå› ï¼š

docker æœåŠ¡å¯åŠ¨çš„æ—¶å€™ï¼ŒdockeræœåŠ¡ä¼šå‘iptablesæ³¨å†Œä¸€ä¸ªé“¾ï¼Œä»¥ä¾¿è®©dockeræœåŠ¡ç®¡ç†çš„å®¹å™¨æ‰€æš´éœ²çš„ç«¯å£ä¹‹é—´è¿›è¡Œé€šä¿¡

é€šè¿‡å‘½ä»¤ ``iptables -L` å¯ä»¥æŸ¥çœ‹iptables é“¾ã€‚æŸ¥çœ‹é“¾è·¯ï¼Œå‘ç°å¹¶æ²¡æœ‰ç›¸å…³ç«¯å£çš„iptables é“¾

![image.png](./Docker-Learning-Local.assets/krem4wdfua2mw_5623670b67e2400fb418c887f83fb5a5-1732518818908-295.png)

åœ¨å¼€å‘ç¯å¢ƒä¸­ï¼Œå¦‚æœä½ åˆ é™¤äº†iptablesä¸­çš„dockeré“¾ï¼Œæˆ–è€…iptablesçš„è§„åˆ™è¢«ä¸¢å¤±äº†ï¼ˆä¾‹å¦‚**é‡å¯é˜²ç«å¢™ï¼Œç¬”è€…å°±æ˜¯é‡å¯é˜²ç«å¢™å¯¼è‡´**ï¼‰ï¼Œdockerå°±ä¼šæŠ¥iptables errorä¾‹å¦‚ï¼š**iptables: No chain/target/match by that name**

![image.png](./Docker-Learning-Local.assets/krem4wdfua2mw_afa34bc4a8f44f8a82073b5f8efcbad5-1732518818908-296.png)



##### è§£å†³æ–¹æ¡ˆ

**é‡å¯dockeræœåŠ¡**ï¼Œä¹‹åï¼Œæ­£ç¡®çš„iptablesè§„åˆ™å°±ä¼šè¢«åˆ›å»ºå‡ºæ¥ã€‚å†æ¬¡æŸ¥çœ‹iptables é“¾ï¼Œç›¸å…³é“¾è·¯å·²ç»å‡ºç°ï¼ŒæœåŠ¡ä¹Ÿæ­£å¸¸å¯åŠ¨ã€‚

![krem4wdfua2mw_f531f9ed8ef54ff584adc3c088a620e8-1732518818908-297](Docker-Learning-Local.assets/krem4wdfua2mw_f531f9ed8ef54ff584adc3c088a620e8-1732518818908-297.png)

```powershell
#é‡å¯dockeræœåŠ¡
systemctl restart docker
```



# å››ã€Docker ==éƒ¨ç½²æµç¨‹==

## 1ã€ç½‘ç»œéƒ¨ç½²-è‡ªå®šä¹‰ç½‘ç»œ(==ç½‘æ¡¥==)

**å®¹å™¨çš„ç½‘ç»œIP**å…¶å®æ˜¯ä¸€ä¸ª**è™šæ‹Ÿçš„IP**ï¼Œ**å…¶å€¼å¹¶ä¸å›ºå®š==ä¸æŸä¸€ä¸ªå®¹å™¨ç»‘å®š==**ï¼Œå¦‚æœæˆ‘ä»¬åœ¨**å¼€å‘æ—¶å†™æ­»æŸä¸ªIP**ï¼Œè€Œåœ¨éƒ¨ç½²æ—¶å¾ˆå¯èƒ½**MySQLå®¹å™¨çš„==IPä¼šå‘ç”Ÿå˜åŒ–==**ï¼Œè¿æ¥ä¼šå¤±è´¥ã€‚

ä¸ºäº†è®©Mysqlå’ŒRedisç­‰ä¸­é—´ä»¶èƒ½å’Œé¡¹ç›®ç›¸äº’é€šè®¯ï¼Œå¯ä»¥==**è‡ªå®šä¹‰ç½‘æ¡¥**==ï¼Œ**è®©è¿™äº›éœ€è¦é€šä¿¡çš„å®¹å™¨åŠ å…¥åˆ°ä¸€ä¸ªç½‘ç»œä¸­**ã€‚

```bash
# 1.é¦–å…ˆé€šè¿‡å‘½ä»¤åˆ›å»ºä¸€ä¸ªç½‘ç»œ
docker network create sky-take-out
```

ä¸ŠèŠ‚è¯¾æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªJavaé¡¹ç›®çš„å®¹å™¨ï¼Œè€ŒJavaé¡¹ç›®å¾€å¾€éœ€è¦è®¿é—®å…¶å®ƒå„ç§**ä¸­é—´ä»¶**ï¼Œä¾‹å¦‚**MySQLã€Redis**ç­‰ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬çš„**å®¹å™¨ä¹‹é—´èƒ½å¦äº’ç›¸è®¿é—®**å‘¢ï¼Ÿæˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹

é¦–å…ˆï¼Œæˆ‘ä»¬æŸ¥çœ‹ä¸‹MySQLå®¹å™¨çš„è¯¦ç»†ä¿¡æ¯ï¼Œé‡ç‚¹å…³æ³¨å…¶ä¸­çš„ç½‘ç»œIPåœ°å€ï¼š

```Bash
# 1.ç”¨åŸºæœ¬å‘½ä»¤ï¼Œå¯»æ‰¾Networks.bridge.IPAddresså±æ€§
docker inspect mysql
# ä¹Ÿå¯ä»¥ä½¿ç”¨formatè¿‡æ»¤ç»“æœ
docker inspect --format='{{range .NetworkSettings.Networks}}{{println .IPAddress}}{{end}}' mysql
# å¾—åˆ°IPåœ°å€å¦‚ä¸‹ï¼š
172.17.0.2

# 2.ç„¶åé€šè¿‡å‘½ä»¤è¿›å…¥ddå®¹å™¨
docker exec -it dd bash

# 3.åœ¨å®¹å™¨å†…ï¼Œé€šè¿‡pingå‘½ä»¤æµ‹è¯•ç½‘ç»œ
ping 172.17.0.2
# ç»“æœ
PING 172.17.0.2 (172.17.0.2) 56(84) bytes of data.
64 bytes from 172.17.0.2: icmp_seq=1 ttl=64 time=0.053 ms
64 bytes from 172.17.0.2: icmp_seq=2 ttl=64 time=0.059 ms
64 bytes from 172.17.0.2: icmp_seq=3 ttl=64 time=0.058 ms
```

å‘ç°å¯ä»¥äº’è”ï¼Œæ²¡æœ‰é—®é¢˜ã€‚

ä½†æ˜¯ï¼Œå®¹å™¨çš„ç½‘ç»œIPå…¶å®æ˜¯ä¸€ä¸ª**è™šæ‹Ÿçš„IP**ï¼Œ**å…¶å€¼å¹¶ä¸å›ºå®šä¸æŸä¸€ä¸ªå®¹å™¨ç»‘å®š**ï¼Œå¦‚æœæˆ‘ä»¬åœ¨**å¼€å‘æ—¶å†™æ­»æŸä¸ªIP**ï¼Œè€Œåœ¨éƒ¨ç½²æ—¶å¾ˆå¯èƒ½**MySQLå®¹å™¨çš„==IPä¼šå‘ç”Ÿå˜åŒ–==**ï¼Œè¿æ¥ä¼šå¤±è´¥ã€‚

![image-20240911162706892-1732518818907-292](Docker-Learning-Local.assets/image-20240911162706892-1732518818907-292.png)

![image-20240911165127797-1732518818907-293](Docker-Learning-Local.assets/image-20240911165127797-1732518818907-293.png)



- **1.è‹¥dockerå®¹å™¨æ„å»ºæ—¶ï¼Œä¸é€šè¿‡ ''==--network ç½‘æ¡¥å=='' çš„æ–¹å¼æ¥æŒ‡å®šéœ€è¦åŠ å…¥çš„ç½‘æ¡¥,ä¼šé»˜è®¤å°†æ–°æ„å»ºçš„å®¹å™¨åŠ å…¥é»˜è®¤çš„ç½‘å…³(ç½‘æ¡¥)ã€‚**

  - ```shell
    # ä¹Ÿå¯ä»¥åœ¨é€šè¿‡é•œåƒæ„å»ºå®¹å™¨æ—¶ï¼Œç›´æ¥åŠ å…¥æ–°çš„ç½‘æ¡¥,è€Œä¸åŠ å…¥é»˜è®¤çš„ç½‘æ¡¥
    docker run -d --name dd -p 8080:8080 --network hmall docker-demo:1.0 #ç›´æ¥å°†è¯¥å®¹å™¨åŠ å…¥åˆ°è‡ªå·±åˆ›å»ºçš„ç½‘ç»œ(ç½‘æ¡¥)hmall
    ```

- **2.å½“æ„å»ºæ—¶æŒ‡å®šäº†è‡ªå®šä¹‰çš„ç½‘æ¡¥ï¼Œè¯¥å®¹å™¨åªä¼šæœ‰è‡ªå®šä¹‰çš„ç½‘æ¡¥ï¼Œ**é»˜è®¤çš„ä¼šè¢«æ›¿ä»£

- **3.ä¸åŒçš„è™šæ‹Ÿç½‘æ¡¥ä¹‹é—´ï¼Œä¸èƒ½è¿›è¡Œé€šä¿¡ã€‚**

- **4.å®¹å™¨çš„ç½‘ç»œIP**å…¶å®æ˜¯ä¸€ä¸ª**è™šæ‹Ÿçš„IP**ï¼Œ**å…¶å€¼å¹¶ä¸å›ºå®š==ä¸æŸä¸€ä¸ªå®¹å™¨ç»‘å®š==**ï¼Œå¦‚æœæˆ‘ä»¬åœ¨**å¼€å‘æ—¶å†™æ­»æŸä¸ªIP**ï¼Œè€Œåœ¨éƒ¨ç½²æ—¶å¾ˆå¯èƒ½**MySQLå®¹å™¨çš„==IPä¼šå‘ç”Ÿå˜åŒ–==**ï¼Œè¿æ¥ä¼šå¤±è´¥ã€‚

  



æ‰€ä»¥ï¼Œæˆ‘ä»¬å¿…é¡»å€ŸåŠ©äº**dockerçš„ç½‘ç»œåŠŸèƒ½**æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå®˜æ–¹æ–‡æ¡£ï¼š

https://docs.docker.com/engine/reference/commandline/network/

å¸¸è§å‘½ä»¤ æœ‰ï¼š

| **å‘½ä»¤**                  | **è¯´æ˜**                             | **æ–‡æ¡£åœ°å€**                                                 |
| :------------------------ | :----------------------------------- | :----------------------------------------------------------- |
| docker network create     | åˆ›å»ºä¸€ä¸ªç½‘ç»œï¼Œ(åˆ›å»ºä¸€ä¸ª**==ç½‘æ¡¥==**) | [docker network create](https://docs.docker.com/engine/reference/commandline/network_create/) |
| docker network ls         | æŸ¥çœ‹æ‰€æœ‰ç½‘ç»œ                         | [docs.docker.com](https://docs.docker.com/engine/reference/commandline/network_ls/) |
| docker network rm         | åˆ é™¤æŒ‡å®šç½‘ç»œ                         | [docs.docker.com](https://docs.docker.com/engine/reference/commandline/network_rm/) |
| docker network prune      | **æ¸…é™¤æœªä½¿ç”¨**çš„ç½‘ç»œ                 | [docs.docker.com](https://docs.docker.com/engine/reference/commandline/network_prune/) |
| docker network connect    | **ä½¿æŒ‡å®šå®¹å™¨è¿æ¥åŠ å…¥æŸç½‘ç»œ**         | [docs.docker.com](https://docs.docker.com/engine/reference/commandline/network_connect/) |
| docker network disconnect | **ä½¿æŒ‡å®šå®¹å™¨è¿æ¥ç¦»å¼€æŸç½‘ç»œ**         | [docker network disconnect](https://docs.docker.com/engine/reference/commandline/network_disconnect/) |
| docker network inspect    | æŸ¥çœ‹ç½‘ç»œè¯¦ç»†ä¿¡æ¯                     | [docker network inspect](https://docs.docker.com/engine/reference/commandline/network_inspect/) |

æ•™å­¦æ¼”ç¤ºï¼š**è‡ªå®šä¹‰ç½‘ç»œ(==ç½‘æ¡¥==)**

```Bash
# 1.é¦–å…ˆé€šè¿‡å‘½ä»¤åˆ›å»ºä¸€ä¸ªç½‘ç»œ
docker network create hmall

# 2.ç„¶åæŸ¥çœ‹ç½‘ç»œ
docker network ls
# ç»“æœï¼š
NETWORK ID     NAME      DRIVER    SCOPE
639bc44d0a87   bridge    bridge    local
403f16ec62a2   hmall     bridge    local
0dc0f72a0fbb   host      host      local
cd8d3e8df47b   none      null      local
# å…¶ä¸­ï¼Œé™¤äº†hmallä»¥å¤–ï¼Œå…¶å®ƒéƒ½æ˜¯é»˜è®¤çš„ç½‘ç»œ

# 3.è®©ddå’Œmysqléƒ½åŠ å…¥è¯¥ç½‘ç»œï¼Œæ³¨æ„ï¼Œåœ¨åŠ å…¥ç½‘ç»œæ—¶å¯ä»¥é€šè¿‡--aliasç»™å®¹å™¨èµ·åˆ«å
# è¿™æ ·è¯¥ç½‘ç»œå†…çš„å…¶å®ƒå®¹å™¨å¯ä»¥ç”¨åˆ«åäº’ç›¸è®¿é—®ï¼
# 3.1.mysqlå®¹å™¨ï¼ŒæŒ‡å®šåˆ«åä¸ºdbï¼Œå¦å¤–æ¯ä¸€ä¸ªå®¹å™¨éƒ½æœ‰ä¸€ä¸ªåˆ«åæ˜¯å®¹å™¨å
docker network connect hmall mysql --alias db
# 3.2.dbå®¹å™¨ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„javaé¡¹ç›®
docker network connect hmall dd

# ä¹Ÿå¯ä»¥åœ¨é€šè¿‡é•œåƒæ„å»ºå®¹å™¨æ—¶ï¼Œç›´æ¥åŠ å…¥æ–°çš„ç½‘æ¡¥,è€Œä¸åŠ å…¥é»˜è®¤çš„ç½‘æ¡¥
docker run -d --name dd -p 8080:8080 --network hmall docker-demo:1.0 #ç›´æ¥å°†è¯¥å®¹å™¨åŠ å…¥åˆ°è‡ªå·±åˆ›å»ºçš„ç½‘ç»œ(ç½‘æ¡¥)hmall

# 4.è¿›å…¥ddå®¹å™¨ï¼Œå°è¯•åˆ©ç”¨åˆ«åè®¿é—®db
# 4.1.è¿›å…¥å®¹å™¨
docker exec -it dd bash
# 4.2.ç”¨dbåˆ«åè®¿é—®
ping db
# ç»“æœ
PING db (172.18.0.2) 56(84) bytes of data.
64 bytes from mysql.hmall (172.18.0.2): icmp_seq=1 ttl=64 time=0.070 ms
64 bytes from mysql.hmall (172.18.0.2): icmp_seq=2 ttl=64 time=0.056 ms
# 4.3.ç”¨å®¹å™¨åè®¿é—®
ping mysql
# ç»“æœï¼š
PING mysql (172.18.0.2) 56(84) bytes of data.
64 bytes from mysql.hmall (172.18.0.2): icmp_seq=1 ttl=64 time=0.044 ms
64 bytes from mysql.hmall (172.18.0.2): icmp_seq=2 ttl=64 time=0.054 ms
```

OKï¼Œç°åœ¨æ— éœ€è®°ä½IPåœ°å€ä¹Ÿå¯ä»¥å®ç°å®¹å™¨äº’è”äº†ã€‚

- **æ€»ç»“**ï¼š
  - åœ¨è‡ªå®šä¹‰ç½‘ç»œä¸­ï¼Œå¯ä»¥**ç»™å®¹å™¨èµ·å¤šä¸ªåˆ«å**ï¼Œ**é»˜è®¤çš„åˆ«åæ˜¯å®¹å™¨åæœ¬èº«**
  - **åœ¨åŒä¸€ä¸ªè‡ªå®šä¹‰ç½‘ç»œä¸­çš„å®¹å™¨ï¼Œå¯ä»¥==é€šè¿‡åˆ«åäº’ç›¸è®¿é—®==**



## 2ã€ Dokcerå®¹å™¨-éƒ¨ç½²ä¸­é—´ä»¶

### ï¼ˆ1ï¼‰æ¡ˆä¾‹-MySQLéƒ¨ç½²

**åˆ›å»ºå®¹å™¨æ—¶è¿›è¡Œ==æŒ‚è½½æœ¬åœ°ç›®å½•==ã€==ç½‘ç»œéƒ¨ç½²==**

#### â‘  æ­£å¸¸éƒ¨ç½²

```powershell
docker run -d \
  --name mysql \
  -p 3306:3306 \
  -e TZ=Asia/Shanghai \
  -e MYSQL_ROOT_PASSWORD=123 \
  mysql
```



#### â‘¡ ==æŒ‚è½½==æœ¬åœ°ç›®å½•

```powershell
  #åˆ›å»ºå¹¶è¿è¡Œæ–°mysqlå®¹å™¨ï¼ŒæŒ‚è½½æœ¬åœ°ç›®å½•
docker run -d \
  --name mysql \
  -p 3306:3306 \
  -e TZ=Asia/Shanghai \
  -e MYSQL_ROOT_PASSWORD=123 \
  -v ./mysql/data:/var/lib/mysql \  #ä¼šè¢«è¯†åˆ«ä¸ºå½“å‰ç›®å½•ä¸‹çš„mysqlç›®å½•ï¼Œè¿è¡Œæ—¶å¦‚æœä¸å­˜åœ¨ä¼šåˆ›å»ºç›®å½•
  -v ./mysql/conf:/etc/mysql/conf.d \
  -v ./mysql/init:/docker-entrypoint-initdb.d \
  mysql
  
 å³ #æœ‰æ—¶å€™ä¸Šé¢çš„å‘½ä»¤å¯èƒ½ä¼šå› ä¸ºæ ¼å¼è€ŒæŠ¥é”™ï¼Œè¯·ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤
  docker run -d --name mysql -p 3306:3306 -e TZ=Asia/Shanghai -e MYSQL_ROOT_PASSWORD=123 -v ./mysql/data:/var/lib/mysql -v ./mysql/conf:/etc/mysql/conf.d -v ./mysql/init:/docker-entrypoint-initdb.d mysql
```



#### Mysqléƒ¨ç½²-åˆå§‹åŒ–å¾…æŒ‚è½½ç›®å½•

**==æŸ¥çœ‹DockerHubç½‘ç«™ï¼ŒæŸ¥è¯¢MySQLå®¹å™¨å¯ä»¥æŒ‚è½½é‚£äº›ç›®å½•==**

**æ•™å­¦æ¼”ç¤º**ï¼Œåˆ é™¤å¹¶é‡æ–°åˆ›å»ºmysqlå®¹å™¨ï¼Œå¹¶å®Œæˆæœ¬åœ°ç›®å½•æŒ‚è½½ï¼š

- æŒ‚è½½`/root/mysql/data`åˆ°å®¹å™¨å†…çš„`/var/lib/mysql`ç›®å½• ï¼ˆä¿å­˜==å„ä¸ªæ•°æ®åº“çš„ç›®å½•==ï¼‰
- æŒ‚è½½`/root/mysql/init`åˆ°å®¹å™¨å†…çš„`/docker-entrypoint-initdb.d`ç›®å½•ï¼ˆ**==åˆå§‹åŒ–çš„SQLè„šæœ¬ç›®å½•==**ï¼‰
- æŒ‚è½½`/root/mysql/conf`åˆ°å®¹å™¨å†…çš„`/etc/mysql/conf.d`ç›®å½•ï¼ˆè¿™ä¸ªæ˜¯**==MySQLé…ç½®æ–‡ä»¶ç›®å½•==**ï¼‰

åœ¨è¯¾å‰èµ„æ–™ä¸­å·²ç»å‡†å¤‡å¥½äº†mysqlçš„`init`ç›®å½•å’Œ`conf`ç›®å½•ï¼š

![1725890609193-1-1732518736071-127-1732518818912-372](Docker-Learning-Local.assets/1725890609193-1-1732518736071-127-1732518818912-372.png)

ä»¥åŠå¯¹åº”çš„åˆå§‹åŒ–SQLè„šæœ¬å’Œé…ç½®æ–‡ä»¶ï¼š

![1725890609193-2-1732518736071-129-1732518818912-373](Docker-Learning-Local.assets/1725890609193-2-1732518736071-129-1732518818912-373.png)

```shell
#hm.cnf é…ç½®æ–‡ä»¶ä¸»è¦æ˜¯é…ç½®äº†MySQLçš„é»˜è®¤ç¼–ç ï¼Œæ”¹ä¸º utf8mb4
[client]
default_character_set=utf8mb4
[mysql]
default_character_set=utf8mb4
[mysqld]
character_set_server=utf8mb4
collation_server=utf8mb4_unicode_ci
init_connect='SET NAMES utf8mb4'
```



![1725890609193-3-1732518736071-131-1732518818912-374](Docker-Learning-Local.assets/1725890609193-3-1732518736071-131-1732518818912-374.png)

```sql
# xxx.sqlåˆ™æ˜¯åé¢æˆ‘ä»¬è¦åˆ›å»ºæ•°æ®åº“ï¼Œç”¨åˆ°çš„é¡¹ç›®çš„åˆå§‹åŒ–SQLè„šæœ¬ã€‚
...
```

å…¶ä¸­ï¼Œhm.cnfä¸»è¦æ˜¯é…ç½®äº†MySQLçš„é»˜è®¤ç¼–ç ï¼Œæ”¹ä¸º**utf8mb4**ï¼›è€Œhmall.sqlåˆ™æ˜¯åé¢æˆ‘ä»¬è¦ç”¨åˆ°çš„é»‘é©¬å•†åŸé¡¹ç›®çš„**åˆå§‹åŒ–SQLè„šæœ¬ã€‚**

æˆ‘ä»¬ç›´æ¥å°†æ•´ä¸ªmysqlç›®å½•ä¸Šä¼ è‡³è™šæ‹Ÿæœºçš„`/root`ç›®å½•ä¸‹ï¼š

![1725890609193-4-1732518736071-133-1732518818912-375](Docker-Learning-Local.assets/1725890609193-4-1732518736071-133-1732518818912-375.png)



#### â‘¢ ==ç½‘ç»œéƒ¨ç½²==

```powershell
  #åˆ›å»ºå¹¶è¿è¡Œæ–°mysqlå®¹å™¨ï¼ŒæŒ‚è½½æœ¬åœ°ç›®å½•
docker run -d \
  --name mysql \
  -p 3306:3306 \
  -e TZ=Asia/Shanghai \
  -e MYSQL_ROOT_PASSWORD=123 \
  -v ./mysql/data:/var/lib/mysql \  #ä¼šè¢«è¯†åˆ«ä¸ºå½“å‰ç›®å½•ä¸‹çš„mysqlç›®å½•ï¼Œè¿è¡Œæ—¶å¦‚æœä¸å­˜åœ¨ä¼šåˆ›å»ºç›®å½•
  -v ./mysql/conf:/etc/mysql/conf.d \
  -v ./mysql/init:/docker-entrypoint-initdb.d \
  --network sky-take-out #å°†è¯¥å®¹å™¨éƒ¨ç½²åˆ°è‡ªå®šä¹‰çš„ç½‘ç»œä¸­
  mysql
  
 å³ #æœ‰æ—¶å€™ä¸Šé¢çš„å‘½ä»¤å¯èƒ½ä¼šå› ä¸ºæ ¼å¼è€ŒæŠ¥é”™ï¼Œè¯·ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤
  docker run -d --name mysql -p 3306:3306 -e TZ=Asia/Shanghai -e MYSQL_ROOT_PASSWORD=123 -v ./mysql/data:/var/lib/mysql -v ./mysql/conf:/etc/mysql/conf.d -v ./mysql/init:/docker-entrypoint-initdb.d --network sky-take-out mysql
```



#### ==â‘£ æ±‡æ€»éƒ¨ç½²==

```powershell
  #åˆ›å»ºå¹¶è¿è¡Œæ–°mysqlå®¹å™¨ï¼ŒæŒ‚è½½æœ¬åœ°ç›®å½•
docker run -d \
  --name mysql \
  -p 3306:3306 \
  -e TZ=Asia/Shanghai \
  -e MYSQL_ROOT_PASSWORD=123 \
  -v ./mysql/data:/var/lib/mysql \  #ä¼šè¢«è¯†åˆ«ä¸ºå½“å‰ç›®å½•ä¸‹çš„mysqlç›®å½•ï¼Œè¿è¡Œæ—¶å¦‚æœä¸å­˜åœ¨ä¼šåˆ›å»ºç›®å½•
  -v ./mysql/conf:/etc/mysql/conf.d \
  -v ./mysql/init:/docker-entrypoint-initdb.d \
  --network sky-take-out #å°†è¯¥å®¹å™¨éƒ¨ç½²åˆ°è‡ªå®šä¹‰çš„ç½‘ç»œä¸­
  mysql
  
 å³ #æœ‰æ—¶å€™ä¸Šé¢çš„å‘½ä»¤å¯èƒ½ä¼šå› ä¸ºæ ¼å¼è€ŒæŠ¥é”™ï¼Œè¯·ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤
  docker run -d --name mysql -p 3306:3306 -e TZ=Asia/Shanghai -e MYSQL_ROOT_PASSWORD=123 -v ./mysql/data:/var/lib/mysql -v ./mysql/conf:/etc/mysql/conf.d -v ./mysql/init:/docker-entrypoint-initdb.d --network sky-take-out mysql
```

> è§£è¯»ï¼š
>
> - `docker run -d` ï¼šåˆ›å»ºå¹¶è¿è¡Œä¸€ä¸ªå®¹å™¨ï¼Œ==`-d`==åˆ™æ˜¯è®©å®¹å™¨ä»¥==åå°è¿›ç¨‹è¿è¡Œ==
> - `--name`` mysql ` : ç»™å®¹å™¨èµ·ä¸ª==åå­—==å«`mysql`ï¼Œä½ å¯ä»¥å«åˆ«çš„
> - `-p 3306:3306` : è®¾ç½®==ç«¯å£æ˜ å°„==ã€‚
>   - **å®¹å™¨æ˜¯éš”ç¦»ç¯å¢ƒ**ï¼Œå¤–ç•Œä¸å¯è®¿é—®ã€‚ä½†æ˜¯å¯ä»¥**å°†å®¿ä¸»æœºç«¯å£æ˜ å°„å®¹å™¨å†…åˆ°ç«¯å£**ï¼Œå½“è®¿é—®å®¿ä¸»æœºæŒ‡å®šç«¯å£æ—¶ï¼Œå°±æ˜¯åœ¨è®¿é—®å®¹å™¨å†…çš„ç«¯å£äº†ã€‚
>   - å®¹å™¨å†…ç«¯å£å¾€å¾€æ˜¯ç”±å®¹å™¨å†…çš„è¿›ç¨‹å†³å®šï¼Œä¾‹å¦‚MySQLè¿›ç¨‹é»˜è®¤ç«¯å£æ˜¯3306ï¼Œå› æ­¤å®¹å™¨å†…ç«¯å£ä¸€å®šæ˜¯3306ï¼›è€Œå®¿ä¸»æœºç«¯å£åˆ™å¯ä»¥ä»»æ„æŒ‡å®šï¼Œä¸€èˆ¬ä¸å®¹å™¨å†…ä¿æŒä¸€è‡´ã€‚
>   - æ ¼å¼ï¼š `-p å®¿ä¸»æœºç«¯å£:å®¹å™¨å†…ç«¯å£`ï¼Œç¤ºä¾‹ä¸­å°±æ˜¯å°†å®¿ä¸»æœºçš„3306æ˜ å°„åˆ°å®¹å™¨å†…çš„3306ç«¯å£
> - `-``e`` TZ=Asia/Shanghai` : é…ç½®å®¹å™¨å†…è¿›ç¨‹è¿è¡Œæ—¶çš„ä¸€äº›å‚æ•°
>   - æ ¼å¼ï¼š`-e KEY=VALUE`ï¼ŒKEYå’ŒVALUEéƒ½ç”±==å®¹å™¨å†…è¿›ç¨‹å†³å®š==
>   - æ¡ˆä¾‹ä¸­ï¼Œ`TZ``=Asia/Shanghai`æ˜¯è®¾ç½®æ—¶åŒºï¼›`MYSQL_ROOT_PASSWORD=123`æ˜¯==è®¾ç½®MySQLé»˜è®¤å¯†ç ==
> - `-v` : æŒ‚è½½æœ¬åœ°ç›®å½•/æ–‡ä»¶
>   - -v æœ¬åœ°ç›®å½•:å®¹å™¨å†…ç›®å½•
>   - -v æœ¬åœ°æ–‡ä»¶:å®¹å™¨å†…æ–‡ä»¶
> - `--network`: å°†è¯¥å®¹å™¨åŠ å…¥è‡ªå®šä¹‰çš„ç½‘ç»œä¸­ï¼Œä¸è¯¥ç½‘ç»œä¸­çš„å…¶ä»–å®¹å™¨è¿›è¡Œé€šä¿¡
> - `mysql` : è®¾ç½®**é•œåƒ**åç§°ï¼ŒDockerä¼šæ ¹æ®è¿™ä¸ªåå­—æœç´¢å¹¶ä¸‹è½½é•œåƒ
>   - æ ¼å¼ï¼š`REPOSITORY:TAG`ï¼Œä¾‹å¦‚`mysql:8.0`ï¼Œå…¶ä¸­`REPOSITORY`å¯ä»¥ç†è§£ä¸ºé•œåƒåï¼Œ`TAG`æ˜¯ç‰ˆæœ¬å·
>   - åœ¨æœªæŒ‡å®š`TAG`çš„æƒ…å†µä¸‹ï¼Œ==é»˜è®¤æ˜¯æœ€æ–°ç‰ˆæœ¬==ï¼Œä¹Ÿå°±æ˜¯`mysql:latest`





## 3ã€Dockerå®¹å™¨-éƒ¨ç½²javaé¡¹ç›®

### ï¼ˆ1ï¼‰è‡ªåŠ¨æ‰“åŒ…==.jar==é•œåƒ-Dockerfile

ä¾‹å¦‚ï¼Œè¦åŸºäºUbuntué•œåƒæ¥æ„å»ºä¸€ä¸ªJavaåº”ç”¨ï¼Œå…¶Dockerfileå†…å®¹å¦‚ä¸‹ï¼š

```Dockerfile
# æŒ‡å®šåŸºç¡€é•œåƒ
FROM ubuntu:16.04
# é…ç½®ç¯å¢ƒå˜é‡ï¼ŒJDKçš„å®‰è£…ç›®å½•ã€å®¹å™¨å†…æ—¶åŒº
ENV JAVA_DIR=/usr/local
ENV TZ=Asia/Shanghai
# æ‹·è´jdkå’Œjavaé¡¹ç›®çš„åŒ…
COPY ./jdk8.tar.gz $JAVA_DIR/
COPY ./docker-demo.jar /tmp/app.jar
# è®¾å®šæ—¶åŒº
RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone
# å®‰è£…JDK
RUN cd $JAVA_DIR \
 && tar -xf ./jdk8.tar.gz \
 && mv ./jdk1.8.0_144 ./java8
# é…ç½®ç¯å¢ƒå˜é‡
ENV JAVA_HOME=$JAVA_DIR/java8
ENV PATH=$PATH:$JAVA_HOME/bin
# æŒ‡å®šé¡¹ç›®ç›‘å¬çš„ç«¯å£ 
EXPOSE 8080
# å…¥å£ï¼Œjavaé¡¹ç›®çš„å¯åŠ¨å‘½ä»¤
ENTRYPOINT ["java", "-jar", "/app.jar"]
```

åŒå­¦ä»¬æ€è€ƒä¸€ä¸‹ï¼šä»¥åæˆ‘ä»¬ä¼šæœ‰å¾ˆå¤šå¾ˆå¤šjavaé¡¹ç›®éœ€è¦æ‰“åŒ…ä¸ºé•œåƒï¼Œä»–ä»¬**éƒ½éœ€è¦Linuxç³»ç»Ÿç¯å¢ƒã€JDKç¯å¢ƒè¿™ä¸¤å±‚**ï¼Œåªæœ‰ä¸Šé¢çš„3å±‚ä¸åŒï¼ˆå› ä¸ºjaråŒ…ä¸åŒï¼‰ã€‚å¦‚æœæ¯æ¬¡åˆ¶ä½œjavaé•œåƒéƒ½é‡å¤åˆ¶ä½œå‰ä¸¤å±‚é•œåƒï¼Œæ˜¯ä¸æ˜¯å¾ˆéº»çƒ¦ã€‚

æ‰€ä»¥ï¼Œå°±æœ‰äººæä¾›äº†åŸºç¡€çš„ç³»ç»ŸåŠ JDKç¯å¢ƒï¼Œæˆ‘ä»¬åœ¨æ­¤åŸºç¡€ä¸Šåˆ¶ä½œjavaé•œåƒï¼Œå°±å¯ä»¥**çœå»JDK**çš„é…ç½®äº†ï¼š

**==DockerFile==æ–‡ä»¶ï¼Œå…¶ä¸­çš„docker-demoéœ€è¦æŒ‰ç…§è‡ªå·±çš„é¡¹ç›®jaråŒ…å»ä¿®æ”¹**

```Dockerfile
# åŸºç¡€é•œåƒ
FROM openjdk:11.0-jre-buster
# è®¾å®šæ—¶åŒº
ENV TZ=Asia/Shanghai
RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone
# æ‹·è´jaråŒ…
COPY docker-demo.jar /app.jar
# å…¥å£
ENTRYPOINT ["java", "-jar", "/app.jar"]
```

æ˜¯ä¸æ˜¯ç®€å•å¤šäº†ã€‚



### ï¼ˆ2ï¼‰æ„å»ºé•œåƒ

å½“**Dockerfileæ–‡ä»¶å†™å¥½ä»¥å**ï¼Œå°±å¯ä»¥**åˆ©ç”¨å‘½ä»¤æ¥æ„å»ºé•œåƒ**äº†ã€‚

åœ¨è¯¾å‰èµ„æ–™ä¸­ï¼Œæˆ‘ä»¬å‡†å¤‡å¥½äº†ä¸€ä¸ªdemoé¡¹ç›®åŠå¯¹åº”çš„Dockerfileï¼š

![img](./Docker-Learning-Local.assets/1725890609193-6-1732518736071-138-1732518818912-377.png)

é¦–å…ˆï¼Œæˆ‘ä»¬å°†è¯¾å‰èµ„æ–™æä¾›çš„`docker-demo.jar`åŒ…ä»¥åŠ`Dockerfile`æ‹·è´åˆ°è™šæ‹Ÿæœºçš„`/root/demo`ç›®å½•ï¼š

![img](./Docker-Learning-Local.assets/1725890609193-7-1732518736072-140-1732518818912-378.png)

ç„¶åï¼Œæ‰§è¡Œå‘½ä»¤ï¼Œ**==æ„å»ºé•œåƒ==**ï¼š

```Bash
# è¿›å…¥é•œåƒç›®å½•
cd /root/demo
# å¼€å§‹æ„å»º
docker build -t docker-demo:1.0 .
```

å‘½ä»¤è¯´æ˜ï¼š

- `docker build `: å°±æ˜¯**æ„å»ºä¸€ä¸ªdockeré•œåƒ**

- `-t docker-demo:1.0` ï¼š`-t`å‚æ•°æ˜¯æŒ‡å®šé•œåƒçš„åç§°ï¼ˆ`repository`å’Œ`tag`ï¼‰

- `.` : æœ€åçš„ç‚¹æ˜¯æŒ‡**æ„å»ºæ—¶Dockerfileæ‰€åœ¨è·¯å¾„**ï¼Œç”±äºæˆ‘ä»¬è¿›å…¥äº†demoç›®å½•ï¼Œæ‰€ä»¥æŒ‡å®šçš„æ˜¯`.`ä»£è¡¨å½“å‰ç›®å½•ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æŒ‡å®šDockerfileç›®å½•ï¼š

  - ```Bash
    # ç›´æ¥æŒ‡å®šDockerfileç›®å½•
    docker build -t docker-demo:1.0 /root/demo
    ```

ç»“æœï¼š

![img](./Docker-Learning-Local.assets/1725890609193-8-1732518736072-142-1732518818912-379.png)

æŸ¥çœ‹é•œåƒåˆ—è¡¨ï¼š

```Bash
# æŸ¥çœ‹é•œåƒåˆ—è¡¨ï¼š
docker images
# ç»“æœ
REPOSITORY    TAG       IMAGE ID       CREATED          SIZE
docker-demo   1.0       d6ab0b9e64b9   27 minutes ago   327MB
nginx         latest    605c77e624dd   16 months ago    141MB
mysql         latest    3218b38490ce   17 months ago    516MB
```

ç„¶åå°è¯•**==è¿è¡Œè¯¥é•œåƒ==**ï¼š

```Bash
# 1.åˆ›å»ºå¹¶è¿è¡Œå®¹å™¨
docker run -d --name dd -p 8080:8080 --network sky-take-out docker-demo:1.0
# 2.æŸ¥çœ‹å®¹å™¨
dps
# ç»“æœ
CONTAINER ID   IMAGE             PORTS                                                  STATUS         NAMES
78a000447b49   docker-demo:1.0   0.0.0.0:8080->8080/tcp, :::8090->8090/tcp              Up 2 seconds   dd
f63cfead8502   mysql             0.0.0.0:3306->3306/tcp, :::3306->3306/tcp, 33060/tcp   Up 2 hours     mysql

# 3.è®¿é—®
curl localhost:8080/hello/count
# ç»“æœï¼š
<h5>>æ¬¢è¿è®¿é—®é»‘é©¬å•†åŸ, è¿™æ˜¯æ‚¨ç¬¬1æ¬¡è®¿é—®<h5>>
```



## 4ã€==ä½¿ç”¨DockerComposeç»Ÿä¸€éƒ¨ç½²ä¸ç®¡ç†==

[è·³è½¬åˆ°DockerCompose](#DockerCompose)

```yaml
version: "3.8"

services:
  mysql:
    image: mysql
    container_name: mysql
    ports:
      - "3306:3306"
    environment:
      TZ: Asia/Shanghai
      MYSQL_ROOT_PASSWORD: 123
    volumes:
      - "/root/mysql/conf:/etc/mysql/conf.d"
      - "/root/mysql/data:/var/lib/mysql"
      - "/root/mysql/init:/docker-entrypoint-initdb.d"
    networks:
      - hm-net
  hmall:
    build: #é€šè¿‡buildæ„å»ºè‡ªå®šä¹‰çš„é•œåƒ
      context: .
      dockerfile: Dockerfile
    container_name: hmall
    ports:
      - "8080:8080"
    networks:
      - hm-net
    depends_on: #ä¾èµ–ä¸mysqlå®¹å™¨ï¼Œåˆ›å»ºæ—¶ä¼šå…ˆåˆ›å»ºmysqå®¹å™¨
      - mysql
  nginx:
    image: nginx
    container_name: nginx
    ports:
      - "18080:18080"
      - "18081:18081"
    volumes:
      - "/root/nginx/nginx.conf:/etc/nginx/nginx.conf"
      - "/root/nginx/html:/usr/share/nginx/html"
    depends_on:
      - hmall
    networks: #ç½‘æ®µ
      - hm-net
      
networks: #åˆ›å»ºè‡ªå®šä¹‰ç½‘ç»œ
  hm-net:
    name: hmall
```





# äº”ã€Dockeréƒ¨ç½²ä¸»ä»æ•°æ®åº“

## **==å£°æ˜==**

â€‹	ä¸‹é¢é’ˆå¯¹çš„æ˜¯åœ¨**ä¸€å°æœåŠ¡å™¨ä¸­**è¿›è¡Œçš„**ä¸»ä»æ•°æ®åº“çš„é…ç½®**ï¼›



ä»¥ä¸‹éƒ½æ˜¯ä»¥è‹ç©¹å¤–å–ä¸ºä¾‹ï¼š

 å‚è€ƒï¼š[Mysqlä¸»ä»é›†ç¾¤æ­å»ºâ€”â€”åŸºäºdocker-composeä¸€é”®éƒ¨ç½²_docker-compose mysql8ä¸»ä»-CSDNåšå®¢](https://blog.csdn.net/taotaojs/article/details/134835384)

## 1ã€ç›®å½•ç»“æ„

![image-20240913153150032-1732518818908-298](Docker-Learning-Local.assets/image-20240913153150032-1732518818908-298.png)



### ==æ³¨æ„==

- ä¸»ä»æ•°æ®åº“çš„éœ€è¦é€šè¿‡æ•°æ®å·æ˜ å°„çš„æœ¬åœ°è·¯å¾„ï¼Œåº”è¯¥**å’Œdocker-compose.yamlæ–‡ä»¶ä¸­å£°æ˜çš„ä¸€è‡´**
- docker-compose.yamlå’ŒDockerfileã€sky-server.jaré¡¹ç›®jaråŒ…ï¼Œä»¥åŠä¸»ä»æ•°æ®åº“çš„ç›¸å¯¹æ ¹ç›®å½•init_db**æœ€å¥½åœ¨ä¸€ä¸ªç›®å½•ä¸‹**(é¿å…å‡ºç°æŠ¥é”™é—®é¢˜)ï¼Œè¯¥æ¡ˆä¾‹ä¸­ï¼Œæ˜¯åŒåœ¨ä¸€ä¸ªrootç›®å½•ä¸‹ã€‚
- docker compose down å’Œ docker compose up -d ä¸¤ä¸ªä¸€é”®éƒ¨ç½²å’Œä¸€é”®åˆ é™¤çš„å‘½ä»¤**åº”è¯¥åœ¨æœ‰docker-compose.yamlç›®å½•ä¸‹è¿›è¡Œ**ã€‚
- å¦‚æœ==å¯¹javaé¡¹ç›®ä¿®æ”¹å==ï¼š
  - æ‰§è¡Œdocker compose downåï¼Œé€šè¿‡dpsaå‘½ä»¤(è‡ªå®šä¹‰å‘½ä»¤)æŸ¥çœ‹å­˜åœ¨çš„å®¹å™¨ï¼Œæ­£å¸¸æƒ…å†µä¼šåˆ é™¤æ‰€ä»¥é€šè¿‡docker compose up -d ä¸€é”®éƒ¨ç½²çš„å®¹å™¨ã€‚
    - ```sh
      dps='docker ps --format "table {{.ID}}\t{{.Image}}\t{{.Ports}}\t{{.Status}}\t{{.Names}}"'
      ```
    
    - dis='docker images'
  - å¦‚æœä½ ç›´æ¥é‡æ–°ä¸Šä¼ ä½ çš„ä¿®æ”¹åçš„jaråŒ…ï¼Œæ‰§è¡Œdocker compose up -dï¼Œé‚£ä¹ˆ**ä»ç„¶ä½¿ç”¨çš„æ˜¯ä½ ä¹‹å‰çš„jaråŒ…**ã€‚
  - **ä½ éœ€è¦é€šè¿‡å‘½ä»¤dis(docker images) æŸ¥çœ‹javaé¡¹ç›®çš„é•œåƒï¼Œ==é€šè¿‡docker rmi xxx åˆ é™¤åŸæ¥çš„javaé•œåƒï¼Œé‡æ–°åŠ è½½åæ–°çš„jaråŒ…æ‰ä¼šç”Ÿæ•ˆã€‚==**





## 2ã€ä¸»ä»æ•°æ®åº“ç›®å½•é…ç½®

å…¶ä»–ç›®å½•åœ¨ä½¿ç”¨docker composeè¿›è¡Œç»Ÿä¸€éƒ¨ç½²æ—¶ï¼Œä¼šæ ¹æ®**==docker-compoe.yaml==**è¿›è¡Œ**ç»Ÿä¸€åˆ›å»ºå¹¶æ˜ å°„**ã€‚

åœ¨åˆå§‹åˆ›å»ºä¸»ä»æ•°æ®åº“çš„ç›®å½•ç»“æ„å¼ï¼Œ**åªéœ€åˆ›å»ºå¥½conf/my.cnfæ–‡ä»¶**ã€‚

![image-20240913153125617-1732518818908-299](Docker-Learning-Local.assets/image-20240913153125617-1732518818908-299.png)



![image-20240913153101272-1732518818908-300](Docker-Learning-Local.assets/image-20240913153101272-1732518818908-300.png)

### ï¼ˆ1ï¼‰ä¸»æ•°æ®åº“é…ç½®æ–‡ä»¶

```shell
[mysqld]
# å¼€æ”¾ipè¿æ¥åœ°å€
bind-address = 0.0.0.0
# ä¸»æ•°æ®åº“ç«¯IDå·
server_id = 101
# å¼€å¯GTIDæ¨¡å¼
gtid_mode = ON
enforce-gtid-consistency = ON
# å¼€å¯äºŒè¿›åˆ¶æ—¥å¿—
log-bin = mysql-bin
# ä¸éœ€è¦å¤åˆ¶çš„æ•°æ®åº“åï¼ˆmysqlåº“ä¸€èˆ¬ä¸åŒæ­¥ï¼‰
binlog-ignore-db = mysql
# ä¸ºæ¯ä¸ªsession åˆ†é…çš„å†…å­˜ï¼Œåœ¨äº‹åŠ¡è¿‡ç¨‹ä¸­ç”¨æ¥å­˜å‚¨äºŒè¿›åˆ¶æ—¥å¿—çš„ç¼“å­˜
binlog_cache_size = 1M
# äºŒè¿›åˆ¶æ—¥å¿—è‡ªåŠ¨åˆ é™¤çš„å¤©æ•°ï¼Œé»˜è®¤å€¼ä¸º0,è¡¨ç¤ºâ€œæ²¡æœ‰è‡ªåŠ¨åˆ é™¤â€ï¼Œå¯åŠ¨æ—¶å’ŒäºŒè¿›åˆ¶æ—¥å¿—å¾ªç¯æ—¶å¯èƒ½åˆ é™¤
expire_logs_days = 7
# å°†å‡½æ•°å¤åˆ¶åˆ°slave
log_bin_trust_function_creators = 1
# ä¸»ä»å¤åˆ¶çš„æ ¼å¼ï¼ˆmixed,statement,rowï¼Œé»˜è®¤æ ¼å¼æ˜¯statementï¼‰
binlog_format = mixed
# è·³è¿‡ä¸»ä»å¤åˆ¶ä¸­é‡åˆ°çš„æ‰€æœ‰é”™è¯¯æˆ–æŒ‡å®šç±»å‹çš„é”™è¯¯ï¼Œé¿å…slaveç«¯å¤åˆ¶ä¸­æ–­ã€‚
# å¦‚ï¼š1062é”™è¯¯æ˜¯æŒ‡ä¸€äº›ä¸»é”®é‡å¤ï¼Œ1032é”™è¯¯æ˜¯å› ä¸ºä¸»ä»æ•°æ®åº“æ•°æ®ä¸ä¸€è‡´
slave_skip_errors = 1062
# log_slave_updatesè¡¨ç¤ºslaveå°†å¤åˆ¶äº‹ä»¶å†™è¿›è‡ªå·±çš„äºŒè¿›åˆ¶æ—¥å¿—
log_slave_updates = ON

# MySQL 8.xï¼Œéœ€è¦å¦‚ä¸‹é…ç½®
default_authentication_plugin=mysql_native_password
character-set-server=utf8mb4
collation-server=utf8mb4_unicode_ci
```



### ï¼ˆ2ï¼‰ä»æ•°æ®åº“é…ç½®æ–‡ä»¶

```shell
[mysqld]
# å¼€æ”¾ipè¿æ¥åœ°å€
bind-address = 0.0.0.0
# ä»æ•°æ®åº“ç«¯IDå·
server_id = 102
# å¼€å¯GTIDæ¨¡å¼
gtid_mode = ON
enforce-gtid-consistency = ON
# å¼€å¯äºŒè¿›åˆ¶æ—¥å¿—
log-bin = mysql-slave1-bin
# ä¸éœ€è¦å¤åˆ¶çš„æ•°æ®åº“åï¼ˆmysqlåº“ä¸€èˆ¬ä¸åŒæ­¥ï¼‰
binlog-ignore-db = mysql
# ä¸ºæ¯ä¸ªsession åˆ†é…çš„å†…å­˜ï¼Œåœ¨äº‹åŠ¡è¿‡ç¨‹ä¸­ç”¨æ¥å­˜å‚¨äºŒè¿›åˆ¶æ—¥å¿—çš„ç¼“å­˜
binlog_cache_size = 1M
# äºŒè¿›åˆ¶æ—¥å¿—è‡ªåŠ¨åˆ é™¤çš„å¤©æ•°ï¼Œé»˜è®¤å€¼ä¸º0,è¡¨ç¤ºâ€œæ²¡æœ‰è‡ªåŠ¨åˆ é™¤â€ï¼Œå¯åŠ¨æ—¶å’ŒäºŒè¿›åˆ¶æ—¥å¿—å¾ªç¯æ—¶å¯èƒ½åˆ é™¤
expire_logs_days = 7
# ä¸»ä»å¤åˆ¶çš„æ ¼å¼ï¼ˆmixed,statement,rowï¼Œé»˜è®¤æ ¼å¼æ˜¯statementï¼‰
binlog_format = mixed
# è·³è¿‡ä¸»ä»å¤åˆ¶ä¸­é‡åˆ°çš„æ‰€æœ‰é”™è¯¯æˆ–æŒ‡å®šç±»å‹çš„é”™è¯¯ï¼Œé¿å…slaveç«¯å¤åˆ¶ä¸­æ–­ã€‚
# å¦‚ï¼š1062é”™è¯¯æ˜¯æŒ‡ä¸€äº›ä¸»é”®é‡å¤ï¼Œ1032é”™è¯¯æ˜¯å› ä¸ºä¸»ä»æ•°æ®åº“æ•°æ®ä¸ä¸€è‡´
slave_skip_errors = 1062
# log_slave_updatesè¡¨ç¤ºslaveå°†å¤åˆ¶äº‹ä»¶å†™è¿›è‡ªå·±çš„äºŒè¿›åˆ¶æ—¥å¿—
log_slave_updates = ON
relay_log = mysql-relay-bin
read_only=1
```





## 3ã€Javaé¡¹ç›®==sharding-jdbc==é…ç½®ä¸»ä»æ•°æ®åº“

![image-20240913161818597-1732518818908-301](Docker-Learning-Local.assets/image-20240913161818597-1732518818908-301.png)

![image-20240913162435092](./Docker-Learning-Local.assets/image-20240913162435092-1732518818908-302.png)

è™½ç„¶åœ¨docker-compose.yamlæ–‡ä»¶ä¸­ï¼Œé…ç½®äº†ä¸¤ä¸ªä¸»ä»æ•°æ®åº“å®¹å™¨çš„**ç«¯å£æ˜ å°„**ï¼š

- â€‹	mysql-master: 3306:3306
- â€‹	mysql-slave-1:3307:3306

ä½†æ˜¯ï¼Œ**==mysqlå®¹å™¨å†…çš„ç«¯å£æ°¸è¿œéƒ½æ˜¯3306==**; msaterå’Œslaveå‰é¢çš„**3306å’Œ3307**æŒ‡çš„æ˜¯**å¤–éƒ¨è®¿é—®çš„ç«¯å£**ã€‚



ç”±äºéƒ¨ç½²åï¼Œ**javaé¡¹ç›®ä¹Ÿéƒ¨ç½²åˆ°å®¹å™¨ä¸­ä¸”å’Œä¸»ä»æ•°æ®åº“ä¸‰è€…==éƒ½åœ¨ä¸€ä¸ªè™šæ‹Ÿç½‘æ¡¥ä¸­==ï¼Œå¯ä»¥é€šè¿‡==å®¹å™¨å+ç«¯å£ç›¸äº’è®¿é—®==ã€‚**



```yaml
spring:
  profiles:
    active: dev #éœ€è¦ä½¿ç”¨çš„é…ç½®æ–‡ä»¶çš„åç¼€ï¼Œé…ç½®ç¯å¢ƒ dev:å¼€å‘; prod:äº§å“; test:æµ‹è¯•

  #ä½¿ç”¨sharding-jdbcæ¡†æ¶å®ç°è¯»å†™åˆ†ç¦»
  shardingsphere:
    datasource:
      names:
        master,slave
      #ä¸»æ•°æ®åº“(ä¸»åº“)
      master:
        type: com.alibaba.druid.pool.DruidDataSource
        driver-class-name: com.mysql.cj.jdbc.Driver
        url: jdbc:mysql://${sky.datasource.docker-host.master}/sky-take-out?serverTimezone=Asia/Shanghai&useUnicode=true&characterEncoding=utf-8&zeroDateTimeBehavior=convertToNull&useSSL=false&allowPublicKeyRetrieval=true
        username: root
        password: root
      #ä»æ•°æ®åº“(ä»åº“)
      slave:
        type: com.alibaba.druid.pool.DruidDataSource
        driver-class-name: com.mysql.cj.jdbc.Driver
        url: jdbc:mysql://${sky.datasource.docker-host.slave1}/sky-take-out?serverTimezone=Asia/Shanghai&useUnicode=true&characterEncoding=utf-8&zeroDateTimeBehavior=convertToNull&useSSL=false&allowPublicKeyRetrieval=true
        username: root
        password: root
    #è¯»å†™åˆ†ç¦»è§„åˆ™
    masterslave:
      #è¯»å†™åˆ†ç¦»é…ç½®
      load-balance-algorithm-type: round_robin #è½®è¯¢æ–¹å¼ï¼Œå¤šä¸ªä»åº“ä¾æ¬¡è½®è¯¢
      #æœ€ç»ˆçš„æ•°æ®æºåç§°
      name: dataSource
      #ä¸»åº“æ•°æ®æºåç§°
      master-data-source-name: master
      #ä»åº“æ•°æ®æºåç§°åˆ—è¡¨ï¼Œå¤šä¸ªé€—å·åˆ†éš”
      slave-data-source-names: slave
    props:
      sql:
        show: true #å¼€å¯SQLæ˜¾ç¤ºï¼Œé»˜è®¤falseï¼Œæ§åˆ¶å°å¯ä»¥è¾“å‡ºsqlè¯­å¥

  main:
    allow-bean-definition-overriding: true   #è¿è¡ŒBeanå¯¹è±¡è¦†ç›–
    allow-circular-references: true
   
```





## 4ã€Javaé¡¹ç›®æ‰“åŒ…é…ç½®

é€šè¿‡Dockerfileæ–‡ä»¶ï¼Œå¯ä»¥å¿«é€Ÿå¯¹javaè¿è¡Œæ‰€éœ€çš„jdkç­‰ç¯å¢ƒè¿›è¡Œé…ç½®ï¼Œä»¥åŠå¿«é€Ÿå¯åŠ¨é¡¹ç›®å¹¶è¿è¡Œ

```dockerfile
# åŸºç¡€é•œåƒ
FROM openjdk:11.0-jre-buster
# è®¾å®šæ—¶åŒº
ENV TZ=Asia/Shanghai
RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone
# æ‹·è´jaråŒ…
COPY sky-server.jar /app.jar
# å…¥å£
ENTRYPOINT ["java", "-jar", "/app.jar"]
```

![image-20240913152725280-1732518818908-303](Docker-Learning-Local.assets/image-20240913152725280-1732518818908-303.png)



## 5ã€==docker-compose.yml==

Docker Composeå¯ä»¥å¸®åŠ©æˆ‘ä»¬å®ç°**==å¤šä¸ªç›¸äº’å…³è”==çš„Dockerå®¹å™¨çš„==å¿«é€Ÿéƒ¨ç½²==**ã€‚å®ƒå…è®¸ç”¨æˆ·é€šè¿‡ä¸€ä¸ªå•ç‹¬çš„ docker-compose.yml **==æ¨¡æ¿æ–‡ä»¶==**ï¼ˆYAML æ ¼å¼ï¼‰æ¥å®šä¹‰ä¸€ç»„ç›¸å…³è”çš„åº”ç”¨å®¹å™¨ã€‚

**ä½¿ç”¨docker compose up -d**

```yaml
version: "3"

services:
  mysql-master:  # ä¸»åº“æœåŠ¡é…ç½®
    container_name: mysql-master  # å®¹å™¨åç§°
    hostname: mysql-master  # å®¹å™¨ä¸»æœºå
    image: "mysql:8.0"  # ä½¿ç”¨çš„ MySQL é•œåƒç‰ˆæœ¬
    ports: 
      - 3306:3306  # æš´éœ²å®¹å™¨å†…éƒ¨çš„ 3306 ç«¯å£åˆ°ä¸»æœºä¸Šçš„ 3306 ç«¯å£
    volumes:
      - ./init_db/master/etc:/etc/mysql  # æ˜ å°„æœ¬åœ°ç›®å½•åˆ°å®¹å™¨å†…çš„ MySQL é…ç½®æ–‡ä»¶ç›®å½•
      - ./init_db/master/var/lib:/var/lib/mysql  # æ˜ å°„æœ¬åœ°ç›®å½•åˆ°å®¹å™¨å†…çš„ MySQL æ•°æ®åº“æ–‡ä»¶ç›®å½•
      - ./init_db/master/conf:/etc/mysql/conf.d  # æ˜ å°„æœ¬åœ° MySQL é…ç½®æ–‡ä»¶åˆ°å®¹å™¨çš„ conf.d ç›®å½•
      - ./init_db/master/init/:/docker-entrypoint-initdb.d/  # åˆå§‹åŒ–è„šæœ¬ç›®å½•
    environment:  # é…ç½® MySQL ç¯å¢ƒå˜é‡
      MYSQL_ROOT_PASSWORD: root  # è®¾ç½® MySQL root ç”¨æˆ·çš„å¯†ç 
      MYSQL_DATABASE: rule_platform  # åˆå§‹åŒ–çš„æ•°æ®åº“åç§°
      MYSQL_USER: lp  # åˆ›å»ºçš„æ™®é€šç”¨æˆ·
      MYSQL_PASSWORD: 123  # æ™®é€šç”¨æˆ·çš„å¯†ç 
      TZ: Asia/Shanghai  # è®¾ç½®æ—¶åŒºä¸ºä¸Šæµ·
    command: --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci  # è®¾ç½®å­—ç¬¦é›†å’Œæ’åºè§„åˆ™
    restart: always  # å®¹å™¨æ„å¤–é€€å‡ºæ—¶è‡ªåŠ¨é‡å¯
    networks:
      - sky  # ä½¿ç”¨å®šä¹‰çš„ sky ç½‘ç»œ
    tty: true  # ä¸ºå®¹å™¨åˆ†é…ä¼ªç»ˆç«¯

  mysql-slave-1:  # ä»åº“1æœåŠ¡é…ç½®
    container_name: mysql-slave-1  # å®¹å™¨åç§°
    hostname: mysql-slave-1  # å®¹å™¨ä¸»æœºå
    image: "mysql:8.0"  # ä½¿ç”¨çš„ MySQL é•œåƒç‰ˆæœ¬
    ports:
      - 3307:3306  # æš´éœ²å®¹å™¨å†…éƒ¨çš„ 3306 ç«¯å£åˆ°ä¸»æœºä¸Šçš„ 3307 ç«¯å£
    volumes:
      - ./init_db/slave01/etc:/etc/mysql  # æ˜ å°„æœ¬åœ°ç›®å½•åˆ°å®¹å™¨å†…çš„ MySQL é…ç½®æ–‡ä»¶ç›®å½•
      - ./init_db/slave01/var/lib:/var/lib/mysql  # æ˜ å°„æœ¬åœ°ç›®å½•åˆ°å®¹å™¨å†…çš„ MySQL æ•°æ®åº“æ–‡ä»¶ç›®å½•
      - ./init_db/slave01/conf:/etc/mysql/conf.d  # æ˜ å°„æœ¬åœ° MySQL é…ç½®æ–‡ä»¶åˆ°å®¹å™¨çš„ conf.d ç›®å½•
      - ./init_db/slave01/init/:/docker-entrypoint-initdb.d/  # åˆå§‹åŒ–è„šæœ¬ç›®å½•
    environment:  # é…ç½® MySQL ç¯å¢ƒå˜é‡
      MYSQL_ROOT_PASSWORD: root  # è®¾ç½® MySQL root ç”¨æˆ·çš„å¯†ç 
      MYSQL_DATABASE: rule_platform  # åˆå§‹åŒ–çš„æ•°æ®åº“åç§°
      MYSQL_USER: lp  # åˆ›å»ºçš„æ™®é€šç”¨æˆ·
      MYSQL_PASSWORD: 123  # æ™®é€šç”¨æˆ·çš„å¯†ç 
      TZ: Asia/Shanghai  # è®¾ç½®æ—¶åŒºä¸ºä¸Šæµ·
    command: --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci  # è®¾ç½®å­—ç¬¦é›†å’Œæ’åºè§„åˆ™
    restart: always  # å®¹å™¨æ„å¤–é€€å‡ºæ—¶è‡ªåŠ¨é‡å¯
    networks:
      - sky  # ä½¿ç”¨å®šä¹‰çš„ sky ç½‘ç»œ
    tty: true  # ä¸ºå®¹å™¨åˆ†é…ä¼ªç»ˆç«¯

  sky-take-out:  # åº”ç”¨æœåŠ¡
    build: 
      context: .  # Docker æ„å»ºä¸Šä¸‹æ–‡
      dockerfile: Dockerfile  # ä½¿ç”¨çš„ Dockerfile æ–‡ä»¶
    container_name: sky-take-out  # å®¹å™¨åç§°
    ports:
      - "9090:9090"  # æš´éœ²å®¹å™¨å†…éƒ¨çš„ 9090 ç«¯å£åˆ°ä¸»æœºä¸Šçš„ 9090 ç«¯å£
    networks:
      - sky  # ä½¿ç”¨å®šä¹‰çš„ sky ç½‘ç»œ
    depends_on:
      - mysql-master  # è®¾ç½®ä¾èµ–çš„æœåŠ¡
      - mysql-slave-1  # è®¾ç½®ä¾èµ–çš„æœåŠ¡
    tty: true  # ä¸ºå®¹å™¨åˆ†é…ä¼ªç»ˆç«¯

networks:
  sky:  # å®šä¹‰çš„ç½‘ç»œé…ç½®
    name: sky-net  # ç½‘ç»œåç§°
```



## 6ã€ä¸€é”®å¯åŠ¨å®¹å™¨å-==é…ç½®ä¸»ä»åŒæ­¥==

å¡«å…¥å¥½docker-compose.ymlæ–‡ä»¶ä¸­é‚£äº›éœ€è¦æ‰‹åŠ¨å¡«å…¥çš„å†…å®¹ï¼Œåˆ›å»ºå¥½æ‰€æœ‰æ–‡ä»¶æ–‡ä»¶å¤¹ä¹‹åï¼Œå°±å¯ä»¥å¯åŠ¨å®¹å™¨äº†ã€‚åœ¨docker-compose.ymlç›®å½•ä¸‹ï¼Œè¿è¡Œ`sudo docker-compose up -d`å³å¯

åœ¨æœåŠ¡å™¨ï¼ˆå®¿ä¸»æœºï¼‰ä¸Šè¿è¡Œä»¥ä¸‹shå‘½ä»¤å³å¯

```shell
# master
docker exec -it zz-base-mysql-master bash
mysql -uroot -på¡«å…¥rootç”¨æˆ·å¯†ç 
create user 'xiaopeng'@'%' identified by '123456';
grant replication client,replication slave on *.* to 'xiaopeng'@'%';

# slave
docker exec -it zz-base-mysql-slave bash
mysql -uroot -på¡«å…¥rootç”¨æˆ·å¯†ç 
reset master;

CHANGE MASTER TO MASTER_HOST='mysqlmaster',MASTER_USER='xiaopeng',MASTER_PASSWORD='123456',MASTER_PORT=3306,MASTER_AUTO_POSITION=1;

start slave;
```



## 7ã€==æ›´æ–°javaé¡¹ç›®==(jaråŒ…)ï¼š

å¦‚æœ==å¯¹javaé¡¹ç›®ä¿®æ”¹å==ï¼š

- æ‰§è¡Œdocker compose downåï¼Œé€šè¿‡dpsaå‘½ä»¤(è‡ªå®šä¹‰å‘½ä»¤)æŸ¥çœ‹å­˜åœ¨çš„å®¹å™¨ï¼Œæ­£å¸¸æƒ…å†µä¼šåˆ é™¤æ‰€ä»¥é€šè¿‡docker compose up -d ä¸€é”®éƒ¨ç½²çš„å®¹å™¨ã€‚
  - ```shell
    dps='docker ps --format "table {{.ID}}\t{{.Image}}\t{{.Ports}}\t{{.Status}}\t{{.Names}}"'
    ```
  
  - dis='docker images'
- å¦‚æœä½ ç›´æ¥é‡æ–°ä¸Šä¼ ä½ çš„ä¿®æ”¹åçš„jaråŒ…ï¼Œæ‰§è¡Œdocker compose up -dï¼Œé‚£ä¹ˆ**ä»ç„¶ä½¿ç”¨çš„æ˜¯ä½ ä¹‹å‰çš„jaråŒ…**ã€‚
- **ä½ éœ€è¦é€šè¿‡å‘½ä»¤dis(docker images) æŸ¥çœ‹javaé¡¹ç›®çš„é•œåƒï¼Œ==é€šè¿‡docker rmi xxx åˆ é™¤åŸæ¥çš„javaé•œåƒï¼Œé‡æ–°åŠ è½½åæ–°çš„jaråŒ…æ‰ä¼šç”Ÿæ•ˆã€‚==**

![image-20240913161046389-1732518818908-304](Docker-Learning-Local.assets/image-20240913161046389-1732518818908-304.png)







## 8ã€å¸¸è§é”™è¯¯

### **ï¼ˆ1ï¼‰RETURN: iptables: No chain/target/match by that name.**

```shell
#é‡å¯dockeræœåŠ¡å³å¯è§£å†³
systemctl restart docker
```

![image-20240913161320240-1732518818908-305](Docker-Learning-Local.assets/image-20240913161320240-1732518818908-305.png)



### ï¼ˆ2ï¼‰æ•°æ®åº“ç”¨æˆ·æƒé™é—®é¢˜

![image-20240913162808015-1732518818908-306](Docker-Learning-Local.assets/image-20240913162808015-1732518818908-306.png)



### ï¼ˆ3ï¼‰æ•°æ®åº“ç«¯å£æ˜ å°„ä¸åŒ¹é…

![image-20240913163350060-1732518818908-307](Docker-Learning-Local.assets/image-20240913163350060-1732518818908-307.png)



```shell
2024-09-12 23:26:43.548 ERROR 1 --- [eate-1747721875] com.alibaba.druid.pool.DruidDataSource   : create connection SQLException, url: jdbc:mysql://mysql-slave-1:3307/sky-take-out?serverTimezone=Asia/Shanghai&useUnicode=true&characterEncoding=utf-8&zeroDateTimeBehavior=convertToNull&useSSL=false&allowPublicKeyRetrieval=true, errorCode 0, state 08S01

com.mysql.cj.jdbc.exceptions.CommunicationsException: Communications link failure

The last packet sent successfully to the server was 0 milliseconds ago. The driver has not received any packets from the server.
        at com.mysql.cj.jdbc.exceptions.SQLError.createCommunicationsException(SQLError.java:174) ~
        .
        .
        .
The last packet sent successfully to the server was 0 milliseconds ago. The driver has not received any packets from the server.
        at java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method) ~[na:na]
        .
        .
        .
Caused by: java.net.ConnectException: Connection refused (Connection refused)
        at java.base/java.net.PlainSocketImpl.socketConnect(Native Method) ~[na:na]
		.
		.
		.
[mysql-connector-java-8.0.30.jar!/:8.0.30]
        ... 9 common frames omitted
```

![image-20240913162435092](./Docker-Learning-Local.assets/image-20240913162435092-1732518818908-302.png)

è™½ç„¶åœ¨docker-compose.yamlæ–‡ä»¶ä¸­ï¼Œé…ç½®äº†ä¸¤ä¸ªä¸»ä»æ•°æ®åº“å®¹å™¨çš„**ç«¯å£æ˜ å°„**ï¼š

- â€‹	mysql-master: 3306:3306
- â€‹	mysql-slave-1:3307:3306

ä½†æ˜¯ï¼Œ**==mysqlå®¹å™¨å†…çš„ç«¯å£æ°¸è¿œéƒ½æ˜¯3306==**; msaterå’Œslaveå‰é¢çš„**3306å’Œ3307**æŒ‡çš„æ˜¯**å¤–éƒ¨è®¿é—®çš„ç«¯å£**ã€‚



ç”±äºéƒ¨ç½²åï¼Œ**javaé¡¹ç›®ä¹Ÿéƒ¨ç½²åˆ°å®¹å™¨ä¸­ä¸”å’Œä¸»ä»æ•°æ®åº“ä¸‰è€…==éƒ½åœ¨ä¸€ä¸ªè™šæ‹Ÿç½‘æ¡¥ä¸­==ï¼Œå¯ä»¥é€šè¿‡==å®¹å™¨å+ç«¯å£ç›¸äº’è®¿é—®==ã€‚**



## 9ã€æ ¹æ®æ—¥å¿—æŸ¥çœ‹é”™è¯¯ä¿¡æ¯

```shell
#æŸ¥çœ‹javaé¡¹ç›®çš„æ—¥å¿—ä¿¡æ¯
docker logs -f sky-take-out

#æŸ¥çœ‹ä¸»ä»æ•°æ®åº“çš„æ—¥å¿—ä¿¡æ¯
docker logs -f mysql-master
docker logs -f mysql-slave-1
```



