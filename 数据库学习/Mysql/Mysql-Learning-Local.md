# MySql-Learning

![image-20250412144000663](./Mysql-Learning-Local.assets/image-20250412144000663.png)



# ä¸€ã€åŸºç¡€ç¯‡

# 1ã€Mysqlæ¦‚è¿°

åœ¨è¿™ä¸€ç« èŠ‚ï¼Œæˆ‘ä»¬ä¸»è¦ä»‹ç»ä¸¤ä¸ªéƒ¨åˆ†ï¼Œæ•°æ®åº“ç›¸å…³æ¦‚å¿µåŠMySQLæ•°æ®åº“çš„ä»‹ç»ã€ä¸‹è½½ã€å®‰è£…ã€å¯åŠ¨åŠè¿æ¥ã€‚

## 1.1 **æ•°æ®åº“ç›¸å…³æ¦‚å¿µ**

åœ¨è¿™ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å…ˆæ¥è®²è§£ä¸‰ä¸ªæ¦‚å¿µï¼šæ•°æ®åº“ã€æ•°æ®åº“ç®¡ç†ç³»ç»Ÿã€SQLã€‚

| **åç§°**       | **å…¨ç§°**                                                     | **ç®€ç§°**                          |
| :------------- | :----------------------------------------------------------- | :-------------------------------- |
| æ•°æ®åº“         | å­˜å‚¨æ•°æ®çš„ä»“åº“ï¼Œæ•°æ®æ˜¯æœ‰ç»„ç»‡çš„è¿›è¡Œå­˜å‚¨                       | DataBaseï¼ˆDBï¼‰                    |
| æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ | æ“çºµå’Œç®¡ç†æ•°æ®åº“çš„å¤§å‹è½¯ä»¶                                   | DataBase Management System (DBMS) |
| SQL            | æ“ä½œå…³ç³»å‹æ•°æ®åº“çš„ç¼–ç¨‹è¯­è¨€ï¼Œå®šä¹‰äº†ä¸€å¥—æ“ä½œå…³ç³»å‹æ•°æ®åº“ç»Ÿä¸€**æ ‡å‡†** | Structured Query Language (SQL)   |

![image-20250412160500512](./Mysql-Learning-Local.assets/image-20250412160500512.png)

è€Œç›®å‰ä¸»æµçš„å…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿçš„å¸‚åœºå æœ‰ç‡æ’åå¦‚ä¸‹ï¼š

![image-20250412160622957](./Mysql-Learning-Local.assets/image-20250412160622957.png)

- **Oracle**ï¼šå¤§å‹çš„æ”¶è´¹æ•°æ®åº“ï¼ŒOracleå…¬å¸äº§å“ï¼Œä»·æ ¼æ˜‚è´µã€‚
- **MySQL**ï¼šå¼€æºå…è´¹çš„ä¸­å°å‹æ•°æ®åº“ï¼Œåæ¥Sunå…¬å¸æ”¶è´­äº†MySQLï¼Œè€ŒOracleåˆæ”¶è´­äº†Sunå…¬å¸ã€‚ç›®å‰Oracleæ¨å‡ºäº†æ”¶è´¹ç‰ˆæœ¬çš„MySQLï¼Œä¹Ÿæä¾›äº†å…è´¹çš„ç¤¾åŒºç‰ˆæœ¬ã€‚
- **SQL Server**ï¼šMicrosoft å…¬å¸æ¨å‡ºçš„æ”¶è´¹çš„ä¸­å‹æ•°æ®åº“ï¼ŒC#ã€.netç­‰è¯­è¨€å¸¸ç”¨ã€‚

- **PostgreSQL**ï¼šå¼€æºå…è´¹çš„ä¸­å°å‹æ•°æ®åº“ã€‚ 
- DB2ï¼šIBMå…¬å¸çš„å¤§å‹æ”¶è´¹æ•°æ®åº“äº§å“ã€‚

- SQLLiteï¼šåµŒå…¥å¼çš„å¾®å‹æ•°æ®åº“ã€‚Androidå†…ç½®çš„æ•°æ®åº“é‡‡ç”¨çš„å°±æ˜¯è¯¥æ•°æ®åº“ã€‚

- MariaDBï¼šå¼€æºå…è´¹çš„ä¸­å°å‹æ•°æ®åº“ã€‚æ˜¯MySQLæ•°æ®åº“çš„å¦å¤–ä¸€ä¸ªåˆ†æ”¯ã€å¦å¤–ä¸€ä¸ªè¡ç”Ÿäº§å“ï¼Œä¸ MySQLæ•°æ®åº“æœ‰å¾ˆå¥½çš„å…¼å®¹æ€§ã€‚


è€Œä¸è®ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ä¸Šé¢çš„å“ªä¸€ä¸ªå…³ç³»å‹æ•°æ®åº“ï¼Œæœ€ç»ˆåœ¨æ“ä½œæ—¶ï¼Œéƒ½æ˜¯ä½¿ç”¨SQLè¯­è¨€æ¥è¿›è¡Œç»Ÿä¸€æ“ä½œï¼Œå› ä¸ºæˆ‘ä»¬å‰é¢è®²åˆ°SQLè¯­è¨€ï¼Œæ˜¯æ“ä½œå…³ç³»å‹æ•°æ®åº“çš„ **ç»Ÿä¸€æ ‡å‡†** ã€‚æ‰€ä»¥å³ä½¿æˆ‘ä»¬ç°åœ¨å­¦ä¹ çš„æ˜¯MySQLï¼Œå‡å¦‚æˆ‘ä»¬ä»¥ååˆ°äº†å…¬å¸ï¼Œä½¿ç”¨çš„æ˜¯åˆ«çš„å…³ç³»å‹æ•°æ®åº“ï¼Œå¦‚ï¼šOracleã€DB2ã€SQLServerï¼Œä¹Ÿå®Œå…¨ä¸ç”¨æ‹…å¿ƒï¼Œå› ä¸ºæ“ä½œçš„æ–¹å¼éƒ½æ˜¯ä¸€è‡´çš„ã€‚

![image-20250412160637812](./Mysql-Learning-Local.assets/image-20250412160637812.png)





## **1.2 MySQLæ•°æ®åº“**

### **ï¼ˆ1ï¼‰ç‰ˆæœ¬**

![image-20250412160845195](./Mysql-Learning-Local.assets/image-20250412160845195.png)

å®˜æ–¹ï¼š [**https://www.mysql.com/**](https://www.mysql.com/)

MySQLå®˜æ–¹æä¾›äº†ä¸¤ç§ä¸åŒçš„ç‰ˆæœ¬ï¼š

- ç¤¾åŒºç‰ˆæœ¬ï¼ˆMySQL Community Server)å…è´¹ï¼Œ MySQLä¸æä¾›ä»»ä½•æŠ€æœ¯æ”¯æŒ

- å•†ä¸šç‰ˆæœ¬ï¼ˆMySQL Enterprise Edition)æ”¶è´¹ï¼Œå¯ä»¥ä½¿ç”¨30å¤©ï¼Œå®˜æ–¹æä¾›æŠ€æœ¯æ”¯æŒ


æœ¬è¯¾ç¨‹é‡‡ç”¨çš„æ˜¯MySQLæœ€æ–°çš„ç¤¾åŒºç‰ˆ-MySQL Community Server 8.0.26

### ï¼ˆ2ï¼‰**ä¸‹è½½**

![image-20250412161603273](./Mysql-Learning-Local.assets/image-20250412161603273.png)

é€‰æ‹©ç¤¾åŒºç‰ˆæœ¬ï¼šhttps://dev.mysql.com/downloads/

![image-20250412161451219](./Mysql-Learning-Local.assets/image-20250412161451219.png)

![image-20250412161246917](./Mysql-Learning-Local.assets/image-20250412161246917.png)



ä¸‹è½½åœ°å€ï¼š [**https://downloads.mysql.com/archives/installer/**](https://downloads.mysql.com/archives/installer/)

![image-20250412161521964](./Mysql-Learning-Local.assets/image-20250412161521964.png)



ä¹Ÿå¯ä»¥ä½¿ç”¨è¯¾ç¨‹èµ„æ–™ä¸­æä¾›çš„MySQLçš„å®‰è£…åŒ…ï¼š

![image-20250412161625270](./Mysql-Learning-Local.assets/image-20250412161625270.png)



### ï¼ˆ3ï¼‰å®‰è£…

**1) åŒå‡»å®˜æ–¹ä¸‹æ¥çš„å®‰è£…åŒ…æ–‡ä»¶**

![image-20210916184347938](./Mysql-Learning-Local.assets/image-20210916184347938.png) 



**2) æ ¹æ®å®‰è£…æç¤ºè¿›è¡Œå®‰è£…**

![image-20210916184532212](./Mysql-Learning-Local.assets/image-20210916184532212.png) 

![image-20210916184603712](./Mysql-Learning-Local.assets/image-20210916184603712.png) 

![image-20210916184634094](./Mysql-Learning-Local.assets/image-20210916184634094.png) 



å®‰è£…MySQLçš„ç›¸å…³ç»„ä»¶ï¼Œè¿™ä¸ªè¿‡ç¨‹å¯èƒ½éœ€è¦è€—æ—¶å‡ åˆ†é’Ÿï¼Œè€å¿ƒç­‰å¾…ã€‚

![image-20210916184700031](./Mysql-Learning-Local.assets/image-20210916184700031.png) 

![image-20210916184709776](./Mysql-Learning-Local.assets/image-20210916184709776.png) 

![image-20210916184743524](./Mysql-Learning-Local.assets/image-20210916184743524.png) 

![image-20210916184759021](./Mysql-Learning-Local.assets/image-20210916184759021.png) 



==è¾“å…¥MySQLä¸­rootç”¨æˆ·çš„å¯†ç ,ä¸€å®šè®°å¾—è®°ä½è¯¥å¯†ç ==

![image-20210916184814656](./Mysql-Learning-Local.assets/image-20210916184814656.png) 

![image-20210916184832159](./Mysql-Learning-Local.assets/image-20210916184832159.png) 

![image-20210916184851013](./Mysql-Learning-Local.assets/image-20210916184851013.png) 





### ï¼ˆ4ï¼‰==é…ç½®ç¯å¢ƒå˜é‡==

å®‰è£…å¥½MySQLä¹‹åï¼Œè¿˜éœ€è¦é…ç½®ç¯å¢ƒå˜é‡ï¼Œè¿™æ ·æ‰**å¯ä»¥åœ¨ä»»ä½•ç›®å½•ä¸‹è¿æ¥MySQL**ã€‚

1). åœ¨æ­¤ç”µè„‘ä¸Šï¼Œå³é”®é€‰æ‹©å±æ€§

![image-20210918161550977](./Mysql-Learning-Local.assets/image-20210918161550977.png) 



2). ç‚¹å‡»å·¦ä¾§çš„ "é«˜çº§ç³»ç»Ÿè®¾ç½®"ï¼Œé€‰æ‹©ç¯å¢ƒå˜é‡

![image-20210918161646433](./Mysql-Learning-Local.assets/image-20210918161646433.png) 



3). æ‰¾åˆ° Path ç³»ç»Ÿå˜é‡, ç‚¹å‡» "ç¼–è¾‘"

![image-20210918161803544](./Mysql-Learning-Local.assets/image-20210918161803544.png) 



4). é€‰æ‹© "æ–°å»º" , å°†MySQL Serverçš„å®‰è£…ç›®å½•ä¸‹çš„binç›®å½•æ·»åŠ åˆ°ç¯å¢ƒå˜é‡

![image-20210918161954696](./Mysql-Learning-Local.assets/image-20210918161954696.png) 





### ï¼ˆ5ï¼‰MySQLå¸è½½æ–‡æ¡£-Windowsç‰ˆ

##### 1. åœæ­¢MySQLæœåŠ¡

win+R æ‰“å¼€è¿è¡Œï¼Œè¾“å…¥ services.msc ç‚¹å‡» "ç¡®å®š" è°ƒå‡ºç³»ç»ŸæœåŠ¡ã€‚

![image-20220209203115052](./Mysql-Learning-Local.assets/image-20220209203115052.png) 

![image-20220209203253220](./Mysql-Learning-Local.assets/image-20220209203253220.png) 





##### 2. å¸è½½MySQLç›¸å…³ç»„ä»¶

æ‰“å¼€æ§åˆ¶é¢æ¿ ---> å¸è½½ç¨‹åº ---> å¸è½½MySQLç›¸å…³æ‰€æœ‰ç»„ä»¶

![image-20220209203345746](./Mysql-Learning-Local.assets/image-20220209203345746.png) 

![image-20220209203431405](./Mysql-Learning-Local.assets/image-20220209203431405.png) 



##### 3. åˆ é™¤MySQLå®‰è£…ç›®å½•

![image-20220209205157019](./Mysql-Learning-Local.assets/image-20220209205157019.png) 





##### 4. åˆ é™¤MySQLæ•°æ®ç›®å½•

æ•°æ®å­˜æ”¾ç›®å½•æ˜¯åœ¨ C:\ProgramData\MySQLï¼Œç›´æ¥å°†è¯¥æ–‡ä»¶å¤¹åˆ é™¤ã€‚

![image-20220209205401563](./Mysql-Learning-Local.assets/image-20220209205401563.png) 





##### 5. å†æ¬¡æ‰“å¼€æœåŠ¡ï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰MySQLå¸è½½æ®‹ç•™

å¦‚æœå·²å°†MySQLå¸è½½ï¼Œä½†æ˜¯é€šè¿‡ä»»åŠ¡ç®¡ç†å™¨--->æœåŠ¡ï¼ŒæŸ¥çœ‹åˆ°MySQLæœåŠ¡ä»ç„¶æ®‹ç•™åœ¨ç³»ç»ŸæœåŠ¡é‡Œã€‚

è§£å†³åŠæ³•ï¼š

â€‹	ä»¥ç®¡ç†å‘˜æ–¹å¼è¿è¡Œcmdå‘½ä»¤è¡Œï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š

â€‹	sc delete æœåŠ¡åç§°ï¼ˆå¦‚MySQL80ï¼‰

è¿™æ ·å¯ä»¥å®ç°åˆ é™¤æœåŠ¡ã€‚



### ï¼ˆ6ï¼‰MysqlæœåŠ¡çš„==å¯åœ==

MySQLå®‰è£…å®Œæˆä¹‹åï¼Œåœ¨ç³»ç»Ÿå¯åŠ¨æ—¶ï¼Œä¼šè‡ªåŠ¨å¯åŠ¨MySQLæœåŠ¡ï¼Œæˆ‘ä»¬æ— éœ€æ‰‹åŠ¨å¯åŠ¨äº†ã€‚

å½“ç„¶ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨çš„é€šè¿‡æŒ‡ä»¤å¯åŠ¨åœæ­¢ï¼Œä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œcmdï¼Œè¿›å…¥å‘½ä»¤è¡Œæ‰§è¡Œå¦‚ä¸‹æŒ‡ä»¤ï¼š

1. net start mysql80
2. net stop mysql80

![image-20250412161955799](./Mysql-Learning-Local.assets/image-20250412161955799.png)

```bash
net start mysql80

net stop mysql80
```

![image-20250412162155828](./Mysql-Learning-Local.assets/image-20250412162155828.png)

> æ³¨æ„ ï¼š ä¸Šè¿°çš„ mysql80 æ˜¯æˆ‘ä»¬åœ¨å®‰è£…MySQLæ—¶ï¼Œé»˜è®¤æŒ‡å®šçš„mysqlçš„ç³»ç»ŸæœåŠ¡åï¼Œä¸æ˜¯å›º
>
> å®šçš„ï¼Œå¦‚æœæœªæ”¹åŠ¨ï¼Œé»˜è®¤å°±æ˜¯mysql80ã€‚
>
> ![image-20250412162539973](./Mysql-Learning-Local.assets/image-20250412162539973.png)



### ï¼ˆ7ï¼‰==å®¢æˆ·ç«¯è¿æ¥==

#### â‘  æ–¹å¼ä¸€ï¼šä½¿ç”¨MySQLæä¾›çš„==å®¢æˆ·ç«¯å‘½ä»¤è¡Œå·¥å…·==

![image-20250412162840628](./Mysql-Learning-Local.assets/image-20250412162840628.png)



#### â‘¡ æ–¹å¼äºŒï¼šä½¿ç”¨==ç³»ç»Ÿè‡ªå¸¦çš„å‘½ä»¤è¡Œå·¥å…·==æ‰§è¡ŒæŒ‡ä»¤

![image-20250412164104594](./Mysql-Learning-Local.assets/image-20250412164104594.png)

```bash
mysql [-h 127.0.0.1] [-P 3306] -u root -p
å‚æ•°ï¼š
-h : MySQLæœåŠ¡æ‰€åœ¨çš„ä¸»æœºIP
-P : MySQLæœåŠ¡ç«¯å£å·ï¼Œ é»˜è®¤3306
-u : MySQLæ•°æ®åº“ç”¨æˆ·å
-p ï¼š MySQLæ•°æ®åº“ç”¨æˆ·åå¯¹åº”çš„å¯†ç 
```

[]å†…ä¸ºå¯é€‰å‚æ•°ï¼Œå¦‚æœéœ€è¦**è¿æ¥è¿œç¨‹çš„MySQL**ï¼Œéœ€è¦åŠ ä¸Šè¿™ä¸¤ä¸ªå‚æ•°æ¥æŒ‡å®š**è¿œç¨‹ä¸»æœºIPã€ç«¯å£**ï¼Œå¦‚æœ

è¿æ¥æœ¬åœ°çš„MySQLï¼Œåˆ™æ— éœ€æŒ‡å®šè¿™ä¸¤ä¸ªå‚æ•°

![image-20250412162719092](./Mysql-Learning-Local.assets/image-20250412162719092.png)

> ==æ³¨æ„==ï¼š ä½¿ç”¨è¿™ç§æ–¹å¼è¿›è¡Œè¿æ¥æ—¶ï¼Œéœ€è¦å®‰è£…å®Œæ¯•å==é…ç½®PATHç¯å¢ƒå˜é‡==ã€‚





### ï¼ˆ8ï¼‰==æ•°æ®æ¨¡å‹==

#### â‘ å…³ç³»å‹æ•°æ®åº“ï¼ˆRDBMSï¼‰

æ¦‚å¿µï¼š**å»ºç«‹åœ¨å…³ç³»æ¨¡å‹åŸºç¡€ä¸Šï¼Œç”±å¤šå¼ ç›¸äº’è¿æ¥çš„äºŒç»´è¡¨ç»„æˆçš„æ•°æ®åº“ã€‚**

è€Œæ‰€è°“äºŒç»´è¡¨ï¼ŒæŒ‡çš„æ˜¯ç”±è¡Œå’Œåˆ—ç»„æˆçš„è¡¨ï¼Œå¦‚ä¸‹å›¾ï¼ˆå°±ç±»ä¼¼äºExcelè¡¨æ ¼æ•°æ®ï¼Œæœ‰è¡¨å¤´ã€æœ‰åˆ—ã€æœ‰è¡Œï¼Œè¿˜å¯ä»¥é€šè¿‡ä¸€åˆ—å…³è”å¦å¤–ä¸€ä¸ªè¡¨æ ¼ä¸­çš„æŸä¸€åˆ—æ•°æ®ï¼‰ã€‚æˆ‘ä»¬ä¹‹å‰æåˆ°çš„MySQLã€Oracleã€DB2ã€SQLServerè¿™äº›éƒ½æ˜¯å±äºå…³ç³»å‹æ•°æ®åº“ï¼Œé‡Œé¢éƒ½æ˜¯åŸºäºäºŒç»´è¡¨å­˜å‚¨æ•°æ®çš„ã€‚ç®€å•è¯´ï¼ŒåŸºäºäºŒç»´è¡¨å­˜å‚¨æ•°æ®çš„æ•°æ®åº“å°±æˆä¸ºå…³ç³»å‹æ•°æ®åº“ï¼Œä¸æ˜¯åŸºäºäºŒç»´è¡¨å­˜å‚¨æ•°æ®çš„æ•°æ®åº“ï¼Œå°±æ˜¯éå…³ç³»å‹æ•°æ®åº“ã€‚

![image-20250412163019353](./Mysql-Learning-Local.assets/image-20250412163019353.png)

==ç‰¹ç‚¹==ï¼š

1. **ä½¿ç”¨è¡¨å­˜å‚¨æ•°æ®ï¼Œæ ¼å¼ç»Ÿä¸€ï¼Œä¾¿äºç»´æŠ¤**ã€‚

2. **ä½¿ç”¨SQLè¯­è¨€æ“ä½œï¼Œæ ‡å‡†ç»Ÿä¸€ï¼Œä½¿ç”¨æ–¹ä¾¿**ã€‚

   

#### â‘¡ æ•°æ®æ¨¡å‹

MySQLæ˜¯å…³ç³»å‹æ•°æ®åº“ï¼Œæ˜¯åŸºäº**äºŒç»´è¡¨è¿›è¡Œæ•°æ®å­˜å‚¨**çš„ï¼Œå…·ä½“çš„ç»“æ„å›¾ä¸‹:

![image-20250412163050614](./Mysql-Learning-Local.assets/image-20250412163050614.png)

-    æˆ‘ä»¬å¯ä»¥é€šè¿‡**MySQLå®¢æˆ·ç«¯è¿æ¥æ•°æ®åº“ç®¡ç†ç³»ç»ŸDBMS**ï¼Œç„¶å**é€šè¿‡DBMSæ“ä½œæ•°æ®åº“**ã€‚
-    å¯ä»¥ä½¿ç”¨SQLè¯­å¥ï¼Œé€šè¿‡æ•°æ®åº“ç®¡ç†ç³»ç»Ÿæ“ä½œæ•°æ®åº“ï¼Œä»¥åŠæ“ä½œæ•°æ®åº“ä¸­çš„è¡¨ç»“æ„åŠæ•°æ®ã€‚
-    ä¸€ä¸ªæ•°æ®åº“æœåŠ¡å™¨ä¸­å¯ä»¥åˆ›å»ºå¤šä¸ªæ•°æ®åº“ï¼Œä¸€ä¸ªæ•°æ®åº“ä¸­ä¹Ÿå¯ä»¥åŒ…å«å¤šå¼ è¡¨ï¼Œè€Œä¸€å¼ è¡¨ä¸­åˆå¯ä»¥åŒ…å«å¤šè¡Œè®°å½•ã€‚



### ï¼ˆ9ï¼‰å°ç»“

![image-20250412164857602](./Mysql-Learning-Local.assets/image-20250412164857602.png)

# 2ã€ğŸŒŸ ==SQL==

![image-20250412164929549](./Mysql-Learning-Local.assets/image-20250412164929549.png)

> å…¨ç§° ==Structured Query Language==ï¼Œ**ç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€**ã€‚æ“ä½œå…³ç³»å‹æ•°æ®åº“çš„ç¼–ç¨‹è¯­è¨€ï¼Œå®šä¹‰äº†ä¸€å¥—æ“ä½œå…³ç³»å‹æ•°æ®åº“ç»Ÿä¸€**æ ‡å‡†** ã€‚

## 2.1 **SQLé€šç”¨è¯­æ³•**

åœ¨å­¦ä¹ å…·ä½“çš„SQLè¯­å¥ä¹‹å‰ï¼Œå…ˆæ¥äº†è§£ä¸€ä¸‹SQLè¯­è¨€çš„åŒäºè¯­æ³•ã€‚

1. SQLè¯­å¥å¯ä»¥**å•è¡Œæˆ–å¤šè¡Œä¹¦å†™ï¼Œä»¥==åˆ†å·ç»“å°¾==**ã€‚
2. SQLè¯­å¥å¯ä»¥ä½¿ç”¨**ç©ºæ ¼/ç¼©è¿›**æ¥å¢å¼ºè¯­å¥çš„å¯è¯»æ€§ã€‚
3. MySQLæ•°æ®åº“çš„SQLè¯­å¥ä¸åŒºåˆ†å¤§å°å†™ï¼Œ**å…³é”®å­—å»ºè®®ä½¿ç”¨å¤§å†™**ã€‚
4. **æ³¨é‡Š**ï¼š
   1. å•è¡Œæ³¨é‡Šï¼š-- æ³¨é‡Šå†…å®¹ æˆ–  # æ³¨é‡Šå†…å®¹  
   2. å¤šè¡Œæ³¨é‡Šï¼š/* æ³¨é‡Šå†…å®¹ */



## 2.2 SQL==åˆ†ç±»==

![image-20250412165349554](./Mysql-Learning-Local.assets/image-20250412165349554.png)

SQLè¯­å¥ï¼Œæ ¹æ®å…¶åŠŸèƒ½ï¼Œä¸»è¦åˆ†ä¸ºå››ç±»ï¼šDDLã€DMLã€DQLã€DCLã€‚

| **åˆ†ç±»** | **å…¨ç§°**                       | **è¯´æ˜**                                               |
| :------- | :----------------------------- | :----------------------------------------------------- |
| **DDL**  | **Data Definition Language**   | æ•°æ®å®šä¹‰è¯­è¨€ï¼Œç”¨æ¥å®šä¹‰æ•°æ®åº“å¯¹è±¡(æ•°æ®åº“ï¼Œè¡¨ï¼Œå­—æ®µ)     |
| **DML**  | **Data Manipulation Language** | æ•°æ®æ“ä½œè¯­è¨€ï¼Œç”¨æ¥å¯¹æ•°æ®åº“è¡¨ä¸­çš„æ•°æ®è¿›è¡Œå¢åˆ æ”¹         |
| **DQL**  | **Data Query Language**        | æ•°æ®æŸ¥è¯¢è¯­è¨€ï¼Œç”¨æ¥æŸ¥è¯¢æ•°æ®åº“ä¸­è¡¨çš„è®°å½•                 |
| **DCL**  | **Data Control Language**      | æ•°æ®æ§åˆ¶è¯­è¨€ï¼Œç”¨æ¥åˆ›å»ºæ•°æ®åº“ç”¨æˆ·ã€æ§åˆ¶æ•°æ®åº“çš„è®¿é—®æƒé™ |



## 2.3 ğŸŒŸDDL-æ•°æ®å®šä¹‰

Data Definition Languageï¼Œ**æ•°æ®å®šä¹‰è¯­è¨€**ï¼Œç”¨æ¥å®šä¹‰æ•°æ®åº“å¯¹è±¡(æ•°æ®åº“ï¼Œè¡¨ï¼Œå­—æ®µ) ã€‚

### ï¼ˆ1ï¼‰æ•°æ®åº“æ“ä½œ

![image-20250412165757574](./Mysql-Learning-Local.assets/image-20250412165757574.png)

#### â‘ **æŸ¥è¯¢æ‰€æœ‰æ•°æ®åº“**

```sql
show databases;
```



#### â‘¡==æŸ¥è¯¢å½“å‰==æ•°æ®åº“

```sql
select database();
```



#### â‘¢åˆ›å»ºæ•°æ®åº“

```sql
create database [ if not exists ] æ•°æ®åº“å [ default charset å­—ç¬¦é›† ] [ collate æ’åº
è§„åˆ™ ] ;
```

###### æ¡ˆä¾‹ï¼š

**ç¬¬ä¸€æ­¥ï¼š**åˆ›å»ºä¸€ä¸ªitcastæ•°æ®åº“, ä½¿ç”¨æ•°æ®åº“é»˜è®¤çš„å­—ç¬¦é›†ã€‚

```sql
create database itcast;
```

![image-20250412170117792](./Mysql-Learning-Local.assets/image-20250412170117792.png)


åœ¨åŒä¸€ä¸ªæ•°æ®åº“æœåŠ¡å™¨ä¸­ï¼Œ**ä¸èƒ½åˆ›å»ºä¸¤ä¸ªåç§°ç›¸åŒçš„æ•°æ®åº“ï¼Œå¦åˆ™å°†ä¼šæŠ¥é”™**ã€‚

![image-20250412170138354](./Mysql-Learning-Local.assets/image-20250412170138354.png)

å¯ä»¥é€šè¿‡**if not exists** å‚æ•°æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ•°æ®åº“ä¸å­˜åœ¨, åˆ™åˆ›å»ºè¯¥æ•°æ®åº“ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™ä¸åˆ›å»ºã€‚

```sql
create database if not extists itcast;
```

![image-20250412170235188](./Mysql-Learning-Local.assets/image-20250412170235188.png)



**ç¬¬äºŒæ­¥ï¼š**åˆ›å»ºä¸€ä¸ªitheimaæ•°æ®åº“ï¼Œå¹¶ä¸”æŒ‡å®šå­—ç¬¦é›†

```sql
create database itheima default charset utf8mb4;
```

![image-20250412170303210](./Mysql-Learning-Local.assets/image-20250412170303210.png)



#### â‘£åˆ é™¤æ•°æ®åº“

```sql
drop database [ if exists ] æ•°æ®åº“å ;
```

å¦‚æœåˆ é™¤ä¸€ä¸ªä¸å­˜åœ¨çš„æ•°æ®åº“ï¼Œå°†ä¼šæŠ¥é”™ã€‚æ­¤æ—¶ï¼Œå¯ä»¥åŠ ä¸Šå‚æ•° if exists ï¼Œå¦‚æœæ•°æ®åº“å­˜åœ¨ï¼Œå†æ‰§è¡Œåˆ é™¤ï¼Œå¦åˆ™ä¸æ‰§è¡Œåˆ é™¤ã€‚

![image-20250412170342138](./Mysql-Learning-Local.assets/image-20250412170342138.png)



#### â‘¥åˆ‡æ¢æ•°æ®åº“

```sql
use æ•°æ®åº“å ;
```

æˆ‘ä»¬è¦æ“ä½œæŸä¸€ä¸ªæ•°æ®åº“ä¸‹çš„è¡¨æ—¶ï¼Œå°±éœ€è¦é€šè¿‡è¯¥æŒ‡ä»¤ï¼Œåˆ‡æ¢åˆ°å¯¹åº”çš„æ•°æ®åº“ä¸‹ï¼Œå¦åˆ™æ˜¯ä¸èƒ½æ“ä½œçš„ã€‚æ¯”å¦‚ï¼Œåˆ‡æ¢åˆ°itcastæ•°æ®ï¼Œæ‰§è¡Œå¦‚ä¸‹SQLï¼š

```sql
use itcast;
```



### ï¼ˆ2ï¼‰ğŸŒŸ ==è¡¨æ“ä½œ==

#### â‘ è¡¨æ“ä½œ-==æŸ¥è¯¢åˆ›å»º==

##### 1ï¼‰**æŸ¥è¯¢å½“å‰æ•°æ®åº“æ‰€æœ‰è¡¨**-show

```sql
show tables;
```

æ¯”å¦‚,æˆ‘ä»¬å¯ä»¥åˆ‡æ¢åˆ°sysè¿™ä¸ªç³»ç»Ÿæ•°æ®åº“,å¹¶æŸ¥çœ‹ç³»ç»Ÿæ•°æ®åº“ä¸­çš„æ‰€æœ‰è¡¨ç»“æ„ã€‚

```sql
use sys;

show tables;
```

![image-20250412172133340](./Mysql-Learning-Local.assets/image-20250412172133340.png)

##### 2ï¼‰==æŸ¥çœ‹æŒ‡å®šè¡¨ç»“æ„==-desc

```sql
desc è¡¨å ;
```

é€šè¿‡è¿™æ¡æŒ‡ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹åˆ°æŒ‡å®š**è¡¨çš„å­—æ®µï¼Œå­—æ®µçš„ç±»å‹ã€æ˜¯å¦å¯ä»¥ä¸ºNULLï¼Œæ˜¯å¦å­˜åœ¨é»˜è®¤å€¼**ç­‰ä¿¡æ¯ã€‚

![image-20250412172138510](./Mysql-Learning-Local.assets/image-20250412172138510.png)

##### 3ï¼‰æŸ¥è¯¢æŒ‡å®šè¡¨çš„==å»ºè¡¨è¯­å¥==-show create table

```sql
show create table è¡¨å ;
```

é€šè¿‡è¿™æ¡æŒ‡ä»¤ï¼Œä¸»è¦æ˜¯ç”¨æ¥**æŸ¥çœ‹å»ºè¡¨è¯­å¥**çš„ï¼Œè€Œæœ‰éƒ¨åˆ†å‚æ•°æˆ‘ä»¬åœ¨åˆ›å»ºè¡¨çš„æ—¶å€™ï¼Œå¹¶æœªæŒ‡å®šä¹Ÿä¼šæŸ¥è¯¢åˆ°ï¼Œå› ä¸ºè¿™éƒ¨åˆ†æ˜¯**æ•°æ®åº“çš„é»˜è®¤å€¼**ï¼Œå¦‚ï¼š==å­˜å‚¨å¼•æ“ã€å­—ç¬¦é›†==ç­‰ã€‚

![image-20250412172725663](./Mysql-Learning-Local.assets/image-20250412172725663.png)

##### 4ï¼‰==åˆ›å»ºè¡¨ç»“æ„==-create table

```sql
CREATE TABLE è¡¨å(
    å­—æ®µ1 å­—æ®µ1ç±»å‹ [ COMMENT å­—æ®µ1æ³¨é‡Š ],
    å­—æ®µ2 å­—æ®µ2ç±»å‹ [COMMENT å­—æ®µ2æ³¨é‡Š ],
    å­—æ®µ3 å­—æ®µ3ç±»å‹ [COMMENT å­—æ®µ3æ³¨é‡Š ],
    ......
    å­—æ®µn å­—æ®µnç±»å‹ [COMMENT å­—æ®µnæ³¨é‡Š ]
) [ COMMENT è¡¨æ³¨é‡Š ] ;
```

![image-20250412171803304](./Mysql-Learning-Local.assets/image-20250412171803304.png)

æ¯”å¦‚ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€å¼ è¡¨ tb_user ï¼Œå¯¹åº”çš„ç»“æ„å¦‚ä¸‹ï¼Œé‚£ä¹ˆå»ºè¡¨è¯­å¥ä¸ºï¼š

![image-20250412171954943](./Mysql-Learning-Local.assets/image-20250412171954943.png)

```sql
create table tb_user(
    id int comment 'ç¼–å·',
    name varchar(50) comment 'å§“å',
    age int comment 'å¹´é¾„',
    gender varchar(1) comment 'æ€§åˆ«'
) comment 'ç”¨æˆ·è¡¨';
```

![image-20250412172528974](./Mysql-Learning-Local.assets/image-20250412172528974.png)



#### â‘¡ğŸŒŸè¡¨æ“ä½œ-==æ•°æ®ç±»å‹==

åœ¨ä¸Šè¿°çš„å»ºè¡¨è¯­å¥ä¸­ï¼Œæˆ‘ä»¬åœ¨æŒ‡å®šå­—æ®µçš„æ•°æ®ç±»å‹æ—¶ï¼Œç”¨åˆ°äº†int ï¼Œvarcharï¼Œé‚£ä¹ˆåœ¨MySQLä¸­é™¤äº†ä»¥ä¸Šçš„æ•°æ®ç±»å‹ï¼Œè¿˜æœ‰å“ªäº›å¸¸è§çš„æ•°æ®ç±»å‹å‘¢ï¼Ÿ æ¥ä¸‹æ¥,æˆ‘ä»¬å°±æ¥è¯¦ç»†ä»‹ç»ä¸€ä¸‹MySQLçš„æ•°æ®ç±»å‹ã€‚MySQLä¸­çš„æ•°æ®ç±»å‹æœ‰å¾ˆå¤šï¼Œä¸»è¦åˆ†ä¸ºä¸‰ç±»ï¼š**æ•°å€¼ç±»å‹ã€å­—ç¬¦ä¸²ç±»å‹ã€æ—¥æœŸæ—¶é—´ç±»å‹**ã€‚

##### 1ï¼‰æ•°å€¼ç±»å‹

![image-20250412172348715](./Mysql-Learning-Local.assets/image-20250412172348715.png)



| ç±»å‹         | å¤§å°    | æœ‰ç¬¦å·(SIGNED)èŒƒå›´                                    | æ— ç¬¦å·(UNSIGNED)èŒƒå›´                                      | æè¿°               |
| ------------ | ------- | ----------------------------------------------------- | --------------------------------------------------------- | ------------------ |
| TINYINT      | 1 byte  | (-128ï¼Œ127)                                           | (0ï¼Œ255)                                                  | å°æ•´æ•°å€¼           |
| SMALLINT     | 2 bytes | (-32768ï¼Œ32767)                                       | (0ï¼Œ65535)                                                | å¤§æ•´æ•°å€¼           |
| MEDIUMINT    | 3 bytes | (-8388608ï¼Œ8388607)                                   | (0ï¼Œ16777215)                                             | å¤§æ•´æ•°å€¼           |
| INTæˆ–INTEGER | 4 bytes | (-2147483648ï¼Œ2147483647)                             | (0ï¼Œ4294967295)                                           | å¤§æ•´æ•°å€¼           |
| BIGINT       | 8 bytes | (-2^63ï¼Œ2^63-1)                                       | (0ï¼Œ2^64-1)                                               | æå¤§æ•´æ•°å€¼         |
| FLOAT        | 4 bytes | (-3.402823466 E+38ï¼Œ3.402823466351 E+38)              | 0 å’Œ (1.175494351 E-38ï¼Œ3.402823466 E+38)                 | å•ç²¾åº¦æµ®ç‚¹æ•°å€¼     |
| DOUBLE       | 8 bytes | (-1.7976931348623157 E+308ï¼Œ1.7976931348623157 E+308) | 0 å’Œ (2.2250738585072014 E-308ï¼Œ1.7976931348623157 E+308) | åŒç²¾åº¦æµ®ç‚¹æ•°å€¼     |
| DECIMAL      |         | ä¾èµ–äºM(ç²¾åº¦)å’ŒD(æ ‡åº¦)çš„å€¼                            | ä¾èµ–äºM(ç²¾åº¦)å’ŒD(æ ‡åº¦)çš„å€¼                                | å°æ•°å€¼(ç²¾ç¡®å®šç‚¹æ•°) |

> å¦‚:
>
> 1). å¹´é¾„å­—æ®µ -- **ä¸ä¼šå‡ºç°è´Ÿæ•°, è€Œä¸”äººçš„å¹´é¾„ä¸ä¼šå¤ªå¤§**
>
> â€‹	age tinyint ==unsigned==   å¹´é¾„ä¸ä¼šå‡ºç°è´Ÿæ•°ï¼Œåˆ™ç”¨æ— ç¬¦å·tinyint
>
> 2). åˆ†æ•° -- æ€»åˆ†100åˆ†, **æœ€å¤šå‡ºç°ä¸€ä½å°æ•°**
>
> â€‹	score double(4,1)



##### 2ï¼‰å­—ç¬¦ä¸²ç±»å‹

![image-20250412173804976](./Mysql-Learning-Local.assets/image-20250412173804976.png)

| ç±»å‹       | å¤§å°                  | æè¿°                            |
| ---------- | --------------------- | ------------------------------- |
| CHAR       | 0-255 bytes           | **å®šé•¿å­—ç¬¦ä¸²**                  |
| VARCHAR    | 0-65535 bytes         | **å˜é•¿å­—ç¬¦ä¸²**                  |
| TINYBLOB   | 0-255 bytes           | ä¸è¶…è¿‡255ä¸ªå­—ç¬¦çš„**äºŒè¿›åˆ¶æ•°æ®** |
| TINYTEXT   | 0-255 bytes           | çŸ­æ–‡æœ¬å­—ç¬¦ä¸²                    |
| BLOB       | 0-65 535 bytes        | äºŒè¿›åˆ¶å½¢å¼çš„é•¿æ–‡æœ¬æ•°æ®          |
| TEXT       | 0-65 535 bytes        | **é•¿æ–‡æœ¬æ•°æ®**                  |
| MEDIUMBLOB | 0-16 777 215 bytes    | äºŒè¿›åˆ¶å½¢å¼çš„ä¸­ç­‰é•¿åº¦æ–‡æœ¬æ•°æ®    |
| MEDIUMTEXT | 0-16 777 215 bytes    | ä¸­ç­‰é•¿åº¦æ–‡æœ¬æ•°æ®                |
| LONGBLOB   | 0-4 294 967 295 bytes | äºŒè¿›åˆ¶å½¢å¼çš„æå¤§æ–‡æœ¬æ•°æ®        |
| LONGTEXT   | 0-4 294 967 295 bytes | æå¤§æ–‡æœ¬æ•°æ®                    |

char ä¸ varchar éƒ½å¯ä»¥æè¿°å­—ç¬¦ä¸²ï¼Œ**charæ˜¯å®šé•¿å­—ç¬¦ä¸²**ï¼ŒæŒ‡å®šé•¿åº¦å¤šé•¿ï¼Œå°±å ç”¨å¤šå°‘ä¸ªå­—ç¬¦ï¼Œå’Œå­—æ®µå€¼çš„é•¿åº¦æ— å…³ ã€‚è€Œ**varcharæ˜¯å˜é•¿å­—ç¬¦ä¸²**ï¼ŒæŒ‡å®šçš„é•¿åº¦ä¸ºæœ€å¤§å ç”¨é•¿åº¦ ã€‚ç›¸å¯¹æ¥è¯´ï¼Œ**==charçš„æ€§èƒ½ä¼šæ›´é«˜äº›ã€‚==**ï¼ŒåŸå› æ˜¯**varcharä¼šæ ¹æ®å†…å®¹çš„å¤§å°è®¡ç®—éœ€è¦çš„å†…å­˜ç©ºé—´ï¼Œæ¶ˆè€—æ€§èƒ½**ã€‚

> â€‹	å¦‚ï¼š
>
> -  ç”¨æˆ·å username ------> ==é•¿åº¦ä¸å®š, æœ€é•¿ä¸ä¼šè¶…è¿‡50==
>    - username varchar(50)
> -  æ€§åˆ« gender ---------> **å­˜å‚¨å€¼, ä¸æ˜¯ç”·,å°±æ˜¯å¥³**
>    - gender char(1)
> -  æ‰‹æœºå· phone --------> **å›ºå®šé•¿åº¦ä¸º11**
>    - phone char(11)



##### 3ï¼‰æ—¥æœŸç±»å‹

![image-20250412174118563](./Mysql-Learning-Local.assets/image-20250412174118563.png)

| ç±»å‹      | å¤§å° | èŒƒå›´                                       | æ ¼å¼                | æè¿°                     |
| --------- | ---- | ------------------------------------------ | ------------------- | ------------------------ |
| DATE      | 3    | 1000-01-01 è‡³ 9999-12-31                   | YYYY-MM-DD          | æ—¥æœŸå€¼                   |
| TIME      | 3    | -838:59:59 è‡³ 838:59:59                    | HH:MM:SS            | æ—¶é—´å€¼æˆ–æŒç»­æ—¶é—´         |
| YEAR      | 1    | 1901 è‡³ 2155                               | YYYY                | å¹´ä»½å€¼                   |
| DATETIME  | 8    | 1000-01-01 00:00:00 è‡³ 9999-12-31 23:59:59 | YYYY-MM-DD HH:MM:SS | æ··åˆæ—¥æœŸå’Œæ—¶é—´å€¼         |
| TIMESTAMP | 4    | 1970-01-01 00:00:01 è‡³ 2038-01-19 03:14:07 | YYYY-MM-DD HH:MM:SS | æ··åˆæ—¥æœŸå’Œæ—¶é—´å€¼ï¼Œæ—¶é—´æˆ³ |

> - ç”Ÿæ—¥å­—æ®µ birthday -**DATE**
>   - birthday date
> - åˆ›å»ºæ—¶é—´ **createtime**
>   - createtime datetime

#### â‘¢è¡¨æ“ä½œ-æ¡ˆä¾‹

![image-20250412174708771](./Mysql-Learning-Local.assets/image-20250412174708771.png)

å¯¹åº”çš„å»ºè¡¨è¯­å¥å¦‚ä¸‹:

![image-20250412175024881](./Mysql-Learning-Local.assets/image-20250412175024881.png)

```sql
create table emp(
    id int comment 'ç¼–å·',
    workno varchar(10) comment 'å·¥å·',
    name varchar(10) comment 'å§“å',
    gender char(1) comment 'æ€§åˆ«',
    age tinyint unsigned comment 'å¹´é¾„',
    idcard char(18) comment 'èº«ä»½è¯å·',
    entrydate date comment 'å…¥èŒæ—¶é—´'
) comment 'å‘˜å·¥è¡¨';
```

SQLè¯­å¥ç¼–å†™å®Œæ¯•ä¹‹åï¼Œå°±å¯ä»¥åœ¨MySQLçš„å‘½ä»¤è¡Œä¸­æ‰§è¡ŒSQLï¼Œç„¶åä¹Ÿå¯ä»¥é€šè¿‡ **desc æŒ‡ä»¤æŸ¥è¯¢è¡¨ç»“æ„ä¿¡æ¯ï¼š**

![image-20250412174858556](./Mysql-Learning-Local.assets/image-20250412174858556.png)

è¡¨ç»“æ„åˆ›å»ºå¥½äº†ï¼Œé‡Œé¢çš„nameå­—æ®µæ˜¯varcharç±»å‹ï¼Œæœ€å¤§é•¿åº¦ä¸º10ï¼Œä¹Ÿå°±æ„å‘³ç€å¦‚æœè¶…è¿‡10å°†ä¼šæŠ¥é”™ï¼Œå¦‚æœæˆ‘ä»¬æƒ³ä¿®æ”¹è¿™ä¸ªå­—æ®µçš„ç±»å‹ æˆ– ä¿®æ”¹å­—æ®µçš„é•¿åº¦è¯¥å¦‚ä½•æ“ä½œå‘¢ï¼Ÿæ¥ä¸‹æ¥å†æ¥è®²è§£**DDLè¯­å¥**ä¸­ï¼Œå¦‚ä½•æ“ä½œè¡¨å­—æ®µã€‚



#### â‘£è¡¨æ“ä½œ-==ä¿®æ”¹==-alter table

##### 1ï¼‰æ·»åŠ å­—æ®µ-add

![image-20250412180141970](./Mysql-Learning-Local.assets/image-20250412180141970.png)

```sql
ALTER TABLE è¡¨å ADD å­—æ®µå ç±»å‹ (é•¿åº¦) [ COMMENT æ³¨é‡Š ] [ çº¦æŸ ];
```

æ¡ˆä¾‹:

ä¸ºempè¡¨å¢åŠ ä¸€ä¸ªæ–°çš„å­—æ®µâ€æ˜µç§°â€ä¸ºnicknameï¼Œç±»å‹ä¸ºvarchar(20)

```sql
ALTER TABLE emp ADD nickname varchar(20) COMMENT 'æ˜µç§°';
```



##### 2ï¼‰ä¿®æ”¹æ•°æ®ç±»å‹-modify

![image-20250412180327532](./Mysql-Learning-Local.assets/image-20250412180327532.png)

```sql
ALTER TABLE è¡¨å MODIFY å­—æ®µå æ–°æ•°æ®ç±»å‹ (é•¿åº¦);
```



##### 3ï¼‰ä¿®æ”¹å­—æ®µåå’Œå­—æ®µç±»å‹-change

```sql
ALTER TABLE è¡¨å CHANGE æ—§å­—æ®µå æ–°å­—æ®µå ç±»å‹ (é•¿åº¦) [ COMMENT æ³¨é‡Š ] [ çº¦æŸ ];
```

æ¡ˆä¾‹:

å°†empè¡¨çš„nicknameå­—æ®µä¿®æ”¹ä¸ºusernameï¼Œç±»å‹ä¸ºvarchar(30)

```sql
ALTER TABLE emp CHANGE nickname username varchar(30) COMMENT 'æ˜µç§°';
```



##### 4ï¼‰åˆ é™¤å­—æ®µ-drop

![image-20250412180404849](./Mysql-Learning-Local.assets/image-20250412180404849.png)

```sql
ALTER TABLE è¡¨å DROP å­—æ®µå;
```

æ¡ˆä¾‹:

å°†empè¡¨çš„å­—æ®µusernameåˆ é™¤

```sql
ALTER TABLE emp DROP username;
```



##### 5ï¼‰ä¿®æ”¹è¡¨å-rename  to

![image-20250412180437733](./Mysql-Learning-Local.assets/image-20250412180437733.png)

```sql
ALTER TABLE è¡¨å RENAME TO æ–°è¡¨å;
```

æ¡ˆä¾‹:

å°†empè¡¨çš„è¡¨åä¿®æ”¹ä¸º employee

```sql
ALTER TABLE emp RENAME TO employee;
```



#### â‘¤è¡¨æ“ä½œåˆ é™¤-drop table

![image-20250412181043667](./Mysql-Learning-Local.assets/image-20250412181043667.png)

##### 1ï¼‰åˆ é™¤è¡¨-drop

```sql
DROP TABLE [ IF EXISTS ] è¡¨å;
```

å¯é€‰é¡¹ IF EXISTS ä»£è¡¨ï¼Œåªæœ‰è¡¨åå­˜åœ¨æ—¶æ‰ä¼šåˆ é™¤è¯¥è¡¨ï¼Œè¡¨åä¸å­˜åœ¨ï¼Œåˆ™ä¸æ‰§è¡Œåˆ é™¤æ“ä½œ(å¦‚æœä¸

åŠ è¯¥å‚æ•°é¡¹ï¼Œåˆ é™¤ä¸€å¼ ä¸å­˜åœ¨çš„è¡¨ï¼Œæ‰§è¡Œå°†ä¼šæŠ¥é”™)ã€‚

æ¡ˆä¾‹:

å¦‚æœtb_userè¡¨å­˜åœ¨ï¼Œåˆ™åˆ é™¤tb_userè¡¨

```sql
DROP TABLE IF EXISTS tb_user;
```



##### 2ï¼‰åˆ é™¤æŒ‡å®šè¡¨, å¹¶é‡æ–°åˆ›å»ºè¡¨-druncate

**æ ¼å¼åŒ–è¡¨**

```sql
TRUNCATE TABLE è¡¨å;
```

> æ³¨æ„: åœ¨åˆ é™¤è¡¨çš„æ—¶å€™ï¼Œ==è¡¨ä¸­çš„å…¨éƒ¨æ•°æ®ä¹Ÿéƒ½ä¼šè¢«åˆ é™¤==ã€‚





### ï¼ˆ3ï¼‰å°ç»“

![image-20250412190200058](./Mysql-Learning-Local.assets/image-20250412190200058.png)



## 2.4 å›¾å½¢åŒ–ç•Œé¢å·¥å…·

ä¸Šè¿°ï¼Œæˆ‘ä»¬å·²ç»è®²è§£äº†é€šè¿‡DDLè¯­å¥ï¼Œå¦‚ä½•æ“ä½œæ•°æ®åº“ã€æ“ä½œè¡¨ã€æ“ä½œè¡¨ä¸­çš„å­—æ®µï¼Œè€Œé€šè¿‡DDLè¯­å¥æ‰§

è¡Œåœ¨å‘½ä»¤è¿›è¡Œæ“ä½œï¼Œä¸»è¦å­˜åœ¨ä»¥ä¸‹ä¸¤ç‚¹é—®é¢˜ï¼š

â€‹	1).ä¼šå½±å“å¼€å‘æ•ˆç‡ ;

â€‹	2). ä½¿ç”¨èµ·æ¥ï¼Œå¹¶ä¸ç›´è§‚ï¼Œå¹¶ä¸æ–¹ä¾¿ ï¼›

æ‰€ä»¥å‘¢ï¼Œæˆ‘ä»¬åœ¨æ—¥å¸¸çš„å¼€å‘ä¸­ï¼Œä¼šå€ŸåŠ©äºMySQLçš„å›¾å½¢åŒ–ç•Œé¢ï¼Œæ¥ç®€åŒ–å¼€å‘ï¼Œæé«˜å¼€å‘æ•ˆç‡ã€‚è€Œç›®å‰

mysqlä¸»æµçš„å›¾å½¢åŒ–ç•Œé¢å·¥å…·ï¼Œæœ‰ä»¥ä¸‹å‡ ç§ï¼š

![image-20250412190353228](./Mysql-Learning-Local.assets/image-20250412190353228.png)

è€Œæœ¬æ¬¡è¯¾ç¨‹ä¸­ï¼Œé€‰æ‹©æœ€åä¸€ç§DataGripï¼Œè¿™ç§å›¾å½¢åŒ–ç•Œé¢å·¥å…·ï¼ŒåŠŸèƒ½æ›´åŠ å¼ºå¤§ï¼Œç•Œé¢æç¤ºæ›´åŠ å‹å¥½ï¼Œ

æ˜¯æˆ‘ä»¬ä½¿ç”¨MySQLçš„ä¸äºŒä¹‹é€‰ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥ä»‹ç»ä¸€ä¸‹**DataGrip**è¯¥å¦‚ä½•å®‰è£…ã€ä½¿ç”¨ã€‚



### ï¼ˆ1ï¼‰å®‰è£…

#### â‘ æ‰¾åˆ°èµ„æ–™ä¸­å‡†å¤‡å¥½çš„å®‰è£…åŒ…ï¼ŒåŒå‡»å¼€å§‹å®‰è£…

![image-20250412191057103](./Mysql-Learning-Local.assets/image-20250412191057103.png)

#### â‘¡ç‚¹å‡»nextï¼Œä¸€æ­¥ä¸€æ­¥çš„å®Œæˆå®‰è£…

![image-20250412191102737](./Mysql-Learning-Local.assets/image-20250412191102737.png)

é€‰æ‹©DataGripçš„å®‰è£…ç›®å½•ï¼Œç„¶åé€‰æ‹©ä¸‹ä¸€æ­¥

![image-20250412191115366](./Mysql-Learning-Local.assets/image-20250412191115366.png)

![image-20250412191125499](./Mysql-Learning-Local.assets/image-20250412191125499.png)

ä¸‹ä¸€æ­¥ï¼Œæ‰§è¡Œå®‰è£…

![image-20250412191132385](./Mysql-Learning-Local.assets/image-20250412191132385.png)

![image-20250412191142390](./Mysql-Learning-Local.assets/image-20250412191142390.png)

### ï¼ˆ2ï¼‰ä½¿ç”¨

#### â‘ æ·»åŠ æ•°æ®æº

å‚è€ƒå›¾ç¤º, ä¸€æ­¥æ­¥æ“ä½œå³å¯

![image-20250412191149805](./Mysql-Learning-Local.assets/image-20250412191149805.png)

é…ç½®ä»¥åŠé©±åŠ¨jaråŒ…ä¸‹è½½å®Œæ¯•ä¹‹åï¼Œå°±å¯ä»¥ç‚¹å‡» "Test Connection" å°±å¯ä»¥æµ‹è¯•ï¼Œæ˜¯å¦å¯ä»¥è¿æ¥MySQLï¼Œå¦‚æœå‡ºç° "Successed"ï¼Œå°±è¡¨åè¿æ¥æˆåŠŸäº† ã€‚

![image-20250412191202311](./Mysql-Learning-Local.assets/image-20250412191202311.png)



#### â‘¡å±•ç¤ºæ‰€æœ‰æ•°æ®åº“

è¿æ¥ä¸Šäº†MySQLæœåŠ¡ä¹‹åï¼Œå¹¶æœªå±•ç¤ºå‡ºæ‰€æœ‰çš„æ•°æ®åº“ï¼Œæ­¤æ—¶ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®ï¼Œå±•ç¤ºæ‰€æœ‰çš„æ•°æ®åº“ï¼Œå…·ä½“æ“ä½œå¦‚ä¸‹ï¼š

![image-20250412191215187](./Mysql-Learning-Local.assets/image-20250412191215187.png)



#### â‘¢åˆ›å»ºæ•°æ®åº“

![image-20250412191222201](./Mysql-Learning-Local.assets/image-20250412191222201.png)



> æ³¨æ„:
>
> ä»¥ä¸‹==ä¸¤ç§æ–¹å¼éƒ½å¯ä»¥åˆ›å»ºæ•°æ®åº“==ï¼š
>
> â€‹	 A. create **database** db01;
>
> 	B. create **schema** db01;



#### â‘£åˆ›å»ºè¡¨

åœ¨æŒ‡å®šçš„æ•°æ®åº“ä¸Šé¢å³é”®ï¼Œé€‰æ‹©new --> Table

![image-20250412191252606](./Mysql-Learning-Local.assets/image-20250412191252606.png)

![image-20250412191259671](./Mysql-Learning-Local.assets/image-20250412191259671.png)

#### â‘¤ä¿®æ”¹è¡¨ç»“æ„

åœ¨éœ€è¦ä¿®æ”¹çš„è¡¨ä¸Šï¼Œå³é”®é€‰æ‹© "Modify Table..."

![image-20250412191309681](./Mysql-Learning-Local.assets/image-20250412191309681.png)

![image-20250412191318159](./Mysql-Learning-Local.assets/image-20250412191318159.png)

å¦‚æœæƒ³å¢åŠ å­—æ®µï¼Œç›´æ¥ç‚¹å‡»+å·ï¼Œå½•å…¥å­—æ®µä¿¡æ¯ï¼Œç„¶åç‚¹å‡»Executeå³å¯ã€‚

å¦‚æœæƒ³åˆ é™¤å­—æ®µï¼Œç›´æ¥ç‚¹å‡»-å·ï¼Œå°±å¯ä»¥åˆ é™¤å­—æ®µï¼Œç„¶åç‚¹å‡»Executeå³å¯ã€‚

å¦‚æœæƒ³ä¿®æ”¹å­—æ®µï¼ŒåŒå‡»å¯¹åº”çš„å­—æ®µï¼Œä¿®æ”¹å­—æ®µä¿¡æ¯ï¼Œç„¶åç‚¹å‡»Executeå³å¯ã€‚

å¦‚æœè¦ä¿®æ”¹è¡¨åï¼Œæˆ–è¡¨çš„æ³¨é‡Šï¼Œç›´æ¥åœ¨è¾“å…¥æ¡†ä¿®æ”¹ï¼Œç„¶åç‚¹å‡»Executeå³å¯ã€‚



#### â‘¥åœ¨DataGripä¸­æ‰§è¡ŒSQLè¯­å¥

åœ¨æŒ‡å®šçš„æ•°æ®åº“ä¸Šï¼Œå³é”®ï¼Œé€‰æ‹© New --> Query Console

![image-20250412191330254](./Mysql-Learning-Local.assets/image-20250412191330254.png)

ç„¶åå°±å¯ä»¥åœ¨æ‰“å¼€çš„Query Consoleæ§åˆ¶å°ï¼Œå¹¶åœ¨æ§åˆ¶å°ä¸­ç¼–å†™SQLï¼Œæ‰§è¡ŒSQLã€‚

![image-20250412191336167](./Mysql-Learning-Local.assets/image-20250412191336167.png)



## 2.5 ğŸŒŸDML-æ•°æ®æ“ä½œ

DMLè‹±æ–‡å…¨ç§°æ˜¯**Data Manipulation Language(==æ•°æ®æ“ä½œè¯­è¨€==)**ï¼Œç”¨æ¥å¯¹æ•°æ®åº“ä¸­è¡¨çš„æ•°æ®è®°å½•è¿›

è¡Œå¢ã€åˆ ã€æ”¹æ“ä½œã€‚

- æ·»åŠ æ•°æ®ï¼ˆINSERTï¼‰
- ä¿®æ”¹æ•°æ®ï¼ˆUPDATEï¼‰
- åˆ é™¤æ•°æ®ï¼ˆDELETEï¼‰

### ï¼ˆ1ï¼‰æ·»åŠ æ•°æ®-insert

![image-20250412210251794](./Mysql-Learning-Local.assets/image-20250412210251794.png)

#### â‘ ç»™æŒ‡å®šå­—æ®µæ·»åŠ æ•°æ®

```sql
INSERT INTO è¡¨å (å­—æ®µå1, å­—æ®µå2, ...) VALUES (å€¼1, å€¼2, ...);
```

**æ¡ˆä¾‹:**  ç»™employeeè¡¨æ‰€æœ‰çš„å­—æ®µæ·»åŠ æ•°æ® ï¼›

```sql
insert into employee(id,workno,name,gender,age,idcard,entrydate)

values(1,'1','Itcast','ç”·',10,'123456789012345678','2000-01-01');
```

æ’å…¥æ•°æ®å®Œæˆä¹‹åï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§æ–¹å¼ï¼ŒæŸ¥è¯¢æ•°æ®åº“çš„æ•°æ®ï¼š

**A. æ–¹å¼ä¸€**

åœ¨å·¦ä¾§çš„è¡¨åä¸ŠåŒå‡»ï¼Œå°±å¯ä»¥æŸ¥çœ‹è¿™å¼ è¡¨çš„æ•°æ®ã€‚

![image-20250412205602957](./Mysql-Learning-Local.assets/image-20250412205602957.png)

**B. æ–¹å¼äºŒ**

å¯ä»¥ç›´æ¥ä¸€æ¡æŸ¥è¯¢æ•°æ®çš„SQLè¯­å¥, è¯­å¥å¦‚ä¸‹:

```sql
select * from employee;
```

æ¡ˆä¾‹: ç»™employeeè¡¨æ‰€æœ‰çš„å­—æ®µæ·»åŠ æ•°æ®

æ‰§è¡Œå¦‚ä¸‹SQLï¼Œæ·»åŠ çš„å¹´é¾„å­—æ®µå€¼ä¸º-1ã€‚

```sql
insert into employee(id,workno,name,gender,age,idcard,entrydate)
values(1,'1','Itcast','ç”·',-1,'123456789012345678','2000-01-01');
```

æ‰§è¡Œä¸Šè¿°çš„SQLè¯­å¥æ—¶ï¼ŒæŠ¥é”™äº†ï¼Œå…·ä½“çš„é”™è¯¯ä¿¡æ¯å¦‚ä¸‹ï¼š

![image-20250412205610876](./Mysql-Learning-Local.assets/image-20250412205610876.png)

å› ä¸º employee è¡¨çš„**ageå­—æ®µç±»å‹ä¸º tinyint**ï¼Œè€Œä¸”è¿˜æ˜¯**æ— ç¬¦å·çš„ unsigned** ï¼Œæ‰€ä»¥**å–å€¼åªèƒ½åœ¨**

**0-255 ä¹‹é—´**ã€‚

![image-20250412205632479](./Mysql-Learning-Local.assets/image-20250412205632479.png)



#### â‘¡ç»™==å…¨éƒ¨å­—æ®µ==æ·»åŠ æ•°æ®

```sql
INSERT INTO è¡¨å VALUES (å€¼1, å€¼2, ...); 
```

æ¡ˆä¾‹ï¼šæ’å…¥æ•°æ®åˆ°employeeè¡¨ï¼Œå…·ä½“çš„SQLå¦‚ä¸‹ï¼š

```sql
insert into employee values(2,'2','å¼ æ— å¿Œ','ç”·',18,'123456789012345670','2005-01-
01');
```



#### â‘¢==æ‰¹é‡æ·»åŠ ==æ•°æ®

```sql
INSERT INTO è¡¨å (å­—æ®µå1, å­—æ®µå2, ...) VALUES (å€¼1, å€¼2, ...), (å€¼1, å€¼2, ...), (å€¼

1, å€¼2, ...) ;
```

```sql
INSERT INTO è¡¨å VALUES (å€¼1, å€¼2, ...), (å€¼1, å€¼2, ...), (å€¼1, å€¼2, ...) ; 
```

æ¡ˆä¾‹ï¼šæ‰¹é‡æ’å…¥æ•°æ®åˆ°employeeè¡¨ï¼Œå…·ä½“çš„SQLå¦‚ä¸‹ï¼š

```sql
insert into employee values(3,'3','éŸ¦ä¸€ç¬‘','ç”·',38,'123456789012345670','2005-01-01'),(4,'4','èµµæ•','å¥³',18,'123456789012345670','2005-01-01');
```



> ==æ³¨æ„äº‹é¡¹==:
>
> - æ’å…¥æ•°æ®æ—¶ï¼ŒæŒ‡å®šçš„**å­—æ®µé¡ºåºéœ€è¦ä¸å€¼çš„é¡ºåºæ˜¯ä¸€ä¸€å¯¹åº”çš„**ã€‚
> - å­—ç¬¦ä¸²å’Œæ—¥æœŸå‹æ•°æ®åº”è¯¥åŒ…å«**åœ¨å¼•å·**ä¸­ã€‚
> - æ’å…¥çš„æ•°æ®å¤§å°ï¼Œåº”è¯¥åœ¨å­—æ®µçš„è§„å®šèŒƒå›´å†…ã€‚



### ï¼ˆ2ï¼‰ä¿®æ”¹æ•°æ®-update

![image-20250412212450098](./Mysql-Learning-Local.assets/image-20250412212450098.png)

ä¿®æ”¹æ•°æ®çš„å…·ä½“è¯­æ³•ä¸º:

```sql
UPDATE è¡¨å SET å­—æ®µå1 = å€¼1 , å­—æ®µå2 = å€¼2 , .... [ WHERE æ¡ä»¶ ] ;
```

æ¡ˆä¾‹:

A. ä¿®æ”¹idä¸º1çš„æ•°æ®ï¼Œå°†nameä¿®æ”¹ä¸ºitheima

```sql
update employee set name = 'itheima' where id = 1; 
```

B. ä¿®æ”¹idä¸º1çš„æ•°æ®, å°†nameä¿®æ”¹ä¸ºå°æ˜­, genderä¿®æ”¹ä¸º å¥³

```sql
update employee set name = 'å°æ˜­' , gender = 'å¥³' where id = 1; 
```

C. å°†æ‰€æœ‰çš„å‘˜å·¥å…¥èŒæ—¥æœŸä¿®æ”¹ä¸º 2008-01-01

```sql
update employee set entrydate = '2008-01-01';
```

> **æ³¨æ„äº‹é¡¹:**
>
> ä¿®æ”¹è¯­å¥çš„æ¡ä»¶å¯ä»¥æœ‰ï¼Œä¹Ÿå¯ä»¥æ²¡æœ‰ï¼Œå¦‚æœ**æ²¡æœ‰æ¡ä»¶ï¼Œåˆ™ä¼šä¿®æ”¹æ•´å¼ è¡¨çš„æ‰€æœ‰æ•°æ®**ã€‚





### ï¼ˆ3ï¼‰åˆ é™¤æ•°æ®-delete

åˆ é™¤æ•°æ®çš„å…·ä½“è¯­æ³•ä¸ºï¼š

```sql
DELETE FROM è¡¨å [ WHERE æ¡ä»¶ ] ;
```

æ¡ˆä¾‹:

A. åˆ é™¤genderä¸ºå¥³çš„å‘˜å·¥

```sql
delete from employee where gender = 'å¥³';
```

B. åˆ é™¤æ‰€æœ‰å‘˜å·¥

```sql
delete from employee;
```



> æ³¨æ„äº‹é¡¹:
>
> - DELETE è¯­å¥çš„æ¡ä»¶å¯ä»¥æœ‰ï¼Œä¹Ÿå¯ä»¥æ²¡æœ‰ï¼Œå¦‚æœæ²¡æœ‰æ¡ä»¶ï¼Œåˆ™ä¼šåˆ é™¤æ•´å¼ è¡¨çš„æ‰€æœ‰æ•°
>
>   æ®ã€‚
>
> - DELETE è¯­å¥ä¸èƒ½åˆ é™¤æŸä¸€ä¸ªå­—æ®µçš„å€¼(å¯ä»¥ä½¿ç”¨UPDATEï¼Œå°†è¯¥å­—æ®µå€¼ç½®ä¸ºNULLå³
>
>   å¯)ã€‚
>
> - å½“è¿›è¡Œåˆ é™¤å…¨éƒ¨æ•°æ®æ“ä½œæ—¶ï¼Œdatagripä¼šæç¤ºæˆ‘ä»¬ï¼Œè¯¢é—®æ˜¯å¦ç¡®è®¤åˆ é™¤ï¼Œæˆ‘ä»¬ç›´æ¥ç‚¹å‡»
>
>   Executeå³å¯ã€‚
>
> 



### ï¼ˆ4ï¼‰å°ç»“

![image-20250412212831041](./Mysql-Learning-Local.assets/image-20250412212831041.png)



## 2.6 ğŸŒŸDQL-æ•°æ®æŸ¥è¯¢

DQLè‹±æ–‡å…¨ç§°æ˜¯**Data Query Language(æ•°æ®æŸ¥è¯¢è¯­è¨€)**ï¼Œæ•°æ®æŸ¥è¯¢è¯­è¨€ï¼Œç”¨æ¥æŸ¥è¯¢æ•°æ®åº“ä¸­è¡¨çš„è®°

å½•ã€‚

æŸ¥è¯¢å…³é”®å­—: SELECT

åœ¨ä¸€ä¸ªæ­£å¸¸çš„ä¸šåŠ¡ç³»ç»Ÿä¸­ï¼Œ**æŸ¥è¯¢æ“ä½œçš„é¢‘æ¬¡æ˜¯è¦è¿œé«˜äºå¢åˆ æ”¹çš„**ï¼Œå½“æˆ‘ä»¬å»è®¿é—®ä¼ä¸šå®˜ç½‘ã€ç”µå•†ç½‘ç«™ï¼Œåœ¨è¿™äº›ç½‘ç«™ä¸­æˆ‘ä»¬æ‰€çœ‹åˆ°çš„æ•°æ®ï¼Œå®é™…éƒ½æ˜¯éœ€è¦ä»æ•°æ®åº“ä¸­æŸ¥è¯¢å¹¶å±•ç¤ºçš„ã€‚è€Œä¸”åœ¨æŸ¥è¯¢çš„è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½è¿˜ä¼šæ¶‰åŠåˆ°æ¡ä»¶ã€æ’åºã€åˆ†é¡µç­‰æ“ä½œã€‚

![image-20250412213429594](./Mysql-Learning-Local.assets/image-20250412213429594.png)

é‚£ä¹ˆï¼Œæœ¬å°èŠ‚æˆ‘ä»¬ä¸»è¦å­¦ä¹ çš„å°±æ˜¯å¦‚ä½•è¿›è¡Œæ•°æ®çš„æŸ¥è¯¢æ“ä½œã€‚ æˆ‘ä»¬å…ˆæ¥å®Œæˆå¦‚ä¸‹æ•°æ®å‡†å¤‡å·¥ä½œ:

```sql
drop table if exists employee;
create table emp(
    id int comment 'ç¼–å·',
    workno varchar(10) comment 'å·¥å·',
    name varchar(10) comment 'å§“å',
    gender char(1) comment 'æ€§åˆ«',
    age tinyint unsigned comment 'å¹´é¾„',
    idcard char(18) comment 'èº«ä»½è¯å·',
    workaddress varchar(50) comment 'å·¥ä½œåœ°å€',
    entrydate date comment 'å…¥èŒæ—¶é—´'
)comment 'å‘˜å·¥è¡¨';
INSERT INTO emp (id, workno, name, gender, age, idcard, workaddress, entrydate)
VALUES (1, '00001', 'æŸ³å²©666', 'å¥³', 20, '123456789012345678', 'åŒ—äº¬', '2000-01-
        01');
INSERT INTO emp (id, workno, name, gender, age, idcard, workaddress, entrydate)
VALUES (2, '00002', 'å¼ æ— å¿Œ', 'ç”·', 18, '123456789012345670', 'åŒ—äº¬', '2005-09-
        01');
INSERT INTO emp (id, workno, name, gender, age, idcard, workaddress, entrydate)
VALUES (3, '00003', 'éŸ¦ä¸€ç¬‘', 'ç”·', 38, '123456789712345670', 'ä¸Šæµ·', '2005-08-
        01');
INSERT INTO emp (id, workno, name, gender, age, idcard, workaddress, entrydate)
VALUES (4, '00004', 'èµµæ•', 'å¥³', 18, '123456757123845670', 'åŒ—äº¬', '2009-12-01');
INSERT INTO emp (id, workno, name, gender, age, idcard, workaddress, entrydate)
VALUES (5, '00005', 'å°æ˜­', 'å¥³', 16, '123456769012345678', 'ä¸Šæµ·', '2007-07-01');
INSERT INTO emp (id, workno, name, gender, age, idcard, workaddress, entrydate)
VALUES (6, '00006', 'æ¨é€', 'ç”·', 28, '12345678931234567X', 'åŒ—äº¬', '2006-01-01');
INSERT INTO emp (id, workno, name, gender, age, idcard, workaddress, entrydate)
VALUES (7, '00007', 'èŒƒç‘¶', 'ç”·', 40, '123456789212345670', 'åŒ—äº¬', '2005-05-01');
INSERT INTO emp (id, workno, name, gender, age, idcard, workaddress, entrydate)
VALUES (8, '00008', 'é»›ç»®ä¸', 'å¥³', 38, '123456157123645670', 'å¤©æ´¥', '2015-05-
        01');
INSERT INTO emp (id, workno, name, gender, age, idcard, workaddress, entrydate)
VALUES (9, '00009', 'èŒƒå‡‰å‡‰', 'å¥³', 45, '123156789012345678', 'åŒ—äº¬', '2010-04-
        01');
INSERT INTO emp (id, workno, name, gender, age, idcard, workaddress, entrydate)
VALUES (10, '00010', 'é™ˆå‹è°…', 'ç”·', 53, '123456789012345670', 'ä¸Šæµ·', '2011-01-
        01');
INSERT INTO emp (id, workno, name, gender, age, idcard, workaddress, entrydate)
VALUES (11, '00011', 'å¼ å£«è¯š', 'ç”·', 55, '123567897123465670', 'æ±Ÿè‹', '2015-05-
        01');
INSERT INTO emp (id, workno, name, gender, age, idcard, workaddress, entrydate)
VALUES (12, '00012', 'å¸¸é‡æ˜¥', 'ç”·', 32, '123446757152345670', 'åŒ—äº¬', '2004-02-
        01');
INSERT INTO emp (id, workno, name, gender, age, idcard, workaddress, entrydate)
VALUES (13, '00013', 'å¼ ä¸‰ä¸°', 'ç”·', 88, '123656789012345678', 'æ±Ÿè‹', '2020-11-
        01');
INSERT INTO emp (id, workno, name, gender, age, idcard, workaddress, entrydate)
VALUES (14, '00014', 'ç­ç»', 'å¥³', 65, '123456719012345670', 'è¥¿å®‰', '2019-05-
        01');
INSERT INTO emp (id, workno, name, gender, age, idcard, workaddress, entrydate)
VALUES (15, '00015', 'èƒ¡é’ç‰›', 'ç”·', 70, '12345674971234567X', 'è¥¿å®‰', '2018-04-
        01');
INSERT INTO emp (id, workno, name, gender, age, idcard, workaddress, entrydate)
VALUES (16, '00016', 'å‘¨èŠ·è‹¥', 'å¥³', 18, null, 'åŒ—äº¬', '2012-06-01');
```

å‡†å¤‡å®Œæ¯•åï¼Œæˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°empè¡¨ä¸­å‡†å¤‡çš„16æ¡æ•°æ®ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†æ¥å®ŒæˆDQLè¯­æ³•çš„å­¦ä¹ ã€‚



### ï¼ˆ1ï¼‰==åŸºæœ¬è¯­æ³•==

DQL æŸ¥è¯¢è¯­å¥ï¼Œè¯­æ³•ç»“æ„å¦‚ä¸‹ï¼š

![image-20250412214157217](./Mysql-Learning-Local.assets/image-20250412214157217.png)

```sql
SELECT
å­—æ®µåˆ—è¡¨
FROM
è¡¨ååˆ—è¡¨
WHERE
æ¡ä»¶åˆ—è¡¨
GROUP BY
åˆ†ç»„å­—æ®µåˆ—è¡¨
HAVING
åˆ†ç»„åæ¡ä»¶åˆ—è¡¨
ORDER BY
æ’åºå­—æ®µåˆ—è¡¨
LIMIT
åˆ†é¡µå‚æ•°
```

æˆ‘ä»¬åœ¨è®²è§£è¿™éƒ¨åˆ†å†…å®¹çš„æ—¶å€™ï¼Œä¼šå°†ä¸Šé¢çš„å®Œæ•´è¯­æ³•è¿›è¡Œæ‹†åˆ†ï¼Œåˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š

- åŸºæœ¬æŸ¥è¯¢ï¼ˆä¸å¸¦ä»»ä½•æ¡ä»¶ï¼‰
- æ¡ä»¶æŸ¥è¯¢ï¼ˆWHEREï¼‰
- **èšåˆå‡½æ•°**ï¼ˆcountã€maxã€minã€avgã€sumï¼‰
- åˆ†ç»„æŸ¥è¯¢ï¼ˆ**group by**ï¼‰
- æ’åºæŸ¥è¯¢ï¼ˆorder byï¼‰
- åˆ†é¡µæŸ¥è¯¢ï¼ˆlimitï¼‰



### ï¼ˆ2ï¼‰åŸºç¡€æŸ¥è¯¢

![image-20250412214245020](./Mysql-Learning-Local.assets/image-20250412214245020.png)

åœ¨åŸºæœ¬æŸ¥è¯¢çš„DQLè¯­å¥ä¸­ï¼Œä¸å¸¦ä»»ä½•çš„æŸ¥è¯¢æ¡ä»¶ï¼ŒæŸ¥è¯¢çš„è¯­æ³•å¦‚ä¸‹ï¼š

#### â‘ æŸ¥è¯¢å¤šä¸ªå­—æ®µ

```sql
SELECT å­—æ®µ1, å­—æ®µ2, å­—æ®µ3 ... FROM è¡¨å ; 

SELECT * FROM è¡¨å ; 
```

> æ³¨æ„ :  * å·ä»£è¡¨æŸ¥è¯¢æ‰€æœ‰å­—æ®µï¼Œåœ¨å®é™…å¼€å‘ä¸­å°½é‡å°‘ç”¨ï¼ˆä¸ç›´è§‚ã€å½±å“æ•ˆç‡ï¼‰

#### â‘¡å­—æ®µè®¾ç½®åˆ«å

```sql
SELECT å­—æ®µ1 [ AS åˆ«å1 ] , å­—æ®µ2 [ AS åˆ«å2 ] ... FROM è¡¨å; 

SELECT å­—æ®µ1 [ åˆ«å1 ] , å­—æ®µ2 [ åˆ«å2 ] ... FROM è¡¨å; 
```



#### â‘¢å»é™¤é‡å¤è®°å½•

```sql
SELECT DISTINCT å­—æ®µåˆ—è¡¨ FROM è¡¨å; 
```



#### â‘£æ¡ˆä¾‹

A. æŸ¥è¯¢æŒ‡å®šå­—æ®µ name, workno, ageå¹¶è¿”å›

```sql
select name,workno,age from emp; 
```

B. æŸ¥è¯¢è¿”å›æ‰€æœ‰å­—æ®µ

```sql
select id ,workno,name,gender,age,idcard,workaddress,entrydate from emp; 

select *from emp; 
```

C. æŸ¥è¯¢æ‰€æœ‰å‘˜å·¥çš„å·¥ä½œåœ°å€,èµ·åˆ«å

```sql
select workaddress as 'å·¥ä½œåœ°å€' from emp; 
-- aså¯ä»¥çœç•¥
select workaddress 'å·¥ä½œåœ°å€' from emp;
```

D. æŸ¥è¯¢å…¬å¸å‘˜å·¥çš„ä¸Šç­åœ°å€æœ‰å“ªäº›(ä¸è¦é‡å¤)

```sql
select distinct workaddress 'å·¥ä½œåœ°å€' from emp;
```



### ï¼ˆ3ï¼‰==æ¡ä»¶æŸ¥è¯¢==-where

![image-20250412215547181](./Mysql-Learning-Local.assets/image-20250412215547181.png)

#### â‘ è¯­æ³•

```sql
SELECT å­—æ®µåˆ—è¡¨ FROM è¡¨å WHERE æ¡ä»¶åˆ—è¡¨ ;
```

#### â‘¡æ¡ä»¶

å¸¸ç”¨çš„æ¯”è¾ƒè¿ç®—ç¬¦å¦‚ä¸‹:

![image-20250412215017001](./Mysql-Learning-Local.assets/image-20250412215017001.png)

| **æ¯”è¾ƒè¿ç®—ç¬¦**      | **åŠŸèƒ½**                                 |
| :------------------ | :--------------------------------------- |
| >                   | å¤§äº                                     |
| >=                  | å¤§äºç­‰äº                                 |
| <                   | å°äº                                     |
| <=                  | å°äºç­‰äº                                 |
| =                   | ç­‰äº                                     |
| <> æˆ– !=            | ä¸ç­‰äº                                   |
| BETWEEN ... AND ... | åœ¨æŸä¸ªèŒƒå›´ä¹‹å†…(å«æœ€å°ã€æœ€å¤§å€¼)           |
| IN(...)             | åœ¨inä¹‹åçš„åˆ—è¡¨ä¸­çš„å€¼ï¼Œå¤šé€‰ä¸€             |
| LIKE å ä½ç¬¦         | æ¨¡ç³ŠåŒ¹é…(_åŒ¹é…å•ä¸ªå­—ç¬¦, %åŒ¹é…ä»»æ„ä¸ªå­—ç¬¦) |
| IS NULL             | æ˜¯NULL                                   |

å¸¸ç”¨çš„é€»è¾‘è¿ç®—ç¬¦å¦‚ä¸‹:

![image-20250412215039264](./Mysql-Learning-Local.assets/image-20250412215039264.png)

| **é€»è¾‘è¿ç®—ç¬¦** | **åŠŸèƒ½**                   |
| :------------- | :------------------------- |
| AND æˆ– &&      | å¹¶ä¸”(å¤šä¸ªæ¡ä»¶åŒæ—¶æˆç«‹)     |
| OR æˆ–          | æˆ–è€…(å¤šä¸ªæ¡ä»¶ä»»æ„ä¸€ä¸ªæˆç«‹) |
| NOT æˆ– !       | é ,ä¸æ˜¯                   |

#### â‘¢æ¡ˆä¾‹

A. æŸ¥è¯¢å¹´é¾„ç­‰äº 88 çš„å‘˜å·¥

```sql
select * from emp where age = 88;
```

B. æŸ¥è¯¢å¹´é¾„å°äº 20 çš„å‘˜å·¥ä¿¡æ¯

```sql
select * from emp where age < 20;
```

C. æŸ¥è¯¢å¹´é¾„å°äºç­‰äº 20 çš„å‘˜å·¥ä¿¡æ¯

```sql
select * from emp where age <= 20; 
```

D. æŸ¥è¯¢æ²¡æœ‰èº«ä»½è¯å·çš„å‘˜å·¥ä¿¡æ¯

```sql
select * from emp where idcard is null; 
```

E. æŸ¥è¯¢æœ‰èº«ä»½è¯å·çš„å‘˜å·¥ä¿¡æ¯

```sql
select * from emp where idcard is not null; 
```

F. æŸ¥è¯¢å¹´é¾„ä¸ç­‰äº 88 çš„å‘˜å·¥ä¿¡æ¯

```sql
select * from emp where age != 88;

select * from emp where age <> 88;
```

G. æŸ¥è¯¢å¹´é¾„åœ¨15å²(åŒ…å«) åˆ° 20å²(åŒ…å«)ä¹‹é—´çš„å‘˜å·¥ä¿¡æ¯

```sql
select * from emp where age >= 15 && age <= 20;

select * from emp where age >= 15 and age <= 20;

select * from emp where age between 15 and 20;
```

H. æŸ¥è¯¢æ€§åˆ«ä¸º å¥³ ä¸”å¹´é¾„å°äº 25å²çš„å‘˜å·¥ä¿¡æ¯

```sql
select * from emp where gender = 'å¥³' and age < 25; 
```

I. æŸ¥è¯¢å¹´é¾„ç­‰äº18 æˆ– 20 æˆ– 40 çš„å‘˜å·¥ä¿¡æ¯

```sql
select * from emp where age = 18 or age = 20 or age =40;

select * from emp where age in(18,20,40);
```

J. æŸ¥è¯¢å§“åä¸ºä¸¤ä¸ªå­—çš„å‘˜å·¥ä¿¡æ¯ _ %

```sql
select * from emp where name like '__'; 
```

K. æŸ¥è¯¢èº«ä»½è¯å·æœ€åä¸€ä½æ˜¯Xçš„å‘˜å·¥ä¿¡æ¯

```sql
select * from emp where idcard like '%X';

select * from emp where idcard like '_________________X';
```



### ï¼ˆ4ï¼‰èšåˆæŸ¥è¯¢-count() ...

![image-20250412220717985](./Mysql-Learning-Local.assets/image-20250412220717985.png)

#### â‘ ä»‹ç»

==å°†**ä¸€åˆ—æ•°æ®ä½œä¸ºä¸€ä¸ªæ•´ä½“**ï¼Œè¿›è¡Œ**çºµå‘è®¡ç®—**==ã€‚

#### â‘¡å¸¸è§çš„èšåˆå‡½æ•°

![image-20250412220045037](./Mysql-Learning-Local.assets/image-20250412220045037.png)

| **å‡½æ•°** | **åŠŸèƒ½** |
| :------- | :------- |
| count    | ç»Ÿè®¡æ•°é‡ |
| max      | æœ€å¤§å€¼   |
| min      | æœ€å°å€¼   |
| avg      | å¹³å‡å€¼   |
| sum      | æ±‚å’Œ     |

#### â‘¢è¯­æ³•

```sql
SELECT èšåˆå‡½æ•°(å­—æ®µåˆ—è¡¨) FROM è¡¨å ;
```

> æ³¨æ„ : **NULLå€¼**æ˜¯==ä¸å‚ä¸æ‰€æœ‰èšåˆå‡½æ•°è¿ç®—==çš„ã€‚



#### â‘£æ¡ˆä¾‹

A. ç»Ÿè®¡è¯¥ä¼ä¸šå‘˜å·¥æ•°é‡

```sql
select count(*) from emp; -- ç»Ÿè®¡çš„æ˜¯æ€»è®°å½•æ•°

select count(idcard) from emp; -- ç»Ÿè®¡çš„æ˜¯idcardå­—æ®µä¸ä¸ºnullçš„è®°å½•æ•°
```

å¯¹äºcountèšåˆå‡½æ•°ï¼Œ**ç»Ÿè®¡ç¬¦åˆæ¡ä»¶çš„æ€»è®°å½•æ•°**ï¼Œè¿˜å¯ä»¥é€šè¿‡ count(æ•°å­—/å­—ç¬¦ä¸²)çš„å½¢å¼è¿›è¡Œç»Ÿè®¡

æŸ¥è¯¢ï¼Œæ¯”å¦‚ï¼š

```sql
select count(1) from emp; 
```



> å¯¹äºcount(*) ã€count(å­—æ®µ)ã€ count(1) çš„**å…·ä½“åŸç†**ï¼Œæˆ‘ä»¬åœ¨è¿›é˜¶ç¯‡ä¸­**SQLä¼˜åŒ–éƒ¨åˆ†**ä¼šè¯¦
>
> ç»†è®²è§£ï¼Œæ­¤å¤„å¤§å®¶åªéœ€è¦çŸ¥é“å¦‚ä½•ä½¿ç”¨å³å¯ã€‚

B. ç»Ÿè®¡è¯¥ä¼ä¸šå‘˜å·¥çš„å¹³å‡å¹´é¾„

```sql
select avg(age) from emp; 
```

C. ç»Ÿè®¡è¯¥ä¼ä¸šå‘˜å·¥çš„æœ€å¤§å¹´é¾„

```sql
select max(age) from emp; 
```

D. ç»Ÿè®¡è¯¥ä¼ä¸šå‘˜å·¥çš„æœ€å°å¹´é¾„

```sql
select min(age) from emp; 
```

E. ç»Ÿè®¡è¥¿å®‰åœ°åŒºå‘˜å·¥çš„å¹´é¾„ä¹‹å’Œ

```sql
select sum(age) from emp where workaddress = 'è¥¿å®‰'; 
```



### ï¼ˆ5ï¼‰åˆ†ç»„æŸ¥è¯¢-group by

![image-20250412223722231](./Mysql-Learning-Local.assets/image-20250412223722231.png)

#### â‘ è¯­æ³•

```sql
SELECT å­—æ®µåˆ—è¡¨ FROM è¡¨å [ WHERE æ¡ä»¶ ] GROUP BY åˆ†ç»„å­—æ®µå [ HAVING åˆ†ç»„åè¿‡æ»¤æ¡ä»¶ ];
```

#### â‘¡ğŸŒŸ ==whereä¸havingåŒºåˆ«==

- æ‰§è¡Œæ—¶æœºä¸åŒï¼šwhereæ˜¯**åˆ†ç»„ä¹‹å‰è¿›è¡Œè¿‡æ»¤**ï¼Œä¸æ»¡è¶³whereæ¡ä»¶ï¼Œ**ä¸å‚ä¸åˆ†ç»„**ï¼›è€Œ**havingæ˜¯åˆ†ç»„ä¹‹åå¯¹ç»“æœè¿›è¡Œè¿‡æ»¤ã€‚**
- åˆ¤æ–­æ¡ä»¶ä¸åŒï¼š**whereä¸èƒ½å¯¹èšåˆå‡½æ•°è¿›è¡Œåˆ¤æ–­**ï¼Œè€Œhavingå¯ä»¥ã€‚

> ==æ³¨æ„äº‹é¡¹==:
>
> - **åˆ†ç»„ä¹‹åï¼ŒæŸ¥è¯¢çš„å­—æ®µä¸€èˆ¬ä¸º==èšåˆå‡½æ•°å’Œåˆ†ç»„å­—æ®µ==**ï¼ŒæŸ¥è¯¢**==å…¶ä»–å­—æ®µæ— ä»»ä½•æ„ä¹‰==**ã€‚
> - **æ‰§è¡Œé¡ºåº: where > èšåˆå‡½æ•° > having** ã€‚
> - æ”¯æŒ**å¤šå­—æ®µåˆ†ç»„,** å…·ä½“è¯­æ³•ä¸º : group by columnA,columnB



#### â‘¢æ¡ˆä¾‹

A. æ ¹æ®æ€§åˆ«åˆ†ç»„ , ç»Ÿè®¡ç”·æ€§å‘˜å·¥ å’Œ å¥³æ€§å‘˜å·¥çš„æ•°é‡

```sql
select gender, count(*) from emp group by gender ; 
```

B. æ ¹æ®æ€§åˆ«åˆ†ç»„ , ç»Ÿè®¡ç”·æ€§å‘˜å·¥ å’Œ å¥³æ€§å‘˜å·¥çš„**å¹³å‡å¹´é¾„**

```sql
select gender, avg(age) from emp group by gender ;
```

C. æŸ¥è¯¢å¹´é¾„å°äº45çš„å‘˜å·¥ , å¹¶æ ¹æ®å·¥ä½œåœ°å€åˆ†ç»„ , è·å–å‘˜å·¥æ•°é‡å¤§äºç­‰äº3çš„å·¥ä½œåœ°å€

```sql
select workaddress, count(*) as address_count from emp where age < 45 group by workaddress having address_count >= 3;
```

D. ç»Ÿè®¡å„ä¸ªå·¥ä½œåœ°å€ä¸Šç­çš„ç”·æ€§åŠå¥³æ€§å‘˜å·¥çš„æ•°é‡

```sql
select workaddress, gender, count(*) as 'æ•°é‡' from emp group by gender,workaddress
```



### ï¼ˆ6ï¼‰æ’åºæŸ¥è¯¢-order by

![image-20250412223958433](./Mysql-Learning-Local.assets/image-20250412223958433.png)

æ’åºåœ¨æ—¥å¸¸å¼€å‘ä¸­æ˜¯éå¸¸å¸¸è§çš„ä¸€ä¸ªæ“ä½œï¼Œæœ‰å‡åºæ’åºï¼Œä¹Ÿæœ‰é™åºæ’åºã€‚

#### â‘ è¯­æ³•

```sql
SELECT å­—æ®µåˆ—è¡¨ FROM è¡¨å ORDER BY å­—æ®µ1 æ’åºæ–¹å¼1 , å­—æ®µ2 æ’åºæ–¹å¼2 ; 
```



#### â‘¡æ’åºæ–¹å¼

- ASC : å‡åº(é»˜è®¤å€¼)
- DESC: é™åº

> ==æ³¨æ„äº‹é¡¹==ï¼š
>
> å¦‚æœæ˜¯å‡åº, å¯ä»¥ä¸æŒ‡å®šæ’åºæ–¹å¼ASCï¼Œ**é»˜è®¤å‡åº** ;
>
> å¦‚æœæ˜¯**å¤šå­—æ®µæ’åº**ï¼Œ**å½“ç¬¬ä¸€ä¸ªå­—æ®µå€¼ç›¸åŒæ—¶ï¼Œæ‰ä¼šæ ¹æ®ç¬¬äºŒä¸ªå­—æ®µè¿›è¡Œæ’åº** ;



#### â‘¢æ¡ˆä¾‹

A. æ ¹æ®å¹´é¾„å¯¹å…¬å¸çš„å‘˜å·¥è¿›è¡Œå‡åºæ’åº

```sql
select * from emp order by age asc;

select * from emp order by age;
```

B. æ ¹æ®å…¥èŒæ—¶é—´, å¯¹å‘˜å·¥è¿›è¡Œé™åºæ’åº

```sql
select * from emp order by entrydate desc; 
```

C. æ ¹æ®å¹´é¾„å¯¹å…¬å¸çš„å‘˜å·¥è¿›è¡Œå‡åºæ’åº , å¹´é¾„ç›¸åŒ , å†æŒ‰ç…§å…¥èŒæ—¶é—´è¿›è¡Œé™åºæ’åº

```sql
select * from emp order by age asc , entrydate desc;
```



### ï¼ˆ7ï¼‰åˆ†é¡µæŸ¥è¯¢-limit

![image-20250412224125738](./Mysql-Learning-Local.assets/image-20250412224125738.png)

åˆ†é¡µæ“ä½œåœ¨ä¸šåŠ¡ç³»ç»Ÿå¼€å‘æ—¶ï¼Œä¹Ÿæ˜¯éå¸¸å¸¸è§çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œæˆ‘ä»¬åœ¨ç½‘ç«™ä¸­çœ‹åˆ°çš„å„ç§å„æ ·çš„**åˆ†é¡µ**æ¡ï¼Œåå°

éƒ½éœ€è¦å€ŸåŠ©äºæ•°æ®åº“çš„åˆ†é¡µæ“ä½œã€‚

#### â‘ è¯­æ³•

```sql
SELECT å­—æ®µåˆ—è¡¨ FROM è¡¨å LIMIT èµ·å§‹ç´¢å¼•, æŸ¥è¯¢è®°å½•æ•° ; 
```

> æ³¨æ„äº‹é¡¹:
>
> - èµ·å§‹ç´¢å¼•ä»0å¼€å§‹ï¼Œ**èµ·å§‹ç´¢å¼•  = ï¼ˆæŸ¥è¯¢é¡µç  - 1ï¼‰*  æ¯é¡µæ˜¾ç¤ºè®°å½•æ•°**ã€‚
> - åˆ†é¡µæŸ¥è¯¢æ˜¯æ•°æ®åº“çš„**æ–¹è¨€**ï¼Œä¸åŒçš„æ•°æ®åº“æœ‰ä¸åŒçš„å®ç°ï¼Œ**MySQLä¸­æ˜¯LIMIT**ã€‚
> - å¦‚æœæŸ¥è¯¢çš„æ˜¯ç¬¬ä¸€é¡µæ•°æ®ï¼Œ**èµ·å§‹ç´¢å¼•å¯ä»¥çœç•¥**ï¼Œç›´æ¥ç®€å†™ä¸º limit 10ã€‚

#### â‘¡æ¡ˆä¾‹

A. æŸ¥è¯¢ç¬¬1é¡µå‘˜å·¥æ•°æ®, æ¯é¡µå±•ç¤º10æ¡è®°å½•

```sql
select * from emp limit 0,10;
select * from emp limit 10;
```

B. æŸ¥è¯¢ç¬¬2é¡µå‘˜å·¥æ•°æ®, æ¯é¡µå±•ç¤º10æ¡è®°å½• -------->  **(é¡µç -1)*é¡µå±•ç¤ºè®°å½•æ•°**

```sql
select * from emp limit 10,10; 
```



### ï¼ˆ8ï¼‰æ¡ˆä¾‹

![image-20250412224227434](./Mysql-Learning-Local.assets/image-20250412224227434.png)

#### â‘ æŸ¥è¯¢å¹´é¾„ä¸º20,21,22,23å²çš„å‘˜å·¥ä¿¡æ¯ã€‚

```sql
select * from emp where gender = 'å¥³' and age in(20,21,22,23); 
```

#### â‘¡æŸ¥è¯¢æ€§åˆ«ä¸º ç”· ï¼Œå¹¶ä¸”å¹´é¾„åœ¨ 20-40 å²(å«)ä»¥å†…çš„å§“åä¸ºä¸‰ä¸ªå­—çš„å‘˜å·¥ã€‚

```sql
select * from emp where gender = 'ç”·' and (age between 20 and 40) and name like
'___';
```

#### â‘¢ç»Ÿè®¡å‘˜å·¥è¡¨ä¸­, å¹´é¾„å°äº60å²çš„ , ç”·æ€§å‘˜å·¥å’Œå¥³æ€§å‘˜å·¥çš„äººæ•°ã€‚

```sql
select gender, count(*) from emp where age < 60 group by gender; 
```

#### â‘£æŸ¥è¯¢æ‰€æœ‰å¹´é¾„å°äºç­‰äº35å²å‘˜å·¥çš„å§“åå’Œå¹´é¾„ï¼Œå¹¶å¯¹æŸ¥è¯¢ç»“æœæŒ‰å¹´é¾„å‡åºæ’åºï¼Œå¦‚æœå¹´é¾„ç›¸åŒæŒ‰å…¥èŒæ—¶é—´é™åºæ’åºã€‚

```sql
select name , age from emp where age <= 35 order by age asc , entrydate desc; 
```

#### â‘¤æŸ¥è¯¢æ€§åˆ«ä¸ºç”·ï¼Œä¸”å¹´é¾„åœ¨20-40 å²(å«)ä»¥å†…çš„å‰5ä¸ªå‘˜å·¥ä¿¡æ¯ï¼Œå¯¹æŸ¥è¯¢çš„ç»“æœæŒ‰å¹´é¾„å‡åºæ’åºï¼Œå¹´é¾„ç›¸åŒæŒ‰å…¥èŒæ—¶é—´å‡åºæ’åºã€‚

```sql
select * from emp where gender = 'ç”·' and (age between 20 and 40) order by age asc ,
entrydate asc limit 5 ;
```



### ï¼ˆ9ï¼‰ğŸŒŸ ==æ‰§è¡Œé¡ºåº==

åœ¨è®²è§£DQLè¯­å¥çš„å…·ä½“è¯­æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬å·²ç»è®²è§£äº†DQLè¯­å¥çš„å®Œæ•´è¯­æ³•ï¼ŒåŠ**ç¼–å†™é¡ºåº**ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦æ¥è¯´æ˜çš„æ˜¯DQLè¯­å¥åœ¨æ‰§è¡Œæ—¶çš„**æ‰§è¡Œé¡ºåº**ï¼Œä¹Ÿå°±æ˜¯å…ˆæ‰§è¡Œé‚£ä¸€éƒ¨åˆ†ï¼Œåæ‰§è¡Œé‚£ä¸€éƒ¨åˆ†ã€‚

![image-20250412223251443](./Mysql-Learning-Local.assets/image-20250412223251443.png)

éªŒè¯ï¼š

æŸ¥è¯¢å¹´é¾„å¤§äº15çš„å‘˜å·¥å§“åã€å¹´é¾„ï¼Œå¹¶æ ¹æ®å¹´é¾„è¿›è¡Œå‡åºæ’åºã€‚

```sql
select name , age from emp where age > 15 order by age asc;
```

åœ¨æŸ¥è¯¢æ—¶ï¼Œæˆ‘ä»¬ç»™empè¡¨èµ·ä¸€ä¸ªåˆ«å eï¼Œç„¶ååœ¨select åŠ whereä¸­ä½¿ç”¨è¯¥åˆ«åã€‚

```sql
select e.name , e.age from emp e where e.age > 15 order by age asc; 
```

æ‰§è¡Œä¸Šè¿°SQLè¯­å¥åï¼Œæˆ‘ä»¬çœ‹åˆ°ä¾ç„¶å¯ä»¥æ­£å¸¸çš„æŸ¥è¯¢åˆ°ç»“æœï¼Œæ­¤æ—¶å°±è¯´æ˜ï¼š **from å…ˆæ‰§è¡Œ, ç„¶å**

**where å’Œ select æ‰§è¡Œã€‚**é‚£ where å’Œ select åˆ°åº•å“ªä¸ªå…ˆæ‰§è¡Œå‘¢?

æ­¤æ—¶ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥ç»™selectåé¢çš„å­—æ®µèµ·åˆ«åï¼Œç„¶ååœ¨ where ä¸­ä½¿ç”¨è¿™ä¸ªåˆ«åï¼Œç„¶åçœ‹çœ‹æ˜¯å¦å¯

ä»¥æ‰§è¡ŒæˆåŠŸã€‚

```sql
select e.name ename , e.age eage from emp e where eage > 15 order by age asc; 
```

æ‰§è¡Œä¸Šè¿°SQLæŠ¥é”™äº†:

![image-20250412223259127](./Mysql-Learning-Local.assets/image-20250412223259127.png)

ç”±æ­¤æˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®º: **from å…ˆæ‰§è¡Œï¼Œç„¶åæ‰§è¡Œ where ï¼Œ å†æ‰§è¡Œselect** ã€‚



æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†æ‰§è¡Œå¦‚ä¸‹SQLè¯­å¥ï¼ŒæŸ¥çœ‹æ‰§è¡Œæ•ˆæœï¼š

```sql
select e.name ename , e.age eage from emp e where e.age > 15 order by eage asc;
```

ç»“æœæ‰§è¡ŒæˆåŠŸã€‚ é‚£ä¹ˆä¹Ÿå°±éªŒè¯äº†: **order by æ˜¯åœ¨select è¯­å¥ä¹‹åæ‰§è¡Œçš„**ã€‚



ç»¼ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°DQLè¯­å¥çš„æ‰§è¡Œé¡ºåºä¸ºï¼š **from ... where ... group by ...**

**having ... select ... order by ... limit ...**



### ï¼ˆ10ï¼‰æ€»ç»“

![image-20250412225219416](./Mysql-Learning-Local.assets/image-20250412225219416.png)





## 2.7 ğŸŒŸDCL-æ•°æ®æ§åˆ¶

DCLè‹±æ–‡å…¨ç§°æ˜¯**Data Control Language**(æ•°æ®æ§åˆ¶è¯­è¨€)ï¼Œç”¨æ¥ç®¡ç†**æ•°æ®åº“ç”¨æˆ·ã€æ§åˆ¶æ•°æ®åº“çš„è®¿é—®æƒé™ã€‚**

![image-20250412225320581](./Mysql-Learning-Local.assets/image-20250412225320581.png)

### ï¼ˆ1ï¼‰ç®¡ç†ç”¨æˆ·-userè¡¨

![image-20250412231042396](./Mysql-Learning-Local.assets/image-20250412231042396.png)

#### â‘ æŸ¥è¯¢ç”¨æˆ·

```sql
select * from mysql.user;
```

æŸ¥è¯¢çš„ç»“æœå¦‚ä¸‹:

![image-20250412225952730](./Mysql-Learning-Local.assets/image-20250412225952730.png)

å…¶ä¸­ Hostä»£è¡¨**å½“å‰ç”¨æˆ·è®¿é—®çš„ä¸»æœº,** å¦‚æœ**==ä¸ºlocalhost, ä»…ä»£è¡¨åªèƒ½å¤Ÿåœ¨å½“å‰æœ¬æœºè®¿é—®==**ï¼Œæ˜¯ä¸å¯ä»¥è¿œç¨‹è®¿é—®çš„ã€‚ Userä»£è¡¨çš„æ˜¯**è®¿é—®è¯¥æ•°æ®åº“çš„ç”¨æˆ·å**ã€‚åœ¨MySQLä¸­éœ€è¦é€šè¿‡**Hostå’ŒUseræ¥å”¯ä¸€æ ‡è¯†ä¸€ä¸ªç”¨æˆ·**ã€‚

#### â‘¡åˆ›å»ºç”¨æˆ·

```sql
CREATE USER 'ç”¨æˆ·å'@'ä¸»æœºå' IDENTIFIED BY 'å¯†ç '; 
```

#### â‘¢ ä¿®æ”¹ç”¨æˆ·å¯†ç 

```sql
ALTER USER 'ç”¨æˆ·å'@'ä¸»æœºå' IDENTIFIED WITH mysql_native_password BY 'æ–°å¯†ç ' ; 
```

#### â‘£åˆ é™¤ç”¨æˆ·

```sql
DROP USER 'ç”¨æˆ·å'@'ä¸»æœºå' ; 
```

æ³¨æ„äº‹é¡¹:

- åœ¨MySQLä¸­éœ€è¦é€šè¿‡ç”¨æˆ·å@ä¸»æœºåçš„æ–¹å¼ï¼Œæ¥å”¯ä¸€æ ‡è¯†ä¸€ä¸ªç”¨æˆ·ã€‚

- ä¸»æœºåå¯ä»¥ä½¿ç”¨ % é€šé…ã€‚
- è¿™ç±»SQLå¼€å‘äººå‘˜æ“ä½œçš„æ¯”è¾ƒå°‘ï¼Œä¸»è¦æ˜¯DBAï¼ˆ Database Administrator æ•°æ®åº“ç®¡ç†å‘˜ï¼‰ä½¿ç”¨ã€‚



#### â‘¤æ¡ˆä¾‹

A. åˆ›å»ºç”¨æˆ·itcast, åªèƒ½å¤Ÿåœ¨**å½“å‰ä¸»æœº**localhostè®¿é—®, å¯†ç 123456;

```sql
create user 'itcast'@'localhost' identified by '123456'; 
```

B. åˆ›å»ºç”¨æˆ·heima, å¯ä»¥åœ¨**ä»»æ„ä¸»æœº**è®¿é—®è¯¥æ•°æ®åº“, å¯†ç 123456;

```sql
create user 'heima'@'%' identified by '123456'; 
```

C. ä¿®æ”¹ç”¨æˆ·heimaçš„è®¿é—®å¯†ç ä¸º1234;

```sql
alter user 'heima'@'%' identified with mysql_native_password by '1234'; 
```

D. åˆ é™¤ itcast@localhost ç”¨æˆ·

```sql
drop user 'itcast'@'localhost';
```



### ï¼ˆ2ï¼‰æƒé™æ§åˆ¶

MySQLä¸­å®šä¹‰äº†å¾ˆå¤šç§æƒé™ï¼Œä½†æ˜¯å¸¸ç”¨çš„å°±ä»¥ä¸‹å‡ ç§ï¼š

![image-20250412231209734](./Mysql-Learning-Local.assets/image-20250412231209734.png)

ä¸Šè¿°åªæ˜¯ç®€å•ç½—åˆ—äº†å¸¸è§çš„å‡ ç§æƒé™æè¿°ï¼Œå…¶ä»–æƒé™æè¿°åŠå«ä¹‰ï¼Œå¯ä»¥ç›´æ¥å‚è€ƒ[**å®˜æ–¹æ–‡æ¡£**](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html)ã€‚



![image-20250412231719322](./Mysql-Learning-Local.assets/image-20250412231719322.png)

![image-20250412225931680](./Mysql-Learning-Local.assets/image-20250412225931680.png)



| **æƒé™**            | **è¯´æ˜**           |
| :------------------ | :----------------- |
| ALL, ALL PRIVILEGES | æ‰€æœ‰æƒé™           |
| SELECT              | æŸ¥è¯¢æ•°æ®           |
| INSERT              | æ’å…¥æ•°æ®           |
| UPDATE              | ä¿®æ”¹æ•°æ®           |
| DELETE              | åˆ é™¤æ•°æ®           |
| ALTER               | ä¿®æ”¹è¡¨             |
| DROP                | åˆ é™¤æ•°æ®åº“/è¡¨/è§†å›¾ |
| CREATE              | åˆ›å»ºæ•°æ®åº“/è¡¨      |



#### â‘  æŸ¥è¯¢æƒé™-show grants 

```sql
SHOW GRANTS FOR 'ç”¨æˆ·å'@'ä¸»æœºå' ; 
```

#### â‘¡ æˆäºˆæƒé™-grant

```sql
GRANT æƒé™åˆ—è¡¨ ON æ•°æ®åº“å.è¡¨å TO 'ç”¨æˆ·å'@'ä¸»æœºå'; 
```

#### â‘¢æ’¤é”€æƒé™-revoke

```sql
REVOKE æƒé™åˆ—è¡¨ ON æ•°æ®åº“å.è¡¨å FROM 'ç”¨æˆ·å'@'ä¸»æœºå'; 
```

> æ³¨æ„äº‹é¡¹ï¼š
>
> - å¤šä¸ªæƒé™ä¹‹é—´ï¼Œä½¿ç”¨é€—å·åˆ†éš”
> - æˆæƒæ—¶ï¼Œ æ•°æ®åº“åå’Œè¡¨åå¯ä»¥ä½¿ç”¨ * è¿›è¡Œé€šé…ï¼Œä»£è¡¨æ‰€æœ‰ã€‚



#### â‘£æ¡ˆä¾‹

A. æŸ¥è¯¢ 'heima'@'%' ç”¨æˆ·çš„æƒé™

```sql
show grants for 'heima'@'%'; 
```

![image-20250412231454380](./Mysql-Learning-Local.assets/image-20250412231454380.png)

B. æˆäºˆ 'heima'@'%' ç”¨æˆ·**itcastæ•°æ®åº“æ‰€æœ‰è¡¨çš„æ‰€æœ‰æ“ä½œ**æƒé™

```sql
grant all on itcast.* to 'heima'@'%'; 
```

![image-20250412231532469](./Mysql-Learning-Local.assets/image-20250412231532469.png)

C. æˆäºˆ 'heima'@'%' ç”¨æˆ·==æ‰€æœ‰æ•°æ®åº“æ‰€æœ‰è¡¨çš„æ‰€æœ‰æ“ä½œ==æƒé™

```sql
grant all on *.* to 'heima'@'%'; 
```

D. æ’¤é”€ 'heima'@'%' ç”¨æˆ·çš„itcastæ•°æ®åº“çš„æ‰€æœ‰æƒé™

```sql
revoke all on itcast.* from 'heima'@'%';
```

![image-20250412231619224](./Mysql-Learning-Local.assets/image-20250412231619224.png)



### ï¼ˆ3ï¼‰å°ç»“

![image-20250413153608736](./Mysql-Learning-Local.assets/image-20250413153608736.png)



# 3ã€å‡½æ•°

å‡½æ•° **æ˜¯æŒ‡ä¸€æ®µå¯ä»¥ç›´æ¥è¢«å¦ä¸€æ®µç¨‹åºè°ƒç”¨çš„ç¨‹åºæˆ–ä»£ç **ã€‚ ä¹Ÿå°±æ„å‘³ç€ï¼Œè¿™ä¸€æ®µç¨‹åºæˆ–ä»£ç åœ¨MySQLä¸­å·²ç»ç»™æˆ‘ä»¬æä¾›äº†ï¼Œæˆ‘ä»¬è¦åšçš„å°±æ˜¯åœ¨åˆé€‚çš„ä¸šåŠ¡åœºæ™¯è°ƒç”¨å¯¹åº”çš„å‡½æ•°å®Œæˆå¯¹åº”çš„ä¸šåŠ¡éœ€æ±‚å³å¯ã€‚ é‚£ä¹ˆï¼Œå‡½æ•°åˆ°åº•åœ¨å“ªå„¿ä½¿ç”¨å‘¢ï¼Ÿ

æˆ‘ä»¬å…ˆæ¥çœ‹ä¸¤ä¸ªåœºæ™¯ï¼š

![image-20250413153934435](./Mysql-Learning-Local.assets/image-20250413153934435.png)



- åœ¨ä¼ä¸šçš„OAæˆ–å…¶ä»–çš„äººåŠ›ç³»ç»Ÿä¸­ï¼Œç»å¸¸ä¼šæä¾›çš„æœ‰è¿™æ ·ä¸€ä¸ªåŠŸèƒ½ï¼Œæ¯ä¸€ä¸ªå‘˜å·¥ç™»å½•ä¸Šæ¥ä¹‹åéƒ½èƒ½å¤Ÿçœ‹åˆ°å½“å‰å‘˜å·¥å…¥èŒçš„å¤©æ•°ã€‚ è€Œåœ¨æ•°æ®åº“ä¸­ï¼Œå­˜å‚¨çš„éƒ½æ˜¯å…¥èŒæ—¥æœŸï¼Œå¦‚ 2000-11-12ï¼Œé‚£å¦‚æœå¿«é€Ÿè®¡ç®—å‡ºå¤©æ•°å‘¢ï¼Ÿ
- åœ¨åšæŠ¥è¡¨è¿™ç±»çš„ä¸šåŠ¡éœ€æ±‚ä¸­,æˆ‘ä»¬è¦å±•ç¤ºå‡ºå­¦å‘˜çš„åˆ†æ•°ç­‰çº§åˆ†å¸ƒã€‚è€Œåœ¨æ•°æ®åº“ä¸­ï¼Œå­˜å‚¨çš„æ˜¯å­¦ç”Ÿçš„åˆ†æ•°å€¼ï¼Œå¦‚98/75ï¼Œå¦‚ä½•å¿«é€Ÿåˆ¤å®šåˆ†æ•°çš„ç­‰çº§å‘¢ï¼Ÿ



å…¶å®ï¼Œä¸Šè¿°çš„è¿™ä¸€ç±»çš„éœ€æ±‚å‘¢ï¼Œæˆ‘ä»¬é€šè¿‡MySQLä¸­çš„å‡½æ•°éƒ½å¯ä»¥å¾ˆæ–¹ä¾¿çš„å®ç° ã€‚

MySQLä¸­çš„å‡½æ•°ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å››ç±»ï¼š **å­—ç¬¦ä¸²å‡½æ•°ã€æ•°å€¼å‡½æ•°ã€æ—¥æœŸå‡½æ•°ã€æµç¨‹å‡½æ•°ã€‚**



## 3.1 å­—ç¬¦ä¸²å‡½æ•°

### ï¼ˆ1ï¼‰å¸¸ç”¨å­—ç¬¦ä¸²å‡½æ•°

MySQLä¸­å†…ç½®äº†å¾ˆå¤šå­—ç¬¦ä¸²å‡½æ•°ï¼Œå¸¸ç”¨çš„å‡ ä¸ªå¦‚ä¸‹ï¼š

![image-20250413161340185](./Mysql-Learning-Local.assets/image-20250413161340185.png)

![image-20250413154723587](./Mysql-Learning-Local.assets/image-20250413154723587.png)

| **å‡½æ•°**                 | **åŠŸèƒ½**                                                  |
| :----------------------- | :-------------------------------------------------------- |
| CONCAT(S1,S2,...Sn)      | å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œå°†S1ï¼ŒS2ï¼Œ... Snæ‹¼æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²              |
| LOWER(str)               | å°†å­—ç¬¦ä¸²strå…¨éƒ¨è½¬ä¸ºå°å†™                                   |
| UPPER(str)               | å°†å­—ç¬¦ä¸²strå…¨éƒ¨è½¬ä¸ºå¤§å†™                                   |
| LPAD(str,n,pad)          | å·¦å¡«å……ï¼Œç”¨å­—ç¬¦ä¸²padå¯¹strçš„å·¦è¾¹è¿›è¡Œå¡«å……ï¼Œè¾¾åˆ°nä¸ªå­—ç¬¦ä¸²é•¿åº¦ |
| RPAD(str,n,pad)          | å³å¡«å……ï¼Œç”¨å­—ç¬¦ä¸²padå¯¹strçš„å³è¾¹è¿›è¡Œå¡«å……ï¼Œè¾¾åˆ°nä¸ªå­—ç¬¦ä¸²é•¿åº¦ |
| TRIM(str)                | å»æ‰å­—ç¬¦ä¸²==å¤´éƒ¨==å’Œ==å°¾éƒ¨==çš„ç©ºæ ¼                        |
| SUBSTRING(str,start,len) | è¿”å›ä»å­—ç¬¦ä¸²strä»startä½ç½®èµ·çš„lenä¸ªé•¿åº¦çš„å­—ç¬¦ä¸²           |



### ï¼ˆ2ï¼‰æ¼”ç¤ºå¦‚ä¸‹

#### A. ==concat== : å­—ç¬¦ä¸²æ‹¼æ¥

```sql
select concat('Hello' , ' MySQL'); 
```

#### B. ==lower== : å…¨éƒ¨è½¬å°å†™

```sql
select lower('Hello'); 
```

#### C. ==upper== : å…¨éƒ¨è½¬å¤§å†™

```sql
select upper('Hello'); 
```

#### D. ==lpad== : å·¦å¡«å……

```sql
select lpad('01', 5, '-'); 
```

#### E. ==rpad== : å³å¡«å……

```sql
select rpad('01', 5, '-'); 
```

#### F. ==trim== : å»é™¤ç©ºæ ¼

```sql
select trim(' Hello MySQL '); 
```

#### G. ==substring== : æˆªå–å­å­—ç¬¦ä¸²

```sql
select substring('Hello MySQL',1,5);
```



### ï¼ˆ3ï¼‰æ¡ˆä¾‹

ç”±äºä¸šåŠ¡éœ€æ±‚å˜æ›´ï¼Œä¼ä¸šå‘˜å·¥çš„å·¥å·ï¼Œç»Ÿä¸€ä¸º5ä½æ•°ï¼Œç›®å‰ä¸è¶³5ä½æ•°çš„å…¨éƒ¨åœ¨å‰é¢è¡¥0ã€‚æ¯”å¦‚ï¼š 1å·å‘˜å·¥çš„å·¥å·åº”è¯¥ä¸º00001ã€‚

![image-20250413161559888](./Mysql-Learning-Local.assets/image-20250413161559888.png)

```sql
update emp set workno = lpad(workno, 5, '0');
```

å¤„ç†å®Œæ¯•å, å…·ä½“çš„æ•°æ®ä¸º:

![image-20250413161610571](./Mysql-Learning-Local.assets/image-20250413161610571.png)



## 3.2 æ•°å€¼å‡½æ•°

### ï¼ˆ1ï¼‰å¸¸è§æ•°å€¼å‡½æ•°

å¸¸è§çš„æ•°å€¼å‡½æ•°å¦‚ä¸‹ï¼š

![image-20250413162032863](./Mysql-Learning-Local.assets/image-20250413162032863.png)

![image-20250413155146707](./Mysql-Learning-Local.assets/image-20250413155146707.png)

| **å‡½æ•°**   | **åŠŸèƒ½**                           |
| :--------- | :--------------------------------- |
| CEIL(x)    | å‘ä¸Šå–æ•´                           |
| FLOOR(x)   | å‘ä¸‹å–æ•´                           |
| MOD(x,y)   | è¿”å›x/yçš„æ¨¡                        |
| RAND()     | è¿”å›0~1å†…çš„éšæœºæ•°                  |
| ROUND(x,y) | æ±‚å‚æ•°xçš„å››èˆäº”å…¥çš„å€¼ï¼Œä¿ç•™yä½å°æ•° |

### ï¼ˆ2ï¼‰æ¼”ç¤ºå¦‚ä¸‹

#### A. ==ceil==ï¼šå‘ä¸Šå–æ•´

```sql
select ceil(1.1); 
```

#### B. ==floor==ï¼šå‘ä¸‹å–æ•´

```sql
select floor(1.9); 
```

#### C. ==mod==ï¼šå–æ¨¡

```sql
select mod(7,4); 
```

#### D. ==rand==ï¼šè·å–éšæœºæ•°-0åˆ°1ä¹‹é—´

```sql
select rand(); 
```

#### E. ==round==ï¼šå››èˆäº”å…¥

```sql
select round(2.344,2);  #2.34
select round(2.345,2);  #2.35
```



### ï¼ˆ3ï¼‰æ¡ˆä¾‹

é€šè¿‡æ•°æ®åº“çš„å‡½æ•°ï¼Œ**ç”Ÿæˆä¸€ä¸ªå…­ä½æ•°çš„éšæœºéªŒè¯ç **ã€‚

æ€è·¯ï¼š è·å–éšæœºæ•°å¯ä»¥é€šè¿‡**rand()å‡½æ•°**ï¼Œä½†æ˜¯è·å–å‡ºæ¥çš„éšæœºæ•°æ˜¯åœ¨0-1ä¹‹é—´çš„ï¼Œæ‰€ä»¥å¯ä»¥**åœ¨å…¶åŸºç¡€ä¸Šä¹˜ä»¥1000000**ï¼Œç„¶å**èˆå¼ƒå°æ•°éƒ¨åˆ†**ï¼Œå¦‚æœé•¿åº¦ä¸è¶³6ä½ï¼Œè¡¥0ï¼ˆå·¦ä¾§è¡¥0ï¼Œæ‰€ä»¥ä½¿ç”¨lpadï¼Œå³ä¾§åˆ™ä½¿ç”¨rpadï¼‰

```sql
select lpad(round(rand()*1000000 , 0), 6, '0');
```



## 3.3 æ—¥æœŸå‡½æ•°

### ï¼ˆ1ï¼‰å¸¸è§æ—¥æœŸå‡½æ•°

![image-20250413162454158](./Mysql-Learning-Local.assets/image-20250413162454158.png)

å¸¸è§çš„æ—¥æœŸå‡½æ•°å¦‚ä¸‹ï¼š

![image-20250413155949307](./Mysql-Learning-Local.assets/image-20250413155949307.png)

| **å‡½æ•°**                           | **åŠŸèƒ½**                                          |
| :--------------------------------- | :------------------------------------------------ |
| CURDATE()                          | è¿”å›å½“å‰æ—¥æœŸ                                      |
| CURTIME()                          | è¿”å›å½“å‰æ—¶é—´                                      |
| NOW()                              | è¿”å›å½“å‰æ—¥æœŸå’Œæ—¶é—´                                |
| YEAR(date)                         | è·å–æŒ‡å®šdateçš„å¹´ä»½                                |
| MONTH(date)                        | è·å–æŒ‡å®šdateçš„æœˆä»½                                |
| DAY(date)                          | è·å–æŒ‡å®šdateçš„æ—¥æœŸ                                |
| DATE_ADD(date, INTERVAL expr type) | è¿”å›ä¸€ä¸ªæ—¥æœŸ/æ—¶é—´å€¼åŠ ä¸Šä¸€ä¸ªæ—¶é—´é—´éš”expråçš„æ—¶é—´å€¼ |
| DATEDIFF(date1,date2)              | è¿”å›èµ·å§‹æ—¶é—´date1 å’Œ ç»“æŸæ—¶é—´date2ä¹‹é—´çš„å¤©æ•°      |

### ï¼ˆ2ï¼‰æ¼”ç¤ºå¦‚ä¸‹

#### A. ==curdate==ï¼šå½“å‰æ—¥æœŸ

```sql
select curdate(); 
```

#### B. ==curtime==ï¼šå½“å‰æ—¶é—´

```sql
select curtime(); 
```

#### C. ==now==ï¼šå½“å‰æ—¥æœŸå’Œæ—¶é—´

```sql
select now(); 
```

#### D. ==YEAR , MONTH , DAY==ï¼š**å½“å‰å¹´ã€æœˆã€æ—¥**

```sql
select YEAR(now());
select MONTH(now());
select DAY(now());
```

#### E. ==date_add==ï¼šå¢åŠ æŒ‡å®šçš„æ—¶é—´é—´éš”-INTERVAL

```sql
select date_add(now(), INTERVAL 70 YEAR );
```

#### F. ==datediff==ï¼šè·å–ä¸¤ä¸ªæ—¥æœŸç›¸å·®çš„å¤©æ•°

```sql
select datediff('2021-10-01', '2021-12-01');  # -61
select datediff('2021-12-01', '2021-10-01');  # 61
```

### ï¼ˆ3ï¼‰æ¡ˆä¾‹

æŸ¥è¯¢æ‰€æœ‰å‘˜å·¥çš„å…¥èŒå¤©æ•°ï¼Œå¹¶æ ¹æ®å…¥èŒå¤©æ•°å€’åºæ’åºã€‚

æ€è·¯ï¼š å…¥èŒå¤©æ•°ï¼Œå°±æ˜¯é€šè¿‡å½“å‰æ—¥æœŸ - å…¥èŒæ—¥æœŸï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨**datediffå‡½æ•°**æ¥å®Œæˆã€‚

```sql
select name, datediff(curdate(), entrydate) as 'entrydays' from emp order by entrydays desc;
```



## 3.4 æµç¨‹å‡½æ•°

æµç¨‹å‡½æ•°ä¹Ÿæ˜¯å¾ˆå¸¸ç”¨çš„ä¸€ç±»å‡½æ•°ï¼Œå¯ä»¥åœ¨SQLè¯­å¥ä¸­å®ç°æ¡ä»¶ç­›é€‰ï¼Œä»è€Œæé«˜è¯­å¥çš„æ•ˆç‡ã€‚

### ï¼ˆ1ï¼‰å¸¸è§æµç¨‹å‡½æ•°

![image-20250413160625835](./Mysql-Learning-Local.assets/image-20250413160625835.png)

| **å‡½æ•°**                                                     | **åŠŸèƒ½**                                                     |
| :----------------------------------------------------------- | :----------------------------------------------------------- |
| IF(value , t , f)                                            | å¦‚æœvalueä¸ºtrueï¼Œåˆ™è¿”å›tï¼Œå¦åˆ™è¿”å›f                          |
| IFNULL(value1 , value2)                                      | å¦‚æœvalue1ä¸ä¸ºç©ºï¼Œè¿”å›value1ï¼Œå¦åˆ™è¿”å›value2                 |
| CASE WHEN [ val1 ] THEN [res1] ...ELSE [ default ] END       | **å¦‚æœval1==ä¸ºtrue==**ï¼Œè¿”å›res1ï¼Œ... å¦åˆ™è¿”å›defaulté»˜è®¤å€¼  |
| CASE [ expr ] WHEN [ val1 ] THEN[res1] ... ELSE [ default ] END | **å¦‚æœexprçš„==å€¼ç­‰äº==val1**ï¼Œè¿”å›res1ï¼Œ... å¦åˆ™è¿”å›defaulté»˜è®¤å€¼ |

### ï¼ˆ2ï¼‰æ¼”ç¤ºå¦‚ä¸‹

#### A. ==if==

```sql
select if(false, 'Ok', 'Error'); 
```

#### B. ==ifnull==

```sql
select ifnull('Ok','Default'); # OK

select ifnull('','Default'); # è¾“å‡º ''

select ifnull(null,'Default');  # è¾“å‡ºDefault
```



#### C. ==case when then else end==

éœ€æ±‚: æŸ¥è¯¢empè¡¨çš„å‘˜å·¥å§“åå’Œå·¥ä½œåœ°å€ (åŒ—äº¬/ä¸Šæµ· ----> ä¸€çº¿åŸå¸‚ , å…¶ä»– ----> äºŒçº¿åŸå¸‚)

```sql
select 
name,
(case workaddress when 'åŒ—äº¬' then 'ä¸€çº¿åŸå¸‚' when 'ä¸Šæµ·' then 'ä¸€çº¿åŸå¸‚' else
 'äºŒçº¿åŸå¸‚' end ) as 'å·¥ä½œåœ°å€'
from emp;
```



### ï¼ˆ3ï¼‰æ¡ˆä¾‹

![image-20250413163559587](./Mysql-Learning-Local.assets/image-20250413163559587.png)

```sql
create table score(
    id int comment 'ID',
    name varchar(20) comment 'å§“å',
    math int comment 'æ•°å­¦',
    english int comment 'è‹±è¯­',
    chinese int comment 'è¯­æ–‡'
) comment 'å­¦å‘˜æˆç»©è¡¨';
insert into score(id, name, math, english, chinese) VALUES (1, 'Tom', 67, 88, 95), (2, 'Rose' , 23, 66, 90),(3, 'Jack', 56, 98, 76);
```

å…·ä½“çš„SQLè¯­å¥å¦‚ä¸‹:

```sql
select
id,
name,
(case when math >= 85 then 'ä¼˜ç§€' when math >=60 then 'åŠæ ¼' else 'ä¸åŠæ ¼' end )
'æ•°å­¦',
(case when english >= 85 then 'ä¼˜ç§€' when english >=60 then 'åŠæ ¼' else 'ä¸åŠæ ¼'
 end ) 'è‹±è¯­',
(case when chinese >= 85 then 'ä¼˜ç§€' when chinese >=60 then 'åŠæ ¼' else 'ä¸åŠæ ¼'
 end ) 'è¯­æ–‡'
from score;
```



## 3.5 å°ç»“

![image-20250413163950502](./Mysql-Learning-Local.assets/image-20250413163950502.png)



> MySQLçš„å¸¸è§å‡½æ•°æˆ‘ä»¬å­¦ä¹ å®Œäº†ï¼Œé‚£æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æ¥åˆ†æä¸€ä¸‹ï¼Œåœ¨å‰é¢è®²åˆ°çš„ä¸¤ä¸ªå‡½æ•°çš„æ¡ˆä¾‹åœºæ™¯ï¼Œ
>
> æ€è€ƒä¸€ä¸‹éœ€è¦ç”¨åˆ°ä»€ä¹ˆæ ·çš„å‡½æ•°æ¥å®ç°?
>
> ![image-20250413164019815](./Mysql-Learning-Local.assets/image-20250413164019815.png)
>
> - æ•°æ®åº“ä¸­ï¼Œå­˜å‚¨çš„æ˜¯å…¥èŒæ—¥æœŸï¼Œå¦‚ 2000-01-01ï¼Œå¦‚ä½•å¿«é€Ÿè®¡ç®—å‡ºå…¥èŒå¤©æ•°å‘¢ï¼Ÿ -------->
>   - ç­”æ¡ˆ: datediff
> - æ•°æ®åº“ä¸­ï¼Œå­˜å‚¨çš„æ˜¯å­¦ç”Ÿçš„åˆ†æ•°å€¼ï¼Œå¦‚98ã€75ï¼Œå¦‚ä½•å¿«é€Ÿåˆ¤å®šåˆ†æ•°çš„ç­‰çº§å‘¢ï¼Ÿ ---------->
>   - ç­”æ¡ˆ: case ... when ...



# 4ã€çº¦æŸ

> ==æ³¨æ„==ï¼šçº¦æŸæ˜¯**ä½œç”¨äºè¡¨ä¸­å­—æ®µä¸Šçš„**ï¼Œå¯ä»¥åœ¨**åˆ›å»ºè¡¨/ä¿®æ”¹è¡¨çš„æ—¶å€™æ·»åŠ çº¦æŸ**ã€‚

## 4.1 æ¦‚è¿°

![image-20250413170414599](./Mysql-Learning-Local.assets/image-20250413170414599.png)

### ï¼ˆ1ï¼‰æ¦‚å¿µ

çº¦æŸæ˜¯ä½œç”¨äºè¡¨ä¸­å­—æ®µä¸Šçš„è§„åˆ™ï¼Œç”¨äºé™åˆ¶å­˜å‚¨åœ¨è¡¨ä¸­çš„æ•°æ®ã€‚

### ï¼ˆ2ï¼‰ç›®çš„

ä¿è¯æ•°æ®åº“ä¸­æ•°æ®çš„æ­£ç¡®ã€æœ‰æ•ˆæ€§å’Œå®Œæ•´æ€§ã€‚

### ï¼ˆ3ï¼‰åˆ†ç±»

![image-20250413164315127](./Mysql-Learning-Local.assets/image-20250413164315127.png)

> ==æ³¨æ„==ï¼šçº¦æŸæ˜¯**ä½œç”¨äºè¡¨ä¸­å­—æ®µä¸Šçš„**ï¼Œå¯ä»¥åœ¨**åˆ›å»ºè¡¨/ä¿®æ”¹è¡¨çš„æ—¶å€™æ·»åŠ çº¦æŸ**ã€‚



## 4.2 çº¦æŸæ¼”ç¤º-æ¡ˆä¾‹

ä¸Šé¢æˆ‘ä»¬ä»‹ç»äº†æ•°æ®åº“ä¸­å¸¸è§çš„çº¦æŸï¼Œä»¥åŠçº¦æŸæ¶‰åŠåˆ°çš„å…³é”®å­—ï¼Œé‚£è¿™äº›çº¦æŸæˆ‘ä»¬åˆ°åº•å¦‚ä½•åœ¨åˆ›å»ºè¡¨ã€ä¿®æ”¹è¡¨çš„æ—¶å€™æ¥æŒ‡å®šå‘¢ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±é€šè¿‡ä¸€ä¸ªæ¡ˆä¾‹ï¼Œæ¥æ¼”ç¤ºä¸€ä¸‹ã€‚

æ¡ˆä¾‹éœ€æ±‚ï¼š æ ¹æ®éœ€æ±‚ï¼Œå®Œæˆè¡¨ç»“æ„çš„åˆ›å»ºã€‚éœ€æ±‚å¦‚ä¸‹ï¼š

![image-20250413170815405](./Mysql-Learning-Local.assets/image-20250413170815405.png)

| **å­—æ®µå**         | **å­—æ®µå«ä¹‰** | **å­—æ®µç±»å‹** | **çº¦æŸæ¡ä»¶**              | **çº¦æŸå…³é”®å­—**              |
| :----------------- | :----------- | :----------- | :------------------------ | :-------------------------- |
| id                 | IDå”¯ä¸€æ ‡è¯†   | int          | ä¸»é”®ï¼Œå¹¶ä¸”è‡ªåŠ¨å¢é•¿        | PRIMARY KEY, AUTO_INCREMENT |
| name               | å§“å         | varchar(10)  | ä¸ä¸ºç©ºï¼Œå¹¶ä¸”å”¯ä¸€          | NOT NULL , UNIQUE           |
| age                | å¹´é¾„         | int          | å¤§äº0ï¼Œå¹¶ä¸”å°äºç­‰äº120    | CHECK                       |
| status             | çŠ¶æ€         | char(1)      | å¦‚æœæ²¡æœ‰æŒ‡å®šè¯¥å€¼ï¼Œé»˜è®¤ä¸º1 | DEFAULT                     |
| gender             | æ€§åˆ«         | char(1)      | æ—                         |                             |
| å¯¹åº”çš„å»ºè¡¨è¯­å¥ä¸ºï¼š |              |              |                           |                             |

å¯¹åº”çš„å»ºè¡¨è¯­å¥ä¸ºï¼š

```sql
CREATE TABLE tb_user(
    id int AUTO_INCREMENT PRIMARY KEY COMMENT 'IDå”¯ä¸€æ ‡è¯†',
    name varchar(10) NOT NULL UNIQUE COMMENT 'å§“å' ,
    age int check (age > 0 && age <= 120) COMMENT 'å¹´é¾„' ,
    status char(1) default '1' COMMENT 'çŠ¶æ€',
    gender char(1) COMMENT 'æ€§åˆ«'
);
```

åœ¨ä¸ºå­—æ®µæ·»åŠ çº¦æŸæ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨**å­—æ®µä¹‹ååŠ ä¸Šçº¦æŸçš„å…³é”®å­—**å³å¯ï¼Œéœ€è¦å…³æ³¨å…¶è¯­æ³•ã€‚æˆ‘ä»¬æ‰§è¡Œä¸Šé¢çš„SQLæŠŠè¡¨ç»“æ„åˆ›å»ºå®Œæˆï¼Œç„¶åæ¥ä¸‹æ¥ï¼Œå°±å¯ä»¥é€šè¿‡ä¸€ç»„æ•°æ®è¿›è¡Œæµ‹è¯•ï¼Œä»è€ŒéªŒè¯ä¸€ä¸‹ï¼Œçº¦æŸæ˜¯å¦å¯ä»¥ç”Ÿæ•ˆã€‚

```sql
insert into tb_user(name,age,status,gender) values ('Tom1',19,'1','ç”·'),
('Tom2',25,'0','ç”·');

# éªŒè¯ name çš„ not null
insert into tb_user(name,age,status,gender) values ('Tom3',19,'1','ç”·');
insert into tb_user(name,age,status,gender) values (null,19,'1','ç”·');

# éªŒè¯ name çš„ Unique
insert into tb_user(name,age,status,gender) values ('Tom3',19,'1','ç”·');

# éªŒè¯ age
insert into tb_user(name,age,status,gender) values ('Tom4',80,'1','ç”·');
insert into tb_user(name,age,status,gender) values ('Tom5',-1,'1','ç”·');
insert into tb_user(name,age,status,gender) values ('Tom5',121,'1','ç”·');

# éªŒè¯statusçš„ Default
insert into tb_user(name,age,gender) values ('Tom5',120,'ç”·');
```

ä¸Šé¢ï¼Œæˆ‘ä»¬æ˜¯é€šè¿‡ç¼–å†™SQLè¯­å¥çš„å½¢å¼æ¥å®Œæˆçº¦æŸçš„æŒ‡å®šï¼Œé‚£åŠ å…¥æˆ‘ä»¬æ˜¯**é€šè¿‡å›¾å½¢åŒ–ç•Œé¢**æ¥åˆ›å»ºè¡¨ç»“æ„æ—¶ï¼Œåˆè¯¥å¦‚ä½•æ¥æŒ‡å®šçº¦æŸå‘¢ï¼Ÿ åªéœ€è¦åœ¨åˆ›å»ºè¡¨çš„æ—¶å€™ï¼Œæ ¹æ®æˆ‘ä»¬çš„éœ€è¦é€‰æ‹©å¯¹åº”çš„çº¦æŸå³å¯ã€‚

![image-20250413164714811](./Mysql-Learning-Local.assets/image-20250413164714811.png)





## 4.3 ==å¤–é”®çº¦æŸ==

### ï¼ˆ1ï¼‰ä»‹ç»

![image-20250413171424550](./Mysql-Learning-Local.assets/image-20250413171424550.png)

å¤–é”®ï¼šç”¨æ¥è®©ä¸¤å¼ è¡¨çš„**æ•°æ®ä¹‹é—´å»ºç«‹è¿æ¥**ï¼Œä»è€Œ**ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§å’Œå®Œæ•´æ€§**ã€‚

æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š

![image-20250413164856886](./Mysql-Learning-Local.assets/image-20250413164856886.png)

å·¦ä¾§çš„empè¡¨æ˜¯å‘˜å·¥è¡¨ï¼Œé‡Œé¢å­˜å‚¨å‘˜å·¥çš„åŸºæœ¬ä¿¡æ¯ï¼ŒåŒ…å«å‘˜å·¥çš„IDã€å§“åã€å¹´é¾„ã€èŒä½ã€è–ªèµ„ã€å…¥èŒæ—¥æœŸã€ä¸Šçº§ä¸»ç®¡IDã€éƒ¨é—¨IDï¼Œåœ¨å‘˜å·¥çš„ä¿¡æ¯ä¸­å­˜å‚¨çš„æ˜¯éƒ¨é—¨çš„ID dept_idï¼Œè€Œè¿™ä¸ªéƒ¨é—¨çš„IDæ˜¯å…³è”çš„éƒ¨é—¨è¡¨deptçš„ä¸»é”®idï¼Œé‚£empè¡¨çš„dept_idå°±æ˜¯å¤–é”®,å…³è”çš„æ˜¯å¦ä¸€å¼ è¡¨çš„ä¸»é”®ã€‚

> æ³¨æ„ï¼šç›®å‰ä¸Šè¿°ä¸¤å¼ è¡¨ï¼Œåªæ˜¯åœ¨**é€»è¾‘ä¸Šå­˜åœ¨è¿™æ ·ä¸€å±‚å…³ç³»**ï¼›**åœ¨æ•°æ®åº“å±‚é¢ï¼Œå¹¶æœªå»ºç«‹å¤–é”®å…³è”**ï¼Œæ‰€ä»¥	æ˜¯æ— æ³•ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§å’Œå®Œæ•´æ€§çš„ã€‚



æ²¡æœ‰æ•°æ®åº“å¤–é”®å…³è”çš„æƒ…å†µä¸‹ï¼Œèƒ½å¤Ÿä¿è¯ä¸€è‡´æ€§å’Œå®Œæ•´æ€§å‘¢ï¼Œæˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ã€‚

**å‡†å¤‡æ•°æ®**

```sql
create table dept(
    id int auto_increment comment 'ID' primary key,
    name varchar(50) not null comment 'éƒ¨é—¨åç§°'
)comment 'éƒ¨é—¨è¡¨';

INSERT INTO dept (id, name) VALUES (1, 'ç ”å‘éƒ¨'), (2, 'å¸‚åœºéƒ¨'),(3, 'è´¢åŠ¡éƒ¨'), (4,'é”€å”®éƒ¨'), (5, 'æ€»ç»åŠ');

drop table if exists emp
create table emp(
    id int auto_increment comment 'ID' primary key,
    name varchar(50) not null comment 'å§“å',
    age int comment 'å¹´é¾„',
    job varchar(20) comment 'èŒä½',
    salary int comment 'è–ªèµ„',
    entrydate date comment 'å…¥èŒæ—¶é—´',
    managerid int comment 'ç›´å±é¢†å¯¼ID',
    dept_id int comment 'éƒ¨é—¨ID'
)comment 'å‘˜å·¥è¡¨';

INSERT INTO emp (id, name, age, job,salary, entrydate, managerid, dept_id) VALUES
(1, 'é‡‘åº¸', 66, 'æ€»è£',20000, '2000-01-01', null,5),
(2, 'å¼ æ— å¿Œ', 20,'é¡¹ç›®ç»ç†',12500, '2005-12-05', 1,1),
(3, 'æ¨é€', 33, 'å¼€å‘', 8400,'2000-11-03', 2,1),
(4, 'éŸ¦ä¸€ç¬‘', 48, 'å¼€å‘',11000, '2002-02-05', 2,1),
(5, 'å¸¸é‡æ˜¥', 43, 'å¼€å‘',10500, '2004-09-07', 3,1),
(6, 'å°æ˜­', 19, 'ç¨‹åºå‘˜é¼“åŠ±å¸ˆ',6600, '2004-10-12', 2,1);
```

![image-20250413164906268](./Mysql-Learning-Local.assets/image-20250413164906268.png)

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥åšä¸€ä¸ªæµ‹è¯•ï¼Œåˆ é™¤idä¸º1çš„éƒ¨é—¨ä¿¡æ¯ã€‚

![image-20250413164913369](./Mysql-Learning-Local.assets/image-20250413164913369.png)

ç»“æœï¼Œæˆ‘ä»¬çœ‹åˆ°åˆ é™¤æˆåŠŸï¼Œè€Œåˆ é™¤æˆåŠŸä¹‹åï¼Œéƒ¨é—¨è¡¨ä¸å­˜åœ¨idä¸º1çš„éƒ¨é—¨ï¼Œè€Œåœ¨empè¡¨ä¸­è¿˜æœ‰å¾ˆå¤šçš„å‘˜å·¥ï¼Œå…³è”çš„ä¸ºidä¸º1çš„éƒ¨é—¨ï¼Œæ­¤æ—¶å°±å‡ºç°äº†æ•°æ®çš„ä¸å®Œæ•´æ€§ã€‚ è€Œè¦æƒ³è§£å†³è¿™ä¸ªé—®é¢˜å°±å¾—é€šè¿‡æ•°æ®åº“çš„å¤–é”®çº¦æŸã€‚



### ï¼ˆ2ï¼‰è¯­æ³•

![image-20250413171938322](./Mysql-Learning-Local.assets/image-20250413171938322.png)

#### â‘ æ·»åŠ å¤–é”®

```sql
CREATE TABLE è¡¨å(
    å­—æ®µå æ•°æ®ç±»å‹,
    ...
    [CONSTRAINT] [å¤–é”®åç§°] FOREIGN KEY (å¤–é”®å­—æ®µå) REFERENCES ä¸»è¡¨ (ä¸»è¡¨åˆ—å)
);

ALTER TABLE è¡¨å ADD CONSTRAINT å¤–é”®åç§° FOREIGN KEY (å¤–é”®å­—æ®µå)
REFERENCES ä¸»è¡¨ (ä¸»è¡¨åˆ—å) ;
```

##### 1ï¼‰æ¡ˆä¾‹

ä¸ºempè¡¨çš„dept_idå­—æ®µæ·»åŠ å¤–é”®çº¦æŸ,å…³è”deptè¡¨çš„ä¸»é”®idã€‚

```sql
alter table emp add constraint fk_emp_dept_id foreign key (dept_id) references dept(id);
```

![image-20250413170144205](./Mysql-Learning-Local.assets/image-20250413170144205.png)

æ·»åŠ äº†å¤–é”®çº¦æŸä¹‹åï¼Œæˆ‘ä»¬å†åˆ°deptè¡¨(çˆ¶è¡¨)åˆ é™¤idä¸º1çš„è®°å½•ï¼Œç„¶åçœ‹ä¸€ä¸‹ä¼šå‘ç”Ÿä»€ä¹ˆç°è±¡ã€‚ æ­¤æ—¶å°†ä¼šæŠ¥é”™ï¼Œä¸èƒ½åˆ é™¤æˆ–æ›´æ–°çˆ¶è¡¨è®°å½•ï¼Œå› ä¸ºå­˜åœ¨å¤–é”®çº¦æŸã€‚

![image-20250413171910459](./Mysql-Learning-Local.assets/image-20250413171910459.png)



#### â‘¡ åˆ é™¤å¤–é”®

```sql
ALTER TABLE è¡¨å DROP FOREIGN KEY å¤–é”®åç§°;
```

##### 1ï¼‰æ¡ˆä¾‹

åˆ é™¤empè¡¨çš„å¤–é”®fk_emp_dept_idã€‚

```sql
alter table emp drop foreign key fk_emp_dept_id; 
```



### ï¼ˆ3ï¼‰åˆ é™¤/æ›´æ–°è¡Œä¸º

æ·»åŠ äº†å¤–é”®ä¹‹åï¼Œå†åˆ é™¤çˆ¶è¡¨æ•°æ®æ—¶äº§ç”Ÿçš„çº¦æŸè¡Œä¸ºï¼Œæˆ‘ä»¬å°±ç§°ä¸ºåˆ é™¤/æ›´æ–°è¡Œä¸ºã€‚å…·ä½“çš„åˆ é™¤/æ›´æ–°è¡Œä¸ºæœ‰ä»¥ä¸‹å‡ ç§:

![image-20250413172446330](./Mysql-Learning-Local.assets/image-20250413172446330.png)

| **è¡Œä¸º**    | **è¯´æ˜**                                                     |
| :---------- | :----------------------------------------------------------- |
| NO ACTION   | å½“åœ¨çˆ¶è¡¨ä¸­åˆ é™¤/æ›´æ–°å¯¹åº”è®°å½•æ—¶ï¼Œé¦–å…ˆ**æ£€æŸ¥è¯¥è®°å½•æ˜¯å¦æœ‰å¯¹åº”å¤–é”®ï¼Œå¦‚æœæœ‰åˆ™ä¸å…è®¸åˆ é™¤/æ›´æ–°**ã€‚ (ä¸ RESTRICT ä¸€è‡´) é»˜è®¤è¡Œä¸º |
| RESTRICT    | å½“åœ¨çˆ¶è¡¨ä¸­åˆ é™¤/æ›´æ–°å¯¹åº”è®°å½•æ—¶ï¼Œé¦–å…ˆæ£€æŸ¥è¯¥è®°å½•æ˜¯å¦æœ‰å¯¹åº”å¤–é”®ï¼Œå¦‚æœæœ‰åˆ™ä¸å…è®¸åˆ é™¤/æ›´æ–°ã€‚ (ä¸ NO ACTION ä¸€è‡´) é»˜è®¤è¡Œä¸º |
| CASCADE     | å½“åœ¨çˆ¶è¡¨ä¸­åˆ é™¤/æ›´æ–°å¯¹åº”è®°å½•æ—¶ï¼Œé¦–å…ˆæ£€æŸ¥è¯¥è®°å½•æ˜¯å¦æœ‰å¯¹åº”å¤–é”®ï¼Œ**å¦‚æœæœ‰ï¼Œåˆ™ä¹Ÿåˆ é™¤/æ›´æ–°å¤–é”®åœ¨å­è¡¨ä¸­çš„è®°å½•ã€‚**==çº§è”åˆ é™¤== |
| SET NULL    | å½“åœ¨çˆ¶è¡¨ä¸­åˆ é™¤å¯¹åº”è®°å½•æ—¶ï¼Œé¦–å…ˆæ£€æŸ¥è¯¥è®°å½•æ˜¯å¦æœ‰å¯¹åº”å¤–é”®ï¼Œ**å¦‚æœæœ‰åˆ™è®¾ç½®å­è¡¨ä¸­è¯¥å¤–é”®å€¼ä¸ºnull**ï¼ˆè¿™å°±**è¦æ±‚è¯¥å¤–é”®å…è®¸å–null**ï¼‰ã€‚ |
| SET DEFAULT | çˆ¶è¡¨æœ‰å˜æ›´æ—¶ï¼Œå­è¡¨å°†å¤–é”®åˆ—è®¾ç½®æˆä¸€ä¸ªé»˜è®¤çš„å€¼ (**Innodbä¸æ”¯æŒ**) |

#### â‘ ==å…·ä½“è¯­æ³•==

```sql
ALTER TABLE è¡¨å ADD CONSTRAINT å¤–é”®åç§° FOREIGN KEY (å¤–é”®å­—æ®µ) REFERENCES
ä¸»è¡¨å (ä¸»è¡¨å­—æ®µå) ON UPDATE CASCADE ON DELETE CASCADE;
```

#### â‘¡æ¼”ç¤ºå¦‚ä¸‹

ç”±äº**NO ACTION æ˜¯é»˜è®¤è¡Œä¸º**ï¼Œæˆ‘ä»¬å‰é¢è¯­æ³•æ¼”ç¤ºçš„æ—¶å€™ï¼Œå·²ç»æµ‹è¯•è¿‡äº†ï¼Œå°±ä¸å†æ¼”ç¤ºäº†ï¼Œè¿™é‡Œæˆ‘ä»¬å†æ¼”ç¤ºå…¶ä»–çš„ä¸¤ç§è¡Œä¸ºï¼š**CASCADEã€SET NULL**ã€‚

##### 1ï¼‰==CASCADE==-çº§è”æ¨¡å¼

```sql
alter table emp add constraint fk_emp_dept_id foreign key (dept_id) references
dept(id) on update cascade on delete cascade ;
```

A. ä¿®æ”¹çˆ¶è¡¨idä¸º1çš„è®°å½•ï¼Œå°†idä¿®æ”¹ä¸º6

![image-20250413170210360](./Mysql-Learning-Local.assets/image-20250413170210360.png)

æˆ‘ä»¬å‘ç°ï¼ŒåŸæ¥åœ¨å­è¡¨ä¸­dept_idå€¼ä¸º1çš„è®°å½•ï¼Œç°åœ¨ä¹Ÿå˜ä¸º6äº†ï¼Œè¿™å°±æ˜¯**cascadeçº§è”**çš„æ•ˆæœã€‚

> åœ¨ä¸€èˆ¬çš„ä¸šåŠ¡ç³»ç»Ÿä¸­ï¼Œ==ä¸ä¼šä¿®æ”¹ä¸€å¼ è¡¨çš„ä¸»é”®å€¼==ã€‚



B. åˆ é™¤çˆ¶è¡¨idä¸º6çš„è®°å½•

![image-20250413170221536](./Mysql-Learning-Local.assets/image-20250413170221536.png)

æˆ‘ä»¬å‘ç°ï¼Œ**çˆ¶è¡¨çš„æ•°æ®åˆ é™¤æˆåŠŸ**äº†ï¼Œä½†æ˜¯**å­è¡¨**ä¸­å…³è”çš„è®°å½•**ä¹Ÿè¢«çº§è”åˆ é™¤**äº†ã€‚



##### 2ï¼‰==SET NULL==-è®¾ä¸ºnull

åœ¨è¿›è¡Œæµ‹è¯•ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆéœ€è¦åˆ é™¤ä¸Šé¢å»ºç«‹çš„å¤–é”® fk_emp_dept_idã€‚ç„¶åå†é€šè¿‡æ•°æ®è„šæœ¬ï¼Œå°†empã€deptè¡¨çš„**æ•°æ®æ¢å¤**äº†ã€‚

```sql
alter table emp add constraint fk_emp_dept_id foreign key (dept_id) references
dept(id) on update cascade on delete cascade ;
```

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ é™¤idä¸º1çš„æ•°æ®ï¼Œçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆæ ·çš„ç°è±¡ã€‚

![image-20250413170236345](./Mysql-Learning-Local.assets/image-20250413170236345.png)

æˆ‘ä»¬å‘ç°çˆ¶è¡¨çš„è®°å½•æ˜¯å¯ä»¥æ­£å¸¸çš„åˆ é™¤çš„ï¼Œçˆ¶è¡¨çš„æ•°æ®åˆ é™¤ä¹‹åï¼Œå†æ‰“å¼€å­è¡¨ empï¼Œæˆ‘ä»¬å‘ç°å­è¡¨empçš„dept_idå­—æ®µï¼ŒåŸæ¥dept_idä¸º1çš„æ•°æ®ï¼Œç°åœ¨éƒ½è¢«ç½®ä¸ºNULLäº†ã€‚

![image-20250413170250541](./Mysql-Learning-Local.assets/image-20250413170250541.png)

è¿™å°±æ˜¯SET NULLè¿™ç§åˆ é™¤/æ›´æ–°è¡Œä¸ºçš„æ•ˆæœã€‚



## 4.4 å°ç»“

![image-20250413172626513](./Mysql-Learning-Local.assets/image-20250413172626513.png)



# 5ã€ğŸŒŸ å¤šè¡¨æŸ¥è¯¢

æˆ‘ä»¬ä¹‹å‰åœ¨è®²è§£SQLè¯­å¥çš„æ—¶å€™ï¼Œè®²è§£äº†DQLè¯­å¥ï¼Œä¹Ÿå°±æ˜¯æ•°æ®æŸ¥è¯¢è¯­å¥ï¼Œä½†æ˜¯ä¹‹å‰è®²è§£çš„æŸ¥è¯¢éƒ½æ˜¯å•è¡¨æŸ¥è¯¢ï¼Œè€Œæœ¬ç« èŠ‚æˆ‘ä»¬è¦å­¦ä¹ çš„åˆ™æ˜¯å¤šè¡¨æŸ¥è¯¢æ“ä½œï¼Œä¸»è¦ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢è¿›è¡Œè®²è§£ã€‚



## 5.1 ğŸŒŸå¤šè¡¨å…³ç³»

é¡¹ç›®å¼€å‘ä¸­ï¼Œåœ¨è¿›è¡Œæ•°æ®åº“è¡¨ç»“æ„è®¾è®¡æ—¶ï¼Œä¼šæ ¹æ®ä¸šåŠ¡éœ€æ±‚åŠä¸šåŠ¡æ¨¡å—ä¹‹é—´çš„å…³ç³»ï¼Œåˆ†æå¹¶è®¾è®¡è¡¨ç»“æ„ï¼Œç”±äºä¸šåŠ¡ä¹‹é—´ç›¸äº’å…³è”ï¼Œæ‰€ä»¥å„ä¸ªè¡¨ç»“æ„ä¹‹é—´ä¹Ÿå­˜åœ¨ç€å„ç§è”ç³»ï¼ŒåŸºæœ¬ä¸Šåˆ†ä¸ºä¸‰ç§ï¼š

- **ä¸€å¯¹å¤š(å¤šå¯¹ä¸€)**
- å¤šå¯¹å¤š
- ä¸€å¯¹ä¸€

### ï¼ˆ1ï¼‰ä¸€å¯¹å¤š(å¤šå¯¹ä¸€)

- æ¡ˆä¾‹: éƒ¨é—¨ ä¸ å‘˜å·¥çš„å…³ç³»
- å…³ç³»: ä¸€ä¸ªéƒ¨é—¨å¯¹åº”å¤šä¸ªå‘˜å·¥ï¼Œä¸€ä¸ªå‘˜å·¥å¯¹åº”ä¸€ä¸ªéƒ¨é—¨
- å®ç°: åœ¨**å¤šçš„ä¸€æ–¹å»ºç«‹å¤–é”®**ï¼ŒæŒ‡å‘ä¸€çš„ä¸€æ–¹çš„ä¸»é”®

![image-20250413173632554](./Mysql-Learning-Local.assets/image-20250413173632554.png)



### ï¼ˆ2ï¼‰å¤šå¯¹å¤š-==å»ºç«‹ä¸­é—´è¡¨==

- æ¡ˆä¾‹: å­¦ç”Ÿ ä¸ è¯¾ç¨‹çš„å…³ç³»

- å…³ç³»: **ä¸€ä¸ªå­¦ç”Ÿå¯ä»¥é€‰ä¿®å¤šé—¨è¯¾ç¨‹ï¼Œä¸€é—¨è¯¾ç¨‹ä¹Ÿå¯ä»¥ä¾›å¤šä¸ªå­¦ç”Ÿé€‰æ‹©**

- å®ç°: **å»ºç«‹ç¬¬ä¸‰å¼ ä¸­é—´è¡¨**ï¼Œ**==ä¸­é—´è¡¨è‡³å°‘åŒ…å«ä¸¤ä¸ªå¤–é”®ï¼Œåˆ†åˆ«å…³è”ä¸¤æ–¹ä¸»é”®==**

  ![image-20250413173638483](./Mysql-Learning-Local.assets/image-20250413173638483.png)

å¯¹åº”çš„SQLè„šæœ¬:

```sql
create table student(
    id int auto_increment primary key comment 'ä¸»é”®ID',
    name varchar(10) comment 'å§“å',
    no varchar(10) comment 'å­¦å·'
) comment 'å­¦ç”Ÿè¡¨';

insert into student values 
(null, 'é»›ç»®ä¸', '2000100101'),
(null, 'è°¢é€Š','2000100102'),
(null, 'æ®·å¤©æ­£', '2000100103'),
(null, 'éŸ¦ä¸€ç¬‘', '2000100104');

create table course(
    id int auto_increment primary key comment 'ä¸»é”®ID',
    name varchar(10) comment 'è¯¾ç¨‹åç§°'
) comment 'è¯¾ç¨‹è¡¨';

insert into course values 
(null, 'Java'),(null, 'PHP'), 
(null , 'MySQL'),(null, 'Hadoop');

create table student_course(
    id int auto_increment comment 'ä¸»é”®' primary key,
    studentid int not null comment 'å­¦ç”ŸID',
    courseid int not null comment 'è¯¾ç¨‹ID',
    constraint fk_courseid foreign key (courseid) references course (id),
    constraint fk_studentid foreign key (studentid) references student (id)
)comment 'å­¦ç”Ÿè¯¾ç¨‹ä¸­é—´è¡¨';

insert into student_course values 
(null,1,1),(null,1,2),
(null,1,3),(null,2,2),
(null,2,3),(null,3,4);
```



### ï¼ˆ3ï¼‰ä¸€å¯¹ä¸€-==å•è¡¨æ‹†åˆ†==

- æ¡ˆä¾‹: ç”¨æˆ· ä¸ ç”¨æˆ·è¯¦æƒ…çš„å…³ç³»
- å…³ç³»: ä¸€å¯¹ä¸€å…³ç³»ï¼Œ**å¤šç”¨äº==å•è¡¨æ‹†åˆ†==ï¼Œå°†ä¸€å¼ è¡¨çš„åŸºç¡€å­—æ®µæ”¾åœ¨ä¸€å¼ è¡¨ä¸­ï¼Œå…¶ä»–è¯¦æƒ…å­—æ®µæ”¾åœ¨å¦ä¸€å¼ è¡¨ä¸­ï¼Œä»¥æå‡æ“ä½œæ•ˆç‡**
- å®ç°: **åœ¨ä»»æ„ä¸€æ–¹åŠ å…¥å¤–é”®ï¼Œå…³è”å¦å¤–ä¸€æ–¹çš„ä¸»é”®**ï¼Œå¹¶ä¸”**==è®¾ç½®å¤–é”®ä¸ºå”¯ä¸€çš„(UNIQUE)==**

![image-20250413173657507](./Mysql-Learning-Local.assets/image-20250413173657507.png)

å¯¹åº”çš„SQLè„šæœ¬:

```sql
create table tb_user(
    id int auto_increment primary key comment 'ä¸»é”®ID',
    name varchar(10) comment 'å§“å',
    age int comment 'å¹´é¾„',
    gender char(1) comment '1: ç”· , 2: å¥³',
    phone char(11) comment 'æ‰‹æœºå·'
) comment 'ç”¨æˆ·åŸºæœ¬ä¿¡æ¯è¡¨';

create table tb_user_edu(
    id int auto_increment primary key comment 'ä¸»é”®ID',
    degree varchar(20) comment 'å­¦å†',
    major varchar(50) comment 'ä¸“ä¸š',
    primaryschool varchar(50) comment 'å°å­¦',
    middleschool varchar(50) comment 'ä¸­å­¦',
    university varchar(50) comment 'å¤§å­¦',
    userid int unique comment 'ç”¨æˆ·ID',
    constraint fk_userid foreign key (userid) references tb_user(id)
) comment 'ç”¨æˆ·æ•™è‚²ä¿¡æ¯è¡¨';

insert into tb_user(id, name, age, gender, phone) values
(null,'é»„æ¸¤',45,'1','18800001111'),
(null,'å†°å†°',35,'2','18800002222'),
(null,'ç äº‘',55,'1','18800008888'),
(null,'æå½¦å®',50,'1','18800009999');

insert into tb_user_edu(id, degree, major, primaryschool, middleschool,university, userid) values
(null,'æœ¬ç§‘','èˆè¹ˆ','é™å®‰åŒºç¬¬ä¸€å°å­¦','é™å®‰åŒºç¬¬ä¸€ä¸­å­¦','åŒ—äº¬èˆè¹ˆå­¦é™¢',1),
(null,'ç¡•å£«','è¡¨æ¼”','æœé˜³åŒºç¬¬ä¸€å°å­¦','æœé˜³åŒºç¬¬ä¸€ä¸­å­¦','åŒ—äº¬ç”µå½±å­¦é™¢',2),
(null,'æœ¬ç§‘','è‹±è¯­','æ­å·å¸‚ç¬¬ä¸€å°å­¦','æ­å·å¸‚ç¬¬ä¸€ä¸­å­¦','æ­å·å¸ˆèŒƒå¤§å­¦',3),
(null,'æœ¬ç§‘','åº”ç”¨æ•°å­¦','é˜³æ³‰ç¬¬ä¸€å°å­¦','é˜³æ³‰åŒºç¬¬ä¸€ä¸­å­¦','æ¸…åå¤§å­¦',4);
```



## 5.2 å¤šè¡¨æŸ¥è¯¢æ¦‚è¿°

### ï¼ˆ1ï¼‰æ•°æ®å‡†å¤‡

1). åˆ é™¤ä¹‹å‰ emp, deptè¡¨çš„æµ‹è¯•æ•°æ®

2). æ‰§è¡Œå¦‚ä¸‹è„šæœ¬ï¼Œåˆ›å»ºempè¡¨ä¸deptè¡¨å¹¶æ’å…¥æµ‹è¯•æ•°æ®

```sql
-- åˆ›å»ºdeptè¡¨ï¼Œå¹¶æ’å…¥æ•°æ®
create table dept(
    id int auto_increment comment 'ID' primary key,
    name varchar(50) not null comment 'éƒ¨é—¨åç§°'
)comment 'éƒ¨é—¨è¡¨';
INSERT INTO dept (id, name) VALUES 
(1, 'ç ”å‘éƒ¨'), (2, 'å¸‚åœºéƒ¨'),(3, 'è´¢åŠ¡éƒ¨'),
(4,'é”€å”®éƒ¨'), (5, 'æ€»ç»åŠ'), (6, 'äººäº‹éƒ¨');

-- åˆ›å»ºempè¡¨ï¼Œå¹¶æ’å…¥æ•°æ®
create table emp(
    id int auto_increment comment 'ID' primary key,
    name varchar(50) not null comment 'å§“å',
    age int comment 'å¹´é¾„',
    job varchar(20) comment 'èŒä½',
    salary int comment 'è–ªèµ„',
    entrydate date comment 'å…¥èŒæ—¶é—´',
    managerid int comment 'ç›´å±é¢†å¯¼ID',
    dept_id int comment 'éƒ¨é—¨ID'
)comment 'å‘˜å·¥è¡¨';

-- æ·»åŠ å¤–é”®
alter table emp add constraint fk_emp_dept_id foreign key (dept_id) references
dept(id);

INSERT INTO emp (id, name, age, job,salary, entrydate, managerid, dept_id)
VALUES
(1, 'é‡‘åº¸', 66, 'æ€»è£',20000, '2000-01-01', null,5),
(2, 'å¼ æ— å¿Œ', 20, 'é¡¹ç›®ç»ç†',12500, '2005-12-05', 1,1),
(3, 'æ¨é€', 33, 'å¼€å‘', 8400,'2000-11-03', 2,1),
(4, 'éŸ¦ä¸€ç¬‘', 48, 'å¼€å‘',11000, '2002-02-05', 2,1),
(5, 'å¸¸é‡æ˜¥', 43, 'å¼€å‘',10500, '2004-09-07', 3,1),
(6, 'å°æ˜­', 19, 'ç¨‹åºå‘˜é¼“åŠ±å¸ˆ',6600, '2004-10-12', 2,1),
(7, 'ç­ç»', 60, 'è´¢åŠ¡æ€»ç›‘',8500, '2002-09-12', 1,3),
(8, 'å‘¨èŠ·è‹¥', 19, 'ä¼šè®¡',48000, '2006-06-02', 7,3),
(9, 'ä¸æ•å›', 23, 'å‡ºçº³',5250, '2009-05-13', 7,3),
(10, 'èµµæ•', 20, 'å¸‚åœºéƒ¨æ€»ç›‘',12500, '2004-10-12', 1,2),
(11, 'é¹¿æ–å®¢', 56, 'èŒå‘˜',3750, '2006-10-03', 10,2),
(12, 'é¹¤ç¬”ç¿', 19, 'èŒå‘˜',3750, '2007-05-09', 10,2),
(13, 'æ–¹ä¸œç™½', 19, 'èŒå‘˜',5500, '2009-02-12', 10,2),
(14, 'å¼ ä¸‰ä¸°', 88, 'é”€å”®æ€»ç›‘',14000, '2004-10-12', 1,4),
(15, 'ä¿è²èˆŸ', 38, 'é”€å”®',4600, '2004-10-12', 14,4),
(16, 'å®‹è¿œæ¡¥', 40, 'é”€å”®',4600, '2004-10-12', 14,4),
(17, 'é™ˆå‹è°…', 42, null,2000, '2011-10-12', 1,null);
```

deptè¡¨å…±6æ¡è®°å½•ï¼Œempè¡¨å…±17æ¡è®°å½•ã€‚



### ï¼ˆ2ï¼‰æ¦‚è¿°

![image-20250413203539493](./Mysql-Learning-Local.assets/image-20250413203539493.png)

å¤šè¡¨æŸ¥è¯¢å°±æ˜¯æŒ‡ä»å¤šå¼ è¡¨ä¸­æŸ¥è¯¢æ•°æ®ã€‚

åŸæ¥**æŸ¥è¯¢å•è¡¨æ•°æ®**ï¼Œæ‰§è¡Œçš„SQLå½¢å¼ä¸ºï¼šselect * from emp;

é‚£ä¹ˆæˆ‘ä»¬è¦æ‰§è¡Œå¤šè¡¨æŸ¥è¯¢ï¼Œå°±åªéœ€è¦**ä½¿ç”¨é€—å·åˆ†éš”å¤šå¼ è¡¨**å³å¯ï¼Œå¦‚ï¼š select * from emp , dept; å…·ä½“çš„æ‰§è¡Œç»“æœå¦‚ä¸‹:

![image-20250413174215467](./Mysql-Learning-Local.assets/image-20250413174215467.png)

æ­¤æ—¶,æˆ‘ä»¬çœ‹åˆ°æŸ¥è¯¢ç»“æœä¸­åŒ…å«äº†å¤§é‡çš„ç»“æœé›†ï¼Œæ€»å…±102æ¡è®°å½•ï¼Œè€Œè¿™å…¶å®å°±æ˜¯å‘˜å·¥è¡¨empæ‰€æœ‰çš„è®°å½•(17) ä¸ éƒ¨é—¨è¡¨deptæ‰€æœ‰è®°å½•(6) çš„æ‰€æœ‰ç»„åˆæƒ…å†µï¼Œè¿™ç§ç°è±¡ç§°ä¹‹ä¸ºç¬›å¡å°”ç§¯ã€‚æ¥ä¸‹æ¥ï¼Œå°±æ¥ç®€å•

ä»‹ç»ä¸‹ç¬›å¡å°”ç§¯ã€‚

**==ç¬›å¡å°”ç§¯==:** ç¬›å¡å°”ä¹˜ç§¯æ˜¯æŒ‡åœ¨æ•°å­¦ä¸­ï¼Œ**ä¸¤ä¸ªé›†åˆAé›†åˆ å’Œ Bé›†åˆçš„æ‰€æœ‰ç»„åˆæƒ…å†µ**ã€‚

![image-20250413174221208](./Mysql-Learning-Local.assets/image-20250413174221208.png)

è€Œåœ¨å¤šè¡¨æŸ¥è¯¢ä¸­ï¼Œæˆ‘ä»¬æ˜¯**éœ€è¦==æ¶ˆé™¤æ— æ•ˆçš„ç¬›å¡å°”ç§¯==**çš„ï¼Œ**åªä¿ç•™ä¸¤å¼ è¡¨å…³è”éƒ¨åˆ†çš„æ•°æ®**ã€‚

![image-20250413174227176](./Mysql-Learning-Local.assets/image-20250413174227176.png)

![image-20250413174232832](./Mysql-Learning-Local.assets/image-20250413174232832.png)

åœ¨SQLè¯­å¥ä¸­ï¼Œå¦‚ä½•æ¥å»é™¤æ— æ•ˆçš„ç¬›å¡å°”ç§¯å‘¢ï¼Ÿ æˆ‘ä»¬å¯ä»¥ç»™å¤šè¡¨æŸ¥è¯¢åŠ ä¸Šè¿æ¥æŸ¥è¯¢çš„æ¡ä»¶å³å¯ã€‚

select * from emp , dept **where** emp.dept_id = dept.id;

![image-20250413174252000](./Mysql-Learning-Local.assets/image-20250413174252000.png)

è€Œç”±äºidä¸º17çš„å‘˜å·¥ï¼Œæ²¡æœ‰dept_idå­—æ®µå€¼ï¼Œæ‰€ä»¥åœ¨å¤šè¡¨æŸ¥è¯¢æ—¶ï¼Œæ ¹æ®è¿æ¥æŸ¥è¯¢çš„æ¡ä»¶å¹¶æ²¡æœ‰æŸ¥è¯¢

åˆ°ã€‚



### ï¼ˆ3ï¼‰åˆ†ç±»

![image-20250413203659368](./Mysql-Learning-Local.assets/image-20250413203659368.png)

- è¿æ¥æŸ¥è¯¢
  - å†…è¿æ¥ï¼šç›¸å½“äºæŸ¥è¯¢Aã€B**äº¤é›†éƒ¨åˆ†æ•°æ®**
  - å¤–è¿æ¥ï¼š
    - å·¦å¤–è¿æ¥ï¼šæŸ¥è¯¢**å·¦è¡¨æ‰€æœ‰æ•°æ®ï¼Œä»¥åŠä¸¤å¼ è¡¨äº¤é›†éƒ¨åˆ†æ•°æ®**
    - å³å¤–è¿æ¥ï¼šæŸ¥è¯¢**å³è¡¨æ‰€æœ‰æ•°æ®ï¼Œä»¥åŠä¸¤å¼ è¡¨äº¤é›†éƒ¨åˆ†æ•°æ®**
  - è‡ªè¿æ¥ï¼šå½“å‰è¡¨ä¸è‡ªèº«çš„è¿æ¥æŸ¥è¯¢ï¼Œè‡ªè¿æ¥å¿…é¡»ä½¿ç”¨è¡¨åˆ«å
- å­æŸ¥è¯¢

![image-20250413174259506](./Mysql-Learning-Local.assets/image-20250413174259506.png)





## 5.3 ğŸŒŸå†…è¿æ¥

![image-20250413204152514](./Mysql-Learning-Local.assets/image-20250413204152514.png)

![image-20250413174343726](./Mysql-Learning-Local.assets/image-20250413174343726.png)

**å†…è¿æ¥æŸ¥è¯¢çš„æ˜¯==ä¸¤å¼ è¡¨äº¤é›†éƒ¨åˆ†==çš„æ•°æ®ã€‚(ä¹Ÿå°±æ˜¯ç»¿è‰²éƒ¨åˆ†çš„æ•°æ®)**

å†…è¿æ¥çš„è¯­æ³•åˆ†ä¸ºä¸¤ç§: **éšå¼å†…è¿æ¥ã€æ˜¾å¼å†…è¿æ¥**ã€‚å…ˆæ¥å­¦ä¹ ä¸€ä¸‹å…·ä½“çš„è¯­æ³•ç»“æ„ã€‚



### ï¼ˆ1ï¼‰éšå¼å†…è¿æ¥

```sql
SELECT å­—æ®µåˆ—è¡¨ FROM è¡¨1 , è¡¨2 WHERE æ¡ä»¶ ... ;
```

### ï¼ˆ2ï¼‰æ˜¾å¼å†…è¿æ¥-inner join ... on ...

```sql
SELECT å­—æ®µåˆ—è¡¨ FROM è¡¨1 [ INNER ] JOIN è¡¨2 ON è¿æ¥æ¡ä»¶ ... ;
```



### ï¼ˆ3ï¼‰æ¡ˆä¾‹

#### A. æŸ¥è¯¢æ¯ä¸€ä¸ªå‘˜å·¥çš„å§“å , åŠå…³è”çš„éƒ¨é—¨çš„åç§° (**éšå¼å†…è¿æ¥å®ç°**)

- è¡¨ç»“æ„: emp , dept
- è¿æ¥æ¡ä»¶: emp.dept_id = dept.id

```sql
select emp.name , dept.name from emp , dept where emp.dept_id = dept.id ;

-- ä¸ºæ¯ä¸€å¼ è¡¨èµ·åˆ«å,ç®€åŒ–SQLç¼–å†™
select e.name,d.name from emp e , dept d where e.dept_id = d.id;
```

#### B. æŸ¥è¯¢æ¯ä¸€ä¸ªå‘˜å·¥çš„å§“å , åŠå…³è”çš„éƒ¨é—¨çš„åç§° (**æ˜¾å¼å†…è¿æ¥å®ç°**) --- INNER JOIN ...ON ...

- è¡¨ç»“æ„: emp , dept
- è¿æ¥æ¡ä»¶: emp.dept_id = dept.id

```sql
select e.name, d.name from emp e inner join dept d on e.dept_id = d.id;

-- ä¸ºæ¯ä¸€å¼ è¡¨èµ·åˆ«å,ç®€åŒ–SQLç¼–å†™
select e.name, d.name from emp e join dept d on e.dept_id = d.id;
```



> **==è¡¨çš„åˆ«å==**:
>
> â‘ . tablea as åˆ«å1 , tableb as åˆ«å2 ;
>
> â‘¡. tablea åˆ«å1 , tableb åˆ«å2 ;
>
> **æ³¨æ„äº‹é¡¹:**
>
> â€‹	**ä¸€æ—¦ä¸ºè¡¨èµ·äº†åˆ«åï¼Œå°±ä¸èƒ½å†ä½¿ç”¨è¡¨åæ¥æŒ‡å®šå¯¹åº”çš„å­—æ®µäº†**ï¼Œæ­¤æ—¶åªèƒ½å¤Ÿä½¿ç”¨åˆ«åæ¥æŒ‡å®šå­—
>
> æ®µã€‚





## 5.4 ğŸŒŸå¤–è¿æ¥

![image-20250413204255225](./Mysql-Learning-Local.assets/image-20250413204255225.png)

![image-20250413193707265](./Mysql-Learning-Local.assets/image-20250413193707265.png)

å¤–è¿æ¥åˆ†ä¸ºä¸¤ç§ï¼Œåˆ†åˆ«æ˜¯ï¼š**å·¦å¤–è¿æ¥ å’Œ å³å¤–è¿æ¥**ã€‚å…·ä½“çš„è¯­æ³•ç»“æ„ä¸ºï¼š

### ï¼ˆ1ï¼‰å·¦å¤–è¿æ¥-left [outer] join

å·¦å¤–è¿æ¥ç›¸å½“äº**æŸ¥è¯¢è¡¨1(å·¦è¡¨)çš„æ‰€æœ‰æ•°æ®**ï¼Œå½“ç„¶ä¹Ÿ**åŒ…å«è¡¨1å’Œè¡¨2äº¤é›†éƒ¨åˆ†**çš„æ•°æ®ã€‚

```sql
SELECT å­—æ®µåˆ—è¡¨ FROM è¡¨1 LEFT [ OUTER ] JOIN è¡¨2 ON æ¡ä»¶ ... ; 
```



### ï¼ˆ2ï¼‰å³å¤–è¿æ¥-right [outer] join

å³å¤–è¿æ¥ç›¸å½“äº**æŸ¥è¯¢è¡¨2(å³è¡¨)çš„æ‰€æœ‰æ•°æ®**ï¼Œå½“ç„¶ä¹Ÿ**åŒ…å«è¡¨1å’Œè¡¨2äº¤é›†éƒ¨åˆ†**çš„æ•°æ®ã€‚

```sql
SELECT å­—æ®µåˆ—è¡¨ FROM è¡¨1 RIGHT [ OUTER ] JOIN è¡¨2 ON æ¡ä»¶ ... ; 
```



### ï¼ˆ3ï¼‰æ¡ˆä¾‹

#### A. æŸ¥è¯¢empè¡¨çš„æ‰€æœ‰æ•°æ®, å’Œå¯¹åº”çš„éƒ¨é—¨ä¿¡æ¯

ç”±äºéœ€æ±‚ä¸­æåˆ°ï¼Œè¦**æŸ¥è¯¢empçš„æ‰€æœ‰æ•°æ®**ï¼Œæ‰€ä»¥æ˜¯ä¸èƒ½å†…è¿æ¥æŸ¥è¯¢çš„ï¼Œéœ€è¦è€ƒè™‘**ä½¿ç”¨å¤–è¿æ¥æŸ¥è¯¢**ã€‚

- è¡¨ç»“æ„: emp, dept
- è¿æ¥æ¡ä»¶: emp.dept_id = dept.id

```sql
select e.*, d.name from emp e left outer join dept d on e.dept_id = d.id;

select e.*, d.name from emp e left join dept d on e.dept_id = d.id;
```

#### B. æŸ¥è¯¢deptè¡¨çš„æ‰€æœ‰æ•°æ®, å’Œå¯¹åº”çš„å‘˜å·¥ä¿¡æ¯(å³å¤–è¿æ¥)

ç”±äºéœ€æ±‚ä¸­æåˆ°ï¼Œè¦æŸ¥è¯¢**deptè¡¨çš„æ‰€æœ‰æ•°æ®**ï¼Œæ‰€ä»¥æ˜¯ä¸èƒ½å†…è¿æ¥æŸ¥è¯¢çš„ï¼Œéœ€è¦è€ƒè™‘ä½¿ç”¨å¤–è¿æ¥æŸ¥è¯¢ã€‚

- è¡¨ç»“æ„: emp, dept
- è¿æ¥æ¡ä»¶: emp.dept_id = dept.id

```sql
select d.*, e.* from emp e right outer join dept d on e.dept_id = d.id;

select d.*, e.* from dept d left outer join emp e on e.dept_id = d.id;
```



> ==**æ³¨æ„äº‹é¡¹ï¼š**==
>
> å·¦å¤–è¿æ¥å’Œå³å¤–è¿æ¥æ˜¯å¯ä»¥**==ç›¸äº’æ›¿æ¢==**çš„ï¼Œåªéœ€è¦**è°ƒæ•´**åœ¨è¿æ¥æŸ¥è¯¢æ—¶SQLä¸­ï¼Œè¡¨ç»“æ„çš„å…ˆåé¡º
>
> åºå°±å¯ä»¥äº†ã€‚è€Œæˆ‘ä»¬åœ¨æ—¥å¸¸å¼€å‘ä½¿ç”¨æ—¶ï¼Œ**æ›´åå‘äºå·¦å¤–è¿æ¥**ã€‚





## 5.5 è‡ªè¿æ¥

### ï¼ˆ1ï¼‰è‡ªè¿æ¥æŸ¥è¯¢

è‡ªè¿æ¥æŸ¥è¯¢ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯è‡ªå·±è¿æ¥è‡ªå·±ï¼Œä¹Ÿå°±æ˜¯æŠŠ**ä¸€å¼ è¡¨è¿æ¥æŸ¥è¯¢å¤šæ¬¡**ã€‚æˆ‘ä»¬å…ˆæ¥å­¦ä¹ ä¸€ä¸‹è‡ªè¿æ¥çš„æŸ¥è¯¢è¯­æ³•ï¼š

è€Œå¯¹äºè‡ªè¿æ¥æŸ¥è¯¢ï¼Œ**==å¯ä»¥æ˜¯å†…è¿æ¥æŸ¥è¯¢ï¼Œä¹Ÿå¯ä»¥æ˜¯å¤–è¿æ¥æŸ¥è¯¢==**ã€‚

#### â‘ æ¡ˆä¾‹

**A. æŸ¥è¯¢å‘˜å·¥ åŠå…¶ æ‰€å±é¢†å¯¼çš„åå­—**

è¡¨ç»“æ„: emp

```sql
select a.name , b.name from emp a , emp b where a.managerid = b.id;
```



**B. æŸ¥è¯¢æ‰€æœ‰å‘˜å·¥ emp åŠå…¶é¢†å¯¼çš„åå­— emp , å¦‚æœ==å‘˜å·¥æ²¡æœ‰é¢†å¯¼(Boss), ä¹Ÿéœ€è¦æŸ¥è¯¢å‡ºæ¥==**

è¡¨ç»“æ„: emp a , emp b

```sql
select a.name 'å‘˜å·¥', b.name 'é¢†å¯¼' from emp a left join emp b on a.managerid =
b.id;
```



> **æ³¨æ„äº‹é¡¹:**
>
> åœ¨è‡ªè¿æ¥æŸ¥è¯¢ä¸­ï¼Œ**==å¿…é¡»è¦ä¸ºè¡¨èµ·åˆ«å==**ï¼Œè¦ä¸ç„¶æˆ‘ä»¬ä¸æ¸…æ¥šæ‰€æŒ‡å®šçš„æ¡ä»¶ã€è¿”å›çš„å­—æ®µï¼Œåˆ°åº•
>
> æ˜¯å“ªä¸€å¼ è¡¨çš„å­—æ®µã€‚



### ï¼ˆ2ï¼‰è”åˆæŸ¥è¯¢-union/union all

![image-20250413205030176](./Mysql-Learning-Local.assets/image-20250413205030176.png)

#### â‘ æ¦‚å¿µ

å¯¹äºunionæŸ¥è¯¢ï¼Œå°±æ˜¯æŠŠ**å¤šæ¬¡æŸ¥è¯¢çš„ç»“æœåˆå¹¶èµ·æ¥ï¼Œå½¢æˆä¸€ä¸ªæ–°çš„æŸ¥è¯¢ç»“æœé›†**ã€‚

```sql
SELECT å­—æ®µåˆ—è¡¨ FROM è¡¨A ...

UNION [ ALL ]

SELECT å­—æ®µåˆ—è¡¨ FROM è¡¨B ....;
```

- å¯¹äºè”åˆæŸ¥è¯¢çš„å¤šå¼ è¡¨çš„**==åˆ—æ•°å¿…é¡»ä¿æŒä¸€è‡´==**ï¼Œ**==å­—æ®µç±»å‹ä¹Ÿéœ€è¦ä¿æŒä¸€è‡´==ã€‚**
- **==union all== ä¼šå°†å…¨éƒ¨çš„æ•°æ®ç›´æ¥åˆå¹¶åœ¨ä¸€èµ·**ï¼Œ**union ä¼š==å¯¹åˆå¹¶ä¹‹åçš„æ•°æ®å»é‡==**ã€‚

#### â‘¡æ¡ˆä¾‹

A. å°†è–ªèµ„ä½äº 5000 çš„å‘˜å·¥ , å’Œ å¹´é¾„å¤§äº 50 å²çš„å‘˜å·¥å…¨éƒ¨æŸ¥è¯¢å‡ºæ¥.

å½“å‰å¯¹äºè¿™ä¸ªéœ€æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨å¤šæ¡ä»¶æŸ¥è¯¢ï¼Œä½¿ç”¨**é€»è¾‘è¿ç®—ç¬¦ or è¿æ¥**å³å¯ã€‚ é‚£è¿™é‡Œå‘¢ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡**union/union allæ¥è”åˆæŸ¥è¯¢**.

```sql
select * from emp where salary < 5000
union all
select * from emp where age > 50;
```

![image-20250413195741993](./Mysql-Learning-Local.assets/image-20250413195741993.png)

union allæŸ¥è¯¢å‡ºæ¥çš„ç»“æœï¼Œ**ä»…ä»…è¿›è¡Œç®€å•çš„åˆå¹¶ï¼Œå¹¶æœªå»é‡**ã€‚



```sql
select * from emp where salary < 5000
union
select * from emp where age > 50;
```

![image-20250413195749836](./Mysql-Learning-Local.assets/image-20250413195749836.png)

union è”åˆæŸ¥è¯¢ï¼Œ**ä¼šå¯¹æŸ¥è¯¢å‡ºæ¥çš„ç»“æœè¿›è¡Œå»é‡å¤„ç†**ã€‚



> **æ³¨æ„ï¼š**
>
> å¦‚æœå¤šæ¡æŸ¥è¯¢è¯­å¥æŸ¥è¯¢å‡ºæ¥çš„ç»“æœï¼Œ**å­—æ®µæ•°é‡ä¸ä¸€è‡´**ï¼Œåœ¨è¿›è¡Œunion/union allè”åˆæŸ¥è¯¢æ—¶ï¼Œå°†ä¼šæŠ¥
>
> é”™ã€‚å¦‚ï¼š
>
> ![image-20250413195820215](./Mysql-Learning-Local.assets/image-20250413195820215.png)





## 5.6 ğŸŒŸå­æŸ¥è¯¢-åµŒå¥—Selectè¯­å¥

### ï¼ˆ1ï¼‰æ¦‚è¿°

![image-20250413205152781](./Mysql-Learning-Local.assets/image-20250413205152781.png)

#### â‘ æ¦‚å¿µ

SQLè¯­å¥ä¸­**==åµŒå¥—SELECTè¯­å¥==ï¼Œç§°ä¸ºåµŒå¥—æŸ¥è¯¢ï¼Œåˆç§°å­æŸ¥è¯¢**ã€‚

```sql
SELECT * FROM t1 WHERE column1 = ( SELECT column1 FROM t2 ); 
```

**å­æŸ¥è¯¢å¤–éƒ¨çš„è¯­å¥å¯ä»¥æ˜¯INSERT / UPDATE / DELETE / SELECT çš„ä»»ä½•ä¸€ä¸ª**ã€‚

#### â‘¡åˆ†ç±»

æ ¹æ®**å­æŸ¥è¯¢ç»“æœä¸åŒ**ï¼Œåˆ†ä¸ºï¼š

- A. æ ‡é‡å­æŸ¥è¯¢ï¼ˆ**å­æŸ¥è¯¢ç»“æœä¸ºå•ä¸ªå€¼**ï¼‰
- B. åˆ—å­æŸ¥è¯¢(å­æŸ¥è¯¢**ç»“æœä¸ºä¸€åˆ—**)
- C. è¡Œå­æŸ¥è¯¢(å­æŸ¥è¯¢**ç»“æœä¸ºä¸€è¡Œ**)
- D. è¡¨å­æŸ¥è¯¢(å­æŸ¥è¯¢ç»“æœä¸º**å¤šè¡Œå¤šåˆ—**)



æ ¹æ®å­æŸ¥è¯¢ä½ç½®ï¼Œåˆ†ä¸ºï¼š

- A. WHEREä¹‹å
- B. FROMä¹‹å
- C. SELECTä¹‹å



### ï¼ˆ2ï¼‰æ ‡é‡å­æŸ¥è¯¢

#### â‘ æ¦‚å¿µ

å­æŸ¥è¯¢è¿”å›çš„ç»“æœæ˜¯**å•ä¸ªå€¼ï¼ˆæ•°å­—ã€å­—ç¬¦ä¸²ã€æ—¥æœŸç­‰ï¼‰**ï¼Œæœ€ç®€å•çš„å½¢å¼ï¼Œè¿™ç§å­æŸ¥è¯¢ç§°ä¸º**æ ‡é‡å­æŸ¥è¯¢**ã€‚

å¸¸ç”¨çš„æ“ä½œç¬¦ï¼š= 	 <>	  > 	>= 	<	 <= 

#### â‘¡æ¡ˆä¾‹

##### **A. æŸ¥è¯¢ "é”€å”®éƒ¨" çš„æ‰€æœ‰å‘˜å·¥ä¿¡æ¯**

å®Œæˆè¿™ä¸ªéœ€æ±‚æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†éœ€æ±‚åˆ†è§£ä¸ºä¸¤æ­¥ï¼š

â‘ . æŸ¥è¯¢ "é”€å”®éƒ¨" éƒ¨é—¨ID

```sql
select id from dept where name = 'é”€å”®éƒ¨'; 
```

â‘¡. æ ¹æ® "é”€å”®éƒ¨" éƒ¨é—¨ID, æŸ¥è¯¢å‘˜å·¥ä¿¡æ¯

```sql
select * from emp where dept_id = (select id from dept where name = 'é”€å”®éƒ¨'); 
```



##### **B. æŸ¥è¯¢åœ¨ "æ–¹ä¸œç™½" å…¥èŒä¹‹åçš„å‘˜å·¥ä¿¡æ¯**

å®Œæˆè¿™ä¸ªéœ€æ±‚æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†éœ€æ±‚åˆ†è§£ä¸ºä¸¤æ­¥ï¼š

â‘ . æŸ¥è¯¢ æ–¹ä¸œç™½ çš„å…¥èŒæ—¥æœŸ

```sql
select entrydate from emp where name = 'æ–¹ä¸œç™½'; 
```

â‘¡. æŸ¥è¯¢æŒ‡å®šå…¥èŒæ—¥æœŸä¹‹åå…¥èŒçš„å‘˜å·¥ä¿¡æ¯

```sql
select * from emp where entrydate > (select entrydate from emp where name = 'æ–¹ä¸œç™½');
```



### ï¼ˆ3ï¼‰åˆ—å­æŸ¥è¯¢

![image-20250413205828834](./Mysql-Learning-Local.assets/image-20250413205828834.png)

#### â‘ æ¦‚å¿µ

å­æŸ¥è¯¢è¿”å›çš„ç»“æœæ˜¯**ä¸€åˆ—ï¼ˆå¯ä»¥æ˜¯å¤šè¡Œï¼‰**ï¼Œè¿™ç§å­æŸ¥è¯¢ç§°ä¸º**åˆ—å­æŸ¥è¯¢**ã€‚

å¸¸ç”¨çš„æ“ä½œç¬¦ï¼š**IN** ã€NOT IN ã€ **ANY** ã€**SOME** ã€ **ALL**

![image-20250413200544852](./Mysql-Learning-Local.assets/image-20250413200544852.png)



#### â‘¡æ¡ˆä¾‹

##### A. æŸ¥è¯¢ "é”€å”®éƒ¨" å’Œ "å¸‚åœºéƒ¨" çš„æ‰€æœ‰å‘˜å·¥ä¿¡æ¯

åˆ†è§£ä¸ºä»¥ä¸‹ä¸¤æ­¥:

â‘ . æŸ¥è¯¢ "é”€å”®éƒ¨" å’Œ "å¸‚åœºéƒ¨" çš„éƒ¨é—¨ID

```sql
select id from dept where name = 'é”€å”®éƒ¨' or name = 'å¸‚åœºéƒ¨';
```

â‘¡. æ ¹æ®éƒ¨é—¨ID, æŸ¥è¯¢å‘˜å·¥ä¿¡æ¯

```sql
select * from emp where dept_id in (select id from dept where name = 'é”€å”®éƒ¨' or
name = 'å¸‚åœºéƒ¨');
```



##### B. æŸ¥è¯¢æ¯” è´¢åŠ¡éƒ¨ ==æ‰€æœ‰äººå·¥èµ„éƒ½é«˜==çš„å‘˜å·¥ä¿¡æ¯

åˆ†è§£ä¸ºä»¥ä¸‹ä¸¤æ­¥:

â‘ . æŸ¥è¯¢æ‰€æœ‰ è´¢åŠ¡éƒ¨ äººå‘˜å·¥èµ„

```sql
select id from dept where name = 'è´¢åŠ¡éƒ¨';
select salary from emp where dept_id = (select id from dept where name = 'è´¢åŠ¡éƒ¨');
```

â‘¡. æ¯” è´¢åŠ¡éƒ¨ **æ‰€æœ‰äººå·¥èµ„éƒ½é«˜**çš„å‘˜å·¥ä¿¡æ¯

```sql
select * from emp where salary > all ( select salary from emp where dept_id =
(select id from dept where name = 'è´¢åŠ¡éƒ¨') );
```



##### C. æŸ¥è¯¢æ¯”ç ”å‘éƒ¨å…¶ä¸­==ä»»æ„ä¸€äººå·¥èµ„é«˜==çš„å‘˜å·¥ä¿¡æ¯ï¼ˆä¹Ÿå°±æ˜¯==æœ‰æ¯”ç ”å‘éƒ¨ä¸­çš„é«˜å°±è¡Œ==ï¼Œåªéœ€è¦æ»¡è¶³å…¶ä¸­ä»»æ„ä¸€ä¸ªï¼‰

åˆ†è§£ä¸ºä»¥ä¸‹ä¸¤æ­¥:

â‘ . æŸ¥è¯¢ç ”å‘éƒ¨æ‰€æœ‰äººå·¥èµ„

```sql
select salary from emp where dept_id = (select id from dept where name = 'ç ”å‘éƒ¨'); 
```

â‘¡. æ¯”ç ”å‘éƒ¨å…¶ä¸­ä»»æ„ä¸€äººå·¥èµ„é«˜çš„å‘˜å·¥ä¿¡æ¯

```sql
select * from emp where salary > any ( select salary from emp where dept_id =
(select id from dept where name = 'ç ”å‘éƒ¨') );
```



### ï¼ˆ4ï¼‰è¡Œå­æŸ¥è¯¢

#### â‘ æ¦‚å¿µ

å­æŸ¥è¯¢è¿”å›çš„ç»“æœæ˜¯**ä¸€è¡Œï¼ˆå¯ä»¥æ˜¯å¤šåˆ—ï¼‰**ï¼Œè¿™ç§å­æŸ¥è¯¢ç§°ä¸º**è¡Œå­æŸ¥è¯¢**ã€‚

å¸¸ç”¨çš„æ“ä½œç¬¦ï¼š= ã€<> ã€IN ã€NOT IN



#### â‘¡æ¡ˆä¾‹

##### A. æŸ¥è¯¢ä¸ "å¼ æ— å¿Œ" çš„è–ªèµ„åŠç›´å±é¢†å¯¼ç›¸åŒçš„å‘˜å·¥ä¿¡æ¯ ;

è¿™ä¸ªéœ€æ±‚åŒæ ·å¯ä»¥æ‹†è§£ä¸ºä¸¤æ­¥è¿›è¡Œ:

â‘ . æŸ¥è¯¢ "å¼ æ— å¿Œ" çš„è–ªèµ„åŠç›´å±é¢†å¯¼

```sql
select salary, managerid from emp where name = 'å¼ æ— å¿Œ';
```

â‘¡. æŸ¥è¯¢ä¸ "å¼ æ— å¿Œ" çš„è–ªèµ„åŠç›´å±é¢†å¯¼ç›¸åŒçš„å‘˜å·¥ä¿¡æ¯ ;

```sql
select * from emp where (salary,managerid) = (select salary, managerid from emp
where name = 'å¼ æ— å¿Œ');
```



### ï¼ˆ5ï¼‰è¡¨å­æŸ¥è¯¢

#### â‘ æ¦‚å¿µ

å­æŸ¥è¯¢è¿”å›çš„ç»“æœæ˜¯**å¤šè¡Œå¤šåˆ—**ï¼Œè¿™ç§å­æŸ¥è¯¢ç§°ä¸º**è¡¨å­æŸ¥è¯¢**ã€‚

å¸¸ç”¨çš„æ“ä½œç¬¦ï¼šIN



#### â‘¡æ¡ˆä¾‹

##### A. æŸ¥è¯¢ä¸ "é¹¿æ–å®¢" , "å®‹è¿œæ¡¥" çš„èŒä½å’Œè–ªèµ„ç›¸åŒçš„å‘˜å·¥ä¿¡æ¯

åˆ†è§£ä¸ºä¸¤æ­¥æ‰§è¡Œ:

â‘ . æŸ¥è¯¢ "é¹¿æ–å®¢" , "å®‹è¿œæ¡¥" çš„èŒä½å’Œè–ªèµ„

```sql
select job, salary from emp where name = 'é¹¿æ–å®¢' or name = 'å®‹è¿œæ¡¥'; 
```

â‘¡. æŸ¥è¯¢ä¸ "é¹¿æ–å®¢" , "å®‹è¿œæ¡¥" çš„èŒä½å’Œè–ªèµ„ç›¸åŒçš„å‘˜å·¥ä¿¡æ¯

```sql
select * from emp where (job,salary) in ( select job, salary from emp where name =
'é¹¿æ–å®¢' or name = 'å®‹è¿œæ¡¥' );
```



##### B. æŸ¥è¯¢å…¥èŒæ—¥æœŸæ˜¯ "2006-01-01" ä¹‹åçš„å‘˜å·¥ä¿¡æ¯ , åŠå…¶éƒ¨é—¨ä¿¡æ¯

åˆ†è§£ä¸ºä¸¤æ­¥æ‰§è¡Œ:

â‘ . å…¥èŒæ—¥æœŸæ˜¯ "2006-01-01" ä¹‹åçš„å‘˜å·¥ä¿¡æ¯

```sql
select * from emp where entrydate > '2006-01-01'; 
```

â‘¡. æŸ¥è¯¢è¿™éƒ¨åˆ†å‘˜å·¥, å¯¹åº”çš„éƒ¨é—¨ä¿¡æ¯;

```sql
select e.*, d.* from (select * from emp where entrydate > '2006-01-01') e left
join dept d on e.dept_id = d.id ;
```



## 5.7 å¤šè¡¨æŸ¥è¯¢æ¡ˆä¾‹

![image-20250413210333565](./Mysql-Learning-Local.assets/image-20250413210333565.png)

**æ•°æ®ç¯å¢ƒå‡†å¤‡:**

```sql
create table salgrade(
    grade int,
    losal int,
    hisal int
) comment 'è–ªèµ„ç­‰çº§è¡¨';
insert into salgrade values (1,0,3000);
insert into salgrade values (2,3001,5000);
insert into salgrade values (3,5001,8000);
insert into salgrade values (4,8001,10000);
insert into salgrade values (5,10001,15000);
insert into salgrade values (6,15001,20000);
insert into salgrade values (7,20001,25000);
insert into salgrade values (8,25001,30000);
```

åœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬ä¸»è¦è¿ç”¨ä¸Šé¢æ‰€è®²è§£çš„å¤šè¡¨æŸ¥è¯¢çš„è¯­æ³•ï¼Œå®Œæˆä»¥ä¸‹çš„12ä¸ªéœ€æ±‚å³å¯ï¼Œè€Œè¿™é‡Œä¸»è¦æ¶‰åŠåˆ°çš„è¡¨å°±ä¸‰å¼ ï¼šempå‘˜å·¥è¡¨ã€deptéƒ¨é—¨è¡¨ã€salgradeè–ªèµ„ç­‰çº§è¡¨ ã€‚



### ï¼ˆ1ï¼‰æŸ¥è¯¢å‘˜å·¥çš„å§“åã€å¹´é¾„ã€èŒä½ã€éƒ¨é—¨ä¿¡æ¯ ï¼ˆéšå¼å†…è¿æ¥ï¼‰

è¡¨: emp , dept

è¿æ¥æ¡ä»¶: emp.dept_id = dept.id

```sql
select e.name , e.age , e.job , d.name from emp e , dept d where e.dept_id = d.id; 
```



### ï¼ˆ2ï¼‰æŸ¥è¯¢å¹´é¾„å°äº30å²çš„å‘˜å·¥çš„å§“åã€å¹´é¾„ã€èŒä½ã€éƒ¨é—¨ä¿¡æ¯ï¼ˆæ˜¾å¼å†…è¿æ¥ï¼‰

è¡¨: emp , dept

è¿æ¥æ¡ä»¶: emp.dept_id = dept.id

```sql
select e.name , e.age , e.job , d.name from emp e inner join dept d on e.dept_id =
d.id where e.age < 30;
```



### ï¼ˆ3ï¼‰æŸ¥è¯¢æ‹¥æœ‰å‘˜å·¥çš„éƒ¨é—¨IDã€éƒ¨é—¨åç§°

è¡¨: emp , dept

è¿æ¥æ¡ä»¶: emp.dept_id = dept.id

```sql
select distinct d.id , d.name from emp e , dept d where e.dept_id = d.id; 
```



### ï¼ˆ4ï¼‰ æŸ¥è¯¢æ‰€æœ‰å¹´é¾„å¤§äº40å²çš„å‘˜å·¥, åŠå…¶å½’å±çš„éƒ¨é—¨åç§°; å¦‚æœå‘˜å·¥æ²¡æœ‰åˆ†é…éƒ¨é—¨, ä¹Ÿéœ€è¦å±•ç¤ºå‡ºæ¥(å¤–è¿æ¥)

è¡¨: emp , dept

è¿æ¥æ¡ä»¶: emp.dept_id = dept.id

```sql
select e.*, d.name from emp e left join dept d on e.dept_id = d.id where e.age >
40 ;
```



### ï¼ˆ5ï¼‰ æŸ¥è¯¢æ‰€æœ‰å‘˜å·¥çš„å·¥èµ„ç­‰çº§

è¡¨: emp , salgrade

è¿æ¥æ¡ä»¶ : emp.salary >= salgrade.losal and emp.salary <= salgrade.hisal

```sql
-- æ–¹å¼ä¸€
select e.* , s.grade , s.losal, s.hisal from emp e , salgrade s where e.salary >=
s.losal and e.salary <= s.hisal;

-- æ–¹å¼äºŒ
select e.* , s.grade , s.losal, s.hisal from emp e , salgrade s where e.salary
between s.losal and s.hisal;
```



### ï¼ˆ6ï¼‰ æŸ¥è¯¢ "ç ”å‘éƒ¨" æ‰€æœ‰å‘˜å·¥çš„ä¿¡æ¯åŠ å·¥èµ„ç­‰çº§

è¡¨: emp , salgrade , dept

è¿æ¥æ¡ä»¶ : emp.salary between salgrade.losal and salgrade.hisal ,

emp.dept_id = dept.id

æŸ¥è¯¢æ¡ä»¶ : dept.name = 'ç ”å‘éƒ¨'

```sql
select e.* , s.grade from emp e , dept d , salgrade s where e.dept_id = d.id and (
e.salary between s.losal and s.hisal ) and d.name = 'ç ”å‘éƒ¨';
```



### ï¼ˆ7ï¼‰æŸ¥è¯¢ "ç ”å‘éƒ¨" å‘˜å·¥çš„å¹³å‡å·¥èµ„

è¡¨: emp , dept

è¿æ¥æ¡ä»¶ : emp.dept_id = dept.id

```sql
select avg(e.salary) from emp e, dept d where e.dept_id = d.id and d.name = 'ç ”å‘
éƒ¨';
```



### ï¼ˆ8ï¼‰æŸ¥è¯¢å·¥èµ„æ¯” "ç­ç»" é«˜çš„å‘˜å·¥ä¿¡æ¯

â‘ . æŸ¥è¯¢ "ç­ç»" çš„è–ªèµ„

```sql
select salary from emp where name = 'ç­ç»'; 
```

â‘¡. æŸ¥è¯¢æ¯”å¥¹å·¥èµ„é«˜çš„å‘˜å·¥æ•°æ®

```sql
select * from emp where salary > ( select salary from emp where name = 'ç­ç»' ); 
```



### ï¼ˆ9ï¼‰æŸ¥è¯¢æ¯”å¹³å‡è–ªèµ„é«˜çš„å‘˜å·¥ä¿¡æ¯

â‘ . æŸ¥è¯¢å‘˜å·¥çš„å¹³å‡è–ªèµ„

```sql
select avg(salary) from emp; 
```

â‘¡. æŸ¥è¯¢æ¯”å¹³å‡è–ªèµ„é«˜çš„å‘˜å·¥ä¿¡æ¯

```sql
select * from emp where salary > ( select avg(salary) from emp ); 
```



### ï¼ˆ10ï¼‰==æŸ¥è¯¢ä½äºæœ¬éƒ¨é—¨å¹³å‡å·¥èµ„çš„å‘˜å·¥ä¿¡æ¯==

â‘ . æŸ¥è¯¢æŒ‡å®šéƒ¨é—¨å¹³å‡è–ªèµ„

```sql
select avg(e1.salary) from emp e1 where e1.dept_id = 1;
select avg(e1.salary) from emp e1 where e1.dept_id = 2;
```

â‘¡. æŸ¥è¯¢ä½äºæœ¬éƒ¨é—¨å¹³å‡å·¥èµ„çš„å‘˜å·¥ä¿¡æ¯

```sql
select * from emp e2 where e2.salary < ( select avg(e1.salary) from emp e1 where
e1.dept_id = e2.dept_id );
```



### ï¼ˆ11ï¼‰ æŸ¥è¯¢æ‰€æœ‰çš„éƒ¨é—¨ä¿¡æ¯, å¹¶ç»Ÿè®¡éƒ¨é—¨çš„å‘˜å·¥äººæ•°

```sql
select d.id, d.name , ( select count(*) from emp e where e.dept_id = d.id ) 'äººæ•°'
from dept d;
```



### ï¼ˆ12ï¼‰ æŸ¥è¯¢æ‰€æœ‰å­¦ç”Ÿçš„é€‰è¯¾æƒ…å†µ, å±•ç¤ºå‡ºå­¦ç”Ÿåç§°, å­¦å·, è¯¾ç¨‹åç§°

è¡¨: student , course , student_course

è¿æ¥æ¡ä»¶: student.id = student_course.studentid , course.id =

student_course.courseid

```sql
select s.name , s.no , c.name from student s , student_course sc , course c where
s.id = sc.studentid and sc.courseid = c.id ;
```



> å¤‡æ³¨: ä»¥ä¸Šéœ€æ±‚çš„å®ç°æ–¹å¼å¯èƒ½ä¼šå¾ˆå¤š, SQLå†™æ³•ä¹Ÿæœ‰å¾ˆå¤šï¼Œåªè¦èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼ŒæŸ¥è¯¢å‡ºç¬¦åˆæ¡ä»¶çš„è®°å½•å³å¯ã€‚



## 5.8 å°ç»“

![image-20250413211807941](./Mysql-Learning-Local.assets/image-20250413211807941.png)



# 6ã€ğŸŒŸ  ==äº‹åŠ¡==

## **6.1** äº‹åŠ¡ç®€ä»‹

![image-20250413212026301](./Mysql-Learning-Local.assets/image-20250413212026301.png)



äº‹åŠ¡ **æ˜¯ä¸€ç»„æ“ä½œçš„é›†åˆ**ï¼Œå®ƒ**æ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½**ï¼Œäº‹åŠ¡ä¼šæŠŠæ‰€æœ‰çš„æ“ä½œä½œä¸ºä¸€ä¸ªæ•´ä½“ä¸€èµ·å‘ç³»ç»Ÿæäº¤æˆ–æ’¤é”€æ“ä½œè¯·æ±‚ï¼Œå³è¿™äº›æ“ä½œ**==è¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥==**ã€‚

å°±æ¯”å¦‚: å¼ ä¸‰ç»™æå››è½¬è´¦1000å—é’±ï¼Œå¼ ä¸‰é“¶è¡Œè´¦æˆ·çš„é’±å‡å°‘1000ï¼Œè€Œæå››é“¶è¡Œè´¦æˆ·çš„é’±è¦å¢åŠ 1000ã€‚ è¿™ä¸€ç»„æ“ä½œå°±å¿…é¡»åœ¨ä¸€ä¸ªäº‹åŠ¡çš„èŒƒå›´å†…ï¼Œè¦ä¹ˆéƒ½æˆåŠŸï¼Œè¦ä¹ˆéƒ½å¤±è´¥ã€‚

![image-20250413212419744](./Mysql-Learning-Local.assets/image-20250413212419744.png)

- **æ­£å¸¸æƒ…å†µ:** è½¬è´¦è¿™ä¸ªæ“ä½œ, éœ€è¦åˆ†ä¸ºä»¥ä¸‹è¿™ä¹ˆä¸‰æ­¥æ¥å®Œæˆ , ä¸‰æ­¥å®Œæˆä¹‹å, å¼ ä¸‰å‡å°‘1000, è€Œæå››

  å¢åŠ 1000, è½¬è´¦æˆåŠŸ :

- **å¼‚å¸¸æƒ…å†µ:** è½¬è´¦è¿™ä¸ªæ“ä½œ, ä¹Ÿæ˜¯åˆ†ä¸ºä»¥ä¸‹è¿™ä¹ˆä¸‰æ­¥æ¥å®Œæˆ , åœ¨æ‰§è¡Œç¬¬ä¸‰æ­¥æ˜¯æŠ¥é”™äº†, è¿™æ ·å°±å¯¼è‡´å¼ 

  ä¸‰å‡å°‘1000å—é’±, è€Œæå››çš„é‡‘é¢æ²¡å˜, è¿™æ ·å°±é€ æˆäº†æ•°æ®çš„ä¸ä¸€è‡´, å°±å‡ºç°é—®é¢˜äº†ã€‚

![image-20250413212456954](./Mysql-Learning-Local.assets/image-20250413212456954.png)



ä¸ºäº†è§£å†³ä¸Šè¿°çš„é—®é¢˜ï¼Œå°±éœ€è¦é€šè¿‡æ•°æ®çš„äº‹åŠ¡æ¥å®Œæˆï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨ä¸šåŠ¡é€»è¾‘æ‰§è¡Œä¹‹å‰å¼€å¯äº‹åŠ¡ï¼Œæ‰§è¡Œå®Œæ¯•åæäº¤äº‹åŠ¡ã€‚**å¦‚æœæ‰§è¡Œè¿‡ç¨‹ä¸­æŠ¥é”™ï¼Œåˆ™å›æ»šäº‹åŠ¡ï¼ŒæŠŠæ•°æ®æ¢å¤åˆ°äº‹åŠ¡å¼€å§‹ä¹‹å‰çš„çŠ¶æ€ã€‚**

![image-20250413212507090](./Mysql-Learning-Local.assets/image-20250413212507090.png)

> **æ³¨æ„ï¼š**  ==é»˜è®¤MySQLçš„äº‹åŠ¡æ˜¯è‡ªåŠ¨æäº¤çš„==ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æ‰§è¡Œå®Œä¸€æ¡DMLè¯­å¥æ—¶ï¼ŒMySQLä¼šç«‹å³éš
>
> å¼çš„æäº¤äº‹åŠ¡ã€‚



## 6.2 äº‹åŠ¡æ“ä½œ

**æ•°æ®å‡†å¤‡ï¼š**

```sql
drop table if exists account;
create table account(
    id int primary key AUTO_INCREMENT comment 'ID',
    name varchar(10) comment 'å§“å',
    money double(10,2) comment 'ä½™é¢'
) comment 'è´¦æˆ·è¡¨';
insert into account(name, money) VALUES ('å¼ ä¸‰',2000), ('æå››',2000);
```



### ï¼ˆ1ï¼‰æœªæ§åˆ¶äº‹åŠ¡

#### â‘ æµ‹è¯•æ­£å¸¸æƒ…å†µ

```sql
-- 1. æŸ¥è¯¢å¼ ä¸‰ä½™é¢
select * from account where name = 'å¼ ä¸‰';
-- 2. å¼ ä¸‰çš„ä½™é¢å‡å°‘1000
update account set money = money - 1000 where name = 'å¼ ä¸‰';
-- 3. æå››çš„ä½™é¢å¢åŠ 1000
update account set money = money + 1000 where name = 'æå››';
```

æµ‹è¯•å®Œæ¯•ä¹‹åæ£€æŸ¥æ•°æ®çš„çŠ¶æ€, å¯ä»¥çœ‹åˆ°æ•°æ®æ“ä½œå‰åæ˜¯ä¸€è‡´çš„ã€‚

![image-20250413213109632](./Mysql-Learning-Local.assets/image-20250413213109632.png)

#### â‘¡æµ‹è¯•å¼‚å¸¸æƒ…å†µ

```sql
-- 1. æŸ¥è¯¢å¼ ä¸‰ä½™é¢
select * from account where name = 'å¼ ä¸‰';
-- 2. å¼ ä¸‰çš„ä½™é¢å‡å°‘1000
update account set money = money - 1000 where name = 'å¼ ä¸‰';
å‡ºé”™äº†....
-- 3. æå››çš„ä½™é¢å¢åŠ 1000
update account set money = money + 1000 where name = 'æå››';
```

æˆ‘ä»¬æŠŠæ•°æ®éƒ½æ¢å¤åˆ°2000ï¼Œ ç„¶åå†æ¬¡ä¸€æ¬¡æ€§æ‰§è¡Œä¸Šè¿°çš„SQLè¯­å¥(å‡ºé”™äº†.... è¿™å¥è¯ä¸ç¬¦åˆSQLè¯­æ³•,æ‰§è¡Œå°±ä¼šæŠ¥é”™)ï¼Œæ£€æŸ¥æœ€ç»ˆçš„æ•°æ®æƒ…å†µ, å‘ç°æ•°æ®åœ¨**æ“ä½œå‰åä¸ä¸€è‡´**äº†ã€‚

![image-20250413213118191](./Mysql-Learning-Local.assets/image-20250413213118191.png)

### ï¼ˆ2ï¼‰æ§åˆ¶äº‹åŠ¡ä¸€

#### â‘ æŸ¥çœ‹/è®¾ç½®äº‹åŠ¡æäº¤æ–¹å¼

```sql
SELECT @@autocommit ; # ä¸º1è‡ªåŠ¨æäº¤ ; ä¸º0æ‰‹åŠ¨æäº¤

SET @@autocommit = 0  # è®¾ç½®ä¸ºæ‰‹åŠ¨æäº¤ï¼Œä¹‹åçš„ä»»ä½•æ“ä½œéƒ½éœ€è¦æ‰‹åŠ¨æäº¤äº‹åŠ¡Commit
```

#### â‘¡æäº¤äº‹åŠ¡

```sql
COMMIT;
```

#### â‘¢å›æ»šäº‹åŠ¡

```sql
ROLLBACK;
```

> **==æ³¨æ„==ï¼š**ä¸Šè¿°çš„è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬æ˜¯**ä¿®æ”¹äº†äº‹åŠ¡çš„è‡ªåŠ¨æäº¤è¡Œä¸º**, **æŠŠé»˜è®¤çš„è‡ªåŠ¨æäº¤ä¿®æ”¹ä¸ºäº†==æ‰‹åŠ¨æäº¤==**, æ­¤æ—¶æˆ‘ä»¬æ‰§è¡Œçš„DMLè¯­å¥éƒ½ä¸ä¼šæäº¤, éœ€è¦**æ‰‹åŠ¨çš„æ‰§è¡Œcommitè¿›è¡Œæäº¤**ã€‚



### ï¼ˆ3ï¼‰==æ§åˆ¶äº‹åŠ¡äºŒ==

![image-20250413214949654](./Mysql-Learning-Local.assets/image-20250413214949654.png)

#### â‘ å¼€å¯äº‹åŠ¡

```sql
START TRANSACTION æˆ– BEGIN ;
```

#### â‘¡æäº¤äº‹åŠ¡

```sql
COMMIT;
```

#### â‘¢å›æ»šäº‹åŠ¡

```sql
ROLLBACK;
```

#### â‘£è½¬è´¦æ¡ˆä¾‹

```sql
-- å¼€å¯äº‹åŠ¡
start transaction
-- 1. æŸ¥è¯¢å¼ ä¸‰ä½™é¢
select * from account where name = 'å¼ ä¸‰';
-- 2. å¼ ä¸‰çš„ä½™é¢å‡å°‘1000
update account set money = money - 1000 where name = 'å¼ ä¸‰';
-- 3. æå››çš„ä½™é¢å¢åŠ 1000
update account set money = money + 1000 where name = 'æå››';
-- å¦‚æœæ­£å¸¸æ‰§è¡Œå®Œæ¯•, åˆ™æäº¤äº‹åŠ¡
commit;
-- å¦‚æœæ‰§è¡Œè¿‡ç¨‹ä¸­æŠ¥é”™, åˆ™å›æ»šäº‹åŠ¡
-- rollback;
```



## 6.3 ğŸŒŸ ==äº‹åŠ¡å››å¤§ç‰¹æ€§==-ACID

![image-20250413215458731](./Mysql-Learning-Local.assets/image-20250413215458731.png)

- åŸå­æ€§ï¼ˆAtomicityï¼‰ï¼šäº‹åŠ¡æ˜¯**ä¸å¯åˆ†å‰²çš„æœ€å°æ“ä½œå•å…ƒï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥**ã€‚
- ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ï¼šäº‹åŠ¡å®Œæˆæ—¶ï¼Œå¿…é¡»ä½¿**æ‰€æœ‰çš„æ•°æ®éƒ½ä¿æŒä¸€è‡´çŠ¶æ€**ã€‚
- éš”ç¦»æ€§ï¼ˆIsolationï¼‰ï¼šæ•°æ®åº“ç³»ç»Ÿæä¾›çš„**éš”ç¦»æœºåˆ¶**ï¼Œä¿è¯**äº‹åŠ¡åœ¨ä¸å—å¤–éƒ¨å¹¶å‘æ“ä½œå½±å“çš„ç‹¬ç«‹ç¯å¢ƒä¸‹è¿è¡Œã€‚**
- æŒä¹…æ€§ï¼ˆDurabilityï¼‰ï¼š**äº‹åŠ¡ä¸€æ—¦æäº¤æˆ–å›æ»š**ï¼Œå®ƒå¯¹æ•°æ®åº“ä¸­çš„æ•°æ®çš„**æ”¹å˜å°±æ˜¯æ°¸ä¹…çš„**ã€‚

ä¸Šè¿°å°±æ˜¯äº‹åŠ¡çš„å››å¤§ç‰¹æ€§ï¼Œç®€ç§°ACIDã€‚

![image-20250413213602494](./Mysql-Learning-Local.assets/image-20250413213602494.png)





## 6.4 ğŸŒŸ ==å¹¶å‘äº‹åŠ¡é—®é¢˜==

![image-20250413215607439](./Mysql-Learning-Local.assets/image-20250413215607439.png)

1. **è„è¯»(Dirty Read)**ï¼šä¸€ä¸ªäº‹åŠ¡è¯»å–äº†å¦ä¸€ä¸ªæœªæäº¤äº‹åŠ¡ä¿®æ”¹è¿‡çš„æ•°æ®
2. **ä¸å¯é‡å¤è¯»(Non-repeatable Read)**ï¼šä¸€ä¸ªäº‹åŠ¡å†…å¤šæ¬¡è¯»å–åŒä¸€æ•°æ®ï¼Œä½†ç”±äºå…¶ä»–äº‹åŠ¡çš„ä¿®æ”¹ï¼Œå¯¼è‡´å‰åè¯»å–çš„ç»“æœä¸ä¸€è‡´
3. **å¹»è¯»(Phantom Read)**ï¼šä¸€ä¸ªäº‹åŠ¡å†…å¤šæ¬¡æŸ¥è¯¢åŒä¸€èŒƒå›´çš„æ•°æ®ï¼Œä½†ç”±äºå…¶ä»–äº‹åŠ¡çš„æ’å…¥æ“ä½œï¼Œå¯¼è‡´å‰åæŸ¥è¯¢ç»“æœçš„è¡Œæ•°ä¸ä¸€è‡´



### ï¼ˆ1ï¼‰*è„è¯»*

**èµƒè¯»ï¼šä¸€ä¸ªäº‹åŠ¡==è¯»åˆ°==å¦å¤–ä¸€ä¸ªäº‹åŠ¡==è¿˜æ²¡æœ‰æäº¤çš„æ•°æ®==ã€‚**

![image-20250413213615342](./Mysql-Learning-Local.assets/image-20250413213615342.png)

æ¯”å¦‚B**è¯»å–åˆ°äº†Aæœªæäº¤çš„æ•°æ®**ã€‚



#### â‘ æ¯”å–»-ä¾¿äºç†è§£

**è„è¯» - è¯»åˆ°"è„"æ•°æ®**

**æ¯”å–»**ï¼šå°±åƒä½ å·çœ‹äº†åŒå­¦è¿˜æ²¡äº¤å·çš„ç­”æ¡ˆï¼Œä½†åæ¥è€å¸ˆå‘ç°ä»–åšé”™äº†ï¼ŒæŠŠç­”æ¡ˆæ”¹äº†ã€‚ä½ çœ‹åˆ°çš„æ˜¯"è„"çš„ã€æœªç¡®è®¤çš„ç­”æ¡ˆã€‚

**ä¾‹å­**ï¼š

- äº‹åŠ¡Aä¿®æ”¹äº†æŸæ¡è®°å½•ä½†æœªæäº¤
- äº‹åŠ¡Bè¯»å–äº†è¿™æ¡è¢«ä¿®æ”¹ä½†æœªæäº¤çš„è®°å½•
- äº‹åŠ¡Aå›æ»šäº†ä¿®æ”¹
- äº‹åŠ¡Bè¯»åˆ°çš„å°±æ˜¯æ— æ•ˆçš„"è„"æ•°æ®



### ï¼ˆ2ï¼‰*ä¸å¯é‡å¤è¯»*

**ä¸å¯é‡å¤è¯»ï¼šä¸€ä¸ªäº‹åŠ¡==å…ˆåè¯»å–åŒä¸€æ¡è®°å½•==ï¼Œä½†==ä¸¤æ¬¡è¯»å–çš„æ•°æ®ä¸åŒ==ï¼Œç§°ä¹‹ä¸ºä¸å¯é‡å¤è¯»ã€‚**

![image-20250413213712438](./Mysql-Learning-Local.assets/image-20250413213712438.png)

äº‹åŠ¡Aä¸¤æ¬¡è¯»å–åŒä¸€æ¡è®°å½•ï¼Œä½†æ˜¯**è¯»å–åˆ°çš„æ•°æ®å´æ˜¯ä¸ä¸€æ ·**çš„ã€‚



#### â‘ æ¯”å–»

**ä¸å¯é‡å¤è¯» - åŒä¸€æ¬¡è€ƒè¯•ä¸­ç­”æ¡ˆå˜äº†**

**æ¯”å–»**ï¼šå°±åƒä½ è€ƒè¯•æ—¶æ£€æŸ¥åŒä¸€é“é¢˜ï¼Œç¬¬ä¸€æ¬¡é€‰Aï¼Œç¬¬äºŒæ¬¡çœ‹å˜æˆäº†Bï¼Œå› ä¸ºè€å¸ˆåœ¨ä½ æ£€æŸ¥æ—¶æ”¹äº†æ­£ç¡®ç­”æ¡ˆã€‚

**ä¾‹å­**ï¼š

- äº‹åŠ¡Aç¬¬ä¸€æ¬¡è¯»å–æ•°æ®ï¼Œå€¼ä¸º100
- äº‹åŠ¡Bä¿®æ”¹äº†è¯¥æ•°æ®ä¸º200å¹¶æäº¤
- äº‹åŠ¡Aå†æ¬¡è¯»å–åŒä¸€æ•°æ®ï¼Œå‘ç°å˜æˆäº†200
- åŒä¸€äº‹åŠ¡å†…ä¸¤æ¬¡è¯»å–ç»“æœä¸åŒ



### ï¼ˆ3ï¼‰*å¹»è¯»*

**å¹»è¯»ï¼šä¸€ä¸ªäº‹åŠ¡==æŒ‰ç…§æ¡ä»¶æŸ¥è¯¢æ•°æ®==æ—¶ï¼Œ==æ²¡æœ‰å¯¹åº”çš„æ•°æ®è¡Œ==ï¼Œä½†æ˜¯==åœ¨æ’å…¥æ•°æ®æ—¶ï¼Œåˆå‘ç°è¿™è¡Œæ•°æ®å·²ç»å­˜åœ¨==ï¼Œ*å¥½åƒå‡ºç°äº† "å¹»å½±"*ã€‚**

![image-20250413213733729](./Mysql-Learning-Local.assets/image-20250413213733729.png)



#### â‘ æ¯”å–»

 **å¹»è¯» - å‡­ç©ºå¤šå‡ºæ¥çš„è¡Œ**

**æ¯”å–»**ï¼šå°±åƒä½ æ•°æ•™å®¤é‡Œçš„äººæ•°ï¼Œç¬¬ä¸€æ¬¡æ•°æ˜¯10äººï¼Œä½å¤´è®°å½•åå†æŠ¬å¤´æ•°å˜æˆäº†11äººï¼Œå› ä¸ºæœ‰ä¸ªäººåœ¨ä½ ä½å¤´æ—¶æºœè¿›æ¥äº†ã€‚

**ä¾‹å­**ï¼š

- äº‹åŠ¡AæŸ¥è¯¢å¹´é¾„>30çš„å‘˜å·¥ï¼Œå¾—åˆ°5æ¡è®°å½•
- äº‹åŠ¡Bæ’å…¥äº†ä¸€ä¸ªå¹´é¾„35çš„æ–°å‘˜å·¥å¹¶æäº¤
- äº‹åŠ¡Aå†æ¬¡æŸ¥è¯¢å¹´é¾„>30çš„å‘˜å·¥ï¼Œå¾—åˆ°6æ¡è®°å½•
- å°±åƒå‡ºç°äº†"å¹»å½±è¡Œ"



### ï¼ˆ4ï¼‰æ€»ç»“

#### â‘ å¦‚ä½•è®°å¿†

- **è„è¯»**ï¼šè¯»åˆ°åˆ«äºº"æ²¡æ´—æ‰‹"(æœªæäº¤)çš„æ•°æ®
- **ä¸å¯é‡å¤è¯»**ï¼šåŒä¸€äº‹åŠ¡å†…"é‡å¤è¯»"ç»“æœä¸åŒ
- **å¹»è¯»**ï¼šåƒå¹»è§‰ä¸€æ ·å¤šå‡ºæˆ–å°‘äº†å‡ è¡Œæ•°æ®

#### â‘¡æ•°æ®åº“éš”ç¦»çº§åˆ«è§£å†³è¿™äº›é—®é¢˜

1. **è¯»æœªæäº¤(Read Uncommitted)**ï¼šä»€ä¹ˆéƒ½ä¸èƒ½é˜²æ­¢
2. **è¯»å·²æäº¤(Read Committed)**ï¼šé˜²æ­¢è„è¯»
3. **å¯é‡å¤è¯»(Repeatable Read)**ï¼šé˜²æ­¢è„è¯»å’Œä¸å¯é‡å¤è¯»
4. **ä¸²è¡ŒåŒ–(Serializable)**ï¼šé˜²æ­¢æ‰€æœ‰é—®é¢˜(ä½†æ€§èƒ½æœ€å·®)

MySQLçš„InnoDBåœ¨"å¯é‡å¤è¯»"çº§åˆ«ä¸‹é€šè¿‡MVCCæœºåˆ¶ä¹Ÿèƒ½é˜²æ­¢å¹»è¯»ã€‚



## 6.5 ğŸŒŸ ==äº‹åŠ¡éš”ç¦»çº§åˆ«==

**æ³¨æ„**ï¼š==**äº‹åŠ¡éš”ç¦»çº§åˆ«è¶Šé«˜ï¼Œæ•°æ®è¶Šå®‰å…¨ï¼Œä½†æ˜¯æ€§èƒ½è¶Šä½**==ã€‚

### ï¼ˆ1ï¼‰äº‹åŠ¡éš”ç¦»çº§åˆ«

**ä¸ºäº†è§£å†³å¹¶å‘äº‹åŠ¡æ‰€å¼•å‘çš„é—®é¢˜ï¼Œåœ¨æ•°æ®åº“ä¸­å¼•å…¥äº†äº‹åŠ¡éš”ç¦»çº§åˆ«ã€‚ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š**

1. **è¯»æœªæäº¤(Read Uncommitted)**ï¼šä»€ä¹ˆéƒ½ä¸èƒ½é˜²æ­¢
2. **è¯»å·²æäº¤(Read Committed)**ï¼šé˜²æ­¢è„è¯»
3. **å¯é‡å¤è¯»(Repeatable Read)**ï¼š**é˜²æ­¢è„è¯»å’Œä¸å¯é‡å¤è¯»**ï¼Œ==Mysqlçš„é»˜è®¤éš”ç¦»çº§åˆ«==
   1. MySQLçš„**InnoDBåœ¨"å¯é‡å¤è¯»"çº§åˆ«**ä¸‹é€šè¿‡**==MVCCæœºåˆ¶==**ä¹Ÿèƒ½**==é˜²æ­¢å¹»è¯»==**ã€‚
4. **ä¸²è¡ŒåŒ–(Serializable)**ï¼šé˜²æ­¢æ‰€æœ‰é—®é¢˜(ä½†æ€§èƒ½æœ€å·®)

![image-20250413213825473](./Mysql-Learning-Local.assets/image-20250413213825473.png)



![image-20250413220153001](./Mysql-Learning-Local.assets/image-20250413220153001.png)

### ï¼ˆ2ï¼‰æŸ¥çœ‹äº‹åŠ¡éš”ç¦»çº§åˆ«

```sql
SELECT @@TRANSACTION_ISOLATION;
```



### ï¼ˆ3ï¼‰è®¾ç½®äº‹åŠ¡éš”ç¦»çº§åˆ«

```sql
SET [ SESSION | GLOBAL ] TRANSACTION ISOLATION LEVEL { READ UNCOMMITTED |
READ COMMITTED | REPEATABLE READ | SERIALIZABLE }
```



> **æ³¨æ„**ï¼š==**äº‹åŠ¡éš”ç¦»çº§åˆ«è¶Šé«˜ï¼Œæ•°æ®è¶Šå®‰å…¨ï¼Œä½†æ˜¯æ€§èƒ½è¶Šä½**==ã€‚



## 6.6 å°ç»“

![image-20250413221043040](./Mysql-Learning-Local.assets/image-20250413221043040.png)



# ----------------------------



# äºŒã€é«˜çº§ç¯‡

![image-20250420144657400](./Mysql-Learning-Local.assets/image-20250420144657400.png)

# 1ã€ğŸŒŸå­˜å‚¨å¼•æ“

## 1.1 MySQLä½“ç³»ç»“æ„

![image-20250413230423557](./Mysql-Learning-Local.assets/image-20250413230423557.png)

![image-20250413224407264](./Mysql-Learning-Local.assets/image-20250413224407264.png)

### ï¼ˆ1ï¼‰è¿æ¥å±‚

æœ€ä¸Šå±‚æ˜¯ä¸€äº›å®¢æˆ·ç«¯å’Œé“¾æ¥æœåŠ¡ï¼ŒåŒ…å«**æœ¬åœ°sock é€šä¿¡**å’Œå¤§å¤šæ•°åŸºäº**å®¢æˆ·ç«¯/æœåŠ¡ç«¯å·¥å…·å®ç°çš„ç±»**ä¼¼äºTCP/IPçš„é€šä¿¡ã€‚ä¸»è¦å®Œæˆä¸€äº›ç±»ä¼¼äº**è¿æ¥å¤„ç†ã€æˆæƒè®¤è¯ã€åŠç›¸å…³çš„å®‰å…¨æ–¹æ¡ˆ**ã€‚åœ¨è¯¥å±‚ä¸Šå¼•å…¥äº†**çº¿ç¨‹æ± **çš„æ¦‚å¿µï¼Œä¸ºé€šè¿‡è®¤è¯å®‰å…¨æ¥å…¥çš„å®¢æˆ·ç«¯æä¾›çº¿ç¨‹ã€‚åŒæ ·åœ¨è¯¥å±‚ä¸Šå¯ä»¥å®ç°åŸºäºSSLçš„å®‰å…¨é“¾æ¥ã€‚æœåŠ¡å™¨ä¹Ÿä¼šä¸ºå®‰å…¨æ¥å…¥çš„æ¯ä¸ªå®¢æˆ·ç«¯éªŒè¯å®ƒæ‰€å…·æœ‰çš„æ“ä½œæƒé™ã€‚



### ï¼ˆ2ï¼‰==æœåŠ¡å±‚==

ç¬¬äºŒå±‚æ¶æ„ä¸»è¦å®Œæˆå¤§å¤šæ•°çš„æ ¸å¿ƒæœåŠ¡åŠŸèƒ½ï¼Œå¦‚**SQLæ¥å£ï¼Œå¹¶å®Œæˆç¼“å­˜çš„æŸ¥è¯¢ï¼ŒSQLçš„åˆ†æå’Œä¼˜åŒ–ï¼Œéƒ¨åˆ†å†…ç½®å‡½æ•°çš„æ‰§è¡Œ**ã€‚æ‰€æœ‰è·¨å­˜å‚¨å¼•æ“çš„åŠŸèƒ½ä¹Ÿåœ¨è¿™ä¸€å±‚å®ç°ï¼Œå¦‚ è¿‡ç¨‹ã€å‡½æ•°ç­‰ã€‚åœ¨è¯¥å±‚ï¼ŒæœåŠ¡å™¨ä¼šè§£ææŸ¥è¯¢å¹¶**åˆ›å»ºç›¸åº”çš„å†…éƒ¨è§£ææ ‘**ï¼Œå¹¶å¯¹å…¶å®Œæˆç›¸åº”çš„ä¼˜åŒ–å¦‚ç¡®å®šè¡¨çš„æŸ¥è¯¢çš„é¡ºåºï¼Œæ˜¯å¦**åˆ©ç”¨ç´¢å¼•**ç­‰ï¼Œæœ€åç”Ÿæˆç›¸åº”çš„æ‰§è¡Œæ“ä½œã€‚å¦‚æœæ˜¯selectè¯­å¥ï¼ŒæœåŠ¡å™¨è¿˜ä¼šæŸ¥è¯¢å†…éƒ¨çš„ç¼“å­˜ï¼Œå¦‚æœç¼“å­˜ç©ºé—´è¶³å¤Ÿå¤§ï¼Œè¿™æ ·åœ¨è§£å†³å¤§é‡è¯»æ“ä½œçš„ç¯å¢ƒä¸­èƒ½å¤Ÿå¾ˆå¥½çš„æå‡ç³»ç»Ÿçš„æ€§èƒ½ã€‚



### ï¼ˆ3ï¼‰å¼•æ“å±‚

å­˜å‚¨å¼•æ“å±‚ï¼Œ å­˜å‚¨å¼•æ“çœŸæ­£çš„**è´Ÿè´£äº†MySQLä¸­æ•°æ®çš„å­˜å‚¨å’Œæå–**ï¼Œ**æœåŠ¡å™¨é€šè¿‡APIå’Œå­˜å‚¨å¼•æ“è¿›è¡Œé€šä¿¡**ã€‚ä¸åŒçš„å­˜å‚¨å¼•æ“å…·æœ‰ä¸åŒçš„åŠŸèƒ½ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦ï¼Œæ¥é€‰å–åˆé€‚çš„å­˜å‚¨å¼•æ“ã€‚**==æ•°æ®åº“ä¸­çš„ç´¢å¼•æ˜¯åœ¨å­˜å‚¨å¼•æ“å±‚å®ç°çš„==**ã€‚



### ï¼ˆ4ï¼‰å­˜å‚¨å±‚

æ•°æ®å­˜å‚¨å±‚ï¼Œ ä¸»è¦æ˜¯å°†**æ•°æ®(å¦‚: redologã€undologã€æ•°æ®ã€ç´¢å¼•ã€äºŒè¿›åˆ¶æ—¥å¿—ã€é”™è¯¯æ—¥å¿—ã€æŸ¥è¯¢æ—¥å¿—ã€æ…¢æŸ¥è¯¢æ—¥å¿—ç­‰)å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¹‹ä¸Š**ï¼Œå¹¶å®Œæˆä¸å­˜å‚¨å¼•æ“çš„äº¤äº’ã€‚



> å’Œå…¶ä»–æ•°æ®åº“ç›¸æ¯”ï¼ŒMySQLæœ‰ç‚¹ä¸ä¼—ä¸åŒï¼Œå®ƒçš„æ¶æ„å¯ä»¥åœ¨å¤šç§ä¸åŒåœºæ™¯ä¸­åº”ç”¨å¹¶å‘æŒ¥è‰¯å¥½ä½œç”¨ã€‚ä¸»è¦  ä½“ç°åœ¨å­˜å‚¨å¼•æ“ä¸Šï¼Œ**==æ’ä»¶å¼çš„å­˜å‚¨å¼•æ“æ¶æ„==**ï¼Œ**å°†æŸ¥è¯¢å¤„ç†å’Œå…¶ä»–çš„ç³»ç»Ÿä»»åŠ¡ä»¥åŠæ•°æ®çš„å­˜å‚¨æå–åˆ†ç¦»**ã€‚ è¿™ç§æ¶æ„å¯ä»¥æ ¹æ®ä¸šåŠ¡çš„éœ€æ±‚å’Œå®é™…éœ€è¦**é€‰æ‹©åˆé€‚çš„å­˜å‚¨å¼•æ“**ã€‚





## 1.2 ==å­˜å‚¨å¼•æ“==ä»‹ç»

![image-20250413230608224](./Mysql-Learning-Local.assets/image-20250413230608224.png)

### ï¼ˆ1ï¼‰æ¦‚å¿µ

![image-20250413224344442](./Mysql-Learning-Local.assets/image-20250413224344442.png)

å¤§å®¶å¯èƒ½æ²¡æœ‰å¬è¯´è¿‡å­˜å‚¨å¼•æ“ï¼Œä½†æ˜¯ä¸€å®šå¬è¿‡å¼•æ“è¿™ä¸ªè¯ï¼Œå¼•æ“å°±æ˜¯å‘åŠ¨æœºï¼Œæ˜¯ä¸€ä¸ªæœºå™¨çš„æ ¸å¿ƒç»„ä»¶ã€‚æ¯”å¦‚ï¼Œå¯¹äºèˆ°è½½æœºã€ç›´å‡æœºã€ç«ç®­æ¥è¯´ï¼Œä»–ä»¬éƒ½æœ‰å„è‡ªçš„å¼•æ“ï¼Œæ˜¯ä»–ä»¬æœ€ä¸ºæ ¸å¿ƒçš„ç»„ä»¶ã€‚è€Œæˆ‘ä»¬åœ¨é€‰æ‹©å¼•æ“çš„æ—¶å€™ï¼Œéœ€è¦åœ¨åˆé€‚çš„åœºæ™¯ï¼Œé€‰æ‹©åˆé€‚çš„å­˜å‚¨å¼•æ“ï¼Œå°±åƒåœ¨ç›´å‡æœºä¸Šï¼Œæˆ‘ä»¬ä¸èƒ½é€‰æ‹©èˆ°è½½æœºçš„å¼•æ“ä¸€æ ·ã€‚

è€Œå¯¹äºå­˜å‚¨å¼•æ“ï¼Œä¹Ÿæ˜¯ä¸€æ ·ï¼Œä»–æ˜¯**mysqlæ•°æ®åº“çš„æ ¸å¿ƒ**ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦åœ¨åˆé€‚çš„åœºæ™¯é€‰æ‹©åˆé€‚çš„å­˜å‚¨å¼•æ“ã€‚æ¥ä¸‹æ¥å°±æ¥ä»‹ç»ä¸€ä¸‹å­˜å‚¨å¼•æ“ã€‚**å­˜å‚¨å¼•æ“å°±æ˜¯å­˜å‚¨æ•°æ®ã€å»ºç«‹ç´¢å¼•ã€æ›´æ–°/æŸ¥è¯¢æ•°æ®ç­‰æŠ€æœ¯çš„å®ç°æ–¹å¼** ã€‚**==å­˜å‚¨å¼•æ“æ˜¯åŸºäºè¡¨çš„ï¼Œè€Œä¸æ˜¯åŸºäºåº“çš„==**ï¼Œæ‰€ä»¥**==å­˜å‚¨å¼•æ“ä¹Ÿå¯è¢«ç§°ä¸ºè¡¨ç±»å‹==**ã€‚æˆ‘ä»¬å¯ä»¥åœ¨åˆ›å»ºè¡¨çš„æ—¶å€™ï¼Œæ¥æŒ‡å®šé€‰æ‹©çš„å­˜å‚¨å¼•æ“ï¼Œå¦‚æœ

**æ²¡æœ‰æŒ‡å®šå°†è‡ªåŠ¨é€‰æ‹©é»˜è®¤çš„å­˜å‚¨å¼•æ“ã€‚**



### ï¼ˆ2ï¼‰å»ºè¡¨æ—¶æŒ‡å®šå­˜å‚¨å¼•æ“

```sql
CREATE TABLE è¡¨å(
å­—æ®µ1 å­—æ®µ1ç±»å‹ [ COMMENT å­—æ®µ1æ³¨é‡Š ] ,
......
å­—æ®µn å­—æ®µnç±»å‹ [COMMENT å­—æ®µnæ³¨é‡Š ]
) ENGINE = INNODB [ COMMENT è¡¨æ³¨é‡Š ] ;
```

### ï¼ˆ3ï¼‰æŸ¥è¯¢å½“å‰æ•°æ®åº“æ”¯æŒçš„å­˜å‚¨å¼•æ“

```sql
show engines;
```

![image-20250413225129981](./Mysql-Learning-Local.assets/image-20250413225129981.png)

### ï¼ˆ4ï¼‰ç¤ºä¾‹æ¼”ç¤º

#### A. æŸ¥è¯¢å»ºè¡¨è¯­å¥ --- é»˜è®¤å­˜å‚¨å¼•æ“: InnoDB

```sql
show create table account; 
```

![image-20250413225027030](./Mysql-Learning-Local.assets/image-20250413225027030.png)

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåˆ›å»ºè¡¨æ—¶ï¼Œå³ä½¿æˆ‘ä»¬æ²¡æœ‰æŒ‡å®šå­˜å‚¨å¼•æ“ï¼Œæ•°æ®åº“ä¹Ÿä¼š**è‡ªåŠ¨é€‰æ‹©é»˜è®¤çš„å­˜å‚¨å¼•æ“**ã€‚



#### B. æŸ¥è¯¢å½“å‰æ•°æ®åº“æ”¯æŒçš„å­˜å‚¨å¼•æ“

```sql
show engines ; 
```

![image-20250413225129981](./Mysql-Learning-Local.assets/image-20250413225129981.png)

#### C. åˆ›å»ºè¡¨ my_myisam , å¹¶æŒ‡å®šMyISAMå­˜å‚¨å¼•æ“

```sql
create table my_myisam(
    id int,
    name varchar(10)
) engine = MyISAM ;
```

#### D. åˆ›å»ºè¡¨ my_memory , æŒ‡å®šMemoryå­˜å‚¨å¼•æ“

```sql
create table my_memory(
    id int,
    name varchar(10)
) engine = Memory ;
```



## 1.3 ğŸŒŸ ==å­˜å‚¨å¼•æ“ç‰¹ç‚¹==

ä¸Šé¢æˆ‘ä»¬ä»‹ç»äº†ä»€ä¹ˆæ˜¯å­˜å‚¨å¼•æ“ï¼Œä»¥åŠå¦‚ä½•åœ¨å»ºè¡¨æ—¶å¦‚ä½•æŒ‡å®šå­˜å‚¨å¼•æ“ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥ä»‹ç»ä¸‹æ¥ä¸Šé¢é‡ç‚¹æåˆ°çš„**ä¸‰ç§å­˜å‚¨å¼•æ“ InnoDBã€MyISAMã€Memoryçš„ç‰¹ç‚¹**ã€‚

### ï¼ˆ1ï¼‰ğŸŒŸ ==InnoDB==

![image-20250413231002320](./Mysql-Learning-Local.assets/image-20250413231002320.png)

#### â‘ ä»‹ç»

**InnoDBæ˜¯ä¸€ç§å…¼é¡¾é«˜å¯é æ€§å’Œé«˜æ€§èƒ½çš„é€šç”¨å­˜å‚¨å¼•æ“**ï¼Œåœ¨ MySQL 5.5 ä¹‹åï¼ŒInnoDBæ˜¯é»˜è®¤çš„MySQL å­˜å‚¨å¼•æ“ã€‚



#### â‘¡ç‰¹ç‚¹

- DML(å¢åˆ æ”¹)æ“ä½œéµå¾ªACIDæ¨¡å‹ï¼Œæ”¯æŒäº‹åŠ¡ï¼›
- **è¡Œçº§é”ï¼Œæé«˜å¹¶å‘è®¿é—®æ€§èƒ½**ï¼›
- æ”¯æŒå¤–é”®FOREIGN KEYçº¦æŸï¼Œä¿è¯æ•°æ®çš„å®Œæ•´æ€§å’Œæ­£ç¡®æ€§ï¼›



#### â‘¢æ–‡ä»¶

xxx.ibdï¼šxxxä»£è¡¨çš„æ˜¯è¡¨åï¼ŒinnoDBå¼•æ“çš„æ¯å¼ è¡¨éƒ½ä¼šå¯¹åº”è¿™æ ·ä¸€ä¸ª**==è¡¨ç©ºé—´æ–‡ä»¶==**ï¼Œå­˜å‚¨è¯¥è¡¨çš„**è¡¨ç»“æ„**ï¼ˆ**frm-æ—©æœŸçš„ ã€sdi-æ–°ç‰ˆçš„**ï¼‰ã€**æ•°æ®å’Œç´¢å¼•**ã€‚

å‚æ•°ï¼šinnodb_file_per_table

```sql
show variables like 'innodb_file_per_table';
```

![image-20250413230158517](./Mysql-Learning-Local.assets/image-20250413230158517.png)

å¦‚æœ**è¯¥å‚æ•°å¼€å¯**ï¼Œä»£è¡¨å¯¹äºInnoDBå¼•æ“çš„è¡¨ï¼Œ**æ¯ä¸€å¼ è¡¨éƒ½å¯¹åº”ä¸€ä¸ªibdæ–‡ä»¶**ã€‚ æˆ‘ä»¬ç›´æ¥æ‰“å¼€MySQLçš„æ•°æ®å­˜æ”¾ç›®å½•ï¼š C:\ProgramData\MySQL\MySQL Server 8.0\Data ï¼Œ è¿™ä¸ªç›®å½•ä¸‹æœ‰å¾ˆå¤šæ–‡ä»¶å¤¹ï¼Œ**ä¸åŒçš„æ–‡ä»¶å¤¹ä»£è¡¨ä¸åŒçš„æ•°æ®åº“**ï¼Œæˆ‘ä»¬ç›´æ¥æ‰“å¼€itcastæ–‡ä»¶å¤¹ã€‚

![image-20250413230347011](./Mysql-Learning-Local.assets/image-20250413230347011.png)

å¯ä»¥çœ‹åˆ°é‡Œé¢æœ‰å¾ˆå¤šçš„ibdæ–‡ä»¶ï¼Œæ¯ä¸€ä¸ªibdæ–‡ä»¶å°±å¯¹åº”ä¸€å¼ è¡¨ï¼Œæ¯”å¦‚ï¼šæˆ‘ä»¬æœ‰ä¸€å¼ è¡¨ accountï¼Œå°±æœ‰è¿™æ ·çš„ä¸€ä¸ªaccount.ibdæ–‡ä»¶ï¼Œè€Œåœ¨è¿™ä¸ªibdæ–‡ä»¶ä¸­ä¸ä»…å­˜æ”¾è¡¨ç»“æ„ã€æ•°æ®ï¼Œè¿˜ä¼šå­˜æ”¾è¯¥è¡¨å¯¹åº”çš„ç´¢å¼•ä¿¡æ¯ã€‚ è€Œè¯¥æ–‡ä»¶æ˜¯åŸºäºäºŒè¿›åˆ¶å­˜å‚¨çš„ï¼Œä¸èƒ½ç›´æ¥åŸºäºè®°äº‹æœ¬æ‰“å¼€ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨**mysqlæä¾›çš„ä¸€ä¸ªæŒ‡ä»¤ ibd2sdi** ï¼Œé€šè¿‡è¯¥æŒ‡ä»¤å°±å¯ä»¥**ä»ibdæ–‡ä»¶ä¸­æå–sdiä¿¡æ¯**ï¼Œè€Œ**sdiæ•°æ®å­—å…¸ä¿¡æ¯ä¸­å°±åŒ…å«è¯¥è¡¨çš„è¡¨ç»“æ„**ã€‚

```bash
idb2sdi account.ibd #è¿”å›ä¸€ä¸ªJSONæ•°æ®
```

![image-20250413230330296](./Mysql-Learning-Local.assets/image-20250413230330296.png)



#### â‘£é€»è¾‘å­˜å‚¨ç»“æ„

![image-20250413231202493](./Mysql-Learning-Local.assets/image-20250413231202493.png)



- è¡¨ç©ºé—´ : InnoDBå­˜å‚¨å¼•æ“é€»è¾‘ç»“æ„çš„æœ€é«˜å±‚ï¼Œ**ibdæ–‡ä»¶å…¶å®å°±æ˜¯è¡¨ç©ºé—´æ–‡ä»¶**ï¼Œåœ¨è¡¨ç©ºé—´ä¸­å¯ä»¥åŒ…å«**å¤šä¸ªSegmentæ®µ**ã€‚
- æ®µ : è¡¨ç©ºé—´æ˜¯ç”±å„ä¸ªæ®µç»„æˆçš„ï¼Œ å¸¸è§çš„æ®µæœ‰**æ•°æ®æ®µã€ç´¢å¼•æ®µã€å›æ»šæ®µ**ç­‰ã€‚InnoDBä¸­å¯¹äºæ®µçš„ç®¡ç†ï¼Œéƒ½æ˜¯å¼•æ“è‡ªèº«å®Œæˆï¼Œä¸éœ€è¦äººä¸ºå¯¹å…¶æ§åˆ¶ï¼Œä¸€ä¸ªæ®µä¸­åŒ…å«å¤šä¸ªåŒºã€‚
- åŒº : åŒºæ˜¯è¡¨ç©ºé—´çš„å•å…ƒç»“æ„ï¼Œ**æ¯ä¸ªåŒºçš„å¤§å°ä¸º1M**ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œ InnoDB**å­˜å‚¨å¼•æ“é¡µå¤§å°ä¸º16K**ï¼Œ **==å³ä¸€ä¸ªåŒºä¸­ä¸€å…±æœ‰64ä¸ªè¿ç»­çš„é¡µ==**ã€‚
- é¡µ : **==é¡µæ˜¯ç»„æˆåŒºçš„æœ€å°å•å…ƒ==**ï¼Œ**é¡µä¹Ÿæ˜¯**InnoDB **å­˜å‚¨å¼•æ“ç£ç›˜ç®¡ç†çš„æœ€å°å•å…ƒ**ï¼Œæ¯ä¸ªé¡µçš„å¤§å°é»˜è®¤ä¸º 16KBã€‚ä¸ºäº†ä¿è¯é¡µçš„è¿ç»­æ€§ï¼ŒInnoDB å­˜å‚¨å¼•æ“**æ¯æ¬¡ä»ç£ç›˜ç”³è¯· 4-5 ä¸ªåŒº**ã€‚
- è¡Œ : **InnoDB å­˜å‚¨å¼•æ“æ˜¯é¢å‘è¡Œçš„**ï¼Œä¹Ÿå°±æ˜¯è¯´**æ•°æ®æ˜¯æŒ‰è¡Œè¿›è¡Œå­˜æ”¾**çš„ï¼Œåœ¨æ¯ä¸€è¡Œä¸­é™¤äº†å®šä¹‰è¡¨æ—¶æ‰€æŒ‡å®šçš„å­—æ®µä»¥å¤–ï¼Œè¿˜åŒ…å«**ä¸¤ä¸ªéšè—å­—æ®µ**ï¼ˆåé¢ä¼šè¯¦ç»†ä»‹ç»ï¼‰
  - Trx id : æœ€åä¸€æ¬¡æ“ä½œçš„äº‹åŠ¡Id 
  - Roll pointer ï¼šæŒ‡é’ˆ



### ï¼ˆ2ï¼‰MyISAM

![image-20250413231612947](./Mysql-Learning-Local.assets/image-20250413231612947.png)

#### â‘ ä»‹ç»

MyISAMæ˜¯MySQLæ—©æœŸçš„é»˜è®¤å­˜å‚¨å¼•æ“ã€‚

#### â‘¡ç‰¹ç‚¹

- ä¸æ”¯æŒäº‹åŠ¡ï¼Œä¸æ”¯æŒå¤–é”®
- **æ”¯æŒè¡¨é”ï¼Œä¸æ”¯æŒè¡Œé”**
- è®¿é—®é€Ÿåº¦å¿«

#### â‘¢æ–‡ä»¶

- xxx.sdiï¼š**å­˜å‚¨è¡¨ç»“æ„**ä¿¡æ¯
- xxx.MYD: å­˜å‚¨**æ•°æ®**
- xxx.MYI: å­˜å‚¨**ç´¢å¼•**

 ![image-20250413230502451](./Mysql-Learning-Local.assets/image-20250413230502451.png)



### ï¼ˆ3ï¼‰Memory

![image-20250413231655565](./Mysql-Learning-Local.assets/image-20250413231655565.png)

#### â‘ ä»‹ç»

Memoryå¼•æ“çš„è¡¨æ•°æ®æ—¶**å­˜å‚¨åœ¨å†…å­˜ä¸­çš„**ï¼Œç”±äºå—åˆ°ç¡¬ä»¶é—®é¢˜ã€æˆ–æ–­ç”µé—®é¢˜çš„å½±å“ï¼Œåªèƒ½å°†è¿™äº›è¡¨ä½œä¸º**ä¸´æ—¶è¡¨æˆ–ç¼“å­˜ä½¿ç”¨**ã€‚

#### â‘¡ç‰¹ç‚¹

- å†…å­˜å­˜æ”¾
- hashç´¢å¼•ï¼ˆé»˜è®¤ï¼‰

#### â‘¢æ–‡ä»¶

xxx.sdiï¼š**å­˜å‚¨è¡¨ç»“æ„ä¿¡æ¯**



### ï¼ˆ4ï¼‰==åŒºåˆ«åŠç‰¹ç‚¹==

![image-20250413231743167](./Mysql-Learning-Local.assets/image-20250413231743167.png)

![image-20250413225914459](./Mysql-Learning-Local.assets/image-20250413225914459.png)



> **é¢è¯•é¢˜:**
>
> InnoDBå¼•æ“ä¸MyISAMå¼•æ“çš„åŒºåˆ« ?
>
> - â‘ InnoDBå¼•æ“, **æ”¯æŒäº‹åŠ¡, è€ŒMyISAMä¸æ”¯æŒ**ã€‚
> - â‘¡InnoDBå¼•æ“, **æ”¯æŒè¡Œé”å’Œè¡¨é”, è€ŒMyISAMä»…æ”¯æŒè¡¨é”, ä¸æ”¯æŒè¡Œé”**ã€‚
> - â‘¢InnoDBå¼•æ“, **æ”¯æŒå¤–é”®, è€ŒMyISAMæ˜¯ä¸æ”¯æŒçš„**ã€‚
>
> ä¸»è¦æ˜¯ä¸Šè¿°ä¸‰ç‚¹åŒºåˆ«ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä»ç´¢å¼•ç»“æ„ã€å­˜å‚¨é™åˆ¶ç­‰æ–¹é¢ï¼Œæ›´åŠ æ·±å…¥çš„å›ç­”ï¼Œå…·ä½“å‚
>
> è€ƒå¦‚ä¸‹å®˜æ–¹æ–‡æ¡£ï¼š
>
> **https://dev.mysql.com/doc/refman/8.0/en/innodb-introduction.html**
>
> **https://dev.mysql.com/doc/refman/8.0/en/myisam-storage-engine.html**



## 1.4 å­˜å‚¨å¼•æ“é€‰æ‹©

![image-20250413231918750](./Mysql-Learning-Local.assets/image-20250413231918750.png)

åœ¨é€‰æ‹©å­˜å‚¨å¼•æ“æ—¶ï¼Œåº”è¯¥æ ¹æ®åº”ç”¨ç³»ç»Ÿçš„ç‰¹ç‚¹é€‰æ‹©åˆé€‚çš„å­˜å‚¨å¼•æ“ã€‚å¯¹äºå¤æ‚çš„åº”ç”¨ç³»ç»Ÿï¼Œè¿˜å¯ä»¥æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©å¤šç§å­˜å‚¨å¼•æ“è¿›è¡Œç»„åˆã€‚

- InnoDB: æ˜¯Mysqlçš„é»˜è®¤å­˜å‚¨å¼•æ“ï¼Œ**æ”¯æŒäº‹åŠ¡ã€å¤–é”®**ã€‚å¦‚æœ**åº”ç”¨å¯¹äº‹åŠ¡çš„å®Œæ•´æ€§æœ‰æ¯”è¾ƒé«˜çš„è¦æ±‚**ï¼Œ**åœ¨å¹¶å‘æ¡ä»¶ä¸‹è¦æ±‚æ•°æ®çš„ä¸€è‡´æ€§ï¼Œæ•°æ®æ“ä½œé™¤äº†æ’å…¥å’ŒæŸ¥è¯¢ä¹‹å¤–ï¼Œè¿˜åŒ…å«å¾ˆå¤šçš„æ›´æ–°ã€åˆ é™¤æ“ä½œ**ï¼Œé‚£ä¹ˆInnoDBå­˜å‚¨å¼•æ“æ˜¯æ¯”è¾ƒåˆé€‚çš„é€‰æ‹©ã€‚
- MyISAM ï¼š å¦‚æœåº”ç”¨æ˜¯**ä»¥è¯»æ“ä½œå’Œæ’å…¥æ“ä½œä¸ºä¸»**ï¼Œåªæœ‰å¾ˆå°‘çš„æ›´æ–°å’Œåˆ é™¤æ“ä½œï¼Œå¹¶ä¸”å¯¹äº‹åŠ¡çš„å®Œæ•´æ€§ã€å¹¶å‘æ€§è¦æ±‚ä¸æ˜¯å¾ˆé«˜ï¼Œé‚£ä¹ˆé€‰æ‹©è¿™ä¸ªå­˜å‚¨å¼•æ“æ˜¯éå¸¸åˆé€‚çš„ã€‚**ï¼ˆè¯¥åœºæ™¯å¯ç”¨NoSQLæ•°æ®åº“ï¼Œ==MongoDB==ï¼‰**
- MEMORYï¼š**å°†æ‰€æœ‰æ•°æ®ä¿å­˜åœ¨å†…å­˜ä¸­**ï¼Œ**è®¿é—®é€Ÿåº¦å¿«ï¼Œé€šå¸¸ç”¨äºä¸´æ—¶è¡¨åŠç¼“å­˜**ã€‚MEMORYçš„ç¼ºé™·å°±æ˜¯å¯¹è¡¨çš„å¤§å°æœ‰é™åˆ¶ï¼Œå¤ªå¤§çš„è¡¨æ— æ³•ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œè€Œä¸”**æ— æ³•ä¿éšœæ•°æ®çš„å®‰å…¨æ€§**ã€‚**ï¼ˆè¯¥åœºæ™¯å¯ç”¨==Redis==æ›¿ä»£ï¼‰**



## 1.5 å°ç»“

![image-20250413232209058](./Mysql-Learning-Local.assets/image-20250413232209058.png)

# 2ã€ğŸš€ ==ç´¢å¼•==

## 2.1 ç´¢å¼•æ¦‚è¿°

### ï¼ˆ1ï¼‰ä»‹ç»

ç´¢å¼•ï¼ˆindexï¼‰æ˜¯å¸®åŠ©**MySQL==é«˜æ•ˆè·å–æ•°æ®çš„æ•°æ®ç»“æ„(æœ‰åº)==**ã€‚åœ¨æ•°æ®ä¹‹å¤–ï¼Œæ•°æ®åº“ç³»ç»Ÿè¿˜ç»´æŠ¤ç€æ»¡è¶³ç‰¹å®šæŸ¥æ‰¾ç®—æ³•çš„æ•°æ®ç»“æ„ï¼Œè¿™äº›æ•°æ®ç»“æ„ä»¥æŸç§æ–¹å¼**å¼•ç”¨ï¼ˆæŒ‡å‘ï¼‰æ•°æ®**ï¼Œ è¿™æ ·å°±å¯ä»¥åœ¨è¿™äº›æ•°æ®ç»“æ„ä¸Šå®ç°é«˜çº§æŸ¥æ‰¾ç®—æ³•ï¼Œè¿™ç§æ•°æ®ç»“æ„å°±æ˜¯ç´¢å¼•ã€‚

<img src="./Mysql-Learning-Local.assets/image-20250415115112093.png" alt="image-20250415115112093" style="zoom:80%;" />

ä¸€æåˆ°æ•°æ®ç»“æ„ï¼Œå¤§å®¶éƒ½ä¼šæœ‰æ‰€æ‹…å¿ƒï¼Œæ‹…å¿ƒè‡ªå·±ä¸èƒ½ç†è§£ï¼Œè·Ÿä¸ä¸ŠèŠ‚å¥ã€‚ä¸è¿‡åœ¨è¿™é‡Œå¤§å®¶å®Œå…¨ä¸ç”¨æ‹…å¿ƒï¼Œæˆ‘ä»¬åé¢åœ¨è®²è§£æ—¶ï¼Œä¼šè¯¦ç»†ä»‹ç»ã€‚



### ï¼ˆ2ï¼‰æ¼”ç¤º

![image-20250415134956149](./Mysql-Learning-Local.assets/image-20250415134956149.png)

è¡¨ç»“æ„åŠå…¶æ•°æ®å¦‚ä¸‹ï¼š

<img src="./Mysql-Learning-Local.assets/image-20250415115133799.png" alt="image-20250415115133799" style="zoom:50%;" />

å‡å¦‚æˆ‘ä»¬è¦æ‰§è¡Œçš„SQLè¯­å¥ä¸º ï¼š select * from user where age = 45;

#### â‘ æ— ç´¢å¼•æƒ…å†µ

<img src="./Mysql-Learning-Local.assets/image-20250415115300649.png" alt="image-20250415115300649" style="zoom: 50%;" />

åœ¨æ— ç´¢å¼•æƒ…å†µä¸‹ï¼Œå°±éœ€è¦ä»**ç¬¬ä¸€è¡Œå¼€å§‹æ‰«æï¼Œä¸€ç›´æ‰«æåˆ°æœ€åä¸€è¡Œï¼ˆä¸ä¸€å®šä¿è¯è¡¨é‡Œé¢åªæœ‰ä¸€ä¸ªage=45**ï¼‰ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º **å…¨è¡¨æ‰«æ**ï¼Œæ€§èƒ½å¾ˆä½ã€‚



#### â‘¡æœ‰ç´¢å¼•æƒ…å†µ

å¦‚æœæˆ‘ä»¬é’ˆå¯¹äºè¿™å¼ è¡¨å»ºç«‹äº†ç´¢å¼•ï¼Œå‡è®¾**ç´¢å¼•ç»“æ„å°±æ˜¯äºŒå‰æ ‘**ï¼Œé‚£ä¹ˆä¹Ÿå°±æ„å‘³ç€ï¼Œä¼šå¯¹ageè¿™ä¸ªå­—æ®µå»ºç«‹ä¸€ä¸ªäºŒå‰æ ‘çš„ç´¢å¼•ç»“æ„ã€‚

<img src="./Mysql-Learning-Local.assets/image-20250415115406576.png" alt="image-20250415115406576" style="zoom:67%;" />

æ­¤æ—¶æˆ‘ä»¬åœ¨è¿›è¡ŒæŸ¥è¯¢æ—¶ï¼Œåªéœ€è¦**æ‰«æä¸‰æ¬¡**å°±å¯ä»¥æ‰¾åˆ°æ•°æ®äº†ï¼Œæå¤§çš„æé«˜çš„æŸ¥è¯¢çš„æ•ˆç‡ã€‚



> **å¤‡æ³¨ï¼š** è¿™é‡Œæˆ‘ä»¬åªæ˜¯å‡è®¾ç´¢å¼•çš„ç»“æ„æ˜¯äºŒå‰æ ‘ï¼Œä»‹ç»ä¸€ä¸‹ç´¢å¼•çš„å¤§æ¦‚åŸç†ï¼Œåªæ˜¯ä¸€ä¸ª**ç¤ºæ„å›¾**ï¼Œå¹¶
>
> **ä¸æ˜¯ç´¢å¼•çš„çœŸå®ç»“æ„**ï¼Œç´¢å¼•çš„çœŸå®ç»“æ„ï¼Œåé¢ä¼šè¯¦ç»†ä»‹ç»ã€‚



### ï¼ˆ3ï¼‰ä¼˜ç¼ºç‚¹

![image-20250415135103536](./Mysql-Learning-Local.assets/image-20250415135103536.png)

![image-20250415131532366](./Mysql-Learning-Local.assets/image-20250415131532366.png)



## 2.2 ğŸŒŸ ç´¢å¼•ç»“æ„

### ï¼ˆ1ï¼‰æ¦‚è¿°

![image-20250415135623947](./Mysql-Learning-Local.assets/image-20250415135623947.png)

MySQLçš„ç´¢å¼•æ˜¯åœ¨**==å­˜å‚¨å¼•æ“å±‚==**å®ç°çš„ï¼Œä¸åŒçš„å­˜å‚¨å¼•æ“æœ‰ä¸åŒçš„ç´¢å¼•ç»“æ„ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹å‡ ç§ï¼š

![image-20250415131610490](./Mysql-Learning-Local.assets/image-20250415131610490.png)

ä¸Šè¿°æ˜¯MySQLä¸­æ‰€æ”¯æŒçš„æ‰€æœ‰çš„ç´¢å¼•ç»“æ„ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹**ä¸åŒçš„å­˜å‚¨å¼•æ“**å¯¹äºç´¢å¼•ç»“æ„çš„æ”¯æŒæƒ…å†µã€‚

![image-20250415135735449](./Mysql-Learning-Local.assets/image-20250415135735449.png)

![image-20250415132239125](./Mysql-Learning-Local.assets/image-20250415132239125.png)



> æ³¨æ„ï¼š æˆ‘ä»¬å¹³å¸¸æ‰€è¯´çš„ç´¢å¼•ï¼Œå¦‚æœæ²¡æœ‰ç‰¹åˆ«æŒ‡æ˜ï¼Œéƒ½æ˜¯**æŒ‡B+æ ‘ç»“æ„ç»„ç»‡çš„ç´¢å¼•**ã€‚



### ï¼ˆ2ï¼‰äºŒå‰æ ‘

![image-20250415135912054](./Mysql-Learning-Local.assets/image-20250415135912054.png)

#### â‘ äºŒå‰æ ‘

å‡å¦‚è¯´MySQLçš„ç´¢å¼•ç»“æ„é‡‡ç”¨äºŒå‰æ ‘çš„æ•°æ®ç»“æ„ï¼Œæ¯”è¾ƒç†æƒ³çš„ç»“æ„å¦‚ä¸‹ï¼š

<img src="./Mysql-Learning-Local.assets/image-20250415132336631.png" alt="image-20250415132336631" style="zoom:67%;" />

å¦‚æœ**ä¸»é”®æ˜¯é¡ºåºæ’å…¥**çš„ï¼Œåˆ™**ä¼šå½¢æˆä¸€ä¸ªå•å‘é“¾è¡¨**ï¼Œç»“æ„å¦‚ä¸‹ï¼š

<img src="./Mysql-Learning-Local.assets/image-20250415132405730.png" alt="image-20250415132405730" style="zoom:50%;" />

æ‰€ä»¥ï¼Œå¦‚æœé€‰æ‹©äºŒå‰æ ‘ä½œä¸ºç´¢å¼•ç»“æ„ï¼Œä¼šå­˜åœ¨ä»¥ä¸‹**ç¼ºç‚¹**ï¼š

- é¡ºåºæ’å…¥æ—¶ï¼Œä¼šå½¢æˆä¸€ä¸ªé“¾è¡¨ï¼Œ**æŸ¥è¯¢æ€§èƒ½å¤§å¤§é™ä½**ã€‚
- å¤§æ•°æ®é‡æƒ…å†µä¸‹ï¼Œ**å±‚çº§è¾ƒæ·±ï¼Œæ£€ç´¢é€Ÿåº¦æ…¢**ã€‚



#### â‘¡çº¢é»‘æ ‘

æ­¤æ—¶å¤§å®¶å¯èƒ½ä¼šæƒ³åˆ°ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©çº¢é»‘æ ‘ï¼Œ**çº¢é»‘æ ‘æ˜¯ä¸€é¢—è‡ªå¹³è¡¡äºŒå‰æ ‘**ï¼Œé‚£è¿™æ ·å³ä½¿æ˜¯é¡ºåºæ’å…¥æ•°æ®ï¼Œæœ€ç»ˆå½¢æˆçš„æ•°æ®ç»“æ„ä¹Ÿæ˜¯ä¸€é¢—**å¹³è¡¡çš„äºŒå‰æ ‘**,ç»“æ„å¦‚ä¸‹:

<img src="./Mysql-Learning-Local.assets/image-20250415132454455.png" alt="image-20250415132454455" style="zoom:50%;" />

ä½†æ˜¯ï¼Œå³ä½¿å¦‚æ­¤ï¼Œç”±äº**çº¢é»‘æ ‘ä¹Ÿæ˜¯ä¸€é¢—äºŒå‰æ ‘**ï¼Œæ‰€ä»¥ä¹Ÿä¼šå­˜åœ¨ä¸€ä¸ª**ç¼ºç‚¹**ï¼š

- å¤§æ•°æ®é‡æƒ…å†µä¸‹ï¼Œ**å±‚çº§è¾ƒæ·±ï¼Œæ£€ç´¢é€Ÿåº¦æ…¢**ã€‚

æ‰€ä»¥ï¼Œåœ¨MySQLçš„ç´¢å¼•ç»“æ„ä¸­ï¼Œå¹¶æ²¡æœ‰é€‰æ‹©äºŒå‰æ ‘æˆ–è€…çº¢é»‘æ ‘ï¼Œè€Œé€‰æ‹©çš„æ˜¯**B+Tre**eï¼Œé‚£ä¹ˆä»€ä¹ˆæ˜¯B+Treeå‘¢ï¼Ÿåœ¨è¯¦è§£B+Treeä¹‹å‰ï¼Œå…ˆæ¥ä»‹ç»ä¸€ä¸ªB-Treeã€‚



### ï¼ˆ3ï¼‰ğŸŒŸ ==B-Tree==

#### â‘ æ¦‚å¿µ

![image-20250415140303752](./Mysql-Learning-Local.assets/image-20250415140303752.png)

B-Treeï¼ŒBæ ‘æ˜¯ä¸€ç§**å¤šå‰è·¯è¡¡æŸ¥æ‰¾æ ‘**ï¼Œç›¸å¯¹äºäºŒå‰æ ‘ï¼ŒBæ ‘**æ¯ä¸ªèŠ‚ç‚¹å¯ä»¥æœ‰å¤šä¸ªåˆ†æ”¯ï¼Œå³å¤šå‰**ã€‚ä»¥ä¸€é¢—æœ€å¤§åº¦æ•°ï¼ˆmax-degreeï¼‰ä¸º5(5é˜¶)çš„b-treeä¸ºä¾‹ï¼Œé‚£è¿™ä¸ªBæ ‘**æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šå­˜å‚¨4ä¸ªkeyï¼Œ5ä¸ªæŒ‡é’ˆ**

- **æŒ‡é’ˆä¼šæ¯”keyå¤šä¸€ä¸ª**ï¼ŒåŸå› æ˜¯å¦‚ä¸‹å›¾çš„20 30 62 89 å¯¹åº”å››ä¸ªkeyï¼Œè€Œè¿™å››ä¸ªkeyå¯ä»¥å°†èŒƒå›´åˆ’åˆ†æˆäº”ä»½ï¼Œæ¯”å¦‚<20, 	20-30 ,	30-62,	 62-89,	 >89 ï¼Œæ‰€ä»¥4ä¸ªkeyå¯¹åº”5ä¸ªæŒ‡é’ˆã€‚

![image-20250415132655910](./Mysql-Learning-Local.assets/image-20250415132655910.png)



> çŸ¥è¯†å°è´´å£«: æ ‘çš„**åº¦æ•°**æŒ‡çš„æ˜¯**ä¸€ä¸ªèŠ‚ç‚¹çš„å­èŠ‚ç‚¹ä¸ªæ•°**ã€‚



æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ª**æ•°æ®ç»“æ„å¯è§†åŒ–çš„ç½‘ç«™**æ¥ç®€å•æ¼”ç¤ºä¸€ä¸‹ã€‚ 

**https://www.cs.usfca.edu/~galles/visualization/BTree.html**

![image-20250415132903372](./Mysql-Learning-Local.assets/image-20250415132903372.png)

æ’å…¥ä¸€ç»„æ•°æ®ï¼š 100 65 169 368 900 556 780 35 215 1200 234 888 158 90 1000 88 120 268 250 ã€‚ç„¶åè§‚å¯Ÿä¸€äº›æ•°æ®æ’å…¥è¿‡ç¨‹ä¸­ï¼ŒèŠ‚ç‚¹çš„å˜åŒ–æƒ…å†µã€‚

![image-20250415132920258](./Mysql-Learning-Local.assets/image-20250415132920258.png)

#### â‘¡ç‰¹ç‚¹

- 5é˜¶çš„Bæ ‘ï¼Œ**æ¯ä¸€ä¸ªèŠ‚ç‚¹æœ€å¤šå­˜å‚¨4ä¸ªkeyï¼Œå¯¹åº”5ä¸ªæŒ‡é’ˆ**ã€‚

- ä¸€æ—¦èŠ‚ç‚¹å­˜å‚¨çš„**keyæ•°é‡åˆ°è¾¾5**ï¼Œå°±ä¼š**==è£‚å˜==ï¼Œ==ä¸­é—´å…ƒç´ å‘ä¸Šåˆ†è£‚==**ã€‚

  <img src="./Mysql-Learning-Local.assets/image-20250415140512702.png" alt="image-20250415140512702" style="zoom:67%;" />

  ![image-20250415140813682](./Mysql-Learning-Local.assets/image-20250415140813682.png)

  

- åœ¨Bæ ‘ä¸­ï¼Œ**==éå¶å­èŠ‚ç‚¹å’Œå¶å­èŠ‚ç‚¹éƒ½ä¼šå­˜æ”¾æ•°æ®==**ã€‚





#### â‘¢è¿‡ç¨‹æ¼”ç¤º

<img src="./Mysql-Learning-Local.assets/image-20250415140512702.png" alt="image-20250415140512702" style="zoom:67%;" />

![image-20250415140813682](./Mysql-Learning-Local.assets/image-20250415140813682.png)

![image-20250415141212299](./Mysql-Learning-Local.assets/image-20250415141212299.png)

![image-20250415141328922](./Mysql-Learning-Local.assets/image-20250415141328922.png)

![image-20250415141632288](./Mysql-Learning-Local.assets/image-20250415141632288.png)

![image-20250415141755092](./Mysql-Learning-Local.assets/image-20250415141755092.png)

**å‰©ä¸‹çš„ä»¥æ­¤ç±»æ¨**ï¼š

![image-20250415141857264](./Mysql-Learning-Local.assets/image-20250415141857264.png)





### ï¼ˆ4ï¼‰ğŸŒŸB+Tree

#### â‘ æ¦‚å¿µåŠç‰¹ç‚¹

B+Treeæ˜¯B-Treeçš„å˜ç§ï¼Œæˆ‘ä»¬ä»¥ä¸€é¢—æœ€å¤§åº¦æ•°ï¼ˆmax-degreeï¼‰ä¸º4ï¼ˆ**4é˜¶**ï¼‰çš„b+treeä¸ºä¾‹ï¼ˆ**==4é˜¶ b+ tree å¯¹åº” 3ä¸ªkeyï¼Œ4ä¸ªæŒ‡é’ˆ==**ï¼‰ï¼Œæ¥çœ‹ä¸€ ä¸‹å…¶ç»“æ„ç¤ºæ„å›¾ï¼š

![image-20250415133144602](./Mysql-Learning-Local.assets/image-20250415133144602.png)

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä¸¤éƒ¨åˆ†ï¼š

- ç»¿è‰²æ¡†æ¡†èµ·æ¥çš„éƒ¨åˆ†ï¼Œæ˜¯**==ç´¢å¼•éƒ¨åˆ†ï¼Œä»…ä»…èµ·åˆ°ç´¢å¼•æ•°æ®çš„ä½œç”¨==**ï¼Œ**ä¸å­˜å‚¨æ•°æ®**ã€‚
- çº¢è‰²æ¡†æ¡†èµ·æ¥çš„éƒ¨åˆ†ï¼Œæ˜¯**æ•°æ®å­˜å‚¨éƒ¨åˆ†**ï¼Œåœ¨**==å…¶å¶å­èŠ‚ç‚¹ä¸­è¦å­˜å‚¨å…·ä½“çš„æ•°æ®==**ã€‚
- **==å¶å­èŠ‚ç‚¹å½¢æˆä¸€ä¸ªå•å‘é“¾è¡¨==**ã€‚
- **==æ‰€æœ‰å…ƒç´ éƒ½ä¼šå‡ºç°åœ¨å¶å­èŠ‚ç‚¹==ï¼ŒåŒ…æ‹¬==è£‚å˜æ—¶å‘ä¸Šåˆ†è£‚çš„ä¸­é—´å…ƒç´ ==**-ä¹Ÿéœ€è¦ä¿ç•™



æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªæ•°æ®ç»“æ„å¯è§†åŒ–çš„ç½‘ç«™æ¥ç®€å•æ¼”ç¤ºä¸€ä¸‹ã€‚ https://www.cs.usfca.edu/~galles/visualization/BPlusTree.html

![image-20250415133240804](./Mysql-Learning-Local.assets/image-20250415133240804.png)

æ’å…¥ä¸€ç»„æ•°æ®ï¼š 100 65 169 368 900 556 780 35 215 1200 234 888 158 90 1000 88 120 268 250 ã€‚ç„¶åè§‚å¯Ÿä¸€äº›æ•°æ®æ’å…¥è¿‡ç¨‹ä¸­ï¼ŒèŠ‚ç‚¹çš„å˜åŒ–æƒ…å†µã€‚

![image-20250415133259260](./Mysql-Learning-Local.assets/image-20250415133259260.png)

æœ€ç»ˆæˆ‘ä»¬çœ‹åˆ°ï¼ŒB+Treeä¸ B-Treeç›¸æ¯”ï¼Œä¸»è¦æœ‰ä»¥ä¸‹**ä¸‰ç‚¹åŒºåˆ«**ï¼š

-  æ‰€æœ‰çš„æ•°æ®éƒ½ä¼šå‡ºç°åœ¨**å¶å­èŠ‚ç‚¹**ã€‚
-  **å¶å­èŠ‚ç‚¹å½¢æˆä¸€ä¸ªå•å‘é“¾è¡¨**ã€‚
-  **éå¶å­èŠ‚ç‚¹**ä»…ä»…èµ·åˆ°**ç´¢å¼•æ•°æ®ä½œç”¨**ï¼Œ**å…·ä½“çš„æ•°æ®**éƒ½æ˜¯åœ¨**å¶å­èŠ‚ç‚¹å­˜æ”¾**çš„ã€‚



#### â‘¡Mysqlä¸­çš„B+Tree-==å¾ªç¯åŒå‘é“¾è¡¨==


ä¸Šè¿°æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ç»“æ„æ˜¯**æ ‡å‡†**çš„B+Treeçš„æ•°æ®ç»“æ„ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹**MySQLä¸­ä¼˜åŒ–ä¹‹åçš„ B+Tree**ã€‚

MySQLç´¢å¼•æ•°æ®ç»“æ„å¯¹ç»å…¸çš„B+Treeè¿›è¡Œäº†ä¼˜åŒ–ã€‚åœ¨åŸB+Treeçš„åŸºç¡€ä¸Šï¼Œ**==å¢åŠ ä¸€ä¸ªæŒ‡å‘ç›¸é‚»å¶å­èŠ‚ç‚¹é“¾è¡¨æŒ‡é’ˆ==**ï¼Œå°±å½¢æˆäº†**==å¸¦æœ‰é¡ºåºæŒ‡é’ˆçš„B+Tree==**ï¼Œ**æé«˜åŒºé—´è®¿é—®çš„æ€§èƒ½ï¼Œåˆ©äºæ’åº**ã€‚

![image-20250415133504338](./Mysql-Learning-Local.assets/image-20250415133504338.png)



### ï¼ˆ5ï¼‰Hash

![image-20250415142755105](./Mysql-Learning-Local.assets/image-20250415142755105.png)

MySQLä¸­é™¤äº†æ”¯æŒB+Treeç´¢å¼•ï¼Œè¿˜æ”¯æŒä¸€ç§ç´¢å¼•ç±»å‹---**Hashç´¢å¼•**ã€‚ 

#### â‘ ç»“æ„

å“ˆå¸Œç´¢å¼•å°±æ˜¯é‡‡ç”¨ä¸€å®šçš„hashç®—æ³•ï¼Œ**å°†é”®å€¼æ¢ç®—æˆæ–°çš„hashå€¼**ï¼Œæ˜ å°„åˆ°å¯¹åº”çš„æ§½ä½ä¸Šï¼Œç„¶åå­˜å‚¨åœ¨
hashè¡¨ä¸­ã€‚

![image-20250415133615758](./Mysql-Learning-Local.assets/image-20250415133615758.png)

å¦‚æœ**ä¸¤ä¸ª(æˆ–å¤šä¸ª)é”®å€¼ï¼Œæ˜ å°„åˆ°ä¸€ä¸ªç›¸åŒçš„æ§½ä½ä¸Š**ï¼Œä»–ä»¬å°±äº§ç”Ÿäº†**hashå†²çª**ï¼ˆä¹Ÿç§°ä¸ºhashç¢°æ’ï¼‰ï¼Œå¯ä»¥**é€šè¿‡é“¾è¡¨æ¥è§£å†³**ã€‚

![image-20250415133632053](./Mysql-Learning-Local.assets/image-20250415133632053.png)



#### â‘¡ç‰¹ç‚¹

- A. Hashç´¢å¼•åªèƒ½ç”¨äº**å¯¹ç­‰æ¯”è¾ƒ**(=ï¼Œin)ï¼Œ**ä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢**ï¼ˆbetweenï¼Œ>ï¼Œ< ï¼Œ...ï¼‰
- B. **æ— æ³•åˆ©ç”¨ç´¢å¼•å®Œæˆ==æ’åºæ“ä½œ==**
- C. æŸ¥è¯¢æ•ˆç‡é«˜ï¼Œé€šå¸¸==(**ä¸å­˜åœ¨hashå†²çªçš„æƒ…å†µ**)**åªéœ€è¦ä¸€æ¬¡æ£€ç´¢**==å°±å¯ä»¥äº†ï¼Œæ•ˆç‡é€šå¸¸è¦é«˜äºB+treeç´¢å¼•



#### â‘¢å­˜å‚¨å¼•æ“æ”¯æŒ

åœ¨MySQLä¸­ï¼Œæ”¯æŒhashç´¢å¼•çš„æ˜¯**Memoryå­˜å‚¨å¼•æ“**ã€‚ è€Œ**InnoDBä¸­å…·æœ‰è‡ªé€‚åº”hashåŠŸèƒ½**ï¼Œhashç´¢å¼•æ˜¯InnoDBå­˜å‚¨å¼•æ“**æ ¹æ®B+Treeç´¢å¼•åœ¨æŒ‡å®šæ¡ä»¶ä¸‹è‡ªåŠ¨æ„å»ºçš„**ã€‚



> æ€è€ƒé¢˜ï¼š ä¸ºä»€ä¹ˆInnoDBå­˜å‚¨å¼•æ“é€‰æ‹©ä½¿ç”¨**B+treeç´¢å¼•ç»“æ„**?
>
> - A. ç›¸å¯¹äºäºŒå‰æ ‘ï¼Œå±‚çº§æ›´å°‘ï¼Œæœç´¢æ•ˆç‡é«˜ï¼›
>
> - B. å¯¹äºB-treeï¼Œæ— è®ºæ˜¯å¶å­èŠ‚ç‚¹è¿˜æ˜¯éå¶å­èŠ‚ç‚¹ï¼Œéƒ½ä¼šä¿å­˜æ•°æ®ï¼Œè¿™æ ·å¯¼è‡´**==ä¸€é¡µä¸­å­˜å‚¨çš„é”®å€¼å‡å°‘ï¼ŒæŒ‡é’ˆè·Ÿç€å‡å°‘==**ï¼Œ**è¦åŒæ ·ä¿å­˜å¤§é‡æ•°æ®ï¼Œåªèƒ½==å¢åŠ æ ‘çš„é«˜åº¦(å±‚çº§å˜æ·±)==ï¼Œå¯¼è‡´æ€§èƒ½é™ä½**ï¼›
>
> - C. **ç›¸å¯¹Hashç´¢å¼•**ï¼ŒB+treeæ”¯æŒ**==èŒƒå›´åŒ¹é…åŠæ’åºæ“ä½œ==**ï¼›
>
>   ![image-20250415133504338](./Mysql-Learning-Local.assets/image-20250415133504338.png)



## 2.3 ğŸŒŸ ==ç´¢å¼•åˆ†ç±»==

### ï¼ˆ1ï¼‰ç´¢å¼•åˆ†ç±»

åœ¨MySQLæ•°æ®åº“ï¼Œå°†ç´¢å¼•çš„å…·ä½“ç±»å‹ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼š**ä¸»é”®ç´¢å¼•ã€å”¯ä¸€ç´¢å¼•ã€å¸¸è§„ç´¢å¼•ã€å…¨æ–‡ç´¢å¼•**ã€‚

![image-20250415143250961](./Mysql-Learning-Local.assets/image-20250415143250961.png)

<img src="./Mysql-Learning-Local.assets/image-20250415134003736.png" alt="image-20250415134003736" style="zoom:80%;" />



### ï¼ˆ2ï¼‰ğŸŒŸèšé›†ç´¢å¼•&äºŒçº§ç´¢å¼•

![image-20250415143555177](./Mysql-Learning-Local.assets/image-20250415143555177.png)

è€Œåœ¨åœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼Œæ ¹æ®ç´¢å¼•çš„å­˜å‚¨å½¢å¼ï¼Œåˆå¯ä»¥åˆ†ä¸ºä»¥ä¸‹ä¸¤ç§ï¼š

![image-20250415134022972](./Mysql-Learning-Local.assets/image-20250415134022972.png)



#### â‘ èšé›†ç´¢å¼•==é€‰å–è§„åˆ™==

- å¦‚æœå­˜åœ¨ä¸»é”®ï¼Œä¸»é”®ç´¢å¼•å°±æ˜¯èšé›†ç´¢å¼•ã€‚
- å¦‚æœ**ä¸å­˜åœ¨ä¸»é”®**ï¼Œå°†ä½¿ç”¨**==ç¬¬ä¸€ä¸ªå”¯ä¸€ï¼ˆUNIQUEï¼‰ç´¢å¼•==**ä½œä¸ºèšé›†ç´¢å¼•ã€‚
- å¦‚æœè¡¨æ²¡æœ‰ä¸»é”®ï¼Œæˆ–æ²¡æœ‰åˆé€‚çš„å”¯ä¸€ç´¢å¼•ï¼Œåˆ™InnoDBä¼š**è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªrowidä½œä¸ºéšè—çš„èšé›†ç´¢å¼•**ã€‚



#### â‘¡èšé›†ç´¢å¼•å’ŒäºŒçº§ç´¢å¼•çš„==å…·ä½“ç»“æ„==

![image-20250415134212796](./Mysql-Learning-Local.assets/image-20250415134212796.png)



- èšé›†ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ä¸‹æŒ‚çš„æ˜¯**è¿™ä¸€è¡Œçš„æ•°æ®** ã€‚
- **äºŒçº§ç´¢å¼•çš„å¶å­èŠ‚ç‚¹**ä¸‹æŒ‚çš„æ˜¯**è¯¥å­—æ®µå€¼==å¯¹åº”çš„ä¸»é”®å€¼==**ã€‚



#### â‘¢ğŸŒŸSQLè¯­å¥æ‰§è¡Œè¿‡ç¨‹åˆ†æ-==å›è¡¨æŸ¥è¯¢==



> **å›è¡¨æŸ¥è¯¢**ï¼š 
>
> è¿™ç§å…ˆåˆ°**äºŒçº§ç´¢å¼•ä¸­æŸ¥æ‰¾æ•°æ®ï¼Œæ‰¾åˆ°ä¸»é”®å€¼**ï¼Œ
>
> ç„¶åå†åˆ°**èšé›†ç´¢å¼•ä¸­æ ¹æ®ä¸»é”®å€¼ï¼Œè·å–æ•°æ®çš„æ–¹å¼**ï¼Œå°±ç§°ä¹‹ä¸º==å›è¡¨æŸ¥è¯¢==ã€‚



æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ï¼Œå½“æˆ‘ä»¬æ‰§è¡Œå¦‚ä¸‹çš„SQLè¯­å¥æ—¶ï¼Œå…·ä½“çš„æŸ¥æ‰¾è¿‡ç¨‹æ˜¯ä»€ä¹ˆæ ·å­çš„ã€‚

![image-20250415134242948](./Mysql-Learning-Local.assets/image-20250415134242948.png)

**å…·ä½“è¿‡ç¨‹å¦‚ä¸‹:**

- â‘  ç”±äºæ˜¯æ ¹æ®nameå­—æ®µè¿›è¡ŒæŸ¥è¯¢ï¼Œæ‰€ä»¥å…ˆæ ¹æ®name='Arm'åˆ°nameå­—æ®µçš„**äºŒçº§ç´¢å¼•ä¸­è¿›è¡ŒåŒ¹é…æŸ¥æ‰¾**ã€‚ä½†æ˜¯åœ¨äºŒçº§ç´¢å¼•ä¸­åªèƒ½æŸ¥æ‰¾åˆ° **Armå¯¹åº”çš„ä¸»é”®å€¼10**ã€‚

- â‘¡ ç”±äºæŸ¥è¯¢è¿”å›çš„æ•°æ®æ˜¯*ï¼Œæ‰€ä»¥æ­¤æ—¶ï¼Œ**è¿˜éœ€è¦==æ ¹æ®ä¸»é”®å€¼10==ï¼Œåˆ°==èšé›†ç´¢å¼•ä¸­æŸ¥æ‰¾10å¯¹åº”çš„è®°å½•==**ï¼Œæœ€ç»ˆæ‰¾åˆ°10å¯¹åº”çš„è¡Œ**row**ã€‚
- â‘¢ **æœ€ç»ˆæ‹¿åˆ°è¿™ä¸€è¡Œçš„æ•°æ®**ï¼Œç›´æ¥è¿”å›å³å¯ã€‚



#### â‘£ğŸŒŸ==æ€è€ƒé¢˜==

> æ€è€ƒé¢˜ï¼š
>
> ä»¥ä¸‹ä¸¤æ¡SQLè¯­å¥ï¼Œé‚£ä¸ªæ‰§è¡Œæ•ˆç‡é«˜? ä¸ºä»€ä¹ˆ?
>
> - A. select * from user where id = 10 ;
> - B. select * from user where name = 'Arm' ;
>
> å¤‡æ³¨: **idä¸ºä¸»é”®**ï¼Œ**nameå­—æ®µåˆ›å»ºçš„æœ‰ç´¢å¼•**ï¼›
>
> 
>
> è§£ç­”ï¼š
>
> â€‹	A è¯­å¥çš„æ‰§è¡Œæ€§èƒ½è¦é«˜äºB è¯­å¥ã€‚
>
> - å› ä¸ºAè¯­å¥**ç›´æ¥èµ°èšé›†ç´¢å¼•**ï¼Œç›´æ¥è¿”å›æ•°æ®ã€‚
> - è€ŒBè¯­å¥éœ€è¦**å…ˆæŸ¥è¯¢**nameå­—æ®µçš„**äºŒçº§ç´¢å¼•**ï¼Œç„¶å**å†æŸ¥è¯¢èšé›†ç´¢å¼•**ï¼Œä¹Ÿå°±æ˜¯**==éœ€è¦è¿›è¡Œå›è¡¨æŸ¥è¯¢==**ã€‚



> **æ€è€ƒé¢˜**ï¼š
>
> ![image-20250415145642499](./Mysql-Learning-Local.assets/image-20250415145642499.png)
>
> **InnoDB==ä¸»é”®ç´¢å¼•çš„B+treeé«˜åº¦ä¸ºå¤šé«˜==å‘¢**?
>
> ![image-20250415133504338](./Mysql-Learning-Local.assets/image-20250415133504338.png)
>
> å‡è®¾:
>
> â€‹	ä¸€è¡Œæ•°æ®å¤§å°ä¸º**1k**ï¼Œ**ä¸€é¡µï¼ˆ16Kï¼‰ä¸­å¯ä»¥å­˜å‚¨16è¡Œ**è¿™æ ·çš„æ•°æ®ã€‚InnoDBçš„**æŒ‡é’ˆå ç”¨6ä¸ªå­—èŠ‚çš„ç©ºé—´**ï¼Œ**ä¸»é”®ç±»å‹**å³ä½¿ä¸º**bigintï¼Œå ç”¨å­—èŠ‚æ•°ä¸º8**ã€‚
>
> é«˜åº¦ä¸º2ï¼š( è®¾æ¯ä¸ªèŠ‚ç‚¹(é¡µ)ä¸­çš„keyçš„ä¸ªæ•°ä¸ºn )
>
> - `n*8`ï¼šè®¾ä¸»é”®ç±»å‹ä¸ºbigint**å ç”¨8å­—èŠ‚**ï¼Œ**æ¯ä¸ªèŠ‚ç‚¹çš„keyä¸ªæ•°ä¸ºn**ï¼Œåˆ™ä¸€ä¸ªé¡µä¸­å› ä¸ºé”®å€¼keyå ç”¨`n*8`å­—èŠ‚
> - `(n+1)*6`ï¼šInnoDBçš„æŒ‡é’ˆ**å ç”¨6ä¸ªå­—èŠ‚**ï¼Œ**æŒ‡é’ˆæ•°é‡=key+1=åº¦æ•°**ï¼Œåˆ™ä¸€é¡µä¸­æŒ‡é’ˆå…±å ç”¨`(n+1)*6`ä¸ªå­—èŠ‚ã€‚
> - `16*1024`ï¼šä¸€é¡µçš„å¤§å°ä¸º16Kï¼Œå‡è®¾ä¸€è¡Œ-**rowçš„æ•°æ®å¤§å°ä¸º1K**,åˆ™ä¸€é¡µå…±å¯ä»¥**å­˜å‚¨16è¡Œ**ã€‚
>
> è®¡ç®—ï¼š
>
> â€‹		n * 8 + (n + 1) * 6 = 16*1024 , ç®—å‡ºnçº¦ä¸º 1170,åˆ™æ¯é¡µä¸­å…±æœ‰1170ä¸ªkey
>
> â€‹		æ¯é¡µä¸­å¯¹åº”çš„æŒ‡é’ˆçš„ä¸ªæ•°ä¸ºï¼š`key+1`  ,å³1171ï¼Œ**æ¯ä¸ªæŒ‡é’ˆåˆä¼šæŒ‡å‘æ–°çš„ä¸€é¡µ**ï¼Œæ¯é¡µä¸­åˆæœ‰16è¡Œæ•°æ®ï¼Œé‚£ä¹ˆ1171* 16 = 18736
>
> ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæ ‘çš„é«˜åº¦ä¸º2ï¼Œåˆ™å¯ä»¥å­˜å‚¨ 18000 å¤šæ¡è®°å½•ã€‚
>
> ------
>
> é«˜åº¦ä¸º3ï¼š
>
> â€‹		1171 * 1171 * 16 = 21939856
>
> ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœ**æ ‘çš„é«˜åº¦ä¸º3**ï¼Œåˆ™å¯ä»¥å­˜å‚¨ **2200w å·¦å³çš„è®°å½•**ã€‚





## 2.4 ç´¢å¼•è¯­æ³•

### ï¼ˆ0ï¼‰Mysqlç´¢å¼•çš„ç±»åˆ«

MySQL æ”¯æŒå¤šç§ç´¢å¼•ç±»å‹ï¼Œæ¯ç§ç±»å‹æœ‰ä¸åŒçš„ç”¨é€”å’Œç‰¹æ€§ã€‚ä»¥ä¸‹æ˜¯ä¸»è¦çš„ç´¢å¼•ç±»åˆ«ï¼š

#### 1. ==æ™®é€šç´¢å¼• (INDEX)==

- **ç‰¹ç‚¹**ï¼š

  - æœ€åŸºæœ¬çš„ç´¢å¼•ç±»å‹ï¼Œä»…åŠ é€ŸæŸ¥è¯¢
  - å…è®¸é‡å¤å€¼å’ŒNULLå€¼

- **åˆ›å»ºæ–¹å¼**ï¼š

  ```sql
  CREATE INDEX idx_name ON table_name(column_name);
  -- æˆ–
  ALTER TABLE table_name ADD INDEX idx_name(column_name);
  ```

#### 2. ==å”¯ä¸€ç´¢å¼• (UNIQUE INDEX)==

- **ç‰¹ç‚¹**ï¼š

  - ç´¢å¼•åˆ—çš„å€¼å¿…é¡»å”¯ä¸€ï¼Œä½†å…è®¸NULLå€¼ï¼ˆNULLå¯ä»¥é‡å¤ï¼‰
  - è‡ªåŠ¨åˆ›å»ºçº¦æŸï¼Œé˜²æ­¢é‡å¤å€¼

- **åˆ›å»ºæ–¹å¼**ï¼š

  ```sql
  CREATE UNIQUE INDEX idx_name ON table_name(column_name);
  -- æˆ–
  ALTER TABLE table_name ADD UNIQUE idx_name(column_name);
  ```

#### 3. ==ä¸»é”®ç´¢å¼• (PRIMARY KEY)==

- **ç‰¹ç‚¹**ï¼š

  - ç‰¹æ®Šçš„å”¯ä¸€ç´¢å¼•ï¼Œä¸å…è®¸NULLå€¼
  - æ¯ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªä¸»é”®
  - è‡ªåŠ¨åˆ›å»ºèšé›†ç´¢å¼•ï¼ˆInnoDBå¼•æ“ï¼‰

- **åˆ›å»ºæ–¹å¼**ï¼š

  ```sql
  ALTER TABLE table_name ADD PRIMARY KEY(column_name);
  -- æˆ–å»ºè¡¨æ—¶æŒ‡å®š
  CREATE TABLE table_name (
    id INT NOT NULL,
    PRIMARY KEY (id)
  );
  ```

#### 4. å…¨æ–‡ç´¢å¼• (FULLTEXT INDEX)

- **ç‰¹ç‚¹**ï¼š

  - ä¸“é—¨ç”¨äºå…¨æ–‡æœç´¢
  - ä»…é€‚ç”¨äºMyISAMå’ŒInnoDBå¼•æ“ï¼ˆMySQL 5.6+ï¼‰
  - æ”¯æŒMATCH AGAINSTæ“ä½œ

- **åˆ›å»ºæ–¹å¼**ï¼š

  ```sql
  CREATE FULLTEXT INDEX idx_name ON table_name(column_name);
  ```

#### 5. ==ç»„åˆç´¢å¼• (å¤åˆç´¢å¼•)==

- **ç‰¹ç‚¹**ï¼š

  - **åœ¨å¤šä¸ªåˆ—ä¸Šå»ºç«‹çš„ç´¢å¼•**
  - éµå¾ª"**æœ€å·¦å‰ç¼€åŸåˆ™**"

- **åˆ›å»ºæ–¹å¼**ï¼š

  ```sql
  CREATE INDEX idx_name ON table_name(col1, col2, col3);
  ```

#### 6. ç©ºé—´ç´¢å¼• (SPATIAL INDEX)

- **ç‰¹ç‚¹**ï¼š

  - ç”¨äºåœ°ç†ç©ºé—´æ•°æ®ç±»å‹ï¼ˆGEOMETRY, POINT, LINESTRINGç­‰ï¼‰
  - ä»…MyISAMå¼•æ“æ”¯æŒï¼ˆMySQL 5.7+çš„InnoDBä¹Ÿæ”¯æŒï¼‰

- **åˆ›å»ºæ–¹å¼**ï¼š

  ```sql
  CREATE SPATIAL INDEX idx_name ON table_name(column_name);
  ```

#### ç´¢å¼•é€‰æ‹©å»ºè®®

1. ä¸»é”®åˆ—è‡ªåŠ¨åˆ›å»ºä¸»é”®ç´¢å¼•
2. é¢‘ç¹ä½œä¸ºæŸ¥è¯¢æ¡ä»¶çš„åˆ—åº”å»ºç«‹ç´¢å¼•
3. å¤–é”®åˆ—é€šå¸¸éœ€è¦ç´¢å¼•
4. é«˜é€‰æ‹©æ€§åˆ—ï¼ˆå”¯ä¸€å€¼æ¯”ä¾‹é«˜ï¼‰æ›´é€‚åˆç´¢å¼•
5. é¿å…å¯¹é¢‘ç¹æ›´æ–°çš„åˆ—å»ºè¿‡å¤šç´¢å¼•

#### æŸ¥çœ‹ç´¢å¼•ä¿¡æ¯

```sql
SHOW INDEX FROM table_name;
```

æ¯ç§ç´¢å¼•ç±»å‹éƒ½æœ‰å…¶é€‚ç”¨åœºæ™¯ï¼Œåˆç†ä½¿ç”¨å¯ä»¥æ˜¾è‘—æé«˜æŸ¥è¯¢æ€§èƒ½ï¼Œä½†è¿‡å¤šç´¢å¼•ä¼šå½±å“å†™å…¥æ€§èƒ½å¹¶å¢åŠ å­˜å‚¨ç©ºé—´ã€‚



### ï¼ˆ1ï¼‰åˆ›å»ºç´¢å¼•

```sql
CREATE [ UNIQUE | FULLTEXT ] INDEX index_name ON table_name (
index_col_name,... ) ;
```

### ï¼ˆ2ï¼‰æŸ¥çœ‹ç´¢å¼•

```sql
SHOW INDEX FROM table_name ;
```

### ï¼ˆ3ï¼‰åˆ é™¤ç´¢å¼•

```sql
DROP INDEX index_name ON table_name ;
```

### ï¼ˆ4ï¼‰æ¡ˆä¾‹æ¼”ç¤º

#### â‘ æ•°æ®å‡†å¤‡

å…ˆæ¥åˆ›å»ºä¸€å¼ è¡¨ tb_userï¼Œå¹¶ä¸”**æŸ¥è¯¢æµ‹è¯•æ•°æ®**ã€‚

```sql
create table tb_user
(
    id         int primary key auto_increment comment 'ä¸»é”®',
    name       varchar(50) not null comment 'ç”¨æˆ·å',
    phone      varchar(11) not null comment 'æ‰‹æœºå·',
    email      varchar(100) comment 'é‚®ç®±',
    profession varchar(11) comment 'ä¸“ä¸š',
    age        tinyint unsigned comment 'å¹´é¾„',
    gender     char(1) comment 'æ€§åˆ« , 1: ç”·, 2: å¥³',
    status     char(1) comment 'çŠ¶æ€',
    createtime datetime comment 'åˆ›å»ºæ—¶é—´'
) comment 'ç³»ç»Ÿç”¨æˆ·è¡¨';
INSERT INTO tb_user (name, phone, email, profession, age, gender, status, createtime)
VALUES ('å•å¸ƒ', '17799990000', 'lvbu666@163.com', 'è½¯ä»¶å·¥ç¨‹', 23, '1', '6', '2001-02-02 00:00:00');
INSERT INTO tb_user (name, phone, email, profession, age, gender, status, createtime)
VALUES ('æ›¹æ“', '17799990001', 'caocao666@qq.com', 'é€šè®¯å·¥ç¨‹', 33, '1', '0', '2001-03-05 00:00:00');
INSERT INTO tb_user (name, phone, email, profession, age, gender, status, createtime)
VALUES ('èµµäº‘', '17799990002', '17799990@139.com', 'è‹±è¯­', 34, '1', '2', '2002-03-02 00:00:00');
INSERT INTO tb_user (name, phone, email, profession, age, gender, status, createtime)
VALUES ('å­™æ‚Ÿç©º', '17799990003', '17799990@sina.com', 'å·¥ç¨‹é€ ä»·', 54, '1', '0', '2001-07-02 00:00:00');
INSERT INTO tb_user (name, phone, email, profession, age, gender, status, createtime)
VALUES ('èŠ±æœ¨å…°', '17799990004', '19980729@sina.com', 'è½¯ä»¶å·¥ç¨‹', 23, '2', '1', '2001-04-22 00:00:00');
INSERT INTO tb_user (name, phone, email, profession, age, gender, status, createtime)
VALUES ('å¤§ä¹”', '17799990005', 'daqiao666@sina.com', 'èˆè¹ˆ', 22, '2', '0', '2001-02-07 00:00:00');
INSERT INTO tb_user (name, phone, email, profession, age, gender, status, createtime)
VALUES ('éœ²å¨œ', '17799990006', 'luna_love@sina.com', 'åº”ç”¨æ•°å­¦', 24, '2', '0', '2001-02-08 00:00:00');
INSERT INTO tb_user (name, phone, email, profession, age, gender, status, createtime)
VALUES ('ç¨‹å’¬é‡‘', '17799990007', 'chengyaojin@163.com', 'åŒ–å·¥', 38, '1', '5', '2001-05-23 00:00:00');
INSERT INTO tb_user (name, phone, email, profession, age, gender, status, createtime)
VALUES ('é¡¹ç¾½', '17799990008', 'xiaoyu666@qq.com', 'é‡‘å±ææ–™', 43, '1', '0', '2001-09-18 00:00:00');
INSERT INTO tb_user (name, phone, email, profession, age, gender, status, createtime)
VALUES ('ç™½èµ·', '17799990009', 'baiqi666@sina.com', 'æœºæ¢°å·¥ç¨‹åŠå…¶è‡ªåŠ¨åŒ–', 27, '1', '2', '2001-08-16 00:00:00');
INSERT INTO tb_user (name, phone, email, profession, age, gender, status, createtime)
VALUES ('éŸ©ä¿¡', '17799990010', 'hanxin520@163.com', 'æ— æœºéé‡‘å±ææ–™å·¥ç¨‹', 27, '1', '0', '2001-06-12 00:00:00');
INSERT INTO tb_user (name, phone, email, profession, age, gender, status, createtime)
VALUES ('è†è½²', '17799990011', 'jingke123@163.com', 'ä¼šè®¡', 29, '1', '0', '2001-05-11 00:00:00');
INSERT INTO tb_user (name, phone, email, profession, age, gender, status, createtime)
VALUES ('å…°é™µç‹', '17799990012', 'lanlinwang666@126.com', 'å·¥ç¨‹é€ ä»·', 44, '1', '1', '2001-04-09 00:00:00');
INSERT INTO tb_user (name, phone, email, profession, age, gender, status, createtime)
VALUES ('ç‹‚é“', '17799990013', 'kuangtie@sina.com', 'åº”ç”¨æ•°å­¦', 43, '1', '2', '2001-04-10 00:00:00');
INSERT INTO tb_user (name, phone, email, profession, age, gender, status, createtime)
VALUES ('è²‚è‰', '17799990014', '84958948374@qq.com', 'è½¯ä»¶å·¥ç¨‹', 40, '2', '3', '2001-02-12 00:00:00');
INSERT INTO tb_user (name, phone, email, profession, age, gender, status, createtime)
VALUES ('å¦²å·±', '17799990015', '2783238293@qq.com', 'è½¯ä»¶å·¥ç¨‹', 31, '2', '0', '2001-01-30 00:00:00');
INSERT INTO tb_user (name, phone, email, profession, age, gender, status, createtime)
VALUES ('èŠˆæœˆ', '17799990016', 'xiaomin2001@sina.com', 'å·¥ä¸šç»æµ', 35, '2', '0', '2000-05-03 00:00:00');
INSERT INTO tb_user (name, phone, email, profession, age, gender, status, createtime)
VALUES ('å¬´æ”¿', '17799990017', '8839434342@qq.com', 'åŒ–å·¥', 38, '1', '1', '2001-08-08 00:00:00');
INSERT INTO tb_user (name, phone, email, profession, age, gender, status, createtime)
VALUES ('ç‹„ä»æ°', '17799990018', 'jujiamlm8166@163.com', 'å›½é™…è´¸æ˜“', 30, '1', '0', '2007-03-12 00:00:00');
INSERT INTO tb_user (name, phone, email, profession, age, gender, status, createtime)
VALUES ('å®‰çªæ‹‰', '17799990019', 'jdodm1h@126.com', 'åŸå¸‚è§„åˆ’', 51, '2', '0', '2001-08-15 00:00:00');
INSERT INTO tb_user (name, phone, email, profession, age, gender, status, createtime)
VALUES ('å…¸éŸ¦', '17799990020', 'ycaunanjian@163.com', 'åŸå¸‚è§„åˆ’', 52, '1', '2', '2000-04-12 00:00:00');
INSERT INTO tb_user (name, phone, email, profession, age, gender, status, createtime)
VALUES ('å»‰é¢‡', '17799990021', 'lianpo321@126.com', 'åœŸæœ¨å·¥ç¨‹', 19, '1', '3', '2002-07-18 00:00:00');
INSERT INTO tb_user (name, phone, email, profession, age, gender, status, createtime)
VALUES ('åç¾¿', '17799990022', 'altycj2000@139.com', 'åŸå¸‚å›­æ—', 20, '1', '0', '2002-03-10 00:00:00');
INSERT INTO tb_user (name, phone, email, profession, age, gender, status, createtime)
VALUES ('å§œå­ç‰™', '17799990023', '37483844@qq.com', 'å·¥ç¨‹é€ ä»·', 29, '1', '4', '2003-05-26 00:00:00');
```

è¡¨ç»“æ„ä¸­æ’å…¥çš„æ•°æ®å¦‚ä¸‹ï¼š

<img src="./Mysql-Learning-Local.assets/image-20250415150604769.png" alt="image-20250415150604769" style="zoom: 67%;" />

<img src="./Mysql-Learning-Local.assets/image-20250415153026874.png" alt="image-20250415153026874" style="zoom: 67%;" />

```sql
show index from tb_user;
show index from tb_user\G; #ç¾åŒ–è¾“å‡º
```

![image-20250415153359543](./Mysql-Learning-Local.assets/image-20250415153359543.png)



#### â‘¡å®Œæˆéœ€æ±‚

<img src="./Mysql-Learning-Local.assets/image-20250415152812037.png" alt="image-20250415152812037" style="zoom: 80%;" />

æ•°æ®å‡†å¤‡å¥½äº†ä¹‹åï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æ¥å®Œæˆå¦‚ä¸‹éœ€æ±‚ï¼š

##### A. nameå­—æ®µä¸ºå§“åå­—æ®µï¼Œè¯¥å­—æ®µçš„å€¼å¯èƒ½ä¼šé‡å¤ï¼Œä¸ºè¯¥å­—æ®µåˆ›å»ºç´¢å¼•ï¼ˆæ™®é€šç´¢å¼•ï¼‰ã€‚

```sql
CREATE INDEX idx_user_name ON tb_user(name); 
```

<img src="./Mysql-Learning-Local.assets/image-20250415153627713.png" alt="image-20250415153627713" style="zoom:80%;" />

##### B. phoneæ‰‹æœºå·å­—æ®µçš„å€¼ï¼Œæ˜¯éç©ºï¼Œä¸”å”¯ä¸€çš„ï¼Œä¸ºè¯¥å­—æ®µåˆ›å»º==å”¯ä¸€ç´¢å¼•==ã€‚

```sql
CREATE UNIQUE INDEX idx_user_phone ON tb_user(phone); 
```

![image-20250415153706674](./Mysql-Learning-Local.assets/image-20250415153706674.png)

##### C. ä¸ºprofessionã€ageã€status==åˆ›å»ºè”åˆç´¢å¼•==ã€‚

```sql
CREATE INDEX idx_user_pro_age_sta ON tb_user(profession,age,status); 
```

<img src="./Mysql-Learning-Local.assets/image-20250415153807892.png" alt="image-20250415153807892" style="zoom: 80%;" />

##### D. ä¸ºemailå»ºç«‹åˆé€‚çš„ç´¢å¼•ï¼ˆæ™®é€šç´¢å¼•ï¼‰æ¥æå‡æŸ¥è¯¢æ•ˆç‡ã€‚

```sql
CREATE INDEX idx_email ON tb_user(email); 
```

![image-20250415153915410](./Mysql-Learning-Local.assets/image-20250415153915410.png)

##### å®Œæˆä¸Šè¿°çš„éœ€æ±‚ä¹‹åï¼Œæˆ‘ä»¬å†æŸ¥çœ‹tb_userè¡¨çš„æ‰€æœ‰çš„ç´¢å¼•æ•°æ®ã€‚

```sql
show index from tb_user;
```

![image-20250415154009918](./Mysql-Learning-Local.assets/image-20250415154009918.png)

![image-20250415150943997](./Mysql-Learning-Local.assets/image-20250415150943997.png)





## 2.5 ğŸŒŸ ==SQLæ€§èƒ½åˆ†æ==

### ï¼ˆ1ï¼‰SQLæ‰§è¡Œé¢‘ç‡

MySQL å®¢æˆ·ç«¯è¿æ¥æˆåŠŸåï¼Œé€šè¿‡ **show [session|global] status å‘½ä»¤**å¯ä»¥**æä¾›æœåŠ¡å™¨çŠ¶æ€ä¿¡æ¯**ã€‚é€šè¿‡å¦‚ä¸‹æŒ‡ä»¤ï¼Œå¯ä»¥æŸ¥çœ‹å½“å‰æ•°æ®åº“çš„INSERTã€UPDATEã€DELETEã€SELECTçš„è®¿é—®é¢‘æ¬¡ï¼š

```sql
-- session æ˜¯æŸ¥çœ‹å½“å‰ä¼šè¯ ;
-- global æ˜¯æŸ¥è¯¢å…¨å±€æ•°æ® ;
SHOW GLOBAL STATUS LIKE 'Com_______';

SHOW SESSION STATUS LIKE 'Com_______';
```

![image-20250415151059539](./Mysql-Learning-Local.assets/image-20250415151059539.png)

![image-20250415154524748](./Mysql-Learning-Local.assets/image-20250415154524748.png)

- Com_delete: åˆ é™¤æ¬¡æ•°
- Com_insert: æ’å…¥æ¬¡æ•°
- Com_select: æŸ¥è¯¢æ¬¡æ•°
- Com_update: æ›´æ–°æ¬¡æ•°

æˆ‘ä»¬å¯ä»¥åœ¨å½“å‰æ•°æ®åº“å†æ‰§è¡Œå‡ æ¬¡æŸ¥è¯¢æ“ä½œï¼Œç„¶åå†æ¬¡æŸ¥çœ‹æ‰§è¡Œé¢‘æ¬¡ï¼Œçœ‹çœ‹ Com_select å‚æ•°ä¼šä¸ä¼šå˜åŒ–ã€‚

> é€šè¿‡ä¸Šè¿°æŒ‡ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹åˆ°å½“å‰æ•°æ®åº“åˆ°åº•æ˜¯**ä»¥æŸ¥è¯¢ä¸ºä¸»**ï¼Œè¿˜æ˜¯ä»¥å¢åˆ æ”¹ä¸ºä¸»ï¼Œä»è€Œä¸ºæ•°æ®åº“ä¼˜åŒ–æä¾›å‚è€ƒä¾æ®ã€‚ å¦‚æœæ˜¯ä»¥å¢åˆ æ”¹ä¸ºä¸»ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ä¸å¯¹å…¶è¿›è¡Œç´¢å¼•çš„ä¼˜åŒ–ã€‚ å¦‚æœæ˜¯ä»¥æŸ¥è¯¢ä¸ºä¸»ï¼Œé‚£ä¹ˆå°±**è¦è€ƒè™‘å¯¹æ•°æ®åº“çš„ç´¢å¼•è¿›è¡Œä¼˜åŒ–äº†**ã€‚

é‚£ä¹ˆé€šè¿‡æŸ¥è¯¢SQLçš„æ‰§è¡Œé¢‘æ¬¡ï¼Œæˆ‘ä»¬å°±èƒ½å¤ŸçŸ¥é“å½“å‰æ•°æ®åº“åˆ°åº•æ˜¯å¢åˆ æ”¹ä¸ºä¸»ï¼Œè¿˜æ˜¯æŸ¥è¯¢ä¸ºä¸»ã€‚ é‚£**å‡å¦‚è¯´æ˜¯ä»¥æŸ¥è¯¢ä¸ºä¸»**ï¼Œæˆ‘ä»¬åˆè¯¥**å¦‚ä½•å®šä½é’ˆå¯¹äºé‚£äº›æŸ¥è¯¢è¯­å¥è¿›è¡Œä¼˜åŒ–**å‘¢ï¼Ÿ **æ¬¡æ•°æˆ‘ä»¬å¯ä»¥å€ŸåŠ©äº==æ…¢æŸ¥è¯¢æ—¥å¿—==**ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æ¥ä»‹ç»ä¸€ä¸‹MySQLä¸­çš„æ…¢æŸ¥è¯¢æ—¥å¿—ã€‚



### ï¼ˆ2ï¼‰ğŸŒŸ ==æ…¢æŸ¥è¯¢æ—¥å¿—==

#### â‘ æ¦‚å¿µ

![image-20250415155713055](./Mysql-Learning-Local.assets/image-20250415155713055.png)

æ…¢æŸ¥è¯¢æ—¥å¿—è®°å½•äº†**æ‰€æœ‰æ‰§è¡Œæ—¶é—´è¶…è¿‡æŒ‡å®šå‚æ•°**ï¼ˆ**==long_query_time==**ï¼Œå•ä½ï¼šç§’ï¼Œé»˜è®¤10ç§’ï¼‰çš„**æ‰€æœ‰SQLè¯­å¥çš„æ—¥å¿—ã€‚**

MySQLçš„**æ…¢æŸ¥è¯¢æ—¥å¿—é»˜è®¤æ²¡æœ‰å¼€å¯**ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹ä¸€ä¸‹ç³»ç»Ÿå˜é‡ ã€‚

**æŸ¥è¯¢æ…¢æŸ¥è¯¢æ—¥å¿—æ˜¯å¦å¼€å¯**

```sql
show variables like 'slow_query_log';
```

![image-20250415154715240](./Mysql-Learning-Local.assets/image-20250415154715240.png)



å¦‚æœè¦å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œéœ€è¦åœ¨**MySQLçš„==é…ç½®æ–‡ä»¶ï¼ˆ/etc/my.cnfï¼‰==**ä¸­é…ç½®å¦‚ä¸‹ä¿¡æ¯ï¼š

```bash
vi /etc/my.cnf
```

åœ¨è¯¥é…ç½®æ–‡ä»¶çš„**æœ€åæ·»åŠ **ï¼š

```bash
# å¼€å¯MySQLæ…¢æ—¥å¿—æŸ¥è¯¢å¼€å…³
slow_query_log=1
# è®¾ç½®æ…¢æ—¥å¿—çš„æ—¶é—´ä¸º2ç§’ï¼ŒSQLè¯­å¥æ‰§è¡Œæ—¶é—´è¶…è¿‡2ç§’ï¼Œå°±ä¼šè§†ä¸ºæ…¢æŸ¥è¯¢ï¼Œè®°å½•æ…¢æŸ¥è¯¢æ—¥å¿—
long_query_time=2
```



é…ç½®å®Œæ¯•ä¹‹åï¼Œé€šè¿‡ä»¥ä¸‹æŒ‡ä»¤**é‡æ–°å¯åŠ¨MySQLæœåŠ¡å™¨**è¿›è¡Œæµ‹è¯•ï¼ŒæŸ¥çœ‹æ…¢æ—¥å¿—æ–‡ä»¶ä¸­**è®°å½•çš„ä¿¡æ¯**

**/var/lib/mysql/localhost-slow.log**

```sql
systemctl restart mysqld
```

ç„¶åï¼Œå†æ¬¡æŸ¥çœ‹å¼€å…³æƒ…å†µï¼Œæ…¢æŸ¥è¯¢æ—¥å¿—å°±å·²ç»æ‰“å¼€äº†ã€‚

![image-20250415155053391](./Mysql-Learning-Local.assets/image-20250415155053391.png)



æŸ¥çœ‹æ…¢æ—¥å¿—æ–‡ä»¶ä¸­**è®°å½•çš„ä¿¡æ¯**ï¼Œ**/var/lib/mysql/localhost-slow.log**

```bash
cat /var/lib/mysql/localhost-slow.log
tail -f /var/lib/mysql/localhost-slow.log #è¿½åŠ æ¨¡å¼æŸ¥çœ‹æ—¥å¿—ä¿¡æ¯
```



#### â‘¡æµ‹è¯•

##### 1ï¼‰æ•°æ®å‡†å¤‡

```sql
CREATE TABLE `tb_sku` (
    `id` int(11) NOT NULL AUTO_INCREMENT COMMENT 'å•†å“id',
    `sn` varchar(100) NOT NULL COMMENT 'å•†å“æ¡ç ',
    `name` varchar(200) NOT NULL COMMENT 'SKUåç§°',
    `price` int(20) NOT NULL COMMENT 'ä»·æ ¼ï¼ˆåˆ†ï¼‰',
    `num` int(10) NOT NULL COMMENT 'åº“å­˜æ•°é‡',
    `alert_num` int(11) DEFAULT NULL COMMENT 'åº“å­˜é¢„è­¦æ•°é‡',
    `image` varchar(200) DEFAULT NULL COMMENT 'å•†å“å›¾ç‰‡',
    `images` varchar(2000) DEFAULT NULL COMMENT 'å•†å“å›¾ç‰‡åˆ—è¡¨',
    `weight` int(11) DEFAULT NULL COMMENT 'é‡é‡ï¼ˆå…‹ï¼‰',
    `create_time` datetime DEFAULT NULL COMMENT 'åˆ›å»ºæ—¶é—´',
    `update_time` datetime DEFAULT NULL COMMENT 'æ›´æ–°æ—¶é—´',
    `category_name` varchar(200) DEFAULT NULL COMMENT 'ç±»ç›®åç§°',
    `brand_name` varchar(100) DEFAULT NULL COMMENT 'å“ç‰Œåç§°',
    `spec` varchar(200) DEFAULT NULL COMMENT 'è§„æ ¼',
    `sale_num` int(11) DEFAULT '0' COMMENT 'é”€é‡',
    `comment_num` int(11) DEFAULT '0' COMMENT 'è¯„è®ºæ•°',
    `status` char(1) DEFAULT '1' COMMENT 'å•†å“çŠ¶æ€ 1-æ­£å¸¸ï¼Œ2-ä¸‹æ¶ï¼Œ3-åˆ é™¤',
    PRIMARY KEY (`id`) USING BTREE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='å•†å“è¡¨';

```

<img src="./Mysql-Learning-Local.assets/image-20250415160544889.png" alt="image-20250415160544889" style="zoom: 80%;" />

```bash
load data local infile '/root/sql/tb_sku1.sql' into table `tb_sku` fields terminated by ',' lines terminated by '\n';


æ³¨æ„ : 
	åœ¨mysqlå‘½ä»¤è¡Œä¸­æ‰§è¡ŒloadæŒ‡ä»¤ï¼Œ
	ç”±äº1000wçš„æ•°æ®é‡è¾ƒå¤§ , å¦‚æœç›´æ¥åŠ è½½1000w , ä¼šéå¸¸è€—è´¹CPUåŠå†…å­˜ ; 
	
	å·²ç»æ‹†åˆ†ä¸º5ä¸ªéƒ¨åˆ† , æ¯ä¸€ä¸ªéƒ¨åˆ†ä¸º200wæ•°æ® , load 5æ¬¡å³å¯ ;
```

###### ç¡®ä¿æ‰€æœ‰å¿…è¦çš„è®¾ç½®å·²å¯ç”¨

**åœ¨å®¢æˆ·ç«¯è¿æ¥æ—¶å¯ç”¨local_infileå¹¶æŒ‡å®šå…è®¸åŠ è½½çš„æ–‡ä»¶ï¼š**

```bash
mysql --local-infile=1 --enable-local-infile -u username -p
```

**åœ¨MySQLå®¢æˆ·ç«¯ä¸­æ‰§è¡Œï¼š**

```sql
SET GLOBAL local_infile = 1;
```

![image-20250415160850985](./Mysql-Learning-Local.assets/image-20250415160850985.png)





##### 2ï¼‰æ‰§è¡Œæµ‹è¯•

###### A. æ‰§è¡Œå¦‚ä¸‹SQLè¯­å¥ ï¼š

```sql
select * from tb_user; -- è¿™æ¡SQLæ‰§è¡Œæ•ˆç‡æ¯”è¾ƒé«˜, æ‰§è¡Œè€—æ—¶ 0.00sec
select count(*) from tb_sku; -- ç”±äºtb_skuè¡¨ä¸­, é¢„å…ˆå­˜å…¥äº†1000wçš„è®°å½•, countä¸€æ¬¡,è€—æ—¶13.35sec
```

<img src="./Mysql-Learning-Local.assets/image-20250415160844552.png" alt="image-20250415160844552" style="zoom:67%;" />

###### B. æ£€æŸ¥æ…¢æŸ¥è¯¢æ—¥å¿— ï¼š

æœ€ç»ˆæˆ‘ä»¬å‘ç°ï¼Œåœ¨æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­ï¼Œåªä¼šè®°å½•æ‰§è¡Œæ—¶é—´è¶…è¿‡æˆ‘ä»¬é¢„è®¾æ—¶é—´ï¼ˆ2sï¼‰çš„SQLï¼Œ**æ‰§è¡Œè¾ƒå¿«çš„SQL**æ˜¯ä¸ä¼šè®°å½•çš„ã€‚

![image-20250415161054785](./Mysql-Learning-Local.assets/image-20250415161054785.png)

![image-20250415161129255](./Mysql-Learning-Local.assets/image-20250415161129255.png)

é‚£è¿™æ ·ï¼Œé€šè¿‡æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œå°±å¯ä»¥**å®šä½å‡ºæ‰§è¡Œæ•ˆç‡æ¯”è¾ƒä½çš„SQL**ï¼Œä»è€Œæœ‰é’ˆå¯¹æ€§çš„è¿›è¡Œä¼˜åŒ–ã€‚



### ï¼ˆ3ï¼‰profileè¯¦æƒ…

![image-20250415161803597](./Mysql-Learning-Local.assets/image-20250415161803597.png)

show profiles èƒ½å¤Ÿåœ¨åšSQLä¼˜åŒ–æ—¶å¸®åŠ©æˆ‘ä»¬**äº†è§£==æ—¶é—´éƒ½è€—è´¹åˆ°å“ªé‡Œå»==**äº†ã€‚é€šè¿‡**have_profilingå‚æ•°**ï¼Œèƒ½å¤Ÿçœ‹åˆ°å½“å‰MySQLæ˜¯å¦æ”¯æŒprofileæ“ä½œï¼š

```sql
SELECT @@have_profiling ;
```

![image-20250415161250158](./Mysql-Learning-Local.assets/image-20250415161250158.png)

å¯ä»¥çœ‹åˆ°ï¼Œå½“å‰MySQLæ˜¯æ”¯æŒ profileæ“ä½œçš„ï¼Œä½†æ˜¯å¼€å…³æ˜¯å…³é—­çš„ã€‚å¯ä»¥é€šè¿‡**setè¯­å¥åœ¨session/globalçº§åˆ«å¼€å¯profiling**ï¼š

```sql
SET profiling = 1;
```

å¼€å…³å·²ç»æ‰“å¼€äº†ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ‰€æ‰§è¡Œçš„SQLè¯­å¥ï¼Œéƒ½ä¼šè¢«MySQLè®°å½•ï¼Œå¹¶è®°å½•æ‰§è¡Œæ—¶é—´æ¶ˆè€—åˆ°å“ªå„¿å»äº†ã€‚ æˆ‘ä»¬ç›´æ¥æ‰§è¡Œå¦‚ä¸‹çš„SQLè¯­å¥ï¼š

```sql
select * from tb_user;
select * from tb_user where id = 1;
select * from tb_user where name = 'ç™½èµ·';
select count(*) from tb_sku;
```



æ‰§è¡Œä¸€ç³»åˆ—çš„ä¸šåŠ¡SQLçš„æ“ä½œï¼Œç„¶åé€šè¿‡å¦‚ä¸‹æŒ‡ä»¤æŸ¥çœ‹æŒ‡ä»¤çš„æ‰§è¡Œè€—æ—¶ï¼š

```sql
-- æŸ¥çœ‹æ¯ä¸€æ¡SQLçš„è€—æ—¶åŸºæœ¬æƒ…å†µ
show profiles;

-- æŸ¥çœ‹æŒ‡å®šquery_idçš„SQLè¯­å¥å„ä¸ªé˜¶æ®µçš„è€—æ—¶æƒ…å†µ
show profile for query query_id;

-- æŸ¥çœ‹æŒ‡å®šquery_idçš„SQLè¯­å¥CPUçš„ä½¿ç”¨æƒ…å†µ
show profile cpu for query query_id;
```

æŸ¥çœ‹æ¯ä¸€æ¡SQLçš„è€—æ—¶æƒ…å†µ:

![image-20250415161553673](./Mysql-Learning-Local.assets/image-20250415161553673.png)

æŸ¥çœ‹æŒ‡å®šSQLå„ä¸ªé˜¶æ®µçš„è€—æ—¶æƒ…å†µ :

![image-20250415161636085](./Mysql-Learning-Local.assets/image-20250415161636085.png)

**æŸ¥çœ‹æŒ‡å®šSQL-CPUçš„è€—æ—¶æƒ…å†µ**

<img src="./Mysql-Learning-Local.assets/image-20250415161749241.png" alt="image-20250415161749241" style="zoom:80%;" />



### ï¼ˆ4ï¼‰ğŸŒŸ ==explain==

![image-20250415162740030](./Mysql-Learning-Local.assets/image-20250415162740030.png)

**EXPLAIN æˆ–è€… DESCå‘½ä»¤**è·å– MySQL **==å¦‚ä½•æ‰§è¡Œ SELECT è¯­å¥çš„ä¿¡æ¯==**ï¼ŒåŒ…æ‹¬åœ¨ SELECT è¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­**è¡¨å¦‚ä½•è¿æ¥å’Œè¿æ¥çš„é¡ºåº**ã€‚

#### â‘ è¯­æ³•

```sql
-- ç›´æ¥åœ¨selectè¯­å¥ä¹‹å‰åŠ ä¸Šå…³é”®å­— explain / desc
EXPLAIN SELECT å­—æ®µåˆ—è¡¨ FROM è¡¨å WHERE æ¡ä»¶ ;
```



#### â‘¡Explain æ‰§è¡Œè®¡åˆ’ä¸­å„ä¸ªå­—æ®µçš„==å«ä¹‰==

<img src="./Mysql-Learning-Local.assets/image-20250415152030804.png" alt="image-20250415152030804" style="zoom: 80%;" />



#### â‘¢æ¡ˆä¾‹SCè¡¨

```sql
create table student(
    id   int auto_increment comment 'ä¸»é”®ID' primary key,
    name varchar(10) null comment 'å§“å',
    no   varchar(10) null comment 'å­¦å·'
)comment 'å­¦ç”Ÿè¡¨';
INSERT INTO student (name, no) VALUES ('é»›ç»®ä¸', '2000100101');
INSERT INTO student (name, no) VALUES ('è°¢é€Š', '2000100102');
INSERT INTO student (name, no) VALUES ('æ®·å¤©æ­£', '2000100103');
INSERT INTO student (name, no) VALUES ('éŸ¦ä¸€ç¬‘', '2000100104');

create table course(
    id int auto_increment comment 'ä¸»é”®ID' primary key,
    name varchar(10) null comment 'è¯¾ç¨‹åç§°'
)comment 'è¯¾ç¨‹è¡¨';
INSERT INTO course (name) VALUES ('Java');
INSERT INTO course (name) VALUES ('PHP');
INSERT INTO course (name) VALUES ('MySQL');
INSERT INTO course (name) VALUES ('Hadoop');

create table student_course(
    id int auto_increment comment 'ä¸»é”®' primary key,
    studentid int not null comment 'å­¦ç”ŸID',
    courseid  int not null comment 'è¯¾ç¨‹ID',
    constraint fk_courseid foreign key (courseid) references course (id),
    constraint fk_studentid foreign key (studentid) references student (id)
)comment 'å­¦ç”Ÿè¯¾ç¨‹ä¸­é—´è¡¨';
INSERT INTO student_course (studentid, courseid) VALUES (1, 1);
INSERT INTO student_course (studentid, courseid) VALUES (1, 2);
INSERT INTO student_course (studentid, courseid) VALUES (1, 3);
INSERT INTO student_course (studentid, courseid) VALUES (2, 2);
INSERT INTO student_course (studentid, courseid) VALUES (2, 3);
INSERT INTO student_course (studentid, courseid) VALUES (3, 4);
```

##### 1ï¼‰æŸ¥è¯¢æ‰€æœ‰å­¦ç”Ÿçš„é€‰è¯¾æƒ…å†µ

```sql
Select * from student s , course c, student_course sc where s.id = sc.studentid and c.id = sc.courseid;
```

![image-20250415163532781](./Mysql-Learning-Local.assets/image-20250415163532781.png)

![image-20250415163509753](./Mysql-Learning-Local.assets/image-20250415163509753.png)

![image-20250415163546066](./Mysql-Learning-Local.assets/image-20250415163546066.png)



##### 2ï¼‰æŸ¥è¯¢é€‰ä¿®äº† MySQL è¯¾ç¨‹çš„å­¦ç”Ÿ (å­æŸ¥è¯¢)

**é€šè¿‡å­æŸ¥è¯¢è§‚å¯Ÿexplainç»“æœä¸­idçš„é¡ºåº**

```sql
#æŸ¥è¯¢MySQLå¯¹åº”çš„è¯¾ç¨‹id
select c.id from course c where c.name = 'MySQL');

#æŸ¥è¯¢é€‰ä¿®äº†mysqlè¯¾ç¨‹id çš„å­¦ç”Ÿid
select sc.studentid from student_course sc where sc.courseid in (1,2,3);

#æŸ¥è¯¢é€‰ä¿®äº† MySQL è¯¾ç¨‹çš„å­¦ç”Ÿ (å­æŸ¥è¯¢)
Select s.*
from student s
where s.id in
      (select sc.studentid from student_course sc where sc.courseid in (select c.id from course c where c.name = 'MySQL'));
```



![image-20250415164815860](./Mysql-Learning-Local.assets/image-20250415164815860.png)



### ï¼ˆ5ï¼‰==explain è¾“å‡ºåˆ—è¯¦è§£==

å½“ä½ ä½¿ç”¨ `EXPLAIN` åˆ†æ SELECT è¯­å¥æ—¶ï¼ŒMySQL ä¼šè¿”å›ä¸€ä¸ªåŒ…å«å¤šåˆ—çš„ç»“æœé›†ï¼Œæ¯åˆ—éƒ½æä¾›äº†æŸ¥è¯¢æ‰§è¡Œè®¡åˆ’çš„é‡è¦ä¿¡æ¯ã€‚ä»¥ä¸‹æ˜¯å„åˆ—çš„è¯¦ç»†è§£é‡Šï¼š

<img src="./Mysql-Learning-Local.assets/image-20250415152030804.png" alt="image-20250415152030804" style="zoom: 80%;" />

#### æ ¸å¿ƒåˆ—è¯´æ˜

#### 1. **id** (æŸ¥è¯¢æ ‡è¯†ç¬¦)

- è¡¨ç¤º SELECT æŸ¥è¯¢çš„åºåˆ—å·

- ç›¸åŒ id è¡¨ç¤ºåŒä¸€æŸ¥è¯¢å±‚çº§ï¼Œæ‰§è¡Œé¡ºåºä»ä¸Šè‡³ä¸‹

- æ•°å­—è¶Šå¤§æ‰§è¡Œä¼˜å…ˆçº§è¶Šé«˜

- id ä¸º NULL **è¡¨ç¤ºæ˜¯ç»“æœé›†**ï¼ˆå¦‚ UNION ç»“æœï¼‰

  

#### 2. **select_type** (æŸ¥è¯¢ç±»å‹)

| ç±»å‹               | è¯´æ˜                             |
| ------------------ | -------------------------------- |
| SIMPLE             | ç®€å•æŸ¥è¯¢ï¼ˆä¸åŒ…å«å­æŸ¥è¯¢æˆ– UNIONï¼‰ |
| PRIMARY            | æœ€å¤–å±‚æŸ¥è¯¢                       |
| SUBQUERY           | å­æŸ¥è¯¢ä¸­çš„**ç¬¬ä¸€ä¸ª SELECT**      |
| DERIVED            | æ´¾ç”Ÿè¡¨ï¼ˆFROM å­å¥ä¸­çš„å­æŸ¥è¯¢ï¼‰    |
| UNION              | UNION ä¸­çš„ç¬¬äºŒä¸ªæˆ–åç»­æŸ¥è¯¢       |
| UNION RESULT       | UNION çš„ç»“æœé›†                   |
| DEPENDENT SUBQUERY | ä¾èµ–å¤–éƒ¨æŸ¥è¯¢çš„å­æŸ¥è¯¢             |
| MATERIALIZED       | ç‰©åŒ–å­æŸ¥è¯¢                       |

#### 3. **table** (è®¿é—®çš„è¡¨)

- æ˜¾ç¤ºæŸ¥è¯¢æ¶‰åŠçš„è¡¨å
- å¯èƒ½æ˜¯**å®é™…è¡¨åã€åˆ«åæˆ–ä¸´æ—¶è¡¨å**
- `<derivedN>` è¡¨ç¤ºæ´¾ç”Ÿè¡¨ï¼ˆN å¯¹åº” idï¼‰
- `<unionM,N>` è¡¨ç¤º UNION ç»“æœï¼ˆM,N å¯¹åº” idï¼‰



#### 4. **partitions** (åŒ¹é…çš„åˆ†åŒº)

- æŸ¥è¯¢åŒ¹é…çš„åˆ†åŒºï¼ˆä»…**åˆ†åŒºè¡¨æœ‰æ•ˆ**ï¼‰
- NULL è¡¨ç¤ºæœªåˆ†åŒºè¡¨



#### 5. ==type== (è®¿é—®ç±»å‹ï¼Œé‡è¦ï¼)

##### â‘ æ€§èƒ½åˆ†æ

è¡¨ç¤º MySQL å¦‚ä½•æŸ¥æ‰¾è¡¨ä¸­çš„è¡Œï¼Œ**==ä»ä¼˜åˆ°åŠ£==æ’åº**ï¼š

| ç±»å‹            | è¯´æ˜                           | æ€§èƒ½     |
| --------------- | ------------------------------ | -------- |
| system          | è¡¨åªæœ‰ä¸€è¡Œï¼ˆç³»ç»Ÿè¡¨ï¼‰           | æœ€ä½³     |
| const           | é€šè¿‡ä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•ä¸€æ¬¡æŸ¥è¯¢     | ä¼˜       |
| eq_ref          | å…³è”æŸ¥è¯¢ä¸­ä¸»é”®/å”¯ä¸€ç´¢å¼•åŒ¹é…    | ä¼˜       |
| ref             | éå”¯ä¸€ç´¢å¼•æŸ¥æ‰¾ï¼ˆ**è”åˆç´¢å¼•**ï¼‰ | è‰¯       |
| fulltext        | å…¨æ–‡ç´¢å¼•æŸ¥æ‰¾                   | ç‰¹æ®Š     |
| ref_or_null     | ç±»ä¼¼ refï¼Œä½†åŒ…å« NULL å€¼       | è‰¯       |
| index_merge     | ç´¢å¼•åˆå¹¶ä¼˜åŒ–                   | è‰¯       |
| unique_subquery | å­æŸ¥è¯¢ä½¿ç”¨å”¯ä¸€ç´¢å¼•             | è‰¯       |
| index_subquery  | å­æŸ¥è¯¢ä½¿ç”¨æ™®é€šç´¢å¼•             | ä¸­       |
| range           | ç´¢å¼•èŒƒå›´æ‰«æ                   | ä¸­       |
| index           | å…¨ç´¢å¼•æ‰«æ                     | å·®       |
| ==ALL==         | **å…¨è¡¨æ‰«æ**                   | **æœ€å·®** |

**ä¸šåŠ¡SQL**å‡ ä¹ä¸å¯èƒ½å‡ºç°**type=null**çš„æƒ…å†µï¼Œé™¤éç›´æ¥æ‰§è¡Œ`select 'A'`ã€‚

![image-20250415170218450](./Mysql-Learning-Local.assets/image-20250415170218450.png)



#### 6. **possible_keys** (å¯èƒ½ä½¿ç”¨çš„ç´¢å¼•)

- æŸ¥è¯¢å¯èƒ½ä½¿ç”¨çš„ç´¢å¼•åˆ—è¡¨
- NULL è¡¨ç¤ºæ²¡æœ‰ç›¸å…³ç´¢å¼•



#### 7. **key** (å®é™…ä½¿ç”¨çš„ç´¢å¼•)

- MySQL å®é™…å†³å®šä½¿ç”¨çš„ç´¢å¼•
- NULL è¡¨ç¤ºæœªä½¿ç”¨ç´¢å¼•
- å¯èƒ½ä¸åœ¨ possible_keys ä¸­ï¼ˆä¼˜åŒ–å™¨é€‰æ‹©ï¼‰



#### 8. **key_len** (ä½¿ç”¨çš„ç´¢å¼•é•¿åº¦)

- è¡¨ç¤ºç´¢å¼•ä¸­ä½¿ç”¨çš„å­—èŠ‚æ•°ï¼Œè¯¥å€¼ä¸ºç´¢å¼•å­—æ®µæœ€å¤§å¯èƒ½é•¿åº¦ï¼Œå¹¶éå®é™…ä½¿ç”¨é•¿
  åº¦ï¼Œåœ¨ä¸æŸå¤±ç²¾ç¡®æ€§çš„å‰æä¸‹ï¼Œé•¿åº¦è¶ŠçŸ­è¶Šå¥½ã€‚
- å¯åˆ¤æ–­æ˜¯å¦ä½¿ç”¨äº†ç´¢å¼•çš„å…¨éƒ¨éƒ¨åˆ†
- è®¡ç®—å…¬å¼ï¼šåˆ—å®šä¹‰é•¿åº¦ + NULL(1) + å˜é•¿(2)



#### 9. **ref** (ç´¢å¼•å¼•ç”¨)

- æ˜¾ç¤ºç´¢å¼•çš„**å“ªä¸€åˆ—è¢«ä½¿ç”¨**äº†
- å¯èƒ½æ˜¯ï¼šconstã€funcã€åˆ—åç­‰



#### 10. **rows** (é¢„ä¼°æ£€æŸ¥è¡Œæ•°)

- MySQL ä¼°è®¡è¦æ£€æŸ¥çš„è¡Œæ•°ï¼ˆä¸æ˜¯ç²¾ç¡®å€¼ï¼‰
- é‡è¦ä¼˜åŒ–æŒ‡æ ‡
- MySQL**è®¤ä¸ºå¿…é¡»è¦æ‰§è¡ŒæŸ¥è¯¢çš„è¡Œæ•°**ï¼Œåœ¨innodbå¼•æ“çš„è¡¨ä¸­ï¼Œæ˜¯ä¸€ä¸ªä¼°è®¡å€¼ï¼Œ
  å¯èƒ½å¹¶ä¸æ€»æ˜¯å‡†ç¡®çš„ã€‚



#### 11. **filtered** (è¿‡æ»¤ç™¾åˆ†æ¯”)

- è¡¨ç¤ºå­˜å‚¨å¼•æ“è¿”å›çš„æ•°æ®åœ¨æœåŠ¡å™¨å±‚**è¿‡æ»¤åå‰©ä½™ç™¾åˆ†æ¯”**
- **100 è¡¨ç¤ºæ²¡æœ‰è¿‡æ»¤**
- è¡¨ç¤ºè¿”å›ç»“æœçš„è¡Œæ•°å éœ€è¯»å–è¡Œæ•°çš„ç™¾åˆ†æ¯”ï¼Œ**filteredçš„å€¼è¶Šå¤§è¶Šå¥½**ã€‚



#### 12. ==Extra== (é¢å¤–ä¿¡æ¯ï¼Œé‡è¦ï¼)

åŒ…å« MySQL è§£å†³æŸ¥è¯¢çš„é¢å¤–ä¿¡æ¯ï¼š

| ä¿¡æ¯                         | è¯´æ˜                       |
| ---------------------------- | -------------------------- |
| Using index                  | ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼ˆåªéœ€ç´¢å¼•ï¼‰   |
| Using where                  | æœåŠ¡å™¨å±‚è¿›è¡Œè¿‡æ»¤           |
| Using temporary              | ä½¿ç”¨ä¸´æ—¶è¡¨                 |
| Using filesort               | **ä½¿ç”¨æ–‡ä»¶æ’åºï¼ˆéœ€ä¼˜åŒ–ï¼‰** |
| Using join buffer            | ä½¿ç”¨è¿æ¥ç¼“å†²               |
| Impossible WHERE             | WHERE æ¡ä»¶æ°¸è¿œä¸æˆç«‹       |
| Select tables optimized away | ä¼˜åŒ–å™¨å·²ä¼˜åŒ–æ‰è¡¨è®¿é—®       |

#### ä¼˜åŒ–å»ºè®®

1. å…³æ³¨ `type` åˆ—ï¼Œ**é¿å…å‡ºç° `ALL`ï¼ˆå…¨è¡¨æ‰«æï¼‰**
2. ç¡®ä¿ `key` åˆ—ä½¿ç”¨äº†é€‚å½“çš„ç´¢å¼•
3. å½“ `Extra` å‡ºç° `Using filesort` æˆ– `Using temporary` æ—¶éœ€ç‰¹åˆ«æ³¨æ„
4. æ¯”è¾ƒ `rows` ä¸å®é™…æ•°æ®é‡ï¼Œ**è¯„ä¼°ç´¢å¼•æ•ˆç‡**
5. å¯¹äºå¤æ‚æŸ¥è¯¢ï¼Œå°è¯• `EXPLAIN FORMAT=JSON` è·å–æ›´è¯¦ç»†ä¿¡æ¯

é€šè¿‡ç†è§£è¿™äº›åˆ—çš„å«ä¹‰ï¼Œä½ å¯ä»¥æœ‰æ•ˆåˆ†ææŸ¥è¯¢æ€§èƒ½ç“¶é¢ˆå¹¶è¿›è¡Œé’ˆå¯¹æ€§ä¼˜åŒ–ã€‚



## 2.6 ğŸŒŸç´¢å¼•ä½¿ç”¨

### ï¼ˆ1ï¼‰éªŒè¯ç´¢å¼•é¢‘ç‡

<img src="./Mysql-Learning-Local.assets/image-20250415195742141.png" alt="image-20250415195742141" style="zoom:80%;" />

åœ¨è®²è§£ç´¢å¼•çš„ä½¿ç”¨åŸåˆ™ä¹‹å‰ï¼Œå…ˆé€šè¿‡ä¸€ä¸ªç®€å•çš„æ¡ˆä¾‹ï¼Œæ¥éªŒè¯ä¸€ä¸‹ç´¢å¼•ï¼Œçœ‹çœ‹æ˜¯å¦èƒ½å¤Ÿé€šè¿‡ç´¢å¼•æ¥æå‡æ•°æ®æŸ¥è¯¢æ€§èƒ½ã€‚åœ¨æ¼”ç¤ºçš„æ—¶å€™ï¼Œæˆ‘ä»¬è¿˜æ˜¯ä½¿ç”¨ä¹‹å‰å‡†å¤‡çš„ä¸€å¼ è¡¨ tb_sku , åœ¨è¿™å¼ è¡¨ä¸­å‡†å¤‡äº†1000wçš„è®°å½•ã€‚

**ä¸ºäº†æ–¹ä¾¿åªæ·»åŠ äº†400W**

![image-20250415171956420](./Mysql-Learning-Local.assets/image-20250415171956420.png)

è¿™å¼ è¡¨ä¸­idä¸ºä¸»é”®ï¼Œæœ‰ä¸»é”®ç´¢å¼•ï¼Œè€Œå…¶ä»–å­—æ®µæ˜¯æ²¡æœ‰å»ºç«‹ç´¢å¼•çš„ã€‚ æˆ‘ä»¬å…ˆæ¥æŸ¥è¯¢å…¶ä¸­çš„ä¸€æ¡è®°å½•ï¼Œçœ‹çœ‹é‡Œé¢çš„å­—æ®µæƒ…å†µï¼Œæ‰§è¡Œå¦‚ä¸‹SQLï¼š

```sql
select * from tb_sku where id = 1\G; # \G è¡¨ç¤º æ ¼å¼åŒ–è¾“å‡º
```

![image-20250415172043986](./Mysql-Learning-Local.assets/image-20250415172043986.png)

å¯ä»¥çœ‹åˆ°å³ä½¿æœ‰1000wçš„æ•°æ®,æ ¹æ®idè¿›è¡Œæ•°æ®æŸ¥è¯¢,**æ€§èƒ½ä¾ç„¶å¾ˆå¿«**ï¼Œå› ä¸ºä¸»é”®idæ˜¯æœ‰ç´¢å¼•çš„ã€‚ é‚£ä¹ˆæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†æ¥æ ¹æ® sn å­—æ®µè¿›è¡ŒæŸ¥è¯¢ï¼Œæ‰§è¡Œå¦‚ä¸‹SQLï¼š

```sql
SELECT * FROM tb_sku WHERE sn = '100000003145001';
```

![image-20250415172240579](./Mysql-Learning-Local.assets/image-20250415172240579.png)

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ ¹æ®snå­—æ®µè¿›è¡ŒæŸ¥è¯¢ï¼ŒæŸ¥è¯¢è¿”å›äº†ä¸€æ¡æ•°æ®ï¼Œç»“æœè€—æ—¶ 20.78secï¼Œå°±æ˜¯**å› ä¸ºsnæ²¡æœ‰ç´¢å¼•ï¼Œè€Œé€ æˆæŸ¥è¯¢æ•ˆç‡å¾ˆä½**ã€‚

é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é’ˆå¯¹äºsnå­—æ®µï¼Œå»ºç«‹ä¸€ä¸ªç´¢å¼•ï¼Œå»ºç«‹äº†ç´¢å¼•ä¹‹åï¼Œæˆ‘ä»¬å†æ¬¡æ ¹æ®snè¿›è¡ŒæŸ¥è¯¢ï¼Œå†æ¥çœ‹ä¸€ä¸‹æŸ¥è¯¢è€—æ—¶æƒ…å†µã€‚

**åˆ›å»ºç´¢å¼•ï¼š**

```sql
create index idx_sku_sn on tb_sku(sn) ;
```

![image-20250415172457818](./Mysql-Learning-Local.assets/image-20250415172457818.png)

<img src="./Mysql-Learning-Local.assets/image-20250415195639603.png" alt="image-20250415195639603" style="zoom:80%;" />

ç„¶åå†æ¬¡æ‰§è¡Œç›¸åŒçš„SQLè¯­å¥ï¼Œå†æ¬¡æŸ¥çœ‹SQLçš„è€—æ—¶ã€‚

```sql
SELECT * FROM tb_sku WHERE sn = '100000003145001';
```

<img src="./Mysql-Learning-Local.assets/image-20250415172511389.png" alt="image-20250415172511389" style="zoom:80%;" />

æˆ‘ä»¬æ˜æ˜¾ä¼šçœ‹åˆ°ï¼Œsnå­—æ®µå»ºç«‹äº†ç´¢å¼•ä¹‹åï¼ŒæŸ¥è¯¢æ€§èƒ½å¤§å¤§æå‡ã€‚å»ºç«‹ç´¢å¼•å‰åï¼ŒæŸ¥è¯¢è€—æ—¶éƒ½ä¸æ˜¯ä¸€ä¸ªæ•°é‡çº§çš„ã€‚

**explainåˆ†æï¼š**

![image-20250415200042256](./Mysql-Learning-Local.assets/image-20250415200042256.png)

```
explain SELECT * FROM tb_sku WHERE sn = '100000003145001'\G;
```



### ï¼ˆ2ï¼‰ğŸŒŸ ==æœ€å·¦å‰ç¼€æ³•åˆ™==

![image-20250415200503945](./Mysql-Learning-Local.assets/image-20250415200503945.png)

å¦‚æœç´¢å¼•äº†å¤šåˆ—ï¼ˆ**è”åˆç´¢å¼•**ï¼‰ï¼Œè¦**éµå®ˆæœ€å·¦å‰ç¼€æ³•åˆ™**ã€‚æœ€å·¦å‰ç¼€æ³•åˆ™æŒ‡çš„æ˜¯**æŸ¥è¯¢ä»ç´¢å¼•çš„æœ€å·¦åˆ—å¼€å§‹ï¼Œå¹¶ä¸”ä¸è·³è¿‡ç´¢å¼•ä¸­çš„åˆ—ã€‚ ** **å¦‚æœè·³è·ƒæŸä¸€åˆ—ï¼Œç´¢å¼•å°†ä¼š==éƒ¨åˆ†å¤±æ•ˆ(åé¢çš„å­—æ®µç´¢å¼•å¤±æ•ˆ)==**ã€‚ä»¥ tb_user è¡¨ä¸ºä¾‹ï¼Œæˆ‘ä»¬å…ˆæ¥æŸ¥çœ‹ä¸€ä¸‹ä¹‹å‰ tb_user è¡¨æ‰€åˆ›å»ºçš„ç´¢å¼•ã€‚

ä»¥ tb_user è¡¨ä¸ºä¾‹ï¼Œæˆ‘ä»¬å…ˆæ¥æŸ¥çœ‹ä¸€ä¸‹ä¹‹å‰ tb_user è¡¨æ‰€åˆ›å»ºçš„ç´¢å¼•ã€‚

![image-20250415173329158](./Mysql-Learning-Local.assets/image-20250415173329158.png)

åœ¨ tb_user è¡¨ä¸­ï¼Œæœ‰ä¸€ä¸ªè”åˆç´¢å¼•ï¼Œè¿™ä¸ªè”åˆç´¢å¼•æ¶‰åŠåˆ°ä¸‰ä¸ªå­—æ®µï¼Œé¡ºåºåˆ†åˆ«ä¸ºï¼šprofessionï¼Œageï¼Œstatusã€‚

å¯¹äº==æœ€å·¦å‰ç¼€æ³•åˆ™==æŒ‡çš„æ˜¯ï¼ŒæŸ¥è¯¢æ—¶ï¼Œ**==æœ€å·¦è¾¹çš„åˆ—==ï¼Œä¹Ÿå°±æ˜¯profession==å¿…é¡»å­˜åœ¨==**ï¼Œ**==å¦åˆ™ç´¢å¼•å…¨éƒ¨å¤±æ•ˆ==**ã€‚è€Œä¸”**ä¸­é—´ä¸èƒ½è·³è¿‡æŸä¸€åˆ—ï¼Œå¦åˆ™==è¯¥åˆ—åé¢çš„å­—æ®µç´¢å¼•å°†å¤±æ•ˆ==**ã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥æ¼”ç¤ºå‡ ç»„æ¡ˆä¾‹ï¼Œçœ‹ä¸€ä¸‹å…·ä½“çš„æ‰§è¡Œè®¡åˆ’ï¼š

```sql
explain select * from tb_user where profession = 'è½¯ä»¶å·¥ç¨‹' and age = 31 and status = '0';
```

![image-20250415173453053](./Mysql-Learning-Local.assets/image-20250415173453053.png)



```sql
explain select * from tb_user where profession = 'è½¯ä»¶å·¥ç¨‹' and age = 31;
```

![image-20250415173500883](./Mysql-Learning-Local.assets/image-20250415173500883.png)



```sql
explain select * from tb_user where profession = 'è½¯ä»¶å·¥ç¨‹';
```

![image-20250415173508735](./Mysql-Learning-Local.assets/image-20250415173508735.png)

ä»¥ä¸Šçš„è¿™ä¸‰ç»„æµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬å‘ç°åªè¦è”åˆç´¢å¼•**æœ€å·¦è¾¹çš„å­—æ®µ professionå­˜åœ¨**ï¼Œç´¢å¼•å°±ä¼šç”Ÿæ•ˆï¼Œåªä¸è¿‡ç´¢å¼•çš„é•¿åº¦ä¸åŒã€‚ è€Œä¸”ç”±ä»¥ä¸Šä¸‰ç»„æµ‹è¯•ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥**==æ¨æµ‹å‡ºprofessionå­—æ®µç´¢å¼•é•¿åº¦ä¸º47ã€ageå­—æ®µç´¢å¼•é•¿åº¦ä¸º2ã€statuså­—æ®µç´¢å¼•é•¿åº¦ä¸º5==**ã€‚



```sql
explain select * from tb_user where age = 31 and status = '0';
```

<img src="./Mysql-Learning-Local.assets/image-20250415201128618.png" alt="image-20250415201128618" style="zoom: 80%;" />



```sql
explain select * from tb_user where status = '0';
```

![image-20250415201156584](./Mysql-Learning-Local.assets/image-20250415201156584.png)



è€Œé€šè¿‡ä¸Šé¢çš„è¿™ä¸¤ç»„æµ‹è¯•ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°**ç´¢å¼•å¹¶æœªç”Ÿæ•ˆï¼ŒåŸå› æ˜¯å› ä¸ºä¸æ»¡è¶³æœ€å·¦å‰ç¼€æ³•åˆ™**ï¼Œè”åˆç´¢å¼•æœ€å·¦è¾¹çš„åˆ—professionä¸å­˜åœ¨ã€‚

```sql
explain select * from tb_user where profession = 'è½¯ä»¶å·¥ç¨‹' and status = '0';
```

![image-20250415201539728](./Mysql-Learning-Local.assets/image-20250415201539728.png)

ä¸Šè¿°çš„SQLæŸ¥è¯¢æ—¶ï¼Œå­˜åœ¨professionå­—æ®µï¼Œæœ€å·¦è¾¹çš„åˆ—æ˜¯å­˜åœ¨çš„ï¼Œç´¢å¼•æ»¡è¶³æœ€å·¦å‰ç¼€æ³•åˆ™çš„åŸºæœ¬æ¡ä»¶ã€‚ä½†æ˜¯æŸ¥è¯¢æ—¶ï¼Œ**è·³è¿‡äº†ageè¿™ä¸ªåˆ—**ï¼Œæ‰€ä»¥åé¢çš„åˆ—ç´¢å¼•æ˜¯ä¸ä¼šä½¿ç”¨çš„ï¼Œä¹Ÿå°±æ˜¯**ç´¢å¼•éƒ¨åˆ†ç”Ÿæ•ˆ**ï¼Œæ‰€ä»¥**ç´¢å¼•çš„é•¿åº¦å°±æ˜¯47**ï¼ˆ**ç›¸å½“äºåªæœ‰professionå­—æ®µçš„ç´¢å¼•**ï¼‰



> **æ€è€ƒé¢˜ï¼š**
>
> 
>
> å½“æ‰§è¡ŒSQLè¯­å¥: explain select * from tb_user where age = 31 and status = '0' and profession = 'è½¯ä»¶å·¥ç¨‹'ï¼› æ—¶ï¼Œ**æ˜¯å¦æ»¡è¶³æœ€å·¦å‰ç¼€æ³•åˆ™**ï¼Œèµ°ä¸èµ°ä¸Šè¿°çš„è”åˆç´¢å¼•ï¼Œç´¢å¼•é•¿åº¦ï¼Ÿ
>
> ![image-20250415202021028](./Mysql-Learning-Local.assets/image-20250415202021028.png)
>
> å¯ä»¥çœ‹åˆ°ï¼Œæ˜¯å®Œå…¨æ»¡è¶³æœ€å·¦å‰ç¼€æ³•åˆ™çš„ï¼Œç´¢å¼•é•¿åº¦54ï¼Œ**è”åˆç´¢å¼•æ˜¯ç”Ÿæ•ˆçš„**ã€‚
>
> 
>
> **==æ³¨æ„== ï¼š** æœ€å·¦å‰ç¼€æ³•åˆ™ä¸­æŒ‡çš„**æœ€å·¦è¾¹çš„åˆ—**ï¼Œæ˜¯æŒ‡åœ¨æŸ¥è¯¢æ—¶ï¼Œè”åˆç´¢å¼•çš„æœ€å·¦è¾¹çš„å­—æ®µ(**å³æ˜¯ç¬¬ä¸€ä¸ªå­—æ®µ)==å¿…é¡»å­˜åœ¨==**ï¼Œä¸æˆ‘ä»¬ç¼–å†™SQLæ—¶ï¼Œ**æ¡ä»¶ç¼–å†™çš„å…ˆåé¡ºåºæ— å…³**ã€‚



### ï¼ˆ3ï¼‰èŒƒå›´æŸ¥è¯¢

è”åˆç´¢å¼•ä¸­ï¼Œå‡ºç°**èŒƒå›´æŸ¥è¯¢(> , <)**ï¼Œ**èŒƒå›´æŸ¥è¯¢å³ä¾§çš„åˆ—ç´¢å¼•å¤±æ•ˆ**ã€‚

```sql
explain select * from tb_user where profession = 'è½¯ä»¶å·¥ç¨‹' and age > 30 and status = '0';
```

![image-20250415202303931](./Mysql-Learning-Local.assets/image-20250415202303931.png)

å½“èŒƒå›´æŸ¥è¯¢ä½¿ç”¨> æˆ– < æ—¶ï¼Œèµ°è”åˆç´¢å¼•äº†ï¼Œä½†æ˜¯ç´¢å¼•çš„é•¿åº¦ä¸º49ï¼Œå°±è¯´æ˜**èŒƒå›´æŸ¥è¯¢å³è¾¹çš„statuså­—æ®µ**æ˜¯æ²¡æœ‰èµ°ç´¢å¼•çš„ã€‚



```sql
explain select * from tb_user where profession = 'è½¯ä»¶å·¥ç¨‹' and age >= 30 and status = '0';
```

![image-20250415202441472](./Mysql-Learning-Local.assets/image-20250415202441472.png)

å½“èŒƒå›´æŸ¥è¯¢ä½¿ç”¨>= æˆ– <= æ—¶ï¼Œ**èµ°è”åˆç´¢å¼•äº†ï¼Œä½†æ˜¯ç´¢å¼•çš„é•¿åº¦ä¸º54ï¼Œå°±è¯´æ˜æ‰€æœ‰çš„å­—æ®µéƒ½æ˜¯èµ°ç´¢å¼•çš„ã€‚**

æ‰€ä»¥ï¼Œ**åœ¨ä¸šåŠ¡å…è®¸çš„æƒ…å†µä¸‹**ï¼Œ==å°½å¯èƒ½çš„ä½¿ç”¨ç±»ä¼¼äº **>= æˆ– <=** è¿™ç±»çš„èŒƒå›´æŸ¥è¯¢==ï¼Œè€Œ**é¿å…ä½¿ç”¨ > æˆ– <**ã€‚



### ï¼ˆ4ï¼‰ğŸŒŸ ==ç´¢å¼•å¤±æ•ˆæƒ…å†µ==

#### â‘ ç´¢å¼•==åˆ—è¿ç®—==

ä¸è¦åœ¨ç´¢å¼•åˆ—ä¸Šè¿›è¡Œ**è¿ç®—æ“ä½œ**ï¼Œ ç´¢å¼•å°†å¤±æ•ˆã€‚

åœ¨tb_userè¡¨ä¸­ï¼Œé™¤äº†å‰é¢ä»‹ç»çš„è”åˆç´¢å¼•ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªç´¢å¼•ï¼Œæ˜¯**phoneå­—æ®µçš„å•åˆ—ç´¢å¼•**ã€‚

```sql
show index from tb_user\G;
```

![image-20250415202704979](./Mysql-Learning-Local.assets/image-20250415202704979.png)

##### A. å½“æ ¹æ®phoneå­—æ®µè¿›è¡Œ==ç­‰å€¼åŒ¹é…æŸ¥è¯¢==æ—¶, ç´¢å¼•ç”Ÿæ•ˆã€‚

```sql
explain select * from tb_user where phone = '17799990015'; 
```

![image-20250415202810833](./Mysql-Learning-Local.assets/image-20250415202810833.png)

##### B. å½“æ ¹æ®phoneå­—æ®µè¿›è¡Œ==å‡½æ•°è¿ç®—æ“ä½œ==ä¹‹åï¼Œç´¢å¼•å¤±æ•ˆã€‚

```sql
explain select * from tb_user where substring(phone,10,2) = '15';
```

![image-20250415203001650](./Mysql-Learning-Local.assets/image-20250415203001650.png)



#### â‘¡å­—ç¬¦ä¸²==ä¸åŠ å¼•å·==-''

å­—ç¬¦ä¸²ç±»å‹å­—æ®µä½¿ç”¨æ—¶ï¼Œ**ä¸åŠ å¼•å·ï¼Œç´¢å¼•å°†å¤±æ•ˆ**ã€‚ï¼ˆ**è¯¥æ²¡åŠ å¼•å·çš„ç´¢å¼•å¤±æ•ˆ**ï¼Œå¹¶å‚ç…§æœ€å·¦å‰ç¼€æ³•åˆ™ï¼‰

**==æ•°æ®åº“å­˜åœ¨éšå¼ç±»å‹è½¬æ¢==ï¼Œç´¢å¼•å°†å¤±æ•ˆã€‚**

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€šè¿‡ä¸¤ç»„ç¤ºä¾‹ï¼Œæ¥çœ‹çœ‹å¯¹äºå­—ç¬¦ä¸²ç±»å‹çš„å­—æ®µï¼ŒåŠ å•å¼•å·ä¸ä¸åŠ å•å¼•å·çš„åŒºåˆ«ï¼š

```sql
explain select * from tb_user where profession = 'è½¯ä»¶å·¥ç¨‹' and age = 31 and status = '0';
explain select * from tb_user where profession = 'è½¯ä»¶å·¥ç¨‹' and age = 31 and status = 0;
```

<img src="./Mysql-Learning-Local.assets/image-20250415203458858.png" alt="image-20250415203458858" style="zoom:80%;" />



```sql
explain select * from tb_user where phone = '17799990015';
explain select * from tb_user where phone = 17799990015;
```

<img src="./Mysql-Learning-Local.assets/image-20250415203538384.png" alt="image-20250415203538384" style="zoom:67%;" />

ç»è¿‡ä¸Šé¢ä¸¤ç»„ç¤ºä¾‹ï¼Œæˆ‘ä»¬ä¼šæ˜æ˜¾çš„å‘ç°ï¼Œ**å¦‚æœå­—ç¬¦ä¸²ä¸åŠ å•å¼•å·ï¼Œå¯¹äºæŸ¥è¯¢ç»“æœï¼Œæ²¡ä»€ä¹ˆå½±å“ï¼Œä½†æ˜¯==æ•°æ®åº“å­˜åœ¨éšå¼ç±»å‹è½¬æ¢==ï¼Œç´¢å¼•å°†å¤±æ•ˆã€‚**



#### â‘¢==æ¨¡ç³ŠæŸ¥è¯¢==-%

å¦‚æœä»…ä»…æ˜¯**==å°¾éƒ¨æ¨¡ç³ŠåŒ¹é…ï¼Œç´¢å¼•ä¸ä¼šå¤±æ•ˆ==**ã€‚å¦‚æœæ˜¯==**å¤´éƒ¨æ¨¡ç³ŠåŒ¹é…ï¼Œç´¢å¼•å¤±æ•ˆ**==ã€‚èµ°çš„æ˜¯**å…¨è¡¨æ‰«æ**ã€‚



æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™ä¸‰æ¡SQLè¯­å¥çš„æ‰§è¡Œæ•ˆæœï¼ŒæŸ¥çœ‹ä¸€ä¸‹å…¶æ‰§è¡Œè®¡åˆ’ï¼š

ç”±äºä¸‹é¢æŸ¥è¯¢è¯­å¥ä¸­ï¼Œéƒ½æ˜¯**æ ¹æ®professionå­—æ®µæŸ¥è¯¢ï¼Œç¬¦åˆæœ€å·¦å‰ç¼€æ³•åˆ™ï¼Œè”åˆç´¢å¼•æ˜¯å¯ä»¥ç”Ÿæ•ˆçš„**ï¼Œ

æˆ‘ä»¬ä¸»è¦çœ‹ä¸€ä¸‹ï¼Œæ¨¡ç³ŠæŸ¥è¯¢æ—¶ï¼Œ**%åŠ åœ¨å…³é”®å­—ä¹‹å‰**ï¼Œå’Œ**åŠ åœ¨å…³é”®å­—ä¹‹å**çš„å½±å“ã€‚

```sql
explain select * from tb_user where profession like 'è½¯ä»¶%';
explain select * from tb_user where profession like '%å·¥ç¨‹';
explain select * from tb_user where profession like '%å·¥%';
```

<img src="./Mysql-Learning-Local.assets/image-20250415203903583.png" alt="image-20250415203903583" style="zoom: 80%;" />

<img src="./Mysql-Learning-Local.assets/image-20250415203928994.png" alt="image-20250415203928994" style="zoom:80%;" />

<img src="./Mysql-Learning-Local.assets/image-20250415203950447.png" alt="image-20250415203950447" style="zoom: 80%;" />



ç»è¿‡ä¸Šè¿°çš„æµ‹è¯•ï¼Œæˆ‘ä»¬å‘ç°ï¼Œåœ¨**likeæ¨¡ç³ŠæŸ¥è¯¢ä¸­ï¼Œåœ¨å…³é”®å­—åé¢åŠ %**ï¼Œ**ç´¢å¼•å¯ä»¥ç”Ÿæ•ˆ**ã€‚è€Œå¦‚æœ**åœ¨å…³é”®å­—å‰é¢åŠ äº†%ï¼Œç´¢å¼•å°†ä¼šå¤±æ•ˆ**ã€‚



#### â‘£==or==è¿æ¥æ¡ä»¶-or

ç”¨oråˆ†å‰²å¼€çš„æ¡ä»¶ï¼Œ å¦‚æœ**orå‰çš„æ¡ä»¶ä¸­çš„åˆ—æœ‰ç´¢å¼•ï¼Œè€Œåé¢çš„åˆ—ä¸­æ²¡æœ‰ç´¢å¼•**ï¼Œé‚£ä¹ˆ**æ¶‰åŠçš„ç´¢å¼•éƒ½ä¸ä¼šè¢«ç”¨åˆ°**ã€‚å³orä¸¤ä¾§ï¼Œä¸€ä¾§æœ‰ç´¢å¼•ã€ä¸€ä¾§æ²¡ç´¢å¼•çš„æ—¶å€™ï¼Œæ‰€ä»¥éƒ½ä¼šå¤±æ•ˆã€‚

```sql
explain select * from tb_user where id = 10 or age = 23;
explain select * from tb_user where phone = '17799990017' or age = 23;
```

![image-20250415204314861](./Mysql-Learning-Local.assets/image-20250415204314861.png)

ç”±äº**ageæ²¡æœ‰ç´¢å¼•**ï¼Œæ‰€ä»¥å³ä½¿idã€phoneæœ‰ç´¢å¼•ï¼Œ**ç´¢å¼•ä¹Ÿä¼šå¤±æ•ˆ**ã€‚æ‰€ä»¥éœ€è¦é’ˆå¯¹äº**ageä¹Ÿè¦å»ºç«‹ç´¢å¼•**ã€‚

ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥å¯¹ageå­—æ®µå»ºç«‹ç´¢å¼•ã€‚

```sql
create index idx_user_age on tb_user(age);
```

<img src="./Mysql-Learning-Local.assets/image-20250415204410407.png" alt="image-20250415204410407"  />

å»ºç«‹äº†ç´¢å¼•ä¹‹åï¼Œæˆ‘ä»¬å†æ¬¡æ‰§è¡Œä¸Šè¿°çš„SQLè¯­å¥ï¼Œçœ‹çœ‹å‰åæ‰§è¡Œè®¡åˆ’çš„å˜åŒ–ã€‚

<img src="./Mysql-Learning-Local.assets/image-20250415204452509.png" alt="image-20250415204452509" style="zoom:80%;" />

æœ€ç»ˆï¼Œæˆ‘ä»¬å‘ç°ï¼Œå½“orè¿æ¥çš„æ¡ä»¶ï¼Œå·¦å³ä¸¤ä¾§å­—æ®µéƒ½æœ‰ç´¢å¼•æ—¶ï¼Œç´¢å¼•æ‰ä¼šç”Ÿæ•ˆã€‚



#### â‘¤==æ•°æ®åˆ†å¸ƒå½±å“==

å¦‚æœMySQL**==è¯„ä¼°ä½¿ç”¨ç´¢å¼•æ¯”å…¨è¡¨æ›´æ…¢==ï¼Œåˆ™ä¸ä½¿ç”¨ç´¢å¼•**ã€‚

```sql
explain select * from tb_user where phone >= '17799990005';
explain select * from tb_user where phone >= '17799990015';
```

<img src="./Mysql-Learning-Local.assets/image-20250415205007418.png" alt="image-20250415205007418" style="zoom:80%;" />

ç»è¿‡æµ‹è¯•æˆ‘ä»¬å‘ç°ï¼Œç›¸åŒçš„SQLè¯­å¥ï¼Œ**åªæ˜¯ä¼ å…¥çš„å­—æ®µå€¼ä¸åŒ**ï¼Œæœ€ç»ˆçš„æ‰§è¡Œè®¡åˆ’ä¹Ÿå®Œå…¨ä¸ä¸€æ ·ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ

å°±æ˜¯å› ä¸ºMySQLåœ¨æŸ¥è¯¢æ—¶ï¼Œ**ä¼šè¯„ä¼°ä½¿ç”¨ç´¢å¼•çš„æ•ˆç‡ä¸èµ°å…¨è¡¨æ‰«æçš„æ•ˆç‡**ï¼Œå¦‚æœ**èµ°å…¨è¡¨æ‰«ææ›´å¿«ï¼Œåˆ™æ”¾å¼ƒç´¢å¼•ï¼Œèµ°å…¨è¡¨æ‰«æ**ã€‚ å› ä¸ºç´¢å¼•æ˜¯ç”¨æ¥**ç´¢å¼•å°‘é‡æ•°æ®çš„**ï¼Œå¦‚æœ**==é€šè¿‡ç´¢å¼•æŸ¥è¯¢è¿”å›å¤§æ‰¹é‡çš„æ•°æ®==**ï¼Œåˆ™**==è¿˜ä¸å¦‚èµ°å…¨è¡¨æ‰«ææ¥çš„å¿«ï¼Œæ­¤æ—¶ç´¢å¼•å°±ä¼šå¤±æ•ˆ==ã€‚**

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹ **is null ä¸ is not null æ“ä½œæ˜¯å¦èµ°ç´¢å¼•**ã€‚

æ‰§è¡Œå¦‚ä¸‹ä¸¤æ¡è¯­å¥ ï¼š

```sql
explain select * from tb_user where profession is null;
explain select * from tb_user where profession is not null;
```

![image-20250415205620709](./Mysql-Learning-Local.assets/image-20250415205620709.png)

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åšä¸€ä¸ªæ“ä½œ**å°†professionå­—æ®µå€¼å…¨éƒ¨æ›´æ–°ä¸ºnull**

```sql
update tb_user set profession = null;
```

<img src="./Mysql-Learning-Local.assets/image-20250415205725965.png" alt="image-20250415205725965" style="zoom:67%;" />

ç„¶åï¼Œå†æ¬¡æ‰§è¡Œä¸Šè¿°çš„ä¸¤æ¡SQLï¼ŒæŸ¥çœ‹SQLè¯­å¥çš„æ‰§è¡Œè®¡åˆ’ã€‚

<img src="./Mysql-Learning-Local.assets/image-20250415205908417.png" alt="image-20250415205908417" style="zoom: 67%;" />

æœ€ç»ˆæˆ‘ä»¬çœ‹åˆ°ï¼Œä¸€æ¨¡ä¸€æ ·çš„SQLè¯­å¥ï¼Œå…ˆåæ‰§è¡Œäº†ä¸¤æ¬¡ï¼Œç»“æœæŸ¥è¯¢è®¡åˆ’æ˜¯ä¸ä¸€æ ·çš„ï¼Œä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ç§ç°è±¡ï¼Œè¿™æ˜¯å’Œ**æ•°æ®åº“çš„æ•°æ®åˆ†å¸ƒæœ‰å…³ç³»**ã€‚æŸ¥è¯¢æ—¶**MySQLä¼šè¯„ä¼°ï¼Œèµ°ç´¢å¼•å¿«ï¼Œè¿˜æ˜¯å…¨è¡¨æ‰«æå¿«**ï¼Œå¦‚æœå…¨è¡¨æ‰«ææ›´å¿«ï¼Œåˆ™æ”¾å¼ƒç´¢å¼•èµ°å…¨è¡¨æ‰«æã€‚ å› æ­¤ï¼Œis null ã€is not nullæ˜¯å¦èµ°ç´¢å¼•ï¼Œ**å¾—å…·ä½“æƒ…å†µå…·ä½“åˆ†æ**ï¼Œå¹¶ä¸æ˜¯å›ºå®šçš„ã€‚



**==æ€»ç»“==ï¼šMysqlè¯„ä¼°æ—¶ï¼Œä¼šåˆ¤æ–­æŸ¥è¯¢æ—¶æ˜¯ç´¢å¼•å¿«ï¼Œè¿˜æ˜¯å…¨è¡¨æ‰«æå¿«ï¼Œ==å¦‚æœæŸ¥è¯¢çš„æ¡ä»¶å¯¹äºè¡¨ä¸­å¤§éƒ¨åˆ†çš„å­—æ®µå€¼éƒ½æ»¡è¶³==ï¼Œåˆ™ä¼šç›´æ¥èµ°==å…¨è¡¨æ‰«æ==ï¼Œæ”¾å¼ƒèµ°ç´¢å¼•ï¼Œåä¹‹ï¼ŒåŒç†ã€‚** **==ç›¸å½“äºç´¢å¼•åªå¯¹å°‘éƒ¨åˆ†æ•°æ®ç”Ÿæ•ˆã€‚==**



### ï¼ˆ5ï¼‰SQLæç¤º

![image-20250415211629620](./Mysql-Learning-Local.assets/image-20250415211629620.png)

#### åœºæ™¯å¼•å…¥

ç›®å‰tb_userè¡¨çš„æ•°æ®æƒ…å†µå¦‚ä¸‹:

![image-20250415210413093](./Mysql-Learning-Local.assets/image-20250415210413093.png)



ç´¢å¼•æƒ…å†µå¦‚ä¸‹:

![image-20250415210625087](./Mysql-Learning-Local.assets/image-20250415210625087.png)

æŠŠä¸Šè¿°çš„ idx_user_age, idx_email è¿™ä¸¤ä¸ªä¹‹å‰æµ‹è¯•ä½¿ç”¨è¿‡çš„ç´¢å¼•**ç›´æ¥åˆ é™¤**ã€‚

![image-20250415210706310](./Mysql-Learning-Local.assets/image-20250415210706310.png)

```sql
drop index idx_user_age on tb_user;
drop index idx_email on tb_user;
```



**A. æ‰§è¡ŒSQL : explain select * from tb_user where profession = 'è½¯ä»¶å·¥ç¨‹';**

```sql
explain select * from tb_user where profession = 'è½¯ä»¶å·¥ç¨‹';
```

æŸ¥è¯¢èµ°äº†è”åˆç´¢å¼•ã€‚

![image-20250415210907304](./Mysql-Learning-Local.assets/image-20250415210907304.png)



**B. æ‰§è¡ŒSQLï¼Œåˆ›å»ºprofessionçš„==å•åˆ—ç´¢å¼•==ï¼šcreate index idx_user_pro on tb_user(profession);**

```sql
create index idx_user_pro on tb_user(profession);
```



**C. åˆ›å»ºå•åˆ—ç´¢å¼•åï¼Œå†æ¬¡æ‰§è¡ŒAä¸­çš„SQLè¯­å¥ï¼ŒæŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ï¼Œçœ‹çœ‹åˆ°åº•èµ°å“ªä¸ªç´¢å¼•ã€‚**

<img src="./Mysql-Learning-Local.assets/image-20250415210944132.png" alt="image-20250415210944132" style="zoom:80%;" />

æµ‹è¯•ç»“æœï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œpossible_keysä¸­ idx_user_pro_age_sta,idx_user_pro **è¿™ä¸¤ä¸ªç´¢å¼•éƒ½å¯èƒ½ç”¨åˆ°**ï¼Œæœ€ç»ˆ**MySQLé€‰æ‹©äº†idx_user_pro_age_staç´¢å¼•**ã€‚è¿™æ˜¯**MySQLè‡ªåŠ¨é€‰æ‹©çš„ç»“æœ**ã€‚

é‚£ä¹ˆï¼Œæˆ‘ä»¬èƒ½ä¸èƒ½åœ¨æŸ¥è¯¢çš„æ—¶å€™ï¼Œ**è‡ªå·±æ¥æŒ‡å®šä½¿ç”¨å“ªä¸ªç´¢å¼•**å‘¢ï¼Ÿ ç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œæ­¤æ—¶å°±å¯ä»¥å€ŸåŠ©äºMySQLçš„**SQLæç¤ºæ¥å®Œæˆ**ã€‚ æ¥ä¸‹æ¥ï¼Œä»‹ç»ä¸€ä¸‹SQLæç¤ºã€‚

**SQLæç¤º**ï¼Œæ˜¯ä¼˜åŒ–æ•°æ®åº“çš„ä¸€ä¸ªé‡è¦æ‰‹æ®µï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯åœ¨SQLè¯­å¥ä¸­åŠ å…¥ä¸€äº›äººä¸ºçš„æç¤ºæ¥è¾¾åˆ°**ä¼˜åŒ–æ“ä½œçš„ç›®çš„ã€‚**



#### â‘ use index -å»ºè®®

å»ºè®®MySQLä½¿ç”¨å“ªä¸€ä¸ªç´¢å¼•å®Œæˆæ­¤æ¬¡æŸ¥è¯¢ï¼ˆä»…ä»…æ˜¯**å»ºè®®ï¼Œmysqlå†…éƒ¨è¿˜ä¼šå†æ¬¡è¿›è¡Œè¯„ä¼°**ï¼‰ã€‚

```sql
explain select * from tb_user use index(idx_user_pro) where profession = 'è½¯ä»¶å·¥ç¨‹';
```

#### â‘¡ignore index å¿½ç•¥æŒ‡å®šçš„ç´¢å¼•

```sql
explain select * from tb_user ignore index(idx_user_pro) where profession = 'è½¯ä»¶å·¥ç¨‹';
```

#### â‘¢force index å¼ºåˆ¶ä½¿ç”¨ç´¢å¼•

```sql
explain select * from tb_user force index(idx_user_pro) where profession = 'è½¯ä»¶å·¥ç¨‹';
```



#### â‘£ç¤ºä¾‹æ¼”ç¤º

A. use index

```sql
explain select * from tb_user use index(idx_user_pro) where profession = 'è½¯ä»¶å·¥ç¨‹';
```

![image-20250415211230863](./Mysql-Learning-Local.assets/image-20250415211230863.png)

B. ignore index

```sql
explain select * from tb_user ignore index(idx_user_pro) where profession = 'è½¯ä»¶å·¥ç¨‹';
```

![image-20250415211254163](./Mysql-Learning-Local.assets/image-20250415211254163.png)

C. force index

```sql
explain select * from tb_user force index(idx_user_pro_age_sta) where profession = 'è½¯ä»¶å·¥ç¨‹';
```

![image-20250415211337575](./Mysql-Learning-Local.assets/image-20250415211337575.png)



### ï¼ˆ6ï¼‰ğŸŒŸ è¦†ç›–ç´¢å¼•

å°½é‡**ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼Œå‡å°‘select ***ã€‚ é‚£ä¹ˆä»€ä¹ˆæ˜¯è¦†ç›–ç´¢å¼•å‘¢ï¼Ÿ è¦†ç›–ç´¢å¼•æ˜¯æŒ‡ **æŸ¥è¯¢ä½¿ç”¨äº†ç´¢å¼•**ï¼Œ**å¹¶ä¸”==éœ€è¦è¿”å›çš„åˆ—==ï¼Œ==åœ¨è¯¥ç´¢å¼•ä¸­å·²ç»å…¨éƒ¨èƒ½å¤Ÿæ‰¾åˆ°==** ã€‚



æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ç»„SQLçš„æ‰§è¡Œè®¡åˆ’ï¼Œçœ‹çœ‹æ‰§è¡Œè®¡åˆ’çš„å·®åˆ«ï¼Œç„¶åå†æ¥å…·ä½“åšä¸€ä¸ªè§£æã€‚

```sql
explain select id, profession from tb_user where profession = 'è½¯ä»¶å·¥ç¨‹' and age = 31 and status = '0' ;

explain select id,profession,age, status from tb_user where profession = 'è½¯ä»¶å·¥ç¨‹' and age = 31 and status = '0' ;

explain select id,profession,age, status, name from tb_user where profession = 'è½¯ä»¶å·¥ç¨‹' and age = 31 and status = '0' ;

explain select * from tb_user where profession = 'è½¯ä»¶å·¥ç¨‹' and age = 31 and status = '0';
```

ä¸Šè¿°è¿™å‡ æ¡SQLçš„æ‰§è¡Œç»“æœä¸º:

![image-20250415212838886](./Mysql-Learning-Local.assets/image-20250415212838886.png)

![image-20250415212927502](./Mysql-Learning-Local.assets/image-20250415212927502.png)



ä»ä¸Šè¿°çš„æ‰§è¡Œè®¡åˆ’æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™å››æ¡SQLè¯­å¥çš„æ‰§è¡Œè®¡åˆ’å‰é¢æ‰€æœ‰çš„æŒ‡æ ‡éƒ½æ˜¯ä¸€æ ·çš„ï¼Œçœ‹ä¸å‡ºæ¥å·®å¼‚ã€‚ä½†æ˜¯æ­¤æ—¶ï¼Œæˆ‘ä»¬ä¸»è¦å…³æ³¨çš„æ˜¯åé¢çš„**==Extra==**ï¼Œå‰é¢ä¸¤æ¡SQLçš„ç»“æœä¸º **Using where; UsingIndex** ; è€Œåé¢ä¸¤æ¡SQLçš„ç»“æœä¸º: **Using index condition** ã€‚

![image-20250415192253342](./Mysql-Learning-Local.assets/image-20250415192253342.png)



å› ä¸ºï¼Œåœ¨tb_userè¡¨ä¸­æœ‰ä¸€ä¸ª**è”åˆç´¢å¼• idx_user_pro_age_sta**ï¼Œè¯¥ç´¢å¼•**å…³è”äº†ä¸‰ä¸ªå­—æ®µprofessionã€ageã€status**ï¼Œè€Œè¿™ä¸ªç´¢å¼•ä¹Ÿæ˜¯ä¸€ä¸ª==äºŒçº§ç´¢å¼•==ï¼Œæ‰€ä»¥å¶å­èŠ‚ç‚¹ä¸‹é¢æŒ‚çš„æ˜¯**è¿™ä¸€è¡Œçš„ä¸»é”®id**ã€‚ æ‰€ä»¥å½“æˆ‘ä»¬**æŸ¥è¯¢è¿”å›çš„æ•°æ®åœ¨ idã€professionã€ageã€status ä¹‹ä¸­**ï¼Œåˆ™**==ç›´æ¥èµ°äºŒçº§ç´¢å¼•ç›´æ¥è¿”å›æ•°æ®==**äº†ã€‚ å¦‚æœè¶…å‡ºè¿™ä¸ªèŒƒå›´ï¼Œå°±**éœ€è¦æ‹¿åˆ°ä¸»é”®id**ï¼Œ**å†==å»æ‰«æèšé›†ç´¢å¼•==**ï¼Œ**å†è·å–é¢å¤–çš„æ•°æ®äº†ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯==å›è¡¨==**ã€‚ è€Œæˆ‘ä»¬å¦‚æœä¸€ç›´ä½¿ç”¨select * æŸ¥è¯¢è¿”å›æ‰€æœ‰å­—æ®µå€¼ï¼Œ**å¾ˆå®¹æ˜“å°±ä¼šé€ æˆå›è¡¨æŸ¥è¯¢**ï¼ˆ**==é™¤éæ˜¯æ ¹æ®ä¸»é”®æŸ¥è¯¢ï¼Œæ­¤æ—¶åªä¼šæ‰«æèšé›†ç´¢å¼•==**ï¼‰ã€‚

ä¸ºäº†å¤§å®¶æ›´æ¸…æ¥šçš„ç†è§£ï¼Œä»€ä¹ˆæ˜¯è¦†ç›–ç´¢å¼•ï¼Œä»€ä¹ˆæ˜¯å›è¡¨æŸ¥è¯¢ï¼Œæˆ‘ä»¬ä¸€èµ·å†æ¥çœ‹ä¸‹é¢çš„è¿™ç»„SQLçš„æ‰§è¡Œè¿‡ç¨‹ã€‚



**A. è¡¨ç»“æ„åŠç´¢å¼•ç¤ºæ„å›¾:**

![image-20250415213944300](./Mysql-Learning-Local.assets/image-20250415213944300.png)

idæ˜¯ä¸»é”®ï¼Œæ˜¯ä¸€ä¸ª**èšé›†ç´¢å¼•**ã€‚ **nameå­—æ®µå»ºç«‹äº†æ™®é€šç´¢å¼•**ï¼Œæ˜¯ä¸€ä¸ª**äºŒçº§ç´¢å¼•ï¼ˆè¾…åŠ©ç´¢å¼•ï¼‰**ã€‚



**B. æ‰§è¡ŒSQL : select * from tb_user where id = 2;**

æ ¹æ®idæŸ¥è¯¢ï¼Œç›´æ¥èµ°èšé›†ç´¢å¼•æŸ¥è¯¢ï¼Œä¸€æ¬¡ç´¢å¼•æ‰«æï¼Œç›´æ¥è¿”å›æ•°æ®ï¼Œæ€§èƒ½é«˜ã€‚

![image-20250415213558596](./Mysql-Learning-Local.assets/image-20250415213558596.png)



**C. æ‰§è¡ŒSQLï¼šselet id,name from tb_user where name = 'Arm';**

è™½ç„¶æ˜¯æ ¹æ®nameå­—æ®µæŸ¥è¯¢ï¼Œ**æŸ¥è¯¢äºŒçº§ç´¢å¼•**ï¼Œä½†æ˜¯ç”±äºæŸ¥è¯¢è¿”å›åœ¨å­—æ®µä¸º idï¼Œnameï¼Œ**åœ¨nameçš„äºŒçº§ç´¢å¼•ä¸­ï¼Œè¿™ä¸¤ä¸ªå€¼éƒ½æ˜¯å¯ä»¥ç›´æ¥è·å–åˆ°çš„**ï¼Œå› ä¸ºè¦†ç›–ç´¢å¼•ï¼Œæ‰€ä»¥**ä¸éœ€è¦å›è¡¨æŸ¥è¯¢**ï¼Œæ€§èƒ½é«˜ã€‚

![image-20250415213851481](./Mysql-Learning-Local.assets/image-20250415213851481.png)





**D. æ‰§è¡ŒSQLï¼šselet id,name,==gender== from tb_user where name = 'Arm';**

![image-20250415213450425](./Mysql-Learning-Local.assets/image-20250415213450425.png)



ç”±äº**åœ¨nameçš„äºŒçº§ç´¢å¼•ä¸­ï¼Œ==ä¸åŒ…å«gender==**ï¼Œæ‰€ä»¥ï¼Œ**éœ€è¦ä¸¤æ¬¡ç´¢å¼•æ‰«æï¼Œä¹Ÿå°±æ˜¯éœ€è¦==å›è¡¨æŸ¥è¯¢==**ï¼Œæ€§èƒ½ç›¸å¯¹è¾ƒå·®ä¸€ç‚¹ã€‚



> **==æ€è€ƒé¢˜==ï¼š**
>
> <img src="./Mysql-Learning-Local.assets/image-20250415214213813.png" alt="image-20250415214213813" style="zoom:80%;" />
>
> ä¸€å¼ è¡¨, æœ‰å››ä¸ªå­—æ®µ(id, username, password, status), ç”±äºæ•°æ®é‡å¤§, éœ€è¦å¯¹ä»¥ä¸‹SQLè¯­å¥è¿›è¡Œä¼˜åŒ–, è¯¥å¦‚ä½•è¿›è¡Œæ‰æ˜¯æœ€ä¼˜æ–¹æ¡ˆ:
>
> â€‹	select id,username,password from tb_user where username = 'itcast';
>
> 
>
> ç­”æ¡ˆ: é’ˆå¯¹äº **==username, passwordå»ºç«‹è”åˆç´¢å¼•==**, sqlä¸º: 
>
> ```sql
> create index idx_user_name_pass on tb_user(username,password);
> ```
>
> è¿™æ ·å¯ä»¥**é¿å…**ä¸Šè¿°çš„SQLè¯­å¥ï¼Œåœ¨æŸ¥è¯¢çš„è¿‡ç¨‹ä¸­ï¼Œ**å‡ºç°å›è¡¨æŸ¥è¯¢**ã€‚



### ï¼ˆ7ï¼‰==å‰ç¼€ç´¢å¼•==

![image-20250415214548331](./Mysql-Learning-Local.assets/image-20250415214548331.png)

å½“å­—æ®µç±»å‹ä¸ºå­—ç¬¦ä¸²ï¼ˆ**varcharï¼Œtextï¼Œlongtext**ç­‰ï¼‰æ—¶ï¼Œæœ‰æ—¶å€™éœ€è¦**ç´¢å¼•å¾ˆé•¿çš„å­—ç¬¦ä¸²**ï¼Œè¿™ä¼šè®©ç´¢å¼•å˜å¾—å¾ˆå¤§ï¼ŒæŸ¥è¯¢æ—¶ï¼Œæµªè´¹å¤§é‡çš„ç£ç›˜IOï¼Œ å½±å“æŸ¥è¯¢æ•ˆç‡ã€‚æ­¤æ—¶å¯ä»¥**åªå°†å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†å‰ç¼€ï¼Œå»ºç«‹ç´¢å¼•**ï¼Œè¿™æ ·å¯ä»¥**å¤§å¤§==èŠ‚çº¦ç´¢å¼•ç©ºé—´==ï¼Œä»è€Œæé«˜ç´¢å¼•æ•ˆç‡**ã€‚

#### â‘ è¯­æ³•-==column(lens)==

```sql
create index idx_xxxx on table_name(column(n)) ;
```



##### 1ï¼‰ç¤ºä¾‹

ä¸ºtb_userè¡¨çš„emailå­—æ®µï¼Œå»ºç«‹é•¿åº¦ä¸º5çš„å‰ç¼€ç´¢å¼•ã€‚

```sql
create index idx_email_5 on tb_user(email(5));
```

![image-20250415214701185](./Mysql-Learning-Local.assets/image-20250415214701185.png)



#### â‘¡å‰ç¼€é•¿åº¦-==è®¡ç®—é€‰æ‹©æ€§==

å¯ä»¥æ ¹æ®ç´¢å¼•çš„é€‰æ‹©æ€§æ¥å†³å®šï¼Œè€Œ**é€‰æ‹©æ€§**æ˜¯**æŒ‡==ä¸é‡å¤çš„ç´¢å¼•å€¼ï¼ˆåŸºæ•°ï¼‰==å’Œæ•°æ®è¡¨çš„==è®°å½•æ€»æ•°==çš„==æ¯”å€¼==**ï¼Œ

ç´¢å¼•é€‰æ‹©æ€§è¶Šé«˜åˆ™æŸ¥è¯¢æ•ˆç‡è¶Šé«˜ï¼Œ **å”¯ä¸€ç´¢å¼•çš„é€‰æ‹©æ€§æ˜¯1**ï¼Œè¿™æ˜¯æœ€å¥½çš„ç´¢å¼•é€‰æ‹©æ€§ï¼Œ**æ€§èƒ½ä¹Ÿæ˜¯æœ€å¥½çš„**ã€‚

```sql
select count(distinct email) / count(*) from tb_user ;
select count(distinct substring(email,1,5)) / count(*) from tb_user ;
```

![image-20250415215305323](./Mysql-Learning-Local.assets/image-20250415215305323.png)



#### â‘¢å‰ç¼€ç´¢å¼•çš„æŸ¥è¯¢æµç¨‹

![image-20250415215455629](./Mysql-Learning-Local.assets/image-20250415215455629.png)



### ï¼ˆ8ï¼‰å•åˆ—ç´¢å¼•ä¸è”åˆç´¢å¼•

> **==æ³¨æ„ï¼š== åˆ›å»ºè”åˆç´¢å¼•æ—¶ï¼Œéœ€è¦==è€ƒè™‘è”åˆç´¢å¼•ä¸­çš„é¡ºåºé—®é¢˜==ï¼Œéœ€è¦è€ƒè™‘==ç´¢å¼•çš„æœ€å·¦å‰ç¼€æ³•åˆ™==**



![image-20250415220717766](./Mysql-Learning-Local.assets/image-20250415220717766.png)



- å•åˆ—ç´¢å¼•ï¼šå³ä¸€ä¸ªç´¢å¼•**åªåŒ…å«å•ä¸ªåˆ—**ã€‚
- è”åˆç´¢å¼•ï¼šå³ä¸€ä¸ªç´¢å¼•**åŒ…å«äº†å¤šä¸ªåˆ—**ã€‚



æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ tb_user è¡¨ä¸­ç›®å‰çš„ç´¢å¼•æƒ…å†µ:

```sql
show index from tb_user;
```

![image-20250415215749977](./Mysql-Learning-Local.assets/image-20250415215749977.png)

åœ¨æŸ¥è¯¢å‡ºæ¥çš„ç´¢å¼•ä¸­ï¼Œæ—¢æœ‰**å•åˆ—ç´¢å¼•ï¼Œåˆæœ‰è”åˆç´¢å¼•**ã€‚



æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥æ‰§è¡Œä¸€æ¡SQLè¯­å¥ï¼Œçœ‹çœ‹å…¶æ‰§è¡Œè®¡åˆ’ï¼š

```sql
explain select id,phone,name from tb_user where phone = '17799990010' and name = 'éŸ©ä¿¡';
```

![image-20250415220146434](./Mysql-Learning-Local.assets/image-20250415220146434.png)

é€šè¿‡ä¸Šè¿°æ‰§è¡Œè®¡åˆ’æˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ¥ï¼Œåœ¨**andè¿æ¥çš„ä¸¤ä¸ªå­—æ®µ phoneã€nameä¸Šéƒ½æ˜¯æœ‰å•åˆ—ç´¢å¼•çš„**ï¼Œä½†æ˜¯æœ€ç»ˆ**mysql==åªä¼šé€‰æ‹©ä¸€ä¸ªç´¢å¼•==**ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåªèƒ½èµ°ä¸€ä¸ªå­—æ®µçš„ç´¢å¼•ï¼Œæ­¤æ—¶æ˜¯ä¼š**==å›è¡¨æŸ¥è¯¢==çš„**ã€‚



ç´§æ¥ç€ï¼Œæˆ‘ä»¬å†æ¥åˆ›å»ºä¸€ä¸ªphoneå’Œnameå­—æ®µçš„è”åˆç´¢å¼•æ¥æŸ¥è¯¢ä¸€ä¸‹æ‰§è¡Œè®¡åˆ’ã€‚

```sql
create unique index idx_user_phone_name on tb_user(phone,name);
```



æ­¤æ—¶ï¼ŒæŸ¥è¯¢æ—¶ï¼Œå°±èµ°äº†è”åˆç´¢å¼•ï¼Œè€Œåœ¨**è”åˆç´¢å¼•ä¸­åŒ…å« phoneã€name**çš„ä¿¡æ¯ï¼Œåœ¨å¶å­èŠ‚ç‚¹ä¸‹æŒ‚çš„æ˜¯å¯¹åº”çš„ä¸»é”®idï¼Œæ‰€ä»¥**æŸ¥è¯¢æ˜¯æ— éœ€å›è¡¨æŸ¥è¯¢çš„**ã€‚

```sql
#ä½¿ç”¨SQLæç¤ºï¼Œè®©Mysqlç”¨æˆ‘åˆ›å»ºçš„è”åˆç´¢å¼•
explain select id,phone,name from tb_user use index(idx_user_phone_name) where phone = '17799990010' and name = 'éŸ©ä¿¡';
```

![image-20250415220605380](./Mysql-Learning-Local.assets/image-20250415220605380.png)



> åœ¨ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œ**å¦‚æœå­˜åœ¨å¤šä¸ªæŸ¥è¯¢æ¡ä»¶**ï¼Œè€ƒè™‘é’ˆå¯¹äºæŸ¥è¯¢å­—æ®µå»ºç«‹ç´¢å¼•æ—¶ï¼Œ**å»ºè®®å»ºç«‹è”åˆç´¢å¼•**ï¼Œè€Œéå•åˆ—ç´¢å¼•ã€‚



å¦‚æœæŸ¥è¯¢ä½¿ç”¨çš„æ˜¯**è”åˆç´¢å¼•**ï¼Œå…·ä½“çš„**ç»“æ„ç¤ºæ„å›¾**å¦‚ä¸‹ï¼š



![image-20250415220902347](./Mysql-Learning-Local.assets/image-20250415220902347.png)





## 2.7 ç´¢å¼•è®¾è®¡åŸåˆ™

![image-20250415221346762](./Mysql-Learning-Local.assets/image-20250415221346762.png)

- 1). é’ˆå¯¹äºæ•°æ®é‡è¾ƒå¤§ï¼ˆ**>100W**ï¼‰ï¼Œä¸”**æŸ¥è¯¢æ¯”è¾ƒé¢‘ç¹**çš„è¡¨å»ºç«‹ç´¢å¼•ã€‚
- 2). é’ˆå¯¹äº**å¸¸ä½œä¸ºæŸ¥è¯¢æ¡ä»¶**ï¼ˆwhereï¼‰ã€æ’åºï¼ˆorder byï¼‰ã€åˆ†ç»„ï¼ˆgroup byï¼‰**æ“ä½œçš„å­—æ®µå»ºç«‹ç´¢å¼•**ã€‚
- 3). å°½é‡é€‰æ‹©åŒº**åˆ†åº¦é«˜çš„åˆ—ä½œä¸ºç´¢å¼•**ï¼Œå°½é‡å»ºç«‹å”¯ä¸€ç´¢å¼•ï¼Œ**åŒºåˆ†åº¦è¶Šé«˜ï¼Œä½¿ç”¨ç´¢å¼•çš„æ•ˆç‡è¶Šé«˜**ã€‚
- 4). å¦‚æœæ˜¯å­—ç¬¦ä¸²ç±»å‹çš„å­—æ®µï¼Œå­—æ®µçš„**é•¿åº¦è¾ƒé•¿**ï¼Œå¯ä»¥é’ˆå¯¹äºå­—æ®µçš„ç‰¹ç‚¹ï¼Œ**å»ºç«‹å‰ç¼€ç´¢å¼•**ã€‚
- 5). **å°½é‡ä½¿ç”¨è”åˆç´¢å¼•**ï¼Œå‡å°‘å•åˆ—ç´¢å¼•ï¼ŒæŸ¥è¯¢æ—¶ï¼Œè”åˆç´¢å¼•å¾ˆå¤šæ—¶å€™å¯ä»¥è¦†ç›–ç´¢å¼•ï¼ŒèŠ‚çœå­˜å‚¨ç©ºé—´ï¼Œ**é¿å…å›è¡¨**ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚
- 6). è¦æ§åˆ¶ç´¢å¼•çš„æ•°é‡ï¼Œç´¢å¼•å¹¶ä¸æ˜¯å¤šå¤šç›Šå–„ï¼Œ**ç´¢å¼•è¶Šå¤šï¼Œç»´æŠ¤ç´¢å¼•ç»“æ„çš„ä»£ä»·ä¹Ÿå°±è¶Šå¤§**ï¼Œ**ä¼šå½±å“å¢åˆ æ”¹çš„æ•ˆç‡ã€‚**
- 7). **å¦‚æœç´¢å¼•åˆ—ä¸èƒ½å­˜å‚¨NULLå€¼**ï¼Œè¯·åœ¨**åˆ›å»ºè¡¨æ—¶ä½¿ç”¨NOT NULLçº¦æŸå®ƒ**ã€‚å½“ä¼˜åŒ–å™¨çŸ¥é“æ¯åˆ—æ˜¯å¦åŒ…å«NULLå€¼æ—¶ï¼Œå®ƒå¯ä»¥æ›´å¥½åœ°ç¡®å®šå“ªä¸ªç´¢å¼•æœ€æœ‰æ•ˆåœ°ç”¨äºæŸ¥è¯¢ã€‚



## 2.8 å°ç»“

![image-20250415221540478](./Mysql-Learning-Local.assets/image-20250415221540478.png)



![image-20250415221840175](./Mysql-Learning-Local.assets/image-20250415221840175.png)



# 3ã€ğŸŒŸ SQLä¼˜åŒ–

## 3.1 æ’å…¥æ•°æ®

### ï¼ˆ1ï¼‰insert

![image-20250416161441229](./Mysql-Learning-Local.assets/image-20250416161441229.png)

å¦‚æœæˆ‘ä»¬éœ€è¦ä¸€æ¬¡æ€§å¾€æ•°æ®åº“è¡¨ä¸­æ’å…¥å¤šæ¡è®°å½•ï¼Œå¯ä»¥ä»ä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢è¿›è¡Œä¼˜åŒ–ã€‚

```sql
insert into tb_test values(1,'tom');
insert into tb_test values(2,'cat');
insert into tb_test values(3,'jerry');
.....
```

#### â‘ ä¼˜åŒ–æ–¹æ¡ˆä¸€-æ‰¹é‡æ’å…¥æ•°æ®

**æ¨èæ‰¹é‡æ’å…¥æ•°é‡åœ¨  500 - 1000æ¡**

```sql
Insert into tb_test values(1,'Tom'),(2,'Cat'),(3,'Jerry');
```



#### â‘¡ä¼˜åŒ–æ–¹æ¡ˆäºŒ-==æ‰‹åŠ¨æ§åˆ¶äº‹åŠ¡==

ç”±äºæ•°æ®åº“æ‰§è¡Œä¸€æ¡insertè¯­å¥å°±ä¼šå¼€å¯å’Œå…³é—­äº‹åŠ¡ï¼Œå¯ä»¥**æ‰‹åŠ¨æ§åˆ¶äº‹åŠ¡**ï¼Œè¿›è€Œ**é¿å…é¢‘ç¹å¼€å§‹å…³é—­äº‹åŠ¡**

```sql
start transaction;
insert into tb_test values(1,'Tom'),(2,'Cat'),(3,'Jerry');
insert into tb_test values(4,'Tom'),(5,'Cat'),(6,'Jerry');
insert into tb_test values(7,'Tom'),(8,'Cat'),(9,'Jerry');
commit;
```



#### â‘¢ä¼˜åŒ–æ–¹æ¡ˆä¸‰-é¡ºåºæ’å…¥

ä¸»é”®é¡ºåºæ’å…¥ï¼Œæ€§èƒ½è¦é«˜äºä¹±åºæ’å…¥ã€‚

```sql
ä¸»é”®ä¹±åºæ’å…¥ : 8 1 9 21 88 2 4 15 89 5 7 3
ä¸»é”®é¡ºåºæ’å…¥ : 1 2 3 4 5 7 8 9 15 21 88 89
```



### ï¼ˆ2ï¼‰å¤§æ‰¹é‡æ’å…¥æ•°æ®-==loadæŒ‡ä»¤==

![image-20250416162221957](./Mysql-Learning-Local.assets/image-20250416162221957.png)

#### â‘ loadæŒ‡ä»¤æ’å…¥

å¦‚æœä¸€æ¬¡æ€§éœ€è¦æ’å…¥å¤§æ‰¹é‡æ•°æ®(æ¯”å¦‚: å‡ ç™¾ä¸‡çš„è®°å½•)ï¼Œä½¿ç”¨insertè¯­å¥æ’å…¥æ€§èƒ½è¾ƒä½ï¼Œæ­¤æ—¶å¯ä»¥**ä½¿ç”¨MySQLæ•°æ®åº“æä¾›çš„==loadæŒ‡ä»¤==è¿›è¡Œæ’å…¥**ã€‚æ“ä½œå¦‚ä¸‹ï¼š



å¯ä»¥æ‰§è¡Œå¦‚ä¸‹æŒ‡ä»¤ï¼Œå°†**æ•°æ®è„šæœ¬æ–‡ä»¶ä¸­çš„æ•°æ®åŠ è½½åˆ°è¡¨ç»“æ„**ä¸­ï¼š

```sql
-- å®¢æˆ·ç«¯è¿æ¥æœåŠ¡ç«¯æ—¶ï¼ŒåŠ ä¸Šå‚æ•° -â€“local-infile
mysql â€“-local-infile -u root -p

#è‹¥å¤±è´¥åˆ™ä½¿ç”¨ï¼š
mysql --local-infile=1 --enable-local-infile -u root -p

-- è®¾ç½®å…¨å±€å‚æ•°local_infileä¸º1ï¼Œå¼€å¯ä»æœ¬åœ°åŠ è½½æ–‡ä»¶å¯¼å…¥æ•°æ®çš„å¼€å…³
set global local_infile = 1;

-- æ‰§è¡ŒloadæŒ‡ä»¤å°†å‡†å¤‡å¥½çš„æ•°æ®ï¼ŒåŠ è½½åˆ°è¡¨ç»“æ„ä¸­
load data local infile '/root/sql1.log' into table tb_user fields terminated by ',' lines terminated by '\n' ;

#è¿™é‡Œçš„ , è¡¨ç¤ºæ¯ä¸ªå­—æ®µæŒ‰ç…§,åˆ†éš”;
	   \n è¡¨ç¤ºä¸€è¡ŒæŒ‰ç…§\nåˆ†éš”
	  
```



> ä¸»é”®==é¡ºåºæ’å…¥æ€§èƒ½==é«˜äº**ä¹±åºæ’å…¥**



#### â‘¡ç¤ºä¾‹æ¼”ç¤º

**A. åˆ›å»ºè¡¨ç»“æ„**

```sql
CREATE TABLE `tb_user` (
    `id` INT(11) NOT NULL AUTO_INCREMENT,
    `username` VARCHAR(50) NOT NULL,
    `password` VARCHAR(50) NOT NULL,
    `name` VARCHAR(20) NOT NULL,
    `birthday` DATE DEFAULT NULL,
    `sex` CHAR(1) DEFAULT NULL,
    PRIMARY KEY (`id`),
    UNIQUE KEY `unique_user_username` (`username`)
) ENGINE=INNODB DEFAULT CHARSET=utf8 ;
```

**B. è®¾ç½®å‚æ•°**

```sql
-- å®¢æˆ·ç«¯è¿æ¥æœåŠ¡ç«¯æ—¶ï¼ŒåŠ ä¸Šå‚æ•° -â€“local-infile
mysql â€“-local-infile -u root -p

#è‹¥å¤±è´¥åˆ™ä½¿ç”¨ï¼š
mysql --local-infile=1 --enable-local-infile -u username -p

# æŸ¥çœ‹local_infile çš„å€¼ 
Select @@local_infile;

-- è®¾ç½®å…¨å±€å‚æ•°local_infileä¸º1ï¼Œå¼€å¯ä»æœ¬åœ°åŠ è½½æ–‡ä»¶å¯¼å…¥æ•°æ®çš„å¼€å…³
set global local_infile = 1;
```

![image-20250416161907516](./Mysql-Learning-Local.assets/image-20250416161907516.png)





**C. loadåŠ è½½æ•°æ®**

![image-20250416162429689](./Mysql-Learning-Local.assets/image-20250416162429689.png)

```sql
# ä¸Šä¼ sqlè„šæœ¬åˆ°LinuxæœåŠ¡å™¨

# æŸ¥çœ‹sqlè„šæœ¬çš„å‰10æ¡æ•°æ®
head load_user_100w_sort.sql;

# loadåŠ è½½æ•°æ®
load data local infile '/root/load_user_100w_sort.sql' into table tb_user fields terminated by ',' lines terminated by '\n' ;
```

æˆ‘ä»¬çœ‹åˆ°ï¼Œæ’å…¥100wçš„è®°å½•ï¼Œ17så°±å®Œæˆäº†ï¼Œæ€§èƒ½å¾ˆå¥½ã€‚

![image-20250416162625767](./Mysql-Learning-Local.assets/image-20250416162625767.png)



> åœ¨loadæ—¶ï¼Œ**==ä¸»é”®é¡ºåºæ’å…¥æ€§èƒ½é«˜äºä¹±åºæ’å…¥==**





## 3.2 ğŸŒŸä¸»é”®ä¼˜åŒ–

åœ¨ä¸Šä¸€å°èŠ‚ï¼Œæˆ‘ä»¬æåˆ°ï¼Œä¸»é”®é¡ºåºæ’å…¥çš„æ€§èƒ½æ˜¯è¦é«˜äºä¹±åºæ’å…¥çš„ã€‚ è¿™ä¸€å°èŠ‚ï¼Œå°±æ¥ä»‹ç»ä¸€ä¸‹å…·ä½“çš„åŸå› ï¼Œç„¶åå†åˆ†æä¸€ä¸‹ä¸»é”®åˆè¯¥å¦‚ä½•è®¾è®¡ã€‚

###  ï¼ˆ1ï¼‰æ•°æ®ç»„ç»‡æ–¹å¼

åœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼Œè¡¨æ•°æ®éƒ½æ˜¯æ ¹æ®**==ä¸»é”®é¡ºåºç»„ç»‡å­˜æ”¾==**çš„ï¼Œè¿™ç§å­˜å‚¨æ–¹å¼çš„è¡¨ç§°ä¸º**ç´¢å¼•ç»„ç»‡è¡¨**(index organized table **IOT**)ã€‚

![image-20250416163715035](./Mysql-Learning-Local.assets/image-20250416163715035.png)



**è¡Œæ•°æ®**ï¼Œéƒ½æ˜¯å­˜å‚¨**åœ¨==èšé›†ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ä¸Š==çš„**ã€‚**éå¶å­èŠ‚ç‚¹ï¼Œå­˜å‚¨çš„åªæ˜¯==èµ·åˆ°ç´¢å¼•æ•°æ®çš„ä½œç”¨==**ï¼Œè€Œæˆ‘ä»¬ä¹‹å‰ä¹Ÿè®²è§£è¿‡InnoDBçš„**é€»è¾‘ç»“æ„å›¾**ï¼š

![image-20250416163750342](./Mysql-Learning-Local.assets/image-20250416163750342.png)



åœ¨InnoDBå¼•æ“ä¸­ï¼Œæ•°æ®è¡Œæ˜¯è®°å½•åœ¨**é€»è¾‘ç»“æ„ page é¡µ**ä¸­çš„ï¼Œè€Œæ¯ä¸€ä¸ªé¡µçš„å¤§å°æ˜¯å›ºå®šçš„ï¼Œ**é»˜è®¤16K**ã€‚é‚£ä¹Ÿå°±æ„å‘³ç€ï¼Œ **ä¸€ä¸ªé¡µä¸­æ‰€å­˜å‚¨çš„è¡Œä¹Ÿæ˜¯æœ‰é™çš„**ï¼Œå¦‚æœæ’å…¥çš„æ•°æ®è¡Œrowåœ¨è¯¥é¡µå­˜å‚¨ä¸äº†ï¼Œ**å°†ä¼šå­˜å‚¨åˆ°ä¸‹ä¸€ä¸ªé¡µä¸­**ï¼Œ**é¡µä¸é¡µä¹‹é—´ä¼š==é€šè¿‡æŒ‡é’ˆè¿æ¥==**ã€‚



### ï¼ˆ2ï¼‰==é¡µåˆ†è£‚==

**é¡µå¯ä»¥ä¸ºç©º**ï¼Œä¹Ÿå¯ä»¥å¡«å……ä¸€åŠï¼Œä¹Ÿå¯ä»¥å¡«å……100%ã€‚**æ¯ä¸ªé¡µåŒ…å«äº†2-Nè¡Œæ•°æ®**(**å¦‚æœä¸€è¡Œæ•°æ®è¿‡å¤§ï¼Œä¼šè¡Œæº¢å‡º**)ï¼Œæ ¹æ®ä¸»é”®æ’åˆ—ã€‚

##### **A. ä¸»é”®==é¡ºåºæ’å…¥==æ•ˆæœ**

**â‘ . ä»ç£ç›˜ä¸­==ç”³è¯·é¡µ==ï¼Œ ä¸»é”®é¡ºåºæ’å…¥**

![image-20250416163941796](./Mysql-Learning-Local.assets/image-20250416163941796.png)

**â‘¡. ç¬¬ä¸€ä¸ªé¡µæ²¡æœ‰æ»¡ï¼Œç»§ç»­å¾€ç¬¬ä¸€é¡µæ’å…¥**

![image-20250416163951466](./Mysql-Learning-Local.assets/image-20250416163951466.png)

**â‘¢. å½“ç¬¬ä¸€ä¸ªä¹Ÿå†™æ»¡ä¹‹åï¼Œå†å†™å…¥ç¬¬äºŒä¸ªé¡µï¼Œé¡µä¸é¡µä¹‹é—´ä¼šé€šè¿‡æŒ‡é’ˆè¿æ¥**

![image-20250416163959684](./Mysql-Learning-Local.assets/image-20250416163959684.png)

**â‘£. å½“ç¬¬äºŒé¡µå†™æ»¡äº†ï¼Œå†å¾€ç¬¬ä¸‰é¡µå†™å…¥**

![image-20250416164005769](./Mysql-Learning-Local.assets/image-20250416164005769.png)



##### **B. ä¸»é”®==ä¹±åºæ’å…¥==æ•ˆæœ**

**â‘ . åŠ å…¥1#,2#é¡µéƒ½å·²ç»å†™æ»¡äº†ï¼Œå­˜æ”¾äº†å¦‚å›¾æ‰€ç¤ºçš„æ•°æ®**

![image-20250416164027268](./Mysql-Learning-Local.assets/image-20250416164027268.png)



**â‘¡. æ­¤æ—¶å†æ’å…¥idä¸º50çš„è®°å½•ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆç°è±¡**

ä¼šå†æ¬¡å¼€å¯ä¸€ä¸ªé¡µï¼Œå†™å…¥æ–°çš„é¡µä¸­å—ï¼Ÿ

![image-20250416164101094](./Mysql-Learning-Local.assets/image-20250416164101094.png)





ä¸ä¼šã€‚å› ä¸ºï¼Œ**==ç´¢å¼•ç»“æ„çš„å¶å­èŠ‚ç‚¹æ˜¯æœ‰é¡ºåºçš„==**ã€‚æŒ‰ç…§**é¡ºåº**ï¼Œåº”è¯¥**å­˜å‚¨åœ¨47ä¹‹å**ã€‚

![image-20250416164134506](./Mysql-Learning-Local.assets/image-20250416164134506.png)

ä½†æ˜¯47æ‰€åœ¨çš„**1#é¡µï¼Œå·²ç»å†™æ»¡äº†**ï¼Œå­˜å‚¨ä¸äº†50å¯¹åº”çš„æ•°æ®äº†ã€‚ é‚£ä¹ˆæ­¤æ—¶ä¼š**å¼€è¾Ÿä¸€ä¸ªæ–°çš„é¡µ 3#ã€‚**

![image-20250416164148521](./Mysql-Learning-Local.assets/image-20250416164148521.png)

ä½†æ˜¯**å¹¶ä¸ä¼šç›´æ¥å°†50å­˜å…¥3#é¡µ**ï¼Œè€Œæ˜¯**ä¼šå°†1#é¡µåä¸€åŠçš„æ•°æ®ï¼Œç§»åŠ¨åˆ°3#é¡µ**ï¼Œç„¶å**==åœ¨3#é¡µï¼Œæ’å…¥50==**ã€‚

![image-20250416164202712](./Mysql-Learning-Local.assets/image-20250416164202712.png)

![image-20250416164208130](./Mysql-Learning-Local.assets/image-20250416164208130.png)

ç§»åŠ¨æ•°æ®ï¼Œå¹¶æ’å…¥idä¸º50çš„æ•°æ®ä¹‹åï¼Œé‚£ä¹ˆæ­¤æ—¶ï¼Œè¿™ä¸‰ä¸ªé¡µä¹‹é—´çš„**æ•°æ®é¡ºåº**æ˜¯æœ‰é—®é¢˜çš„ã€‚ 1#çš„ä¸‹ä¸€ä¸ªé¡µï¼Œåº”è¯¥æ˜¯3#ï¼Œ 3#çš„ä¸‹ä¸€ä¸ªé¡µæ˜¯2#ã€‚ æ‰€ä»¥ï¼Œæ­¤æ—¶ï¼Œ**éœ€è¦é‡æ–°è®¾ç½®é“¾è¡¨æŒ‡é’ˆ**ã€‚

![image-20250416164243644](./Mysql-Learning-Local.assets/image-20250416164243644.png)

ä¸Šè¿°çš„è¿™ç§ç°è±¡ï¼Œç§°ä¹‹ä¸º "é¡µåˆ†è£‚"ï¼Œæ˜¯**==æ¯”è¾ƒè€—è´¹æ€§èƒ½çš„æ“ä½œ==**ã€‚



### ï¼ˆ3ï¼‰é¡µåˆå¹¶

![image-20250416164604963](./Mysql-Learning-Local.assets/image-20250416164604963.png)

ç›®å‰è¡¨ä¸­å·²æœ‰æ•°æ®çš„ç´¢å¼•ç»“æ„(å¶å­èŠ‚ç‚¹)å¦‚ä¸‹ï¼š

![image-20250416164334276](./Mysql-Learning-Local.assets/image-20250416164334276.png)

å½“æˆ‘ä»¬**å¯¹å·²æœ‰æ•°æ®è¿›è¡Œåˆ é™¤**æ—¶ï¼Œå…·ä½“çš„æ•ˆæœå¦‚ä¸‹:

å½“åˆ é™¤ä¸€è¡Œè®°å½•æ—¶ï¼Œ**å®é™…ä¸Šè®°å½•å¹¶æ²¡æœ‰è¢«ç‰©ç†åˆ é™¤**ï¼Œåªæ˜¯**è®°å½•==è¢«æ ‡è®°ï¼ˆflagedï¼‰ä¸ºåˆ é™¤==**å¹¶ä¸”**å®ƒçš„ç©ºé—´å˜å¾—å…è®¸è¢«å…¶ä»–è®°å½•å£°æ˜ä½¿ç”¨**ã€‚

![image-20250416164406947](./Mysql-Learning-Local.assets/image-20250416164406947.png)

å½“æˆ‘ä»¬ç»§ç»­åˆ é™¤2#çš„æ•°æ®è®°å½•

![image-20250416164419849](./Mysql-Learning-Local.assets/image-20250416164419849.png)

å½“é¡µä¸­åˆ é™¤çš„è®°å½•**è¾¾åˆ° MERGE_THRESHOLDï¼ˆé»˜è®¤ä¸º==é¡µçš„50%==ï¼‰**ï¼ŒInnoDBä¼šå¼€å§‹**å¯»æ‰¾æœ€é è¿‘çš„é¡µï¼ˆå‰æˆ–å**ï¼‰çœ‹çœ‹**æ˜¯å¦å¯ä»¥å°†ä¸¤ä¸ªé¡µ==åˆå¹¶ä»¥ä¼˜åŒ–ç©ºé—´ä½¿ç”¨==**ã€‚

![image-20250416164457100](./Mysql-Learning-Local.assets/image-20250416164457100.png)

![image-20250416164504470](./Mysql-Learning-Local.assets/image-20250416164504470.png)

åˆ é™¤æ•°æ®ï¼Œå¹¶å°†é¡µåˆå¹¶ä¹‹åï¼Œ**å†æ¬¡æ’å…¥æ–°çš„æ•°æ®21**ï¼Œåˆ™ç›´æ¥æ’å…¥3#é¡µ

![image-20250416164514397](./Mysql-Learning-Local.assets/image-20250416164514397.png)



è¿™ä¸ªé‡Œé¢æ‰€å‘ç”Ÿçš„åˆå¹¶é¡µçš„è¿™ä¸ªç°è±¡ï¼Œå°±ç§°ä¹‹ä¸º **"é¡µåˆå¹¶"**ã€‚



> **çŸ¥è¯†å°è´´å£«ï¼š**
>
> MERGE_THRESHOLDï¼š**åˆå¹¶é¡µçš„é˜ˆå€¼ï¼Œå¯ä»¥è‡ªå·±è®¾ç½®ï¼Œåœ¨==åˆ›å»ºè¡¨æˆ–è€…åˆ›å»ºç´¢å¼•==æ—¶æŒ‡å®šã€‚**



### ï¼ˆ4ï¼‰ä¸»é”®è®¾è®¡åŸåˆ™

![image-20250416165433932](./Mysql-Learning-Local.assets/image-20250416165433932.png)

- æ»¡è¶³ä¸šåŠ¡éœ€æ±‚çš„æƒ…å†µä¸‹ï¼Œå°½é‡**==é™ä½ä¸»é”®çš„é•¿åº¦==**ã€‚
  - ç”±äº**äºŒçº§ç´¢å¼•ä¿å­˜æ•°æ®çš„æ˜¯ä¸»é”®çš„id**ï¼Œå¦‚æœä¸»é”®é•¿åº¦è¿‡å¤§ä¼šå¯¼è‡´ï¼Œ**å ç”¨å¤§é‡çš„ç£ç›˜ç©ºé—´ã€‚**

- æ’å…¥æ•°æ®æ—¶ï¼Œ**å°½é‡é€‰æ‹©==é¡ºåºæ’å…¥==**ï¼Œé€‰æ‹©ä½¿ç”¨**AUTO_INCREMENTè‡ªå¢ä¸»é”®**ã€‚
  - é¿å…å‡ºç°é¡µåˆ†è£‚ç°è±¡
  - å¦‚æœæ’å…¥æ˜¯è‡ªå¢ä¸»é”®ï¼Œä¼š**ä¾æ¬¡æ’å…¥å¯¹åº”åˆ°é¡µä¸­**(å¦‚æœå½“å‰é¡µæ»¡äº†åˆ™åˆ›å»ºæ–°çš„é¡µå³å¯)ï¼Œ**æ— éœ€è°ƒæ•´é¡µçš„é¡ºåº**ï¼Œæé«˜äº†æ€§èƒ½ã€‚
  - å¦‚æœæ˜¯ä¹±åºæ’å…¥ï¼Œä¼šå› ä¸ºéœ€è¦**ä¿æŒå¶å­èŠ‚ç‚¹ä¸­çš„æ•°æ®æ˜¯æœ‰åºçš„è¿™ä¸€åŸåˆ™**ï¼Œè€Œéœ€è¦**ä¸æ–­åœ°è°ƒæ•´ä¹Ÿä¸­æ•°æ®çš„ä½ç½®ä»¥åŠé¡µçš„ä½ç½®**ï¼Œè¿›è€Œå¯¼è‡´å¢åŠ æ’å…¥æ—¶çš„æ€§èƒ½æŸå¤±ã€‚

- å°½é‡**ä¸è¦ä½¿ç”¨UUIDåšä¸»é”®**æˆ–è€…æ˜¯å…¶ä»–è‡ªç„¶ä¸»é”®ï¼Œå¦‚èº«ä»½è¯å·ã€‚
  - UUIDæ˜¯æ— åºçš„
  - UUIDçš„é•¿åº¦æœ‰äº›é•¿ï¼Œä¼šè®©ä¸»é”®çš„é•¿åº¦åé•¿

- ä¸šåŠ¡æ“ä½œæ—¶ï¼Œ**==é¿å…å¯¹ä¸»é”®çš„ä¿®æ”¹==**ã€‚
  - å› ä¸º**åœ¨äºŒçº§ç´¢å¼•çš„ç´¢å¼•ç»“æ„ä¸­ä¿å­˜çš„æ•°æ®æ˜¯ä¸»é”®çš„id**ï¼Œå¦‚æœç›´æ¥å¯¹ä¸»é”®è¿›è¡Œä¿®æ”¹ï¼ŒåŒæ—¶éœ€è¦ä¿®æ”¹å¯¹åº”äºŒçº§ç´¢å¼•ä¸­çš„ä¸»é”®idï¼Œè¿™æ ·ä¿®æ”¹çš„ä»£ä»·è¿‡å¤§






## 3.3 order byä¼˜åŒ–

### ï¼ˆ1ï¼‰æ’åºæ–¹å¼

#### â‘ Using filesort

#### â‘¡Using index

MySQLçš„æ’åºï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼š

- **Using filesort** : é€šè¿‡**è¡¨çš„ç´¢å¼•æˆ–å…¨è¡¨æ‰«æ**ï¼Œè¯»å–æ»¡è¶³æ¡ä»¶çš„æ•°æ®è¡Œï¼Œç„¶å**åœ¨æ’åºç¼“å†²åŒºsort bufferä¸­å®Œæˆæ’åºæ“ä½œ**ï¼Œ**æ‰€æœ‰==ä¸æ˜¯é€šè¿‡ç´¢å¼•ç›´æ¥è¿”å›æ’åºç»“æœ==çš„æ’åºéƒ½å« FileSort æ’åºã€‚**
- **Using index** : **é€šè¿‡==æœ‰åºç´¢å¼•é¡ºåºæ‰«æç›´æ¥è¿”å›æœ‰åºæ•°æ®==**ï¼Œè¿™ç§æƒ…å†µå³ä¸º using indexï¼Œä¸éœ€è¦é¢å¤–æ’åºï¼Œ**æ“ä½œæ•ˆç‡é«˜**ã€‚

å¯¹äºä»¥ä¸Šçš„ä¸¤ç§æ’åºæ–¹å¼ï¼Œ**Using indexçš„æ€§èƒ½é«˜**ï¼Œè€ŒUsing filesortçš„æ€§èƒ½ä½ï¼Œæˆ‘ä»¬åœ¨ä¼˜åŒ–æ’åºæ“ä½œæ—¶ï¼Œå°½é‡è¦ä¼˜åŒ–ä¸º Using indexã€‚



### ï¼ˆ2ï¼‰æµ‹è¯•

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥åšä¸€ä¸ªæµ‹è¯•ï¼š

#### **A. æ•°æ®å‡†å¤‡**

æŠŠä¹‹å‰æµ‹è¯•æ—¶ï¼Œä¸ºtb_userè¡¨æ‰€å»ºç«‹çš„éƒ¨åˆ†ç´¢å¼•ç›´æ¥åˆ é™¤æ‰

```sql
show index from tb_user;

drop index idx_user_phone on tb_user;

drop index idx_user_phone_name on tb_user;

drop index idx_user_name on tb_user;
```

![image-20250416171144687](./Mysql-Learning-Local.assets/image-20250416171144687.png)

![image-20250416171302562](./Mysql-Learning-Local.assets/image-20250416171302562.png)



#### **B. æ‰§è¡Œæ’åºSQL**

```sql
explain select id,age,phone from tb_user order by age ; 
```



```sql
explain select id,age,phone from tb_user order by age, phone ; 
```

![image-20250416171351789](./Mysql-Learning-Local.assets/image-20250416171351789.png)

ç”±äº **age, phone éƒ½æ²¡æœ‰ç´¢å¼•**ï¼Œæ‰€ä»¥æ­¤æ—¶å†æ’åºæ—¶ï¼Œå‡ºç°**Using filesortï¼Œ æ’åºæ€§èƒ½è¾ƒä½**ã€‚



#### **C. åˆ›å»ºç´¢å¼•**

```sql
-- åˆ›å»ºç´¢å¼•
create index idx_user_age_phone_aa on tb_user(age,phone);
# è¿™é‡Œç´¢å¼•åå­—å‘½åä¸­çš„ _aa è¡¨ç¤ºçš„æ˜¯ageå’Œphoneéƒ½æ˜¯æŒ‰ç…§ å‡åºæ’åº åˆ›å»ºçš„ç´¢å¼•
```

![image-20250416171600235](./Mysql-Learning-Local.assets/image-20250416171600235.png)



#### **D. åˆ›å»ºç´¢å¼•åï¼Œæ ¹æ®age, phoneè¿›è¡Œå‡åºæ’åº**

```sql
explain select id,age,phone from tb_user order by age; 
```

![image-20250416171652850](./Mysql-Learning-Local.assets/image-20250416171652850.png)

```sql
explain select id,age,phone from tb_user order by age , phone; 
```

![image-20250416171704332](./Mysql-Learning-Local.assets/image-20250416171704332.png)

å»ºç«‹ç´¢å¼•ä¹‹åï¼Œå†æ¬¡è¿›è¡Œæ’åºæŸ¥è¯¢ï¼Œå°±ç”±**åŸæ¥çš„Using filesortï¼Œ å˜ä¸ºäº† Using index**ï¼Œæ€§èƒ½å°±æ˜¯æ¯”è¾ƒé«˜çš„äº†ã€‚

**å¦‚æœåªå¯¹phoneè¿›è¡Œå‡åºæ’åº**

```sql
 explain select id , phone from tb_user order by phone;
```

![image-20250416172201885](./Mysql-Learning-Local.assets/image-20250416172201885.png)



#### **E. åˆ›å»ºç´¢å¼•åï¼Œæ ¹æ®age, phoneè¿›è¡Œ==é™åºæ’åº==**

```sql
explain select id,age,phone from tb_user order by age desc , phone desc; 
```

![image-20250416172535693](./Mysql-Learning-Local.assets/image-20250416172535693.png)

ä¹Ÿå‡ºç° Using indexï¼Œ ä½†æ˜¯æ­¤æ—¶Extraä¸­å‡ºç°äº† **Backward index scan**ï¼Œè¿™ä¸ª**ä»£è¡¨åå‘æ‰«æç´¢å¼•**ï¼Œ

å› ä¸ºåœ¨MySQLä¸­æˆ‘ä»¬åˆ›å»ºçš„ç´¢å¼•ï¼Œ**==é»˜è®¤ç´¢å¼•çš„å¶å­èŠ‚ç‚¹æ˜¯ä»å°åˆ°å¤§æ’åºçš„==**ï¼Œè€Œæ­¤æ—¶æˆ‘ä»¬æŸ¥è¯¢æ’åºæ—¶ï¼Œæ˜¯ä»å¤§åˆ°å°ï¼ˆdesc é™åºæ’åˆ—ï¼‰

æ‰€ä»¥ï¼Œåœ¨æ‰«ææ—¶ï¼Œå°±æ˜¯**åå‘æ‰«æ**ï¼Œå°±ä¼šå‡ºç° **Backward index scan**ã€‚ åœ¨MySQL8ç‰ˆæœ¬ä¸­ï¼Œæ”¯æŒé™åºç´¢å¼•ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥**åˆ›å»ºé™åºç´¢å¼•**ã€‚



#### **F. æ ¹æ®phoneï¼Œageè¿›è¡Œå‡åºæ’åºï¼Œ==phoneåœ¨å‰ï¼Œageåœ¨å==ã€‚**

```sql
explain select id,age,phone from tb_user order by phone , age; 
```

![image-20250416172602287](./Mysql-Learning-Local.assets/image-20250416172602287.png)

æ’åºæ—¶,ä¹Ÿéœ€è¦**æ»¡è¶³==æœ€å·¦å‰ç¼€æ³•åˆ™==,å¦åˆ™ä¹Ÿä¼šå‡ºç° filesort**ã€‚

å› ä¸ºåœ¨**åˆ›å»ºç´¢å¼•**çš„æ—¶å€™ï¼Œ ageæ˜¯ç¬¬ä¸€ä¸ªå­—æ®µï¼Œphoneæ˜¯ç¬¬äºŒä¸ªå­—æ®µï¼Œæ‰€ä»¥æ’åºæ—¶ï¼Œä¹Ÿå°±è¯¥**æŒ‰ç…§è¿™ä¸ªé¡ºåºæ¥**ï¼Œå¦åˆ™**å°±ä¼šå‡ºç° Usingfilesort**ã€‚



#### **G. æ ¹æ®age, phoneè¿›è¡Œé™åºä¸€ä¸ªå‡åºï¼Œä¸€ä¸ªé™åº**

```sql
explain select id,age,phone from tb_user order by age asc , phone desc ; 
```

![image-20250416172631864](./Mysql-Learning-Local.assets/image-20250416172631864.png)

å› ä¸ºåˆ›å»ºç´¢å¼•æ—¶ï¼Œ**å¦‚æœ==æœªæŒ‡å®šé¡ºåº==ï¼Œé»˜è®¤éƒ½æ˜¯æŒ‰ç…§å‡åºæ’åºçš„**ï¼Œè€ŒæŸ¥è¯¢æ—¶ï¼Œ**ä¸€ä¸ªå‡åºï¼Œä¸€ä¸ªé™åºï¼Œæ­¤æ—¶å°±ä¼šå‡ºç°Using filesort**ã€‚



ä¸ºäº†è§£å†³ä¸Šè¿°çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªç´¢å¼•ï¼Œè¿™ä¸ªè”åˆç´¢å¼•ä¸­ **age å‡åºæ’åºï¼Œphone å€’åº**æ’åºã€‚



#### **H. åˆ›å»ºè”åˆç´¢å¼•(age å‡åºæ’åºï¼Œphone å€’åºæ’åº)**

```sql
create index idx_user_age_phone_ad on tb_user(age asc ,phone desc); 
# è¿™é‡Œç´¢å¼•åå­—å‘½åä¸­çš„ _ad è¡¨ç¤ºçš„æ˜¯ age å‡åºæ’åºï¼Œphone å€’åºæ’åº åˆ›å»ºçš„ç´¢å¼•
```

![image-20250416172805864](./Mysql-Learning-Local.assets/image-20250416172805864.png)



#### **I. ç„¶åå†æ¬¡æ‰§è¡Œå¦‚ä¸‹SQL**

```sql
explain select id,age,phone from tb_user order by age asc , phone desc ; 
```

![image-20250416172836448](./Mysql-Learning-Local.assets/image-20250416172836448.png)



å‡åº/é™åº**è”åˆç´¢å¼•ç»“æ„å›¾ç¤º**:

![image-20250416173020989](./Mysql-Learning-Local.assets/image-20250416173020989.png)



### ï¼ˆ3ï¼‰==ä¼˜åŒ–åŸåˆ™==

![image-20250416173452795](./Mysql-Learning-Local.assets/image-20250416173452795.png)

ç”±ä¸Šè¿°çš„æµ‹è¯•,æˆ‘ä»¬å¾—å‡º**order byä¼˜åŒ–åŸåˆ™**:

- A. æ ¹æ®æ’åºå­—æ®µå»ºç«‹åˆé€‚çš„ç´¢å¼•ï¼Œ**å¤šå­—æ®µæ’åº**æ—¶ï¼Œä¹Ÿ**éµå¾ªæœ€å·¦å‰ç¼€æ³•åˆ™**ã€‚

- B. **å°½é‡ä½¿ç”¨==è¦†ç›–ç´¢å¼•==**ã€‚

  - å¦‚æœ**ä¸ä½¿ç”¨è¦†ç›–ç´¢å¼•**ï¼ˆå¦‚Select * fromï¼‰çš„è¯ï¼Œè¿˜æ˜¯ä¼šä½¿ç”¨Using filesortæ–¹å¼è¿›è¡Œæ’åº

  - ```sql
    explain select * from tb_user order by age asc , phone desc ; 
    ```

  ![image-20250416173415968](./Mysql-Learning-Local.assets/image-20250416173415968.png)

  

- C. å¤šå­—æ®µæ’åº, ä¸€ä¸ªå‡åºä¸€ä¸ªé™åºï¼Œæ­¤æ—¶éœ€è¦**æ³¨æ„è”åˆç´¢å¼•åœ¨åˆ›å»ºæ—¶çš„è§„åˆ™**ï¼ˆASC/DESCï¼‰ã€‚

- D. å¦‚æœ**ä¸å¯é¿å…**çš„å‡ºç°filesortï¼Œå¤§æ•°æ®é‡æ’åºæ—¶ï¼Œå¯ä»¥**é€‚å½“å¢å¤§æ’åºç¼“å†²åŒºå¤§å°sort_buffer_size(é»˜è®¤256k)**,å¦‚æœè¶…è¿‡äº†è®¾ç½®çš„æ’åºç¼“å­˜åŒºçš„å¤§å°ï¼Œä¼šåœ¨ç£ç›˜æ–‡ä»¶ä¸­è¿›è¡Œæ’åºï¼Œç›¸å¯¹çš„ç£ç›˜ä¸­è¿›è¡Œæ’åºä¼šæ…¢å¾—å¤šã€‚

  - ```sql
    show variables like 'sort_buffer_size';
    ```

    



## 3.4 group byä¼˜åŒ–

åˆ†ç»„æ“ä½œï¼Œæˆ‘ä»¬ä¸»è¦æ¥çœ‹çœ‹**ç´¢å¼•å¯¹äºåˆ†ç»„æ“ä½œ**çš„å½±å“ã€‚

![image-20250416174851892](./Mysql-Learning-Local.assets/image-20250416174851892.png)



é¦–å…ˆæˆ‘ä»¬å…ˆå°† tb_user è¡¨çš„ç´¢å¼•å…¨éƒ¨åˆ é™¤æ‰ ã€‚

```sql
drop index idx_user_pro_age_sta on tb_user;

drop index idx_email_5 on tb_user;

drop index idx_user_age_phone_aa on tb_user;

drop index idx_user_age_phone_ad on tb_user;

show index from tb_user;
```

![image-20250416174247861](./Mysql-Learning-Local.assets/image-20250416174247861.png)



æ¥ä¸‹æ¥ï¼Œåœ¨æ²¡æœ‰ç´¢å¼•çš„æƒ…å†µä¸‹ï¼Œæ‰§è¡Œå¦‚ä¸‹SQLï¼ŒæŸ¥è¯¢æ‰§è¡Œè®¡åˆ’ï¼š

```sql
explain select profession , count(*) from tb_user group by profession ; 
```

![image-20250416174333206](./Mysql-Learning-Local.assets/image-20250416174333206.png)

**Using temporaryï¼Œè¡¨ç¤ºä½¿ç”¨åˆ°äº†==ä¸´æ—¶è¡¨==**



ç„¶åï¼Œæˆ‘ä»¬åœ¨é’ˆå¯¹äº profession ï¼Œ ageï¼Œ status åˆ›å»ºä¸€ä¸ªè”åˆç´¢å¼•ã€‚

```sql
create index idx_user_pro_age_sta on tb_user(profession , age , status);
```

ç´§æ¥ç€ï¼Œå†æ‰§è¡Œå‰é¢ç›¸åŒçš„SQLæŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ã€‚

```sql
explain select profession , count(*) from tb_user group by profession ;
```

![image-20250416174406134](./Mysql-Learning-Local.assets/image-20250416174406134.png)

å†æ‰§è¡Œå¦‚ä¸‹çš„åˆ†ç»„æŸ¥è¯¢SQLï¼ŒæŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ï¼š

```sql
explain select age ,count(*) from tb_user group by age;
```

![image-20250416174604250](./Mysql-Learning-Local.assets/image-20250416174604250.png)

æˆ‘ä»¬å‘ç°ï¼Œå¦‚æœ**ä»…ä»…æ ¹æ®ageåˆ†ç»„ï¼Œå°±ä¼šå‡ºç° Using temporary** ï¼›è€Œå¦‚æœæ˜¯ **æ ¹æ®profession,ageä¸¤ä¸ªå­—æ®µ==åŒæ—¶åˆ†ç»„==**ï¼Œåˆ™ä¸ä¼šå‡ºç° Using temporaryã€‚åŸå› æ˜¯å› ä¸ºå¯¹äºåˆ†ç»„æ“ä½œï¼Œåœ¨è”åˆç´¢å¼•ä¸­ï¼Œ**ä¹Ÿæ˜¯==ç¬¦åˆæœ€å·¦å‰ç¼€æ³•åˆ™çš„==**ã€‚

**==æ³¨æ„==ï¼Œä¸‹åˆ—æƒ…å†µä¹Ÿæ»¡è¶³æœ€å·¦å‰ç¼€æ³•åˆ™**

```sql
explain select age ,count(*) from tb_user where profession = 'è½¯ä»¶å·¥ç¨‹' group by age;
```

![image-20250416174832045](./Mysql-Learning-Local.assets/image-20250416174832045.png)



æ‰€ä»¥ï¼Œåœ¨åˆ†ç»„æ“ä½œä¸­ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ä»¥ä¸‹ä¸¤ç‚¹è¿›è¡Œä¼˜åŒ–ï¼Œä»¥æå‡æ€§èƒ½ï¼š

- A. åœ¨åˆ†ç»„æ“ä½œæ—¶ï¼Œå¯ä»¥**é€šè¿‡ç´¢å¼•æ¥æé«˜æ•ˆç‡**ã€‚
- B. åˆ†ç»„æ“ä½œæ—¶ï¼Œç´¢å¼•çš„ä½¿ç”¨ä¹Ÿæ˜¯**æ»¡è¶³æœ€å·¦å‰ç¼€æ³•åˆ™çš„ã€‚**





## 3.5 limitä¼˜åŒ–

![image-20250416190607098](./Mysql-Learning-Local.assets/image-20250416190607098.png)

åœ¨æ•°æ®é‡æ¯”è¾ƒå¤§æ—¶ï¼Œå¦‚æœè¿›è¡Œlimitåˆ†é¡µæŸ¥è¯¢ï¼Œ**åœ¨æŸ¥è¯¢æ—¶ï¼Œè¶Šå¾€åï¼Œåˆ†é¡µæŸ¥è¯¢æ•ˆç‡è¶Šä½**ã€‚

```sql
select * from tb_sku limit 0,10;
select * from tb_sku limit 100000,10;
select * from tb_sku limit 1000000,10;
```

æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹æ‰§è¡Œlimitåˆ†é¡µæŸ¥è¯¢è€—æ—¶å¯¹æ¯”ï¼š

<img src="./Mysql-Learning-Local.assets/image-20250416185815279.png" alt="image-20250416185815279" style="zoom: 67%;" />

<img src="./Mysql-Learning-Local.assets/image-20250416185846023.png" alt="image-20250416185846023" style="zoom: 67%;" />

<img src="./Mysql-Learning-Local.assets/image-20250416185917595.png" alt="image-20250416185917595" style="zoom:67%;" />



é€šè¿‡æµ‹è¯•æˆ‘ä»¬ä¼šçœ‹åˆ°ï¼Œ**è¶Šå¾€åï¼Œåˆ†é¡µæŸ¥è¯¢æ•ˆç‡è¶Šä½**ï¼Œè¿™å°±æ˜¯åˆ†é¡µæŸ¥è¯¢çš„é—®é¢˜æ‰€åœ¨ã€‚

å› ä¸ºï¼Œå½“åœ¨è¿›è¡Œåˆ†é¡µæŸ¥è¯¢æ—¶ï¼Œå¦‚æœæ‰§è¡Œ **limit 2000000,10** ï¼Œæ­¤æ—¶éœ€è¦MySQLæ’åºå‰2000010 è®°å½•ï¼Œ**ä»…ä»…è¿”å› 2000000 - 2000010 çš„è®°å½•**ï¼Œ**å…¶ä»–è®°å½•ä¸¢å¼ƒï¼ŒæŸ¥è¯¢æ’åºçš„ä»£ä»·éå¸¸å¤§** ã€‚

**ä¼˜åŒ–æ€è·¯:** ä¸€èˆ¬åˆ†é¡µæŸ¥è¯¢æ—¶ï¼Œé€šè¿‡åˆ›å»º **è¦†ç›–ç´¢å¼•** èƒ½å¤Ÿæ¯”è¾ƒå¥½åœ°æé«˜æ€§èƒ½ï¼Œå¯ä»¥é€šè¿‡**==è¦†ç›–ç´¢å¼•åŠ å­æŸ¥è¯¢==å½¢å¼è¿›è¡Œä¼˜åŒ–**ã€‚

```sql
# ä½¿ç”¨èšé›†ç´¢å¼•ï¼Œä¹Ÿå°±æ˜¯è¿™é‡Œçš„idè¿›è¡ŒæŸ¥è¯¢ï¼Œä¹Ÿå¯ä»¥æ˜¯ä½¿ç”¨è¦†ç›–ç´¢å¼•è¿›è¡Œå…ˆä¸€æ­¥æŸ¥è¯¢
select id from tb_sku order by id limit 2000000,10;
```

![image-20250416190451623](./Mysql-Learning-Local.assets/image-20250416190451623.png)



**==æ³¨æ„==-è¿™é‡Œä¸èƒ½ç›´æ¥ä½¿ç”¨inçš„æ–¹å¼**

```sql
select * from tb_sku t where t.id in (select id from tb_sku order by id limit 2000000,10);
```

![image-20250416190829682](./Mysql-Learning-Local.assets/image-20250416190829682.png)



```sql
# é€šè¿‡å°†åˆ©ç”¨è¦†ç›–ç´¢å¼•(è¿™é‡Œçš„èšé›†ç´¢å¼•id)æŸ¥è¯¢åˆ°çš„idä¿¡æ¯å½“åšä¸€å¼ è¡¨å’Œtb_skuè¿›è¡Œè¿æ¥ã€‚è¿›è€Œä¼˜åŒ–æŸ¥è¯¢æ•ˆç‡
explain select * from tb_sku t , (select id from tb_sku order by id limit 2000000,10) a where t.id = a.id;
```

![image-20250416190504809](./Mysql-Learning-Local.assets/image-20250416190504809.png)

![image-20250416190524081](./Mysql-Learning-Local.assets/image-20250416190524081.png)

![image-20250416190536349](./Mysql-Learning-Local.assets/image-20250416190536349.png)



## 3.6 countä¼˜åŒ–

### ï¼ˆ1ï¼‰æ¦‚è¿°

```sql
select count(*) from tb_user ; 
```

åœ¨ä¹‹å‰çš„æµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬å‘ç°ï¼Œå¦‚æœ**æ•°æ®é‡å¾ˆå¤§ï¼Œåœ¨æ‰§è¡Œcountæ“ä½œæ—¶ï¼Œæ˜¯éå¸¸è€—æ—¶çš„**ã€‚



- MyISAM å¼•æ“æŠŠ**ä¸€ä¸ªè¡¨çš„æ€»è¡Œæ•°å­˜åœ¨äº†ç£ç›˜**ä¸Šï¼Œå› æ­¤æ‰§è¡Œ count(*) çš„æ—¶å€™ä¼šç›´æ¥è¿”å›è¿™ä¸ªæ•°ï¼Œ**æ•ˆç‡å¾ˆé«˜**ï¼› ä½†æ˜¯å¦‚æœæ˜¯å¸¦**æ¡ä»¶çš„count**ï¼ŒMyISAMä¹Ÿæ…¢ã€‚
- **InnoDB å¼•æ“**å°±éº»çƒ¦äº†ï¼Œå®ƒæ‰§è¡Œ count(*) çš„æ—¶å€™ï¼Œéœ€è¦æŠŠæ•°æ®ä¸€è¡Œä¸€è¡Œåœ°ä»å¼•æ“é‡Œé¢è¯»å‡ºæ¥ï¼Œç„¶å**ç´¯ç§¯è®¡æ•°**ã€‚



å¦‚æœè¯´è¦**å¤§å¹…åº¦æå‡**InnoDBè¡¨çš„countæ•ˆç‡ï¼Œä¸»è¦çš„ä¼˜åŒ–æ€è·¯ï¼š

**è‡ªå·±è®¡æ•°**

- å¯ä»¥**å€ŸåŠ©äºredisè¿™æ ·çš„æ•°æ®åº“è¿›è¡Œ**,å¦‚æœå¢åŠ æ•°æ®è¡Œæ•°é‡+1ï¼Œåˆ é™¤-1ï¼Œè‡ªå·±å»ç»´æŠ¤æ€»æ•°
- ä½†æ˜¯å¦‚æœæ˜¯å¸¦æ¡ä»¶çš„countåˆæ¯”è¾ƒéº»çƒ¦äº†



### ï¼ˆ2ï¼‰countç”¨æ³•

count() æ˜¯ä¸€ä¸ªèšåˆå‡½æ•°ï¼Œå¯¹äºè¿”å›çš„ç»“æœé›†ï¼Œä¸€è¡Œè¡Œåœ°åˆ¤æ–­ï¼Œå¦‚æœ **count å‡½æ•°çš„==å‚æ•°ä¸æ˜¯NULL==**ï¼Œ**ç´¯è®¡å€¼å°±åŠ  1ï¼Œå¦åˆ™ä¸åŠ **ï¼Œ**æœ€åè¿”å›ç´¯è®¡å€¼**ã€‚

ç”¨æ³•ï¼šcountï¼ˆ*ï¼‰ã€countï¼ˆä¸»é”®ï¼‰ã€countï¼ˆå­—æ®µï¼‰ã€countï¼ˆæ•°å­—ï¼‰

![image-20250416191624113](./Mysql-Learning-Local.assets/image-20250416191624113.png)

![image-20250415230713795](./Mysql-Learning-Local.assets/image-20250415230713795.png)



> **æŒ‰ç…§æ•ˆç‡æ’åºçš„è¯**ï¼Œcount(å­—æ®µ) < count(ä¸»é”® id) < count(1) â‰ˆ `count(*)`ï¼Œæ‰€ä»¥å°½é‡ä½¿ç”¨ `count(*)`ã€‚



## 3.7  ğŸŒŸupdateä¼˜åŒ–

![image-20250416192633757](./Mysql-Learning-Local.assets/image-20250416192633757.png)

æˆ‘ä»¬ä¸»è¦éœ€è¦æ³¨æ„ä¸€ä¸‹updateè¯­å¥æ‰§è¡Œæ—¶çš„æ³¨æ„äº‹é¡¹ã€‚

```sql
begin;
update course set name = 'javaEE' where id = 1 ;
commit;
```

å½“æˆ‘ä»¬åœ¨æ‰§è¡Œåˆ é™¤çš„SQLè¯­å¥æ—¶ï¼Œä¼šé”å®šidï¼ˆ**idä¸ºä¸»é”®-èšé›†ç´¢å¼•**ï¼‰ä¸º1è¿™ä¸€è¡Œçš„æ•°æ®ï¼Œ**ç„¶åäº‹åŠ¡æäº¤ä¹‹åï¼Œè¡Œé”é‡Šæ”¾ã€‚**



ä½†æ˜¯å½“æˆ‘ä»¬åœ¨æ‰§è¡Œå¦‚ä¸‹SQLæ—¶ã€‚

```sql
begin;
update course set name = 'SpringBoot' where name = 'PHP' ; 
commit;
```

å½“æˆ‘ä»¬å¼€å¯å¤šä¸ªäº‹åŠ¡ï¼Œåœ¨æ‰§è¡Œä¸Šè¿°çš„SQLæ—¶ï¼Œæˆ‘ä»¬å‘ç°**è¡Œé”å‡çº§ä¸ºäº†è¡¨é”**ã€‚ å¯¼è‡´è¯¥updateè¯­å¥çš„**æ€§èƒ½å¤§å¤§é™ä½**ã€‚

**åŸå› ï¼š** InnoDBçš„**==è¡Œé”æ˜¯é’ˆå¯¹ç´¢å¼•åŠ çš„é”==**

 åœ¨è¿›è¡Œupdateè¯­å¥çš„æ—¶å€™å¦‚æœåé¢çš„**whereæ¡ä»¶æ¶‰åŠçš„å­—æ®µæ˜¯ç´¢å¼•**çš„è¯ï¼Œåˆ™ä¼šå¯¹æ­¤æ—¶ä¿®æ”¹çš„è®°å½•**==åŠ è¡Œé”==**ï¼Œ**åœ¨å½“å‰ä¿®æ”¹äº‹åŠ¡æœªæäº¤å‰ï¼Œå…¶ä»–äº‹åŠ¡å¯ä»¥ä¿®æ”¹è¡¨ä¸­çš„å…¶ä»–è¡Œ**ã€‚

ä½†å¦‚æœ**whereåçš„å­—æ®µä¸æ˜¯ç´¢å¼•**çš„è¯ï¼ŒInnoDBä¼š**==ä»è¡Œé”å‡çº§ä¸ºè¡¨é”==**ï¼Œæ­¤æ—¶å…¶ä»–äº‹åŠ¡å°±ä¸èƒ½è®¿é—®è¯¥è¡¨ä¸­çš„å…¶ä»–å­—æ®µäº†ã€‚



> InnoDBçš„**==è¡Œé”æ˜¯é’ˆå¯¹ç´¢å¼•åŠ çš„é”ï¼Œä¸æ˜¯é’ˆå¯¹è®°å½•åŠ çš„é”==** ,å¹¶ä¸”è¯¥ç´¢å¼•ä¸èƒ½å¤±æ•ˆï¼Œå¦åˆ™ä¼šä»è¡Œé”å‡çº§ä¸ºè¡¨é” ã€‚è¿›è€Œå¯¼è‡´è¡¨çš„å¹¶å‘æ€§èƒ½ã€‚



## 3.8 å°ç»“

![image-20250416193541886](./Mysql-Learning-Local.assets/image-20250416193541886.png)





# 4ã€è§†å›¾/å­˜å‚¨è¿‡ç¨‹/è§¦å‘å™¨

## 4.1 è§†å›¾

### ï¼ˆ1ï¼‰ä»‹ç»

è§†å›¾ï¼ˆViewï¼‰æ˜¯ä¸€ç§**è™šæ‹Ÿå­˜åœ¨çš„è¡¨**ã€‚è§†å›¾ä¸­çš„**æ•°æ®å¹¶ä¸åœ¨æ•°æ®åº“ä¸­å®é™…å­˜åœ¨**ï¼Œè¡Œå’Œåˆ—æ•°æ®æ¥è‡ªå®šä¹‰è§†å›¾çš„æŸ¥è¯¢ä¸­ä½¿ç”¨çš„è¡¨ï¼Œå¹¶ä¸”æ˜¯åœ¨**ä½¿ç”¨è§†å›¾æ—¶åŠ¨æ€ç”Ÿæˆ**çš„ã€‚

é€šä¿—çš„è®²ï¼Œè§†å›¾**åªä¿å­˜äº†æŸ¥è¯¢çš„SQLé€»è¾‘**ï¼Œ**ä¸ä¿å­˜æŸ¥è¯¢ç»“æœ**ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨åˆ›å»ºè§†å›¾çš„æ—¶å€™ï¼Œä¸»è¦çš„å·¥ä½œå°±è½åœ¨åˆ›å»ºè¿™æ¡SQLæŸ¥è¯¢è¯­å¥ä¸Šã€‚



### ï¼ˆ2ï¼‰è¯­æ³•

![image-20250416214806509](./Mysql-Learning-Local.assets/image-20250416214806509.png)

#### â‘ åˆ›å»º

create or replace : **åˆ›å»ºæˆ–è€…æ›¿æ¢**ä¸€ä¸ªè§†å›¾

```sql
CREATE [OR REPLACE] VIEW è§†å›¾åç§°[(åˆ—ååˆ—è¡¨)] AS SELECTè¯­å¥ [ WITH [CASCADED | LOCAL ] CHECK OPTION ]
```



#### â‘¡æŸ¥è¯¢

```sql
æŸ¥çœ‹åˆ›å»ºè§†å›¾è¯­å¥ï¼šSHOW CREATE VIEW è§†å›¾åç§°;

æŸ¥çœ‹è§†å›¾æ•°æ®ï¼šSELECT * FROM è§†å›¾åç§° ...... ;
```



#### â‘¢ä¿®æ”¹

```sql
æ–¹å¼ä¸€ï¼šCREATE [OR REPLACE] VIEW è§†å›¾åç§°[(åˆ—ååˆ—è¡¨)] AS SELECTè¯­å¥ [ WITH [ CASCADED | LOCAL ] CHECK OPTION ]

æ–¹å¼äºŒï¼šALTER VIEW è§†å›¾åç§°[(åˆ—ååˆ—è¡¨)] AS SELECTè¯­å¥ [ WITH [ CASCADED | LOCAL ] CHECK OPTION ]
```



#### â‘£åˆ é™¤

```sql
DROP VIEW [IF EXISTS] è§†å›¾åç§° [,è§†å›¾åç§°] ... 
```



#### â‘¤æ¼”ç¤ºç¤ºä¾‹

```sql
-- åˆ›å»ºè§†å›¾
create or replace view stu_v_1 as select id,name from student where id <= 10;

-- æŸ¥è¯¢è§†å›¾
show create view stu_v_1;

select * from stu_v_1;
select * from stu_v_1 where id < 3;

-- ä¿®æ”¹è§†å›¾
create or replace view stu_v_1 as select id,name,no from student where id <= 10;

alter view stu_v_1 as select id,name from student where id <= 10;

-- åˆ é™¤è§†å›¾
drop view if exists stu_v_1;
```

ä¸Šè¿°æˆ‘ä»¬æ¼”ç¤ºäº†ï¼Œè§†å›¾åº”è¯¥å¦‚ä½•åˆ›å»ºã€æŸ¥è¯¢ã€ä¿®æ”¹ã€åˆ é™¤ï¼Œé‚£ä¹ˆæˆ‘ä»¬èƒ½ä¸èƒ½é€šè¿‡è§†å›¾æ¥æ’å…¥ã€æ›´æ–°æ•°æ®å‘¢ï¼Ÿ æ¥ä¸‹æ¥ï¼Œåšä¸€ä¸ªæµ‹è¯•ã€‚

```sql
create or replace view stu_v_1 as select id,name from student where id <= 10 ;

select * from stu_v_1;
insert into stu_v_1 values(6,'Tom');
insert into stu_v_1 values(17,'Tom22');
```

æ‰§è¡Œä¸Šè¿°çš„SQLï¼Œæˆ‘ä»¬ä¼šå‘ç°ï¼Œidä¸º6å’Œ17çš„æ•°æ®**éƒ½æ˜¯å¯ä»¥æˆåŠŸæ’å…¥çš„**ã€‚ ä½†æ˜¯æˆ‘ä»¬æ‰§è¡ŒæŸ¥è¯¢ï¼ŒæŸ¥è¯¢å‡ºæ¥çš„æ•°æ®ï¼Œ**å´æ²¡æœ‰idä¸º17çš„è®°å½•**ã€‚

<img src="./Mysql-Learning-Local.assets/image-20250416215054282.png" alt="image-20250416215054282" style="zoom:80%;" />



å› ä¸ºæˆ‘ä»¬åœ¨åˆ›å»ºè§†å›¾çš„æ—¶å€™ï¼Œ**==æŒ‡å®šçš„æ¡ä»¶ä¸º id<=10==**, idä¸º**17çš„æ•°æ®ï¼Œæ˜¯ä¸ç¬¦åˆæ¡ä»¶çš„**ï¼Œæ‰€ä»¥æ²¡æœ‰æŸ¥è¯¢å‡ºæ¥ï¼Œä½†æ˜¯**è¿™æ¡æ•°æ®==ç¡®å®æ˜¯å·²ç»æˆåŠŸçš„æ’å…¥åˆ°äº†åŸºè¡¨ä¸­==**ã€‚ 

å¦‚æœæˆ‘ä»¬å®šä¹‰è§†å›¾æ—¶ï¼Œå¦‚æœæŒ‡å®šäº†æ¡ä»¶ï¼Œç„¶åæˆ‘ä»¬åœ¨æ’å…¥ã€ä¿®æ”¹ã€åˆ é™¤æ•°æ®æ—¶ï¼Œæ˜¯å¦å¯ä»¥**åšåˆ°å¿…é¡»æ»¡è¶³æ¡ä»¶æ‰èƒ½æ“ä½œï¼Œå¦åˆ™ä¸èƒ½å¤Ÿæ“ä½œ**å‘¢ï¼Ÿ ç­”æ¡ˆæ˜¯å¯ä»¥çš„ï¼Œè¿™å°±éœ€è¦å€ŸåŠ©äº**è§†å›¾çš„æ£€æŸ¥é€‰é¡¹**äº†ã€‚



### ï¼ˆ3ï¼‰==æ£€æŸ¥é€‰é¡¹==

å½“ä½¿ç”¨**==WITH CHECK OPTION==å­å¥**åˆ›å»ºè§†å›¾æ—¶ï¼ŒMySQLä¼š**é€šè¿‡è§†å›¾æ£€æŸ¥æ­£åœ¨æ›´æ”¹çš„æ¯ä¸ªè¡Œ**ï¼Œä¾‹å¦‚ æ’å…¥ï¼Œæ›´æ–°ï¼Œåˆ é™¤ï¼Œä»¥ä½¿å…¶**==ç¬¦åˆè§†å›¾çš„å®šä¹‰==**ã€‚ MySQLå…è®¸**åŸºäºå¦ä¸€ä¸ªè§†å›¾åˆ›å»ºè§†å›¾**ï¼Œå®ƒè¿˜ä¼š**æ£€æŸ¥ä¾èµ–è§†å›¾ä¸­çš„è§„åˆ™ä»¥ä¿æŒä¸€è‡´æ€§**ã€‚ä¸ºäº†**ç¡®å®šæ£€æŸ¥çš„èŒƒå›´**ï¼Œmysqlæä¾›äº†ä¸¤ä¸ªé€‰é¡¹ï¼š **CASCADED å’Œ LOCAL**ï¼Œé»˜è®¤å€¼ä¸º CASCADED ã€‚

```sql
create or replace view stu_v_1 
as select id,name 
from student 
where id <= 10 
with [cascaded | local] check option;
```



#### â‘ CASCADEDçº§è”

æ¯”å¦‚ï¼Œ**v2è§†å›¾æ˜¯åŸºäºv1è§†å›¾çš„**ï¼Œå¦‚æœåœ¨v2è§†å›¾åˆ›å»ºçš„æ—¶å€™**æŒ‡å®šäº†æ£€æŸ¥é€‰é¡¹ä¸º cascaded**ï¼Œ**ä½†æ˜¯v1è§†å›¾åˆ›å»ºæ—¶==æœªæŒ‡å®šæ£€æŸ¥é€‰é¡¹==**ã€‚ åˆ™åœ¨æ‰§è¡Œæ£€æŸ¥æ—¶ï¼Œ**==ä¸ä»…ä¼šæ£€æŸ¥v2ï¼Œè¿˜ä¼šçº§è”æ£€æŸ¥v2çš„å…³è”è§†å›¾v1==**ã€‚

cascadedçº§è”ï¼Œä¼šå¯¹åŠ ä¸Šäº†**è¯¥ æ£€æŸ¥é€‰é¡¹ çš„è§†å›¾v** æ£€æŸ¥æ­£åœ¨æ›´æ”¹çš„æ“ä½œæ˜¯å¦ç¬¦åˆè§†å›¾çš„å®šä¹‰ï¼Œå¹¶ä¸”**å¦‚æœè¯¥è§†å›¾vè¿˜æœ‰ä¾èµ–å…¶ä»–è§†å›¾ï¼Œåˆ™è¿˜ä¼šçº§è”æ£€æŸ¥è¯¥è§†å›¾vä¾èµ–çš„æ‰€æœ‰è§†å›¾**ã€‚

![image-20250416220236875](./Mysql-Learning-Local.assets/image-20250416220236875.png)

```sql
create or replace view stu_v_1 
as select id, name, no 
from student 
where id <= 20;

insert into stu_v_1 values (5, 'Tom'); 
insert into stu_v_1 values (25, 'Tom22');
# ç”±äºæ²¡æœ‰åŠ ä¸Šæ£€æŸ¥é€‰é¡¹ï¼Œèƒ½å¤Ÿæ·»åŠ è¿›åŸºè¡¨studentä¸­ï¼Œä¸ä¼šæ·»åŠ åˆ°v1ä¸­ï¼Œå¹¶ä¸”ä¹Ÿä¸ä¼šæŠ¥é”™ã€‚


create or replace view stu_v_2 
as select id, name 
from stu_v_1 
where id >= 10 
with cascaded check option;

insert into stu_v_2 values (7, 'Tom'); #æŠ¥é”™ï¼Œä¸æ»¡è¶³v2çš„å®šä¹‰ >=10
insert into stu_v_2 values (26, 'Tom'); 
# ç”±äºè§†å›¾v2åœ¨åˆ›å»ºæ—¶ä½¿ç”¨äº†cascadedçº§è”ï¼Œè™½ç„¶æ»¡è¶³v2çš„å®šä¹‰ï¼Œä½†æ˜¯ä¸æ»¡è¶³v2ä¾èµ–çš„v1çš„å®šä¹‰

insert into stu_v_2 values (15, 'Tom');

create or replace view stu_v_3 
as select id, name 
from stu_v_2 
where id <= 15;

insert into stu_v_3 values (11, 'Tom'); insert into stu_v_3 values (17, 'Tom'); 
#ä¸æ»¡è¶³v3çš„å®šä¹‰,ä½†æ˜¯èƒ½å¤Ÿæ‰§è¡ŒæˆåŠŸï¼Œå› ä¸ºæ²¡æœ‰ç»™v3åŠ ä¸Šæ£€æŸ¥é€‰é¡¹ï¼Œè™½ç„¶v3ä¸­ä¸èƒ½æ·»åŠ åˆ°ï¼Œåªèƒ½æ·»åŠ åˆ°åŸºè¡¨studentä¸­ï¼Œä½†æ˜¯ä¹Ÿä¸ä¼šæŠ¥é”™

insert into stu_v_3 values (28, 'Tom'); 
#æŠ¥é”™ï¼Œè™½ç„¶ä¸ä¼šå»æ£€æŸ¥v3ä½†æ˜¯v2æ·»åŠ äº†æ£€æŸ¥é€‰é¡¹ä¼šè¿›è¡Œcascadedçº§è”æ£€æŸ¥ï¼Œä¸ç¬¦åˆv1çš„å®šä¹‰
```



#### â‘¡LOCALæœ¬åœ°

æ¯”å¦‚ï¼Œ**v2è§†å›¾æ˜¯åŸºäºv1è§†å›¾çš„**ï¼Œå¦‚æœåœ¨v2è§†å›¾åˆ›å»ºçš„æ—¶å€™**==æŒ‡å®šäº†æ£€æŸ¥é€‰é¡¹ä¸º local==** ï¼Œä½†æ˜¯**v1**è§†å›¾åˆ›å»ºæ—¶**æœªæŒ‡å®šæ£€æŸ¥é€‰é¡¹**ã€‚ åˆ™åœ¨æ‰§è¡Œæ£€æŸ¥æ—¶ï¼Œ**==åªä¼šæ£€æŸ¥v2==**ï¼Œä¸ä¼šæ£€æŸ¥v2çš„å…³è”è§†å›¾v1ã€‚

ä½¿ç”¨localåï¼Œå¦‚æœ**å½“å‰åŠ äº† localæ£€æŸ¥é€‰é¡¹ çš„è§†å›¾v**ï¼Œå¹¶ä¸”è¯¥è§†å›¾è¿˜ä¾èµ–äº†å…¶ä»–è§†å›¾v' ï¼Œå®ƒä¼šå»æ£€æŸ¥å®ƒæ‰€ä¾èµ–çš„è§†å›¾v' æ˜¯å¦åœ¨åˆ›å»ºè§†å›¾æ—¶æ·»åŠ äº†æ£€æŸ¥é€‰é¡¹ï¼Œ**å¦‚æœæ·»åŠ äº†å°±ä¸€èµ·åˆ¤æ–­**ï¼Œ**å¦‚==æ²¡æœ‰æ·»åŠ åˆ™åªä¼šåˆ¤æ–­è§†å›¾væ‰€å®šä¹‰çš„æ¡ä»¶==**

 ![image-20250416222627166](./Mysql-Learning-Local.assets/image-20250416222627166.png)



### ï¼ˆ4ï¼‰è§†å›¾çš„æ›´æ–°

#### â‘ æ¦‚å¿µ

![image-20250416222950695](./Mysql-Learning-Local.assets/image-20250416222950695.png)

è¦ä½¿è§†å›¾å¯æ›´æ–°ï¼Œ**è§†å›¾ä¸­çš„è¡Œä¸==åŸºç¡€è¡¨ä¸­çš„è¡Œ==ä¹‹é—´å¿…é¡»å­˜åœ¨==ä¸€å¯¹ä¸€==çš„å…³ç³»**ã€‚å¦‚æœè§†å›¾åŒ…å«ä»¥ä¸‹ä»»ä½•ä¸€é¡¹ï¼Œåˆ™**è¯¥è§†å›¾ä¸å¯æ›´æ–°**ï¼š

A. èšåˆå‡½æ•°æˆ–çª—å£å‡½æ•°ï¼ˆSUM()ã€ MIN()ã€ MAX()ã€ COUNT()ç­‰ï¼‰

B. DISTINCT

C. GROUP BY

D. HAVING

E. UNION æˆ–è€… UNION ALL



#### â‘¡ç¤ºä¾‹æ¼”ç¤º

```sql
create view stu_v_count as select count(*) from student; 
```

ä¸Šè¿°çš„è§†å›¾ä¸­ï¼Œå°±**åªæœ‰ä¸€ä¸ªå•è¡Œå•åˆ—çš„æ•°æ®**ï¼Œå¦‚æœæˆ‘ä»¬**å¯¹è¿™ä¸ªè§†å›¾è¿›è¡Œæ›´æ–°æˆ–æ’å…¥**çš„ï¼Œå°†**ä¼šæŠ¥é”™**ã€‚

![image-20250416222902625](./Mysql-Learning-Local.assets/image-20250416222902625.png)

```sql
insert into stu_v_count values(10); 
```

![image-20250416222925441](./Mysql-Learning-Local.assets/image-20250416222925441.png)





### ï¼ˆ5ï¼‰è§†å›¾çš„ä½œç”¨

#### â‘ ç®€å•

è§†å›¾ä¸ä»…å¯ä»¥**ç®€åŒ–ç”¨æˆ·å¯¹æ•°æ®çš„ç†è§£**ï¼Œä¹Ÿå¯ä»¥ç®€åŒ–ä»–ä»¬çš„æ“ä½œã€‚é‚£äº›è¢«ç»å¸¸ä½¿ç”¨çš„æŸ¥è¯¢å¯ä»¥è¢«å®šä¹‰ä¸ºè§†å›¾ï¼Œä»è€Œä½¿å¾—ç”¨æˆ·ä¸å¿…ä¸ºä»¥åçš„æ“ä½œæ¯æ¬¡æŒ‡å®šå…¨éƒ¨çš„æ¡ä»¶ã€‚

#### â‘¡å®‰å…¨

æ•°æ®åº“å¯ä»¥æˆæƒï¼Œ**ä½†ä¸èƒ½æˆæƒåˆ°æ•°æ®åº“ç‰¹å®šè¡Œå’Œç‰¹å®šçš„åˆ—ä¸Š**ã€‚é€šè¿‡**è§†å›¾ç”¨æˆ·==åªèƒ½æŸ¥è¯¢å’Œä¿®æ”¹ä»–ä»¬æ‰€èƒ½è§åˆ°çš„æ•°æ®==**



#### â‘¢æ•°æ®ç‹¬ç«‹

è§†å›¾å¯**å¸®åŠ©ç”¨æˆ·å±è”½çœŸå®è¡¨ç»“æ„å˜åŒ–å¸¦æ¥çš„å½±å“**ã€‚

â€‹	æ¯”å¦‚ï¼Œstudentè¡¨ä¸­çš„nameå­—æ®µå‘ç”Ÿå˜åŒ–ï¼Œä»name -ã€‹stuNameï¼Œæ­¤æ—¶åªéœ€æ”¹å˜è§†å›¾çš„æ˜ å°„å…³ç³»å³å¯ï¼Œæ— éœ€æ”¹å˜ä¸šåŠ¡ä»£ç ã€‚

```sql
# åŸæœ¬çš„è§†å›¾
create or replace view stu_v_1 
as select id, name, no 
from student where id <= 10;

# éœ€æ±‚å˜æ›´ï¼Œå°†åŸºè¡¨studentçš„nameå­—æ®µæ”¹å˜ï¼Œä»name -ã€‹stuName

# æ”¹å˜è§†å›¾çš„æ˜ å°„å…³ç³»å³å¯ï¼Œä¸å½±å“ä¸šåŠ¡ä»£ç 
create or replace view stu_v_1 
as select id, stuName, no 
from student where id <= 10;
```



### ï¼ˆ6ï¼‰æ¡ˆä¾‹

1). ä¸ºäº†ä¿è¯æ•°æ®åº“è¡¨çš„å®‰å…¨æ€§ï¼Œå¼€å‘äººå‘˜åœ¨æ“ä½œtb_userè¡¨æ—¶ï¼Œåªèƒ½çœ‹åˆ°çš„**ç”¨æˆ·çš„åŸºæœ¬å­—æ®µ**ï¼Œ**å±è”½æ‰‹æœºå·å’Œé‚®ç®±ä¸¤ä¸ªå­—æ®µ**ã€‚

```sql
create view tb_user_view 
as select id,name,profession,age,gender,status,createtime 
from tb_user;

select * from tb_user_view;
```



2). æŸ¥è¯¢**æ¯ä¸ªå­¦ç”Ÿæ‰€é€‰ä¿®çš„è¯¾ç¨‹ï¼ˆä¸‰å¼ è¡¨è”æŸ¥ï¼‰**ï¼Œè¿™ä¸ªåŠŸèƒ½åœ¨å¾ˆå¤šçš„ä¸šåŠ¡ä¸­éƒ½æœ‰ä½¿ç”¨åˆ°ï¼Œä¸ºäº†ç®€åŒ–æ“ä½œï¼Œå®šä¹‰ä¸€ä¸ªè§†å›¾ã€‚

```sql
create view tb_stu_course_view 
    as select s.name student_name , s.no student_no , c.name course_name 
    from student s, student_course sc , course c
    where s.id = sc.studentid and sc.courseid = c.id;

select * from tb_stu_course_view;
```



## 4.2 å­˜å‚¨è¿‡ç¨‹

### ï¼ˆ1ï¼‰ä»‹ç»å’Œç‰¹ç‚¹

å­˜å‚¨è¿‡ç¨‹æ˜¯**äº‹å…ˆç»è¿‡ç¼–è¯‘å¹¶å­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„ä¸€æ®µ SQL è¯­å¥çš„é›†åˆ**ï¼Œè°ƒç”¨å­˜å‚¨è¿‡ç¨‹å¯ä»¥ç®€åŒ–åº”ç”¨å¼€å‘äººå‘˜çš„å¾ˆå¤šå·¥ä½œï¼Œ**å‡å°‘æ•°æ®åœ¨æ•°æ®åº“å’Œåº”ç”¨æœåŠ¡å™¨ä¹‹é—´çš„ä¼ è¾“**ï¼ˆä¸»è¦æ˜¯ç½‘ç»œä¼ è¾“ï¼‰ï¼Œå¯¹äº**æé«˜æ•°æ®å¤„ç†çš„æ•ˆç‡**æ˜¯æœ‰å¥½å¤„çš„ã€‚

å­˜å‚¨è¿‡ç¨‹æ€æƒ³ä¸Šå¾ˆç®€å•ï¼Œå°±æ˜¯æ•°æ®åº“ SQL è¯­è¨€å±‚é¢çš„**ä»£ç å°è£…ä¸é‡ç”¨**ã€‚

![image-20250417194543284](./Mysql-Learning-Local.assets/image-20250417194543284.png)

#### **ç‰¹ç‚¹**

- **å°è£…ï¼Œå¤ç”¨** 
  - å¯ä»¥æŠŠæŸä¸€ä¸šåŠ¡SQLå°è£…åœ¨å­˜å‚¨è¿‡ç¨‹ä¸­ï¼Œéœ€è¦ç”¨åˆ°çš„æ—¶å€™ç›´æ¥è°ƒç”¨å³å¯ã€‚

- **å¯ä»¥æ¥æ”¶å‚æ•°ï¼Œä¹Ÿå¯ä»¥è¿”å›æ•°æ®** 
  - å†å­˜å‚¨è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥ä¼ é€’å‚æ•°ï¼Œä¹Ÿå¯ä»¥æ¥æ”¶è¿”å›å€¼ã€‚

- **==å‡å°‘ç½‘ç»œäº¤äº’ï¼Œæ•ˆç‡æå‡==**
  - å¦‚æœæ¶‰åŠåˆ°å¤šæ¡SQLï¼Œæ¯æ‰§è¡Œä¸€æ¬¡éƒ½æ˜¯ä¸€æ¬¡ç½‘ç»œä¼ è¾“ã€‚ è€Œå¦‚æœå°è£…åœ¨å­˜å‚¨è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦ç½‘ç»œäº¤äº’ä¸€æ¬¡å¯èƒ½å°±å¯ä»¥äº†ã€‚




### ï¼ˆ2ï¼‰åŸºæœ¬ç”¨æ³•

![image-20250417194456782](./Mysql-Learning-Local.assets/image-20250417194456782.png)

#### â‘  åˆ›å»º

```sql
CREATE PROCEDURE å­˜å‚¨è¿‡ç¨‹åç§° ([ å‚æ•°åˆ—è¡¨ ])

BEGIN

-- SQLè¯­å¥

END ;
```

#### â‘¡ è°ƒç”¨

```
CALL åç§° ([ å‚æ•° ]);
```

#### â‘¢ æŸ¥çœ‹

```sql
SELECT * FROM INFORMATION_SCHEMA.ROUTINES WHERE ROUTINE_SCHEMA = 'xxx'; -- æŸ¥è¯¢æŒ‡å®šæ•°æ®åº“çš„å­˜å‚¨è¿‡ç¨‹åŠçŠ¶æ€ä¿¡æ¯
SHOW CREATE PROCEDURE å­˜å‚¨è¿‡ç¨‹åç§° ; -- æŸ¥è¯¢æŸä¸ªå­˜å‚¨è¿‡ç¨‹çš„å®šä¹‰
```



#### â‘£ åˆ é™¤

```sql
DROP PROCEDURE [ IF EXISTS ] å­˜å‚¨è¿‡ç¨‹åç§° ï¼›
```



> ==**æ³¨æ„:**==
>
> åœ¨**å‘½ä»¤è¡Œä¸­**ï¼Œæ‰§è¡Œåˆ›å»ºå­˜å‚¨è¿‡ç¨‹çš„SQLæ—¶ï¼Œéœ€è¦é€šè¿‡**å…³é”®å­— ==delimiter æŒ‡å®šSQLè¯­å¥çš„ç»“æŸç¬¦==**ã€‚
>
> - è¿™ä¸ªæ˜¯å› ä¸ºåœ¨å­˜å‚¨è¿‡ç¨‹ä¸­çš„å†…éƒ¨å¯èƒ½ä¼šæœ‰`;` çš„ä½œä¸ºç»“æŸçš„è¯­å¥ï¼Œæ­¤æ—¶åœ¨å‘½ä»¤è¡Œä¸­ï¼Œå°±è®¤ä¸ºè¯¥`;`æ˜¯è¯¥è¯­å¥çš„ç»“æŸç¬¦ï¼Œè¯¥å­˜å‚¨è¿‡ç¨‹çš„åç»­ä¸èƒ½å°±å¾—ä¸åˆ°æ‰§è¡Œï¼š
>
>   ```sql
>   create procedure p1()
>   begin
>   	select count(*) from student;
>   end;
>   ```
>
>   è¿™é‡Œçš„`end;`å°±å¾—ä¸åˆ°æ‰§è¡Œï¼Œæ­¤æ—¶å¯ä»¥é€šè¿‡delimiteræŒ‡ä»¤ä¿®æ”¹mysqlå‘½ä»¤è¡Œä¸­çš„ç»“æŸç¬¦ä¸º`$$`ç­‰å…¶ä»–ä¸ä¼šå¼•èµ·å†²çªçš„ç¬¦å·ã€‚
>
>   ```sql
>   delimiter $$;
>   ```





#### â‘¤æ¼”ç¤ºç¤ºä¾‹

```sql
-- å­˜å‚¨è¿‡ç¨‹åŸºæœ¬è¯­æ³•
-- åˆ›å»º
create procedure p1()
begin

select count(*) from student;

end;

-- è°ƒç”¨
call p1();

-- æŸ¥çœ‹
select * from information_schema.ROUTINES where ROUTINE_SCHEMA = 'itcast';

show create procedure p1;

-- åˆ é™¤
drop procedure if exists p1;
```



### ï¼ˆ3ï¼‰==å˜é‡==

åœ¨MySQLä¸­å˜é‡åˆ†ä¸ºä¸‰ç§ç±»å‹: **ç³»ç»Ÿå˜é‡ã€ç”¨æˆ·å®šä¹‰å˜é‡ã€å±€éƒ¨å˜é‡**ã€‚

#### â‘ ç³»ç»Ÿå˜é‡

![image-20250417195354412](./Mysql-Learning-Local.assets/image-20250417195354412.png)

ç³»ç»Ÿå˜é‡ æ˜¯MySQLæœåŠ¡å™¨æä¾›ï¼Œä¸æ˜¯ç”¨æˆ·å®šä¹‰çš„ï¼Œå±äºæœåŠ¡å™¨å±‚é¢ã€‚åˆ†ä¸º**å…¨å±€å˜é‡ï¼ˆGLOBALï¼‰**ã€**ä¼šè¯å˜é‡ï¼ˆSESSIONï¼‰**ã€‚**é»˜è®¤**æŸ¥è¯¢çš„æ˜¯sessionä¼šè¯å˜é‡ã€‚

##### 1). æŸ¥çœ‹ç³»ç»Ÿå˜é‡

```sql
SHOW [ SESSION | GLOBAL ] VARIABLES ; -- æŸ¥çœ‹æ‰€æœ‰ç³»ç»Ÿå˜é‡
SHOW [ SESSION | GLOBAL ] VARIABLES LIKE '......'; -- å¯ä»¥é€šè¿‡LIKEæ¨¡ç³ŠåŒ¹é…æ–¹å¼æŸ¥æ‰¾å˜é‡
SELECT @@[SESSION | GLOBAL] ç³»ç»Ÿå˜é‡å; -- æŸ¥çœ‹æŒ‡å®šå˜é‡çš„å€¼
```



##### 2). è®¾ç½®ç³»ç»Ÿå˜é‡

```sql
SET [ SESSION | GLOBAL ] ç³»ç»Ÿå˜é‡å = å€¼ ;
SET @@[SESSION | GLOBAL]ç³»ç»Ÿå˜é‡å = å€¼ ;
```



> **æ³¨æ„ï¼š**
>
> å¦‚æœæ²¡æœ‰æŒ‡å®šSESSION/GLOBALï¼Œé»˜è®¤æ˜¯SESSIONï¼Œä¼šè¯å˜é‡ã€‚
>
> mysqlæœåŠ¡é‡æ–°å¯åŠ¨ä¹‹åï¼Œæ‰€è®¾ç½®çš„å…¨å±€å‚æ•°ä¼šå¤±æ•ˆï¼Œè¦æƒ³ä¸å¤±æ•ˆï¼Œå¯ä»¥åœ¨ /etc/my.cnf ä¸­é…ç½®ã€‚ 
>
> - A. å…¨å±€å˜é‡(GLOBAL): å…¨å±€å˜é‡é’ˆå¯¹äºæ‰€æœ‰çš„ä¼šè¯ã€‚
> - B. ä¼šè¯å˜é‡(SESSION): ä¼šè¯å˜é‡é’ˆå¯¹äºå•ä¸ªä¼šè¯ï¼Œåœ¨å¦å¤–ä¸€ä¸ªä¼šè¯çª—å£å°±ä¸ç”Ÿæ•ˆäº†ã€‚



**æ¼”ç¤ºç¤ºä¾‹:**

```sql
-- æŸ¥çœ‹ç³»ç»Ÿå˜é‡
show session variables ;

show session variables like 'auto%';
show global variables like 'auto%';

select @@global.autocommit;  -- æŸ¥çœ‹æŒ‡å®šglobalçº§åˆ«ä¸‹è¯¥å˜é‡çš„å€¼
select @@session.autocommit; -- æŸ¥çœ‹æŒ‡å®šsessionçº§åˆ«ä¸‹è¯¥å˜é‡çš„å€¼

-- è®¾ç½®ç³»ç»Ÿå˜é‡
set session autocommit = 1; -- æ”¹å˜çš„åªæ˜¯å½“å‰ä¼šè¯

insert into course(id, name) VALUES (6, 'ES');

set global autocommit = 0;

select @@global.autocommit;
```



#### â‘¡ç”¨æˆ·å®šä¹‰å˜é‡

ç”¨æˆ·å®šä¹‰å˜é‡ æ˜¯ç”¨æˆ·æ ¹æ®éœ€è¦è‡ªå·±å®šä¹‰çš„å˜é‡ï¼Œ**ç”¨æˆ·å˜é‡ä¸ç”¨æå‰å£°æ˜**ï¼Œåœ¨ç”¨çš„æ—¶å€™**ç›´æ¥ç”¨ "@å˜é‡å"** ä½¿ç”¨å°±å¯ä»¥ã€‚å…¶**ä½œç”¨åŸŸä¸ºå½“å‰è¿æ¥**ï¼ˆåªåœ¨å½“å‰ä¼šè¯æœ‰æ•ˆï¼‰ã€‚

![image-20250417195856244](./Mysql-Learning-Local.assets/image-20250417195856244.png)

##### 1). èµ‹å€¼

**æ–¹å¼ä¸€:**

```sql
SET @var_name = expr [, @var_name = expr] ... ;

SET @var_name := expr [, @var_name := expr] ... ;
```

èµ‹å€¼æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ = ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ := ã€‚

**æ–¹å¼äºŒ:**

```sql
SELECT @var_name := expr [, @var_name := expr] ... ;

SELECT å­—æ®µå INTO @var_name FROM è¡¨å;
```



##### 2). ä½¿ç”¨

```sql
SELECT @var_name ;
```

> æ³¨æ„: ç”¨æˆ·å®šä¹‰çš„å˜é‡**æ— éœ€å¯¹å…¶è¿›è¡Œå£°æ˜æˆ–åˆå§‹åŒ–**ï¼Œ**åªä¸è¿‡==è·å–åˆ°çš„å€¼ä¸ºNULL==**ã€‚

![image-20250417195653062](./Mysql-Learning-Local.assets/image-20250417195653062.png)



##### æ¼”ç¤ºç¤ºä¾‹

```sql
-- èµ‹å€¼
set @myname = 'itcast';
set @myage := 10;
set @mygender := 'ç”·',@myhobby := 'java';

select @mycolor := 'red';
select count(*) into @mycount from tb_user;

-- ä½¿ç”¨
select @myname,@myage,@mygender,@myhobby;

select @mycolor , @mycount;

select @abc;
```



#### â‘¢å±€éƒ¨å˜é‡

å±€éƒ¨å˜é‡ æ˜¯æ ¹æ®éœ€è¦å®šä¹‰çš„åœ¨å±€éƒ¨ç”Ÿæ•ˆçš„å˜é‡ï¼Œè®¿é—®ä¹‹å‰ï¼Œ==éœ€è¦**DECLAREå£°æ˜**==ã€‚å¯ç”¨ä½œå­˜å‚¨è¿‡ç¨‹å†…çš„å±€éƒ¨å˜é‡å’Œè¾“å…¥å‚æ•°ï¼Œ**å±€éƒ¨å˜é‡çš„==èŒƒå›´==æ˜¯åœ¨å…¶å†…å£°æ˜çš„==BEGIN ... ENDå—==**ã€‚

![image-20250417200137491](./Mysql-Learning-Local.assets/image-20250417200137491.png)

##### 1). å£°æ˜

```sql
DECLARE å˜é‡å å˜é‡ç±»å‹ [DEFAULT ... ] ; 
```

å˜é‡ç±»å‹å°±æ˜¯æ•°æ®åº“å­—æ®µç±»å‹ï¼š**INTã€BIGINTã€CHARã€VARCHARã€DATEã€TIME**ç­‰ã€‚

##### 2). èµ‹å€¼

```sql
SET å˜é‡å = å€¼ ;

SET å˜é‡å := å€¼ ;

SELECT å­—æ®µå INTO å˜é‡å FROM è¡¨å ... ;
```



##### æ¼”ç¤ºç¤ºä¾‹

```sql
-- å£°æ˜å±€éƒ¨å˜é‡ - declare
-- èµ‹å€¼

create procedure p2()

begin

	declare stu_count int default 0;
	select count(*) into stu_count from student;
	select stu_count;

end;

call p2();
```



### ï¼ˆ4ï¼‰if

#### â‘  ä»‹ç»

if ç”¨äºåšæ¡ä»¶åˆ¤æ–­ï¼Œå…·ä½“çš„è¯­æ³•ç»“æ„ä¸ºï¼š



```sql
IF æ¡ä»¶1 THEN
	.....

ELSEIF æ¡ä»¶2 THEN -- å¯é€‰
	.....

ELSE -- å¯é€‰
	.....

END IF; -- ç»“æŸ
```

åœ¨ifæ¡ä»¶åˆ¤æ–­çš„ç»“æ„ä¸­ï¼ŒELSE IF ç»“æ„å¯ä»¥æœ‰å¤šä¸ªï¼Œä¹Ÿ**å¯ä»¥æ²¡æœ‰**ã€‚ ELSEç»“æ„å¯ä»¥æœ‰ï¼Œä¹Ÿ**å¯ä»¥æ²¡æœ‰**ã€‚



#### â‘¡æ¡ˆä¾‹

æ ¹æ®å®šä¹‰çš„åˆ†æ•°scoreå˜é‡ï¼Œåˆ¤å®šå½“å‰åˆ†æ•°å¯¹åº”çš„åˆ†æ•°ç­‰çº§ã€‚

- score >= 85åˆ†ï¼Œç­‰çº§ä¸ºä¼˜ç§€ã€‚
- score >= 60åˆ† ä¸” score < 85åˆ†ï¼Œç­‰çº§ä¸ºåŠæ ¼ã€‚
- score < 60åˆ†ï¼Œç­‰çº§ä¸ºä¸åŠæ ¼ã€‚

```sql
create procedure p3()

begin
    declare score int default 58;
    declare result varchar(10);

    if score >= 85 then
   	 	set result := 'ä¼˜ç§€';

    elseif score >= 60 then
    	set result := 'åŠæ ¼';

    else
   	 	set result := 'ä¸åŠæ ¼';

    end if;
    
    select result;
end;

call p3();
```



ä¸Šè¿°çš„éœ€æ±‚æˆ‘ä»¬è™½ç„¶å·²ç»å®ç°äº†ï¼Œä½†æ˜¯ä¹Ÿå­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚ï¼šscore åˆ†æ•°æˆ‘ä»¬æ˜¯åœ¨**å­˜å‚¨è¿‡ç¨‹ä¸­å®šä¹‰æ­»çš„**ï¼Œè€Œä¸”æœ€ç»ˆè®¡ç®—å‡ºæ¥çš„åˆ†æ•°ç­‰çº§ï¼Œæˆ‘ä»¬ä¹Ÿä»…ä»…æ˜¯æœ€ç»ˆæŸ¥è¯¢å±•ç¤ºå‡ºæ¥è€Œå·²ã€‚

é‚£ä¹ˆæˆ‘ä»¬èƒ½ä¸èƒ½ï¼ŒæŠŠscoreåˆ†æ•°åŠ¨æ€çš„ä¼ é€’è¿›æ¥ï¼Œè®¡ç®—å‡ºæ¥çš„åˆ†æ•°ç­‰çº§æ˜¯å¦å¯ä»¥ä½œä¸ºè¿”å›å€¼è¿”å›å‘¢ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ¥ä¸‹æ¥æ‰€è®²è§£çš„ **å‚æ•°** æ¥è§£å†³ä¸Šè¿°çš„é—®é¢˜ã€‚



### ï¼ˆ5ï¼‰å‚æ•°

#### â‘ ä»‹ç»

å‚æ•°çš„ç±»å‹ï¼Œä¸»è¦åˆ†ä¸ºä»¥ä¸‹ä¸‰ç§ï¼šINã€OUTã€INOUTã€‚ å…·ä½“çš„å«ä¹‰å¦‚ä¸‹ï¼š

![image-20250417200551022](./Mysql-Learning-Local.assets/image-20250417200551022.png)

ç”¨æ³•ï¼š

```sql
CREATE PROCEDURE å­˜å‚¨è¿‡ç¨‹åç§° ([ IN/OUT/INOUT å‚æ•°å å‚æ•°ç±»å‹ ])

BEGIN
	-- SQLè¯­å¥
END ;
```



#### â‘¡æ¡ˆä¾‹ä¸€in&out

æ ¹æ®ä¼ å…¥å‚æ•°scoreï¼Œåˆ¤å®šå½“å‰åˆ†æ•°å¯¹åº”çš„åˆ†æ•°ç­‰çº§ï¼Œå¹¶è¿”å›ã€‚

- score >= 85åˆ†ï¼Œç­‰çº§ä¸ºä¼˜ç§€ã€‚
- score >= 60åˆ† ä¸” score < 85åˆ†ï¼Œç­‰çº§ä¸ºåŠæ ¼ã€‚
- score < 60åˆ†ï¼Œç­‰çº§ä¸ºä¸åŠæ ¼ã€‚

```sql
create procedure p4(in score int, out result varchar(10)) -- å®šä¹‰ è¾“å…¥è¾“å‡º å‚æ•°

begin
    if score >= 85 then
    	set result := 'ä¼˜ç§€';

    elseif score >= 60 then
    	set result := 'åŠæ ¼';

    else
    	set result := 'ä¸åŠæ ¼';

    end if;
end;

-- å®šä¹‰ç”¨æˆ·å˜é‡ @resultæ¥æ¥æ”¶è¿”å›çš„æ•°æ®, ç”¨æˆ·å˜é‡å¯ä»¥ä¸ç”¨å£°æ˜
call p4(18, @result);

select @result;
```



#### â‘¢æ¡ˆä¾‹äºŒ-inout

å°†**ä¼ å…¥**çš„200åˆ†åˆ¶çš„åˆ†æ•°ï¼Œè¿›è¡Œæ¢ç®—ï¼Œ**æ¢ç®—æˆç™¾åˆ†åˆ¶**ï¼Œç„¶å**è¿”å›**ã€‚

```sql
create procedure p5(inout score double)

begin
	set score := score * 0.5;
end;

set @score = 198; -- ç”¨æˆ·å˜é‡ï¼Œä¸ç”¨å£°æ˜ï¼Œå¯ä»¥ç›´æ¥è®¾ç½®set
call p5(@score);

select @score;
```



### ï¼ˆ6ï¼‰case

#### â‘ ä»‹ç»

caseç»“æ„åŠä½œç”¨ï¼Œå’Œæˆ‘ä»¬åœ¨åŸºç¡€ç¯‡ä¸­æ‰€è®²è§£çš„æµç¨‹æ§åˆ¶å‡½æ•°å¾ˆç±»ä¼¼ã€‚æœ‰ä¸¤ç§è¯­æ³•æ ¼å¼ï¼š

**è¯­æ³•1ï¼š**

```sql
-- å«ä¹‰ï¼š å½“case_valueçš„ å€¼ä¸º when_value1 æ—¶ï¼Œæ‰§è¡Œstatement_list1ï¼Œå½“å€¼ä¸º when_value2æ—¶ï¼Œæ‰§è¡Œstatement_list2ï¼Œ å¦åˆ™å°±æ‰§è¡Œ statement_list

CASE case_value
	WHEN when_value1 THEN statement_list1
	[ WHEN when_value2 THEN statement_list2] ...	
	[ ELSE statement_list ]
END CASE;
```

**è¯­æ³•2ï¼š**

```sql
-- å«ä¹‰ï¼š å½“ æ¡ä»¶search_condition1æˆç«‹ æ—¶ï¼Œæ‰§è¡Œstatement_list1ï¼Œå½“æ¡ä»¶search_condition2æˆç«‹æ—¶ï¼Œæ‰§è¡Œstatement_list2ï¼Œ å¦åˆ™å°±æ‰§è¡Œ statement_list

CASE
    WHEN search_condition1 THEN statement_list1
    [WHEN search_condition2 THEN statement_list2] ...
    [ELSE statement_list]
END CASE;
```





#### â‘¡æ¡ˆä¾‹

æ ¹æ®ä¼ å…¥çš„æœˆä»½ï¼Œåˆ¤å®šæœˆä»½æ‰€å±çš„å­£èŠ‚ï¼ˆè¦æ±‚é‡‡ç”¨caseç»“æ„ï¼‰ã€‚

- 1-3æœˆä»½ï¼Œä¸ºç¬¬ä¸€å­£åº¦
- 4-6æœˆä»½ï¼Œä¸ºç¬¬äºŒå­£åº¦
- 7-9æœˆä»½ï¼Œä¸ºç¬¬ä¸‰å­£åº¦
- 10-12æœˆä»½ï¼Œä¸ºç¬¬å››å­£åº¦

```sql
create procedure p6(in month int)

begin

    declare result varchar(10);

    case
        when month >= 1 and month <= 3 then
       	 	set result := 'ç¬¬ä¸€å­£åº¦';

        when month >= 4 and month <= 6 then
        	set result := 'ç¬¬äºŒå­£åº¦';

        when month >= 7 and month <= 9 then
        	set result := 'ç¬¬ä¸‰å­£åº¦';

        when month >= 10 and month <= 12 then
        	set result := 'ç¬¬å››å­£åº¦';

        else
        	set result := 'éæ³•å‚æ•°';
    end case ;

    select concat('æ‚¨è¾“å…¥çš„æœˆä»½ä¸º: ',month, ', æ‰€å±çš„å­£åº¦ä¸º: ',result);

end;

call p6(4);
call p6(16);
```



> æ³¨æ„ï¼šå¦‚æœåˆ¤å®šæ¡ä»¶æœ‰å¤šä¸ªï¼Œå¤šä¸ªæ¡ä»¶ä¹‹é—´ï¼Œå¯ä»¥ä½¿ç”¨ **and æˆ– or è¿›è¡Œè¿æ¥**ã€‚
>
> **concat()å‡½æ•°ï¼Œç”¨äºå­—ç¬¦ä¸²æ‹¼æ¥ã€‚**



### ï¼ˆ7ï¼‰while

#### â‘ ä»‹ç»

![image-20250417201655039](./Mysql-Learning-Local.assets/image-20250417201655039.png)

while å¾ªç¯æ˜¯**æœ‰æ¡ä»¶çš„å¾ªç¯æ§åˆ¶è¯­å¥**ã€‚æ»¡è¶³æ¡ä»¶åï¼Œå†æ‰§è¡Œå¾ªç¯ä½“ä¸­çš„SQLè¯­å¥ã€‚å…·ä½“è¯­æ³•ä¸ºï¼š

```sql
-- å…ˆåˆ¤å®šæ¡ä»¶ï¼Œå¦‚æœæ¡ä»¶ä¸ºtrueï¼Œåˆ™æ‰§è¡Œé€»è¾‘ï¼Œå¦åˆ™ï¼Œä¸æ‰§è¡Œé€»è¾‘
WHILE æ¡ä»¶ DO
	-- SQLé€»è¾‘...
END WHILE;
```



#### â‘¡æ¡ˆä¾‹

è®¡ç®—ä»1ç´¯åŠ åˆ°nçš„å€¼ï¼Œ**nä¸ºä¼ å…¥çš„å‚æ•°å€¼**ã€‚

```sql
-- A. å®šä¹‰å±€éƒ¨å˜é‡, è®°å½•ç´¯åŠ ä¹‹åçš„å€¼;
-- B. æ¯å¾ªç¯ä¸€æ¬¡, å°±ä¼šå¯¹nè¿›è¡Œå‡1 , å¦‚æœnå‡åˆ°0, åˆ™é€€å‡ºå¾ªç¯
create procedure p7(in n int)

begin
	declare total int default 0;
	
	while n>0 do
		set total := total + n;
		set n := n - 1;
	end while;
	
	select total;
end;

call p7(100);
```



### ï¼ˆ8ï¼‰repeat

#### â‘  ä»‹ç»

![image-20250417202027825](./Mysql-Learning-Local.assets/image-20250417202027825.png)

repeatæ˜¯æœ‰æ¡ä»¶çš„å¾ªç¯æ§åˆ¶è¯­å¥, **å½“æ»¡è¶³untilå£°æ˜çš„æ¡ä»¶çš„æ—¶å€™ï¼Œåˆ™==é€€å‡ºå¾ªç¯==** ã€‚å…·ä½“è¯­æ³•ä¸ºï¼š

```sql
-- å…ˆæ‰§è¡Œä¸€æ¬¡é€»è¾‘ï¼Œç„¶ååˆ¤å®šUNTILæ¡ä»¶æ˜¯å¦æ»¡è¶³ï¼Œå¦‚æœæ»¡è¶³ï¼Œåˆ™é€€å‡ºã€‚å¦‚æœä¸æ»¡è¶³ï¼Œåˆ™ç»§ç»­ä¸‹ä¸€æ¬¡å¾ªç¯

REPEAT
    -- SQLé€»è¾‘...
    UNTIL æ¡ä»¶
END REPEAT;
```



#### â‘¡æ¡ˆä¾‹

è®¡ç®—ä»1ç´¯åŠ åˆ°nçš„å€¼ï¼Œnä¸ºä¼ å…¥çš„å‚æ•°å€¼ã€‚(ä½¿ç”¨repeatå®ç°)

```sql
-- A. å®šä¹‰å±€éƒ¨å˜é‡, è®°å½•ç´¯åŠ ä¹‹åçš„å€¼;
-- B. æ¯å¾ªç¯ä¸€æ¬¡, å°±ä¼šå¯¹nè¿›è¡Œ-1 , å¦‚æœnå‡åˆ°0, åˆ™é€€å‡ºå¾ªç¯

create procedure p8(in n int)

begin

    declare total int default 0;

    repeat
        set total := total + n;
        set n := n - 1;
    until n <= 0
    end repeat;

    select total;

end;

call p8(10);
call p8(100);
```



### ï¼ˆ9ï¼‰loop

#### â‘ ä»‹ç»

LOOP å®ç°ç®€å•çš„å¾ªç¯ï¼Œå¦‚æœ**ä¸åœ¨SQLé€»è¾‘ä¸­å¢åŠ é€€å‡ºå¾ªç¯**çš„æ¡ä»¶ï¼Œå¯ä»¥ç”¨å…¶æ¥å®ç°**ç®€å•çš„æ­»å¾ªç¯**ã€‚LOOPå¯ä»¥é…åˆä¸€ä¸‹ä¸¤ä¸ªè¯­å¥ä½¿ç”¨ï¼š

- **LEAVE** ï¼š**é…åˆå¾ªç¯ä½¿ç”¨ï¼Œé€€å‡ºå¾ªç¯**ã€‚ï¼ˆç›¸å½“äºjavaä¸­çš„breakï¼‰
- **ITERATE**ï¼šå¿…é¡»ç”¨åœ¨å¾ªç¯ä¸­ï¼Œä½œç”¨æ˜¯**==è·³è¿‡å½“å‰å¾ªç¯å‰©ä¸‹çš„è¯­å¥ï¼Œç›´æ¥è¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯==**ã€‚ï¼ˆç›¸å½“äºjavaä¸­çš„continueï¼‰

```sql
[begin_label:] LOOP

	-- SQLé€»è¾‘...

END LOOP [end_label];
```



```sql
LEAVE label; -- é€€å‡ºæŒ‡å®šæ ‡è®°çš„å¾ªç¯ä½“ï¼Œè¿™é‡Œçš„labelå°±æ˜¯åˆ›å»ºloopä¸­æŒ‡å®šçš„æ ‡è¯†

ITERATE label; -- ç›´æ¥è¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯
```

ä¸Šè¿°è¯­æ³•ä¸­å‡ºç°çš„ begin_labelï¼Œend_labelï¼Œlabel æŒ‡çš„éƒ½æ˜¯æˆ‘ä»¬æ‰€è‡ªå®šä¹‰çš„æ ‡è®°ã€‚



#### â‘¡æ¡ˆä¾‹ä¸€-leave

è®¡ç®—ä»1ç´¯åŠ åˆ°nçš„å€¼ï¼Œnä¸ºä¼ å…¥çš„å‚æ•°å€¼ã€‚

```sql
-- A. å®šä¹‰å±€éƒ¨å˜é‡, è®°å½•ç´¯åŠ ä¹‹åçš„å€¼;

-- B. æ¯å¾ªç¯ä¸€æ¬¡, å°±ä¼šå¯¹nè¿›è¡Œ-1 , å¦‚æœnå‡åˆ°0, åˆ™é€€å‡ºå¾ªç¯ ----> leave xx

create procedure p9(in n int)
begin
	declare total int default 0;

    sum:loop
        if n<=0 then
            leave sum;
        end if;

        set total := total + n;
        set n := n - 1;

    end loop sum;

	select total;

end;

call p9(100);
```



#### â‘¢æ¡ˆä¾‹äºŒ-iterate

è®¡ç®—ä»1åˆ°nä¹‹é—´çš„**å¶æ•°ç´¯åŠ **çš„å€¼ï¼Œnä¸ºä¼ å…¥çš„å‚æ•°å€¼ã€‚

```sql
-- A. å®šä¹‰å±€éƒ¨å˜é‡, è®°å½•ç´¯åŠ ä¹‹åçš„å€¼;
-- B. æ¯å¾ªç¯ä¸€æ¬¡, å°±ä¼šå¯¹nè¿›è¡Œ-1 , å¦‚æœnå‡åˆ°0, åˆ™é€€å‡ºå¾ªç¯ ----> leave xx
-- C. å¦‚æœå½“æ¬¡ç´¯åŠ çš„æ•°æ®æ˜¯å¥‡æ•°, åˆ™ç›´æ¥è¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯. --------> iterate xx

create procedure p10(in n int)

begin
    declare total int default 0;

    sum:loop

    if n<=0 then
        leave sum;
    end if;

    if n%2 = 1 then
    	set n := n - 1;
    	iterate sum;
    end if;

    set total := total + n;
    set n := n - 1;

    end loop sum;
    select total;

end;

call p10(100);
```



### ï¼ˆ10ï¼‰æ¸¸æ ‡

#### â‘ ä»‹ç»

**æ¸¸æ ‡ï¼ˆCURSORï¼‰**æ˜¯ç”¨æ¥**==å­˜å‚¨æŸ¥è¯¢ç»“æœé›†çš„æ•°æ®ç±»å‹==** , åœ¨å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°ä¸­å¯ä»¥ä½¿ç”¨æ¸¸æ ‡**å¯¹ç»“æœé›†è¿›è¡Œå¾ªç¯çš„å¤„ç†ã€‚ **æ¸¸æ ‡çš„ä½¿ç”¨åŒ…æ‹¬**æ¸¸æ ‡çš„å£°æ˜ã€OPENã€FETCH å’Œ CLOSE**ï¼Œå…¶è¯­æ³•åˆ†åˆ«å¦‚ä¸‹ã€‚

##### A. å£°æ˜æ¸¸æ ‡-declare

```sql
DECLARE æ¸¸æ ‡åç§° CURSOR FOR æŸ¥è¯¢è¯­å¥ ; 
```

##### B. æ‰“å¼€æ¸¸æ ‡-open

```sql
OPEN æ¸¸æ ‡åç§° ; 
```

##### C. è·å–æ¸¸æ ‡è®°å½•-fetch

```sql
FETCH æ¸¸æ ‡åç§° INTO å˜é‡ [, å˜é‡ ] ; 
```

##### D. å…³é—­æ¸¸æ ‡-close

```sql
CLOSE æ¸¸æ ‡åç§° ; 
```



#### â‘¡ æ¡ˆä¾‹

æ ¹æ®ä¼ å…¥çš„å‚æ•°uageï¼Œæ¥æŸ¥è¯¢ç”¨æˆ·è¡¨tb_userä¸­ï¼Œæ‰€æœ‰çš„ç”¨æˆ·å¹´é¾„å°äºç­‰äºuageçš„ ç”¨æˆ·å§“åï¼ˆnameï¼‰å’Œä¸“ä¸šï¼ˆprofessionï¼‰ï¼Œå¹¶å°†ç”¨æˆ·çš„å§“åå’Œä¸“ä¸š**æ’å…¥åˆ°æ‰€åˆ›å»ºçš„ä¸€å¼ æ–°è¡¨(id,name,profession)ä¸­**ã€‚

```sql
-- é€»è¾‘:
-- A. å£°æ˜æ¸¸æ ‡, å­˜å‚¨æŸ¥è¯¢ç»“æœé›†
-- B. å‡†å¤‡: åˆ›å»ºè¡¨ç»“æ„
-- C. å¼€å¯æ¸¸æ ‡
-- D. è·å–æ¸¸æ ‡ä¸­çš„è®°å½•
-- E. æ’å…¥æ•°æ®åˆ°æ–°è¡¨ä¸­
-- F. å…³é—­æ¸¸æ ‡

create procedure p11(in uage int)

begin

    declare uname varchar(100);
    declare upro varchar(100);
    -- æ¸¸æ ‡çš„å£°æ˜éœ€è¦åœ¨æ™®é€šå˜é‡ä¹‹å
    declare u_cursor cursor for select name,profession from tb_user where age <= uage;

    drop table if exists tb_user_pro;

    create table if not exists tb_user_pro(
        id int primary key auto_increment,
        name varchar(100),
        profession varchar(100)
    );


    open u_cursor;
    while true do
        fetch u_cursor into uname,upro;
        insert into tb_user_pro values (null, uname, upro);
    end while;

    close u_cursor;

end;

call p11(30);
```

ä¸Šè¿°çš„å­˜å‚¨è¿‡ç¨‹ï¼Œæœ€ç»ˆæˆ‘ä»¬åœ¨è°ƒç”¨çš„è¿‡ç¨‹ä¸­ï¼Œä¼šæŠ¥é”™ï¼Œä¹‹æ‰€ä»¥æŠ¥é”™æ˜¯å› ä¸º**ä¸Šé¢çš„whileå¾ªç¯ä¸­ï¼Œå¹¶æ²¡æœ‰é€€å‡ºæ¡ä»¶ã€‚**å½“æ¸¸æ ‡çš„æ•°æ®é›†**è·å–å®Œæ¯•ä¹‹åï¼Œå†æ¬¡è·å–æ•°æ®ï¼Œå°±ä¼šæŠ¥é”™ï¼Œ**ä»è€Œç»ˆæ­¢äº†ç¨‹åºçš„æ‰§è¡Œã€‚

![image-20250417203906594](./Mysql-Learning-Local.assets/image-20250417203906594.png)

ä½†æ˜¯æ­¤æ—¶ï¼Œtb_user_proè¡¨ç»“æ„åŠ**å…¶æ•°æ®éƒ½å·²ç»æ’å…¥æˆåŠŸäº†**ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åˆ·æ–°è¡¨ç»“æ„ï¼Œæ£€æŸ¥è¡¨ç»“æ„ä¸­çš„æ•°æ®ã€‚

![image-20250417203947881](./Mysql-Learning-Local.assets/image-20250417203947881.png)

ä¸Šè¿°çš„åŠŸèƒ½ï¼Œè™½ç„¶æˆ‘ä»¬å®ç°äº†ï¼Œä½†æ˜¯é€»è¾‘å¹¶ä¸å®Œå–„ï¼Œè€Œä¸”ç¨‹åºæ‰§è¡Œå®Œæ¯•ï¼Œè·å–ä¸åˆ°æ•°æ®ï¼Œæ•°æ®åº“è¿˜æŠ¥é”™ã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±éœ€è¦æ¥å®Œæˆè¿™ä¸ªå­˜å‚¨è¿‡ç¨‹ï¼Œå¹¶ä¸”è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

è¦æƒ³è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±éœ€è¦é€šè¿‡MySQLä¸­æä¾›çš„ **æ¡ä»¶å¤„ç†ç¨‹åº Handler** æ¥è§£å†³ã€‚



### ï¼ˆ11ï¼‰æ¡ä»¶å¤„ç†ç¨‹åº-Handler

#### â‘  ä»‹ç»

![image-20250417204446613](./Mysql-Learning-Local.assets/image-20250417204446613.png)

æ¡ä»¶å¤„ç†ç¨‹åºï¼ˆHandlerï¼‰å¯ä»¥ç”¨æ¥å®šä¹‰**åœ¨æµç¨‹æ§åˆ¶ç»“æ„æ‰§è¡Œè¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜æ—¶ç›¸åº”çš„å¤„ç†æ­¥éª¤**ã€‚å…·ä½“è¯­æ³•ä¸ºï¼š

```sql
DECLARE handler_action HANDLER FOR condition_value [, condition_value]... statement ;

handler_action çš„å–å€¼ï¼š
    CONTINUE: ç»§ç»­æ‰§è¡Œå½“å‰ç¨‹åº
    EXIT: ç»ˆæ­¢æ‰§è¡Œå½“å‰ç¨‹åº

condition_value çš„å–å€¼ï¼š
    SQLSTATE sqlstate_value: çŠ¶æ€ç ï¼Œå¦‚ 02000

    SQLWARNING: æ‰€æœ‰ä»¥01å¼€å¤´çš„SQLSTATEä»£ç çš„ç®€å†™
    NOT FOUND: æ‰€æœ‰ä»¥02å¼€å¤´çš„SQLSTATEä»£ç çš„ç®€å†™
    SQLEXCEPTION: æ‰€æœ‰æ²¡æœ‰è¢«SQLWARNING æˆ– NOT FOUNDæ•è·çš„SQLSTATEä»£ç çš„ç®€å†™
```



#### â‘¡æ¡ˆä¾‹

æˆ‘ä»¬ç»§ç»­æ¥å®Œæˆåœ¨ä¸Šä¸€å°èŠ‚æå‡ºçš„è¿™ä¸ªéœ€æ±‚ï¼Œå¹¶è§£å†³å…¶ä¸­çš„é—®é¢˜ã€‚

æ ¹æ®ä¼ å…¥çš„å‚æ•°uageï¼Œæ¥æŸ¥è¯¢ç”¨æˆ·è¡¨tb_userä¸­ï¼Œæ‰€æœ‰çš„ç”¨æˆ·å¹´é¾„å°äºç­‰äºuageçš„ç”¨æˆ·å§“åï¼ˆnameï¼‰å’Œä¸“ä¸šï¼ˆprofessionï¼‰ï¼Œå¹¶å°†ç”¨æˆ·çš„å§“åå’Œä¸“ä¸šæ’å…¥åˆ°æ‰€åˆ›å»ºçš„ä¸€å¼ æ–°è¡¨(id,name,profession)ä¸­ã€‚

**A. é€šè¿‡SQLSTATEæŒ‡å®šå…·ä½“çš„çŠ¶æ€ç **

```sql
-- é€»è¾‘:
-- A. å£°æ˜æ¸¸æ ‡, å­˜å‚¨æŸ¥è¯¢ç»“æœé›†
-- B. å‡†å¤‡: åˆ›å»ºè¡¨ç»“æ„
-- C. å¼€å¯æ¸¸æ ‡
-- D. è·å–æ¸¸æ ‡ä¸­çš„è®°å½•
-- E. æ’å…¥æ•°æ®åˆ°æ–°è¡¨ä¸­
-- F. å…³é—­æ¸¸æ ‡

create procedure p11(in uage int)

begin
    declare uname varchar(100);
    declare upro varchar(100);
    declare u_cursor cursor for select name,profession from tb_user where age <=uage;
    -- å£°æ˜æ¡ä»¶å¤„ç†ç¨‹åº ï¼š å½“SQLè¯­å¥æ‰§è¡ŒæŠ›å‡ºçš„çŠ¶æ€ç ä¸º02000æ—¶ï¼Œå°†å…³é—­æ¸¸æ ‡u_cursorï¼Œå¹¶é€€å‡º
    declare exit handler for SQLSTATE '02000' close u_cursor;

    drop table if exists tb_user_pro;
    create table if not exists tb_user_pro(
        id int primary key auto_increment,
        name varchar(100),
        profession varchar(100)
    );

    open u_cursor;
    
    while true do
        fetch u_cursor into uname,upro;
        insert into tb_user_pro values (null, uname, upro);
    end while;

    close u_cursor;

end;

call p11(30);
```



**B. é€šè¿‡SQLSTATEçš„ä»£ç ç®€å†™æ–¹å¼ ==NOT FOUND==**

â€‹	**02 å¼€å¤´çš„çŠ¶æ€ç ï¼Œä»£ç ç®€å†™ä¸º NOT FOUND**

```sql
create procedure p12(in uage int)

begin

    declare uname varchar(100);
    declare upro varchar(100);
    declare u_cursor cursor for select name,profession from tb_user where age <=uage;

    -- å£°æ˜æ¡ä»¶å¤„ç†ç¨‹åº ï¼š å½“SQLè¯­å¥æ‰§è¡ŒæŠ›å‡ºçš„çŠ¶æ€ç ä¸º02å¼€å¤´æ—¶ï¼Œå°†å…³é—­æ¸¸æ ‡u_cursorï¼Œå¹¶é€€å‡º
    declare exit handler for not found close u_cursor;

    drop table if exists tb_user_pro;
    create table if not exists tb_user_pro(
        id int primary key auto_increment,
        name varchar(100),
        profession varchar(100)
    );

    open u_cursor;

    while true do
        fetch u_cursor into uname,upro;
        insert into tb_user_pro values (null, uname, upro);
    end while;

    close u_cursor;

end;

call p12(30);
```



**å…·ä½“çš„é”™è¯¯çŠ¶æ€ç **ï¼Œå¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š

**https://dev.mysql.com/doc/refman/8.0/en/declare-handler.html**

**https://dev.mysql.com/doc/mysql-errors/8.0/en/server-error-reference.html**



## 4.3 å­˜å‚¨å‡½æ•°

#### ï¼ˆ1ï¼‰ä»‹ç»

å­˜å‚¨å‡½æ•°æ˜¯**==æœ‰è¿”å›å€¼çš„å­˜å‚¨è¿‡ç¨‹==**ï¼Œå­˜å‚¨å‡½æ•°çš„==å‚æ•°**åªèƒ½æ˜¯INç±»å‹çš„**==ã€‚å…·ä½“è¯­æ³•å¦‚ä¸‹ï¼š

```sql
CREATE FUNCTION å­˜å‚¨å‡½æ•°åç§° ([ å‚æ•°åˆ—è¡¨ ])
RETURNS type [characteristic ...]

BEGIN
    -- SQLè¯­å¥
    RETURN ...; -- è¿”å›ç»“æœ
END ;
```

**characteristicè¯´æ˜ï¼š**

- DETERMINISTICï¼š**==ç›¸åŒçš„è¾“å…¥å‚æ•°æ€»æ˜¯äº§ç”Ÿç›¸åŒçš„ç»“æœ==**
- NO SQL ï¼šä¸åŒ…å« SQL è¯­å¥ã€‚
- READS SQL DATAï¼š**åŒ…å«è¯»å–æ•°æ®çš„è¯­å¥ï¼Œä½†ä¸åŒ…å«å†™å…¥æ•°æ®çš„è¯­å¥**ã€‚



#### ï¼ˆ2ï¼‰æ¡ˆä¾‹

è®¡ç®—ä»1ç´¯åŠ åˆ°nçš„å€¼ï¼Œnä¸ºä¼ å…¥çš„å‚æ•°å€¼ã€‚

```sql
create function fun1(n int)
returns int deterministic -- ç›¸åŒçš„è¾“å…¥å‚æ•°æ€»æ˜¯äº§ç”Ÿç›¸åŒçš„ç»“æœ
begin
    declare total int default 0;
    
    while n>0 do
    	set total := total + n;
   	 	set n := n - 1;
    end while;
    
    return total;
end;

select fun1(50);
```

åœ¨mysql8.0ç‰ˆæœ¬ä¸­**binlogï¼ˆäºŒè¿›åˆ¶æ—¥å¿—ï¼‰é»˜è®¤æ˜¯å¼€å¯çš„**ï¼Œ**ä¸€æ—¦å¼€å¯äº†**ï¼Œmysqlå°±è¦æ±‚åœ¨å®šä¹‰å­˜å‚¨è¿‡ç¨‹æ—¶ï¼Œ==**éœ€è¦æŒ‡å®šcharacteristicç‰¹æ€§**==ï¼Œ**å¦åˆ™å°±ä¼šæŠ¥å¦‚ä¸‹é”™è¯¯**ï¼š

![image-20250417205056469](./Mysql-Learning-Local.assets/image-20250417205056469.png)

![image-20250417205133058](./Mysql-Learning-Local.assets/image-20250417205133058.png)





## 4.4 è§¦å‘å™¨

### ï¼ˆ1ï¼‰ä»‹ç»

![image-20250417211400006](./Mysql-Learning-Local.assets/image-20250417211400006.png)

è§¦å‘å™¨æ˜¯ä¸è¡¨æœ‰å…³çš„æ•°æ®åº“å¯¹è±¡ï¼ŒæŒ‡åœ¨**insert/update/delete==ä¹‹å‰(BEFORE)æˆ–ä¹‹å(AFTER)==**ï¼Œè§¦å‘å¹¶**æ‰§è¡Œè§¦å‘å™¨ä¸­å®šä¹‰çš„SQLè¯­å¥é›†åˆ**ã€‚è§¦å‘å™¨çš„è¿™ç§ç‰¹æ€§å¯ä»¥ååŠ©åº”ç”¨åœ¨æ•°æ®åº“ç«¯ç¡®ä¿æ•°æ®çš„**å®Œæ•´æ€§, æ—¥å¿—è®°å½• , æ•°æ®æ ¡éªŒç­‰æ“ä½œ ã€‚**

ä½¿ç”¨åˆ«åOLDå’ŒNEWæ¥å¼•ç”¨è§¦å‘å™¨ä¸­å‘ç”Ÿå˜åŒ–çš„è®°å½•å†…å®¹ï¼Œè¿™ä¸å…¶ä»–çš„æ•°æ®åº“æ˜¯ç›¸ä¼¼çš„ã€‚**==ç°åœ¨è§¦å‘å™¨è¿˜åªæ”¯æŒè¡Œçº§è§¦å‘ï¼Œä¸æ”¯æŒè¯­å¥çº§è§¦å‘ã€‚==**

- **è¡Œçº§è§¦å‘**
  - æ¯”å¦‚æ‰§è¡Œupdateè¯­å¥ï¼Œå½±å“äº†5è¡Œï¼Œè§¦å‘å™¨ä¼šæ‰§è¡Œ5æ¬¡
- **è¯­å¥çº§è§¦å‘**
  - æ¯”å¦‚æ‰§è¡Œupdateè¯­å¥ï¼Œå½±å“äº†5è¡Œï¼Œ**è§¦å‘å™¨åªä¼šæ‰§è¡Œ1æ¬¡**

![image-20250416212257370](./Mysql-Learning-Local.assets/image-20250416212257370.png)



### ï¼ˆ2ï¼‰è¯­æ³•

![image-20250417212032956](./Mysql-Learning-Local.assets/image-20250417212032956.png)

#### â‘ åˆ›å»º

```sql
CREATE TRIGGER trigger_name

BEFORE/AFTER INSERT/UPDATE/DELETE

ON tbl_name FOR EACH ROW -- è¡Œçº§è§¦å‘å™¨ï¼Œç›®å‰Mysql8.0 åªæ”¯æŒè¡Œçº§è§¦å‘å™¨

BEGIN

	trigger_stmt ;

END;
```

#### â‘¡ æŸ¥çœ‹

```sql
SHOW TRIGGERS ; 
```

#### â‘¢åˆ é™¤

```sql
DROP TRIGGER [schema_name.]trigger_name ; -- åˆ é™¤(æŒ‡å®šæ•°æ®åº“çš„)è§¦å‘å™¨
-- å¦‚æœæ²¡æœ‰æŒ‡å®š schema_nameï¼Œé»˜è®¤ä¸ºå½“å‰æ•°æ®åº“ ã€‚
```



### ï¼ˆ3ï¼‰æ¡ˆä¾‹-è®°å½•æ•°æ®å˜æ›´æ—¥å¿—

é€šè¿‡è§¦å‘å™¨è®°å½• tb_user è¡¨çš„æ•°æ®å˜æ›´æ—¥å¿—ï¼Œå°†å˜æ›´æ—¥å¿—æ’å…¥åˆ°æ—¥å¿—è¡¨user_logsä¸­, åŒ…å«å¢åŠ ,ä¿®æ”¹ , åˆ é™¤ ;

**è¡¨ç»“æ„å‡†å¤‡:**

```sql
-- å‡†å¤‡å·¥ä½œ : æ—¥å¿—è¡¨ user_logs
create table user_logs(
    id int(11) not null auto_increment,
    operation varchar(20) not null comment 'æ“ä½œç±»å‹, insert/update/delete',
    operate_time datetime not null comment 'æ“ä½œæ—¶é—´',
    operate_id int(11) not null comment 'æ“ä½œçš„ID',
    operate_params varchar(500) comment 'æ“ä½œå‚æ•°',
    primary key(`id`)
)engine=innodb default charset=utf8;
```

#### A. æ’å…¥æ•°æ®è§¦å‘å™¨

```sql
create trigger tb_user_insert_trigger
	after insert 
	on tb_user for each row

begin
	insert into user_logs(id, operation, operate_time, operate_id, operate_params)
    VALUES
        (null, 'insert', now(), new.id, 
         concat('æ’å…¥çš„æ•°æ®å†…å®¹ä¸º: id=',new.id,',name=',new.name, ', phone=', NEW.phone, ', email=', NEW.email, ', profession=', NEW.profession));

end;
```

**æµ‹è¯•:**

```sql
-- æŸ¥çœ‹
show triggers ;

-- åˆ é™¤æŒ‡å®šçš„è§¦å‘å™¨
drop trigger tb_user_insert_trigger;

-- æ’å…¥æ•°æ®åˆ°tb_user
insert into tb_user(id, name, phone, email, profession, age, gender, status, createtime) 
VALUES (26,'ä¸‰çš‡å­','18809091212','erhuangzi@163.com','è½¯ä»¶å·¥ç¨‹',23,'1','1',now());
```

æµ‹è¯•å®Œæ¯•ä¹‹åï¼Œæ£€æŸ¥æ—¥å¿—è¡¨ä¸­çš„æ•°æ®æ˜¯å¦å¯ä»¥æ­£å¸¸æ’å…¥ï¼Œä»¥åŠæ’å…¥æ•°æ®çš„æ­£ç¡®æ€§ã€‚



#### B. ä¿®æ”¹æ•°æ®è§¦å‘å™¨

```sql
create trigger tb_user_update_trigger
	after update on tb_user for each row

begin
    insert into user_logs(id, operation, operate_time, operate_id, operate_params)
    VALUES
        (null, 'update', now(), new.id, 
         concat('æ›´æ–°ä¹‹å‰çš„æ•°æ®: id=',old.id,',name=',old.name, ', phone=',old.phone, ', email=', old.email, ', profession=', old.profession,
         ' | æ›´æ–°ä¹‹åçš„æ•°æ®: id=',new.id,',name=',new.name, ', phone=', NEW.phone, ', email=', NEW.email, ', profession=', NEW.profession));

end;
```

**æµ‹è¯•**

```sql
-- æŸ¥çœ‹
show triggers ;

-- æ›´æ–°
update tb_user set profession = 'ä¼šè®¡' where id = 23;

update tb_user set profession = 'ä¼šè®¡' where id <= 5; -- å› ä¸ºä½¿ç”¨çš„each row è¡Œçº§è§¦å‘å™¨ï¼Œæ‰§è¡Œupdateæ›´æ–°äº†5è¡Œï¼Œå¯¹åº”çš„è§¦å‘å™¨ä¹Ÿä¼šæ‰§è¡Œ5æ¬¡
```

æµ‹è¯•å®Œæ¯•ä¹‹åï¼Œæ£€æŸ¥æ—¥å¿—è¡¨ä¸­çš„æ•°æ®æ˜¯å¦å¯ä»¥æ­£å¸¸æ’å…¥ï¼Œä»¥åŠæ’å…¥æ•°æ®çš„æ­£ç¡®æ€§ã€‚



#### C. åˆ é™¤æ•°æ®è§¦å‘å™¨

```sql
create trigger tb_user_delete_trigger
after delete on tb_user for each row

begin
    insert into user_logs(id, operation, operate_time, operate_id, operate_params)
    VALUES
        (null, 'delete', now(), old.id,
        concat('åˆ é™¤ä¹‹å‰çš„æ•°æ®: id=',old.id,',name=',old.name, ', phone=',
        old.phone, ', email=', old.email, ', profession=', old.profession));

end;
```

**æµ‹è¯•**

```sql
-- æŸ¥çœ‹
show triggers ;

-- åˆ é™¤æ•°æ®
delete from tb_user where id = 26;
```

æµ‹è¯•å®Œæ¯•ä¹‹åï¼Œæ£€æŸ¥æ—¥å¿—è¡¨ä¸­çš„æ•°æ®æ˜¯å¦å¯ä»¥æ­£å¸¸æ’å…¥ï¼Œä»¥åŠæ’å…¥æ•°æ®çš„æ­£ç¡®æ€§ã€‚



## 4.5 å°ç»“



![image-20250417220016823](./Mysql-Learning-Local.assets/image-20250417220016823.png)



# 5ã€ğŸš€ ==é”==

## 5.1 æ¦‚è¿°

é”æ˜¯è®¡ç®—æœº**==åè°ƒå¤šä¸ªè¿›ç¨‹æˆ–çº¿ç¨‹å¹¶å‘è®¿é—®æŸä¸€èµ„æºçš„æœºåˆ¶==**ã€‚åœ¨æ•°æ®åº“ä¸­ï¼Œé™¤ä¼ ç»Ÿçš„è®¡ç®—èµ„æºï¼ˆCPUã€RAMã€I/Oï¼‰çš„äº‰ç”¨ä»¥å¤–ï¼Œæ•°æ®ä¹Ÿæ˜¯ä¸€ç§ä¾›è®¸å¤šç”¨æˆ·å…±äº«çš„èµ„æºã€‚å¦‚ä½•**ä¿è¯æ•°æ®å¹¶å‘è®¿é—®çš„ä¸€è‡´æ€§ã€æœ‰æ•ˆæ€§**æ˜¯æ‰€æœ‰æ•°æ®åº“å¿…é¡»è§£å†³çš„ä¸€ä¸ªé—®é¢˜ï¼Œé”å†²çªä¹Ÿæ˜¯å½±å“æ•°æ®åº“å¹¶å‘è®¿é—®æ€§èƒ½çš„ä¸€ä¸ªé‡è¦å› ç´ ã€‚ä»è¿™ä¸ªè§’åº¦æ¥è¯´ï¼Œé”å¯¹æ•°æ®åº“è€Œè¨€æ˜¾å¾—å°¤å…¶é‡è¦ï¼Œä¹Ÿæ›´åŠ å¤æ‚ã€‚

MySQLä¸­çš„é”ï¼ŒæŒ‰ç…§**é”çš„ç²’åº¦åˆ†**ï¼Œåˆ†ä¸ºä»¥ä¸‹ä¸‰ç±»ï¼š

- **å…¨å±€é”**ï¼šé”å®šæ•°æ®åº“ä¸­çš„**æ‰€æœ‰è¡¨**ã€‚
- **è¡¨çº§é”**ï¼šæ¯æ¬¡**æ“ä½œé”ä½æ•´å¼ è¡¨**ã€‚
- **è¡Œçº§é”**ï¼šæ¯æ¬¡æ“ä½œ**é”ä½å¯¹åº”çš„è¡Œæ•°æ®**ã€‚



## 5.2 ğŸŒŸ å…¨å±€é”

### ï¼ˆ1ï¼‰ä»‹ç»

å…¨å±€é”å°±æ˜¯å¯¹æ•´ä¸ªæ•°æ®åº“å®ä¾‹åŠ é”ï¼Œ**åŠ é”å==æ•´ä¸ªå®ä¾‹å°±å¤„äºåªè¯»çŠ¶æ€==**ï¼Œåç»­çš„DMLçš„å†™è¯­å¥ï¼ŒDDLè¯­å¥ï¼Œå·²ç»æ›´æ–°æ“ä½œçš„**äº‹åŠ¡æäº¤è¯­å¥éƒ½å°†==è¢«é˜»å¡==**ã€‚



### ï¼ˆ2ï¼‰ğŸŒŸ ä½¿ç”¨åœºæ™¯

å…¶å…¸å‹çš„**ä½¿ç”¨åœºæ™¯æ˜¯åšå…¨åº“çš„é€»è¾‘å¤‡ä»½**ï¼Œå¯¹æ‰€æœ‰çš„è¡¨è¿›è¡Œé”å®šï¼Œä»è€Œ**è·å–ä¸€è‡´æ€§è§†å›¾ï¼Œä¿è¯æ•°æ®çš„å®Œæ•´æ€§**ã€‚



ä¸ºä»€ä¹ˆå…¨åº“é€»è¾‘å¤‡ä»½ï¼Œå°±éœ€è¦åŠ å…¨å°±é”å‘¢ï¼Ÿ

##### **A. æˆ‘ä»¬ä¸€èµ·å…ˆæ¥åˆ†æä¸€ä¸‹ä¸åŠ å…¨å±€é”ï¼Œå¯èƒ½å­˜åœ¨çš„é—®é¢˜ã€‚**

å‡è®¾åœ¨æ•°æ®åº“ä¸­å­˜åœ¨è¿™æ ·ä¸‰å¼ è¡¨: tb_stock åº“å­˜è¡¨ï¼Œtb_order è®¢å•è¡¨ï¼Œtb_orderlog è®¢å•æ—¥å¿—è¡¨ã€‚

![image-20250417220831903](./Mysql-Learning-Local.assets/image-20250417220831903.png)

- åœ¨è¿›è¡Œæ•°æ®å¤‡ä»½æ—¶ï¼Œ**å…ˆå¤‡ä»½äº†tb_stockåº“å­˜è¡¨**ã€‚
- ç„¶åæ¥ä¸‹æ¥ï¼Œåœ¨ä¸šåŠ¡ç³»ç»Ÿä¸­ï¼Œ**æ‰§è¡Œäº†ä¸‹å•æ“ä½œ**ï¼Œæ‰£å‡åº“å­˜ï¼Œç”Ÿæˆè®¢å•ï¼ˆæ›´æ–°tb_stockè¡¨ï¼Œæ’å…¥tb_orderè¡¨ï¼‰ã€‚
- ç„¶å**å†æ‰§è¡Œå¤‡ä»½ tb_orderè¡¨çš„é€»è¾‘**ã€‚
- ä¸šåŠ¡ä¸­æ‰§è¡Œæ’å…¥è®¢å•æ—¥å¿—æ“ä½œã€‚
- æœ€åï¼Œåˆå¤‡ä»½äº†tb_orderlogè¡¨ã€‚



æ­¤æ—¶å¤‡ä»½å‡ºæ¥çš„æ•°æ®ï¼Œæ˜¯å­˜åœ¨é—®é¢˜çš„ã€‚å› ä¸ºå¤‡ä»½å‡ºæ¥çš„æ•°æ®ï¼Œtb_stockè¡¨ä¸tb_orderè¡¨çš„**æ•°æ®ä¸ä¸€è‡´(æœ‰æœ€æ–°æ“ä½œçš„è®¢å•ä¿¡æ¯,ä½†æ˜¯åº“å­˜æ•°æ²¡å‡)**ã€‚

é‚£å¦‚ä½•æ¥è§„é¿è¿™ç§é—®é¢˜å‘¢? æ­¤æ—¶å°±å¯ä»¥å€ŸåŠ©äº**MySQLçš„å…¨å±€é”æ¥è§£å†³**ã€‚



##### **B. å†æ¥åˆ†æä¸€ä¸‹åŠ äº†å…¨å±€é”åçš„æƒ…å†µ**

![image-20250417220959936](./Mysql-Learning-Local.assets/image-20250417220959936.png)

å¯¹æ•°æ®åº“è¿›è¡Œè¿›è¡Œé€»è¾‘å¤‡ä»½ä¹‹å‰ï¼Œå…ˆ**å¯¹æ•´ä¸ªæ•°æ®åº“åŠ ä¸Šå…¨å±€é”**ï¼Œä¸€æ—¦åŠ äº†å…¨å±€é”ä¹‹åï¼Œå…¶ä»–çš„DDLã€DMLå…¨éƒ¨éƒ½**å¤„äºé˜»å¡çŠ¶æ€**ï¼Œä½†æ˜¯**å¯ä»¥æ‰§è¡ŒDQLè¯­å¥ï¼Œä¹Ÿå°±æ˜¯==å¤„äºåªè¯»çŠ¶æ€==**ï¼Œè€Œ**æ•°æ®å¤‡ä»½å°±æ˜¯æŸ¥è¯¢æ“ä½œ**ã€‚é‚£ä¹ˆæ•°æ®åœ¨è¿›è¡Œé€»è¾‘å¤‡ä»½çš„è¿‡ç¨‹ä¸­ï¼Œæ•°æ®åº“ä¸­çš„æ•°æ®å°±æ˜¯ä¸ä¼šå‘ç”Ÿå˜åŒ–çš„ï¼Œè¿™æ ·å°±**ä¿è¯äº†æ•°æ®çš„ä¸€è‡´æ€§å’Œå®Œæ•´æ€§**ã€‚



### ï¼ˆ3ï¼‰è¯­æ³•

![image-20250417221329655](./Mysql-Learning-Local.assets/image-20250417221329655.png)

#### â‘ åŠ å…¨å±€é”

```sql
flush tables with read lock ; 
```

#### â‘¡æ•°æ®å¤‡ä»½

```sql
mysqldump [-h 192.168.200.202] -uroot â€“p1234 itcast > ./itcast.sql 
```

æ•°æ®å¤‡ä»½çš„ç›¸å…³æŒ‡ä»¤, åœ¨åé¢**MySQLç®¡ç†ç« èŠ‚**, è¿˜ä¼šè¯¦ç»†è®²è§£.

#### â‘¢é‡Šæ”¾é”

```sql
unlock tables ; 
```



### ï¼ˆ4ï¼‰ğŸŒŸ ==ç‰¹ç‚¹==

![image-20250417222056002](./Mysql-Learning-Local.assets/image-20250417222056002.png)

æ•°æ®åº“ä¸­åŠ å…¨å±€é”ï¼Œæ˜¯ä¸€ä¸ªæ¯”è¾ƒé‡çš„æ“ä½œï¼Œå­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š

- å¦‚æœåœ¨**ä¸»åº“ä¸Šå¤‡ä»½**ï¼Œé‚£ä¹ˆåœ¨**å¤‡ä»½æœŸé—´éƒ½ä¸èƒ½æ‰§è¡Œæ›´æ–°ï¼Œä¸šåŠ¡åŸºæœ¬ä¸Šå°±å¾—åœæ‘†**ã€‚
- å¦‚æœåœ¨**ä»åº“ä¸Šå¤‡ä»½**ï¼Œé‚£ä¹ˆåœ¨å¤‡ä»½æœŸé—´**ä»åº“ä¸èƒ½æ‰§è¡Œä¸»åº“åŒæ­¥è¿‡æ¥çš„äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆbinlogï¼‰**ï¼Œ**==ä¼šå¯¼è‡´ä¸»ä»å»¶è¿Ÿã€‚==**



åœ¨InnoDBå¼•æ“ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¤‡ä»½æ—¶**åŠ ä¸Šå‚æ•° --single-transaction å‚æ•°**æ¥å®Œæˆ**==ä¸åŠ é”çš„ä¸€è‡´æ€§æ•°æ®å¤‡ä»½==**ã€‚

```sql
mysqldump --single-transaction [-h 192.168.200.202] -uroot â€“p123456 itcast > itcast.sql 
-- MySQLçš„åº•å±‚åˆ©ç”¨çš„æ˜¯å¿«ç…§è¯»çš„æ–¹å¼å®ç°çš„
```

**MySQLçš„åº•å±‚==åˆ©ç”¨çš„æ˜¯å¿«ç…§è¯»çš„æ–¹å¼==å®ç°çš„**



## 5.3 ğŸŒŸ è¡¨çº§é”

### ï¼ˆ1ï¼‰ä»‹ç»

è¡¨çº§é”ï¼Œ**æ¯æ¬¡æ“ä½œé”ä½æ•´å¼ è¡¨**ã€‚é”å®šç²’åº¦å¤§ï¼Œå‘ç”Ÿ**é”å†²çªçš„æ¦‚ç‡æœ€é«˜ï¼Œå¹¶å‘åº¦æœ€ä½**ã€‚åº”ç”¨åœ¨MyISAMã€InnoDBã€BDBç­‰å­˜å‚¨å¼•æ“ä¸­ã€‚

å¯¹äºè¡¨çº§é”ï¼Œä¸»è¦åˆ†ä¸ºä»¥ä¸‹ä¸‰ç±»ï¼š

- **è¡¨é”**
- **å…ƒæ•°æ®é”**ï¼ˆmeta data lockï¼ŒMDLï¼‰
- **æ„å‘é”**



### ï¼ˆ2ï¼‰ğŸŒŸ ==è¡¨é”==

![image-20250417223630891](./Mysql-Learning-Local.assets/image-20250417223630891.png)

#### â‘ ==åˆ†ç±»==

##### è¡¨å…±äº«è¯»é”

##### è¡¨ç‹¬å å†™é”

å¯¹äºè¡¨é”ï¼Œåˆ†ä¸ºä¸¤ç±»ï¼š

- **==è¡¨å…±äº«è¯»é”==ï¼ˆread lock**ï¼‰ - ç®€ç§°ä¸ºè¯»é”
- **==è¡¨ç‹¬å å†™é”==ï¼ˆwrite lockï¼‰**- ç®€ç§°ä¸ºå†™é”
  - è¿™é‡Œçš„**ç‹¬å **æ„æ€æ˜¯ï¼Œå…¶ä»–å®¢æˆ·ç«¯çš„`è¯»å’Œå†™`æ“ä½œéƒ½ä¼šè¢«é˜»å¡ï¼Œ
  - è€Œ**==å½“å‰å®¢æˆ·ç«¯çš„è¯»å’Œå†™ä¸ä¼šè¢«é˜»å¡==**



#### â‘¡è¯­æ³•

- **åŠ é”**ï¼šlock tables è¡¨å... read/writeã€‚

```sql
lock tables è¡¨å... read/write
```



- **é‡Šæ”¾é”**ï¼šunlock tables æˆ–è€… å®¢æˆ·ç«¯æ–­å¼€è¿æ¥ ã€‚

```sql
unlock tables 
æˆ–è€… å°†å½“å‰å®¢æˆ·ç«¯æ–­å¼€è¿æ¥
```



#### â‘¢==ç‰¹ç‚¹==

##### A. è¯»é”

![image-20250417222550874](./Mysql-Learning-Local.assets/image-20250417222550874.png)

â€‹	å·¦ä¾§ä¸ºå®¢æˆ·ç«¯ä¸€ï¼Œå¯¹æŒ‡å®šè¡¨åŠ äº†è¯»é”ï¼Œ**ä¸ä¼šå½±å“å³ä¾§å®¢æˆ·ç«¯äºŒçš„è¯»**ï¼Œä½†æ˜¯ä¼š**é˜»å¡å³ä¾§å®¢æˆ·ç«¯çš„å†™**ã€‚

**æµ‹è¯•:**

![image-20250417222627290](./Mysql-Learning-Local.assets/image-20250417222627290.png)



##### B. å†™é”

![image-20250417222703508](./Mysql-Learning-Local.assets/image-20250417222703508.png)

â€‹	å·¦ä¾§ä¸ºå®¢æˆ·ç«¯ä¸€ï¼Œå¯¹æŒ‡å®šè¡¨åŠ äº†å†™é”ï¼Œ**ä¼šé˜»å¡å³ä¾§å®¢æˆ·ç«¯çš„è¯»å’Œå†™**ã€‚



**æµ‹è¯•:**

![image-20250417223602566](./Mysql-Learning-Local.assets/image-20250417223602566.png)



#### â‘£ğŸŒŸ ==ç»“è®º==



> **ç»“è®º:** 
>
> - è¯»é”**ä¸ä¼šé˜»å¡å…¶ä»–å®¢æˆ·ç«¯çš„è¯»ï¼Œä½†æ˜¯ä¼šé˜»å¡å†™**ã€‚
>
>   - å½“å‰å®¢æˆ·ç«¯å’Œå…¶ä»–å®¢æˆ·ç«¯**éƒ½å¯ä»¥è¯»**
>   - å½“å‰å®¢æˆ·ç«¯å’Œå…¶ä»–å®¢æˆ·ç«¯**éƒ½ä¸å¯ä»¥å†™**
>
>   ![image-20250417222550874](./Mysql-Learning-Local.assets/image-20250417222550874.png)
>
> - å†™é”**æ—¢ä¼šé˜»å¡==å…¶ä»–å®¢æˆ·ç«¯==çš„è¯»ï¼Œåˆä¼šé˜»å¡==å…¶ä»–å®¢æˆ·ç«¯==çš„å†™**ã€‚
>
>   - æ³¨æ„ è¿™é‡Œé˜»å¡çš„`è¯»å’Œå†™`éƒ½æŒ‡çš„æ˜¯**å…¶ä»–å®¢æˆ·ç«¯**
>   - **==å½“å‰å®¢æˆ·ç«¯çš„è¯»å’Œå†™ä¸ä¼šè¢«é˜»å¡==**
>
> ![image-20250417222703508](./Mysql-Learning-Local.assets/image-20250417222703508.png)



### ï¼ˆ3ï¼‰ğŸŒŸ ==å…ƒæ•°æ®é”-MDL==

#### â‘ æ¦‚è¿°

![image-20250417233151833](./Mysql-Learning-Local.assets/image-20250417233151833.png)

meta data lock , å…ƒæ•°æ®é”ï¼Œç®€å†™MDLã€‚

**MDLåŠ é”è¿‡ç¨‹æ˜¯ç³»ç»Ÿè‡ªåŠ¨æ§åˆ¶**ï¼Œæ— éœ€æ˜¾å¼ä½¿ç”¨ï¼Œåœ¨**è®¿é—®ä¸€å¼ è¡¨çš„æ—¶å€™ä¼šè‡ªåŠ¨åŠ ä¸Š**ã€‚

MDLé”ä¸»è¦ä½œç”¨æ˜¯**ç»´æŠ¤è¡¨å…ƒæ•°æ®çš„æ•°æ®ä¸€è‡´æ€§**ï¼Œåœ¨è¡¨ä¸Šæœ‰æ´»åŠ¨äº‹åŠ¡çš„æ—¶å€™ï¼Œä¸å¯ä»¥å¯¹å…ƒæ•°æ®è¿›è¡Œå†™å…¥æ“ä½œã€‚**==ä¸ºäº†é¿å…DMLä¸DDLå†²çªï¼Œä¿è¯è¯»å†™çš„æ­£ç¡®æ€§ã€‚==**



è¿™é‡Œçš„å…ƒæ•°æ®ï¼Œå¤§å®¶å¯ä»¥ç®€å•ç†è§£ä¸ºå°±æ˜¯**ä¸€å¼ è¡¨çš„è¡¨ç»“æ„**ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œ**==æŸä¸€å¼ è¡¨æ¶‰åŠåˆ°æœªæäº¤çš„äº‹åŠ¡æ—¶ï¼Œæ˜¯ä¸èƒ½å¤Ÿä¿®æ”¹è¿™å¼ è¡¨çš„è¡¨ç»“æ„çš„ã€‚==**



åœ¨MySQL5.5ä¸­å¼•å…¥äº†MDLï¼š

- å½“å¯¹ä¸€å¼ è¡¨è¿›è¡Œå¢åˆ æ”¹æŸ¥çš„æ—¶å€™ï¼Œ**åŠ MDLè¯»é”(å…±äº«)**ï¼›
- å½“**å¯¹è¡¨ç»“æ„è¿›è¡Œå˜æ›´æ“ä½œ**çš„æ—¶å€™ï¼Œ**==åŠ MDLå†™é”(æ’ä»–)==**ã€‚



å¸¸è§çš„SQLæ“ä½œæ—¶ï¼Œæ‰€æ·»åŠ çš„å…ƒæ•°æ®é”ï¼š

<img src="./Mysql-Learning-Local.assets/image-20250417224140352.png" alt="image-20250417224140352" style="zoom:80%;" />



#### â‘¡ğŸŒŸ ==æ¼”ç¤º==

> æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„SQLï¼Œæ¥**==æŸ¥çœ‹æ•°æ®åº“ä¸­çš„å…ƒæ•°æ®é”==**çš„æƒ…å†µï¼š
>
> ```sql
> select object_type,object_schema,object_name,lock_type,lock_duration from performance_schema.metadata_locks ;
> ```
>
> æˆ‘ä»¬åœ¨æ“ä½œè¿‡ç¨‹ä¸­ï¼Œå¯ä»¥é€šè¿‡ä¸Šè¿°çš„SQLè¯­å¥ï¼Œæ¥**æŸ¥çœ‹å…ƒæ•°æ®é”çš„åŠ é”æƒ…å†µ**ã€‚



##### 1ï¼‰å…ƒæ•°æ®å…±äº«é”-==ç›¸äº’å…¼å®¹==

å½“æ‰§è¡Œ**SELECT** =ã€‹ shared_read

**INSERTã€UPDATEã€DELETE**ã€**==Select ... for update==**ç­‰è¯­å¥æ—¶ => shared_write

æ·»åŠ çš„æ˜¯**==å…ƒæ•°æ®å…±äº«é”==**ï¼ˆSHARED_READ /SHARED_WRITEï¼‰ï¼Œè¿™**==ä¸¤è€…ä¹‹é—´æ˜¯å…¼å®¹==**çš„ã€‚

**å¯¹äºå®¢æˆ·ç«¯ä¸€ï¼š**

```sql
begin;

	select * from tb_user where id = 1;

commit; -- ä¸ºäº†æŸ¥çœ‹æ•ˆæœï¼Œäº‹åŠ¡çš„æäº¤å¯ä»¥å»¶åæ‰§è¡Œ
```

**å¯¹äºå®¢æˆ·ç«¯äºŒï¼š**

```sql
begin;

	update tb_user set name = 'å°é¹' where id = 1;
	
commit;
```

![image-20250417231150088](./Mysql-Learning-Local.assets/image-20250417231150088.png)



![image-20250417230805332](./Mysql-Learning-Local.assets/image-20250417230805332.png)



**æ³¨æ„ï¼š==å½“äº‹åŠ¡æäº¤åï¼Œä¹‹å‰ç»™è¡¨æ·»åŠ çš„å…ƒæ•°æ®é”éƒ½ä¼šæ¶ˆå¤±==ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå…ƒæ•°æ®é”çš„æ·»åŠ å’Œæ¶ˆå¤±ï¼Œæ˜¯==åŠ¨æ€çš„==**

![image-20250417231437866](./Mysql-Learning-Local.assets/image-20250417231437866.png)





##### 2ï¼‰æ’ä»–é”å’Œå…¶ä»–å…±äº«é”==äº’æ–¥==

å½“æ‰§è¡ŒSELECTè¯­å¥æ—¶ï¼Œæ·»åŠ çš„æ˜¯å…ƒæ•°æ®å…±äº«é”ï¼ˆSHARED_READï¼‰ï¼Œä¼š==é˜»å¡**å…ƒæ•°æ®æ’ä»–é”**==ï¼ˆ**EXCLUSIVE**ï¼‰ï¼Œä»–ä»¬äºŒè€…ä¹‹é—´æ˜¯**äº’æ–¥çš„**ã€‚

ä¾‹å¦‚ï¼Œä½¿ç”¨alter table.. ä¿®æ”¹è¡¨ç»“æ„ï¼Œè¿™æ—¶ä¼š**ç»™è¡¨åŠ ä¸Šexclusiveå…ƒæ•°æ®æ’å®ƒé”**

**å¯¹äºå®¢æˆ·ç«¯ä¸€ï¼š**

```sql
begin;

	select * from tb_user where id = 1;

commit; -- ä¸ºäº†æŸ¥çœ‹æ•ˆæœï¼Œäº‹åŠ¡çš„æäº¤å¯ä»¥å»¶åæ‰§è¡Œ
```

**å¯¹äºå®¢æˆ·ç«¯äºŒï¼š**æ‰§è¡Œäº†alter table æ”¹å˜äº†è¡¨ç»“æ„ï¼Œä¼šç»™æ“ä½œçš„è¡¨**==æ·»åŠ å…ƒæ•°æ®æ’ä»–é”==**

```sql
begin;

	alter table tb_user add column test_col varchar(10);
	
commit;
```

**å®¢æˆ·ç«¯ä¸€ï¼Œæ‰§è¡Œselectæ“ä½œï¼Œæ·»åŠ å…ƒæ•°æ®å…±äº«é”**

![image-20250417232831464](./Mysql-Learning-Local.assets/image-20250417232831464.png)



**å®¢æˆ·ç«¯äºŒï¼Œè¢«é˜»å¡**

![image-20250417232650390](./Mysql-Learning-Local.assets/image-20250417232650390.png)

![image-20250417233019379](./Mysql-Learning-Local.assets/image-20250417233019379.png)



**tb_userè¡¨ï¼Œæ‰§è¡Œå‰åçš„==å…ƒæ•°æ®é”çš„ä¿¡æ¯==**

![image-20250417232312551](./Mysql-Learning-Local.assets/image-20250417232312551.png)





### ï¼ˆ4ï¼‰ğŸŒŸ ==æ„å‘é”==

#### â‘ ä»‹ç»

ä¸ºäº†**é¿å…DMLåœ¨æ‰§è¡Œæ—¶**ï¼Œ**åŠ çš„è¡Œé”ä¸è¡¨é”çš„å†²çª**ï¼Œåœ¨InnoDBä¸­å¼•å…¥äº†æ„å‘é”ï¼Œ**ä½¿å¾—è¡¨é”ä¸ç”¨æ£€æŸ¥æ¯è¡Œæ•°æ®æ˜¯å¦åŠ é”**ï¼Œ**ä½¿ç”¨æ„å‘é”æ¥å‡å°‘è¡¨é”çš„æ£€æŸ¥**ã€‚

##### 1ï¼‰==æ²¡æœ‰æ„å‘é”==æ—¶

å‡å¦‚æ²¡æœ‰æ„å‘é”ï¼Œå®¢æˆ·ç«¯ä¸€å¯¹è¡¨åŠ äº†è¡Œé”åï¼Œå®¢æˆ·ç«¯äºŒå¦‚ä½•ç»™è¡¨åŠ è¡¨é”å‘¢ï¼Œæ¥é€šè¿‡ç¤ºæ„å›¾ç®€å•åˆ†æä¸€ä¸‹ï¼š

é¦–å…ˆå®¢æˆ·ç«¯ä¸€ï¼Œå¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼Œç„¶åæ‰§è¡ŒDMLæ“ä½œï¼Œåœ¨**æ‰§è¡ŒDMLè¯­å¥**æ—¶ï¼Œ**ä¼š==å¯¹æ¶‰åŠåˆ°çš„è¡ŒåŠ è¡Œé”==**ã€‚

![image-20250417233416617](./Mysql-Learning-Local.assets/image-20250417233416617.png)

å½“å®¢æˆ·ç«¯äºŒï¼Œ**æƒ³å¯¹è¿™å¼ è¡¨åŠ è¡¨é”æ—¶**ï¼Œ**ä¼šæ£€æŸ¥å½“å‰è¡¨æ˜¯å¦æœ‰å¯¹åº”çš„è¡Œé”**ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™æ·»åŠ è¡¨é”ï¼Œ**æ­¤æ—¶å°±ä¼šä»ç¬¬ä¸€è¡Œæ•°æ®ï¼Œæ£€æŸ¥åˆ°æœ€åä¸€è¡Œæ•°æ®ï¼Œ==æ•ˆç‡è¾ƒä½==**ã€‚

![image-20250417233511896](./Mysql-Learning-Local.assets/image-20250417233511896.png)



##### 2ï¼‰æœ‰äº†æ„å‘é”==ä¹‹å==

å®¢æˆ·ç«¯ä¸€ï¼Œåœ¨æ‰§è¡ŒDMLæ“ä½œæ—¶ï¼Œä¼šå¯¹æ¶‰åŠçš„è¡Œ**åŠ è¡Œé”**ï¼ŒåŒæ—¶ä¹Ÿä¼š==**å¯¹è¯¥è¡¨åŠ ä¸Šæ„å‘é”**==ã€‚

![image-20250417233534456](./Mysql-Learning-Local.assets/image-20250417233534456.png)

è€Œå…¶ä»–å®¢æˆ·ç«¯ï¼Œåœ¨å¯¹è¿™å¼ è¡¨åŠ è¡¨é”çš„æ—¶å€™ï¼Œä¼šæ ¹æ®è¯¥è¡¨ä¸Š**æ‰€åŠ çš„æ„å‘é”æ¥åˆ¤å®šæ˜¯å¦å¯ä»¥æˆåŠŸåŠ è¡¨é”**ï¼Œ(==åˆ¤æ–­å½“å‰æ‰€åŠ çš„æ„å‘é”å’Œå°†è¦æ·»åŠ çš„è¡¨é”æ˜¯å¦æ˜¯å…¼å®¹çš„==)ï¼Œè€Œä¸ç”¨é€è¡Œåˆ¤æ–­è¡Œé”æƒ…å†µäº†ã€‚



![image-20250417233620257](./Mysql-Learning-Local.assets/image-20250417233620257.png)



#### â‘¡==åˆ†ç±»==

![image-20250417234341556](./Mysql-Learning-Local.assets/image-20250417234341556.png)

- **æ„å‘å…±äº«é”(IS)**: ç”±è¯­å¥select ... **lock in share mode**æ·»åŠ  ã€‚ ==ä¸ è¡¨é”å…±äº«é”(read)å…¼å®¹ï¼Œä¸è¡¨é”æ’ä»–é”(write)äº’æ–¥==ã€‚
- **æ„å‘æ’ä»–é”(IX)**: ç”±insertã€updateã€deleteã€**==select...for update==**æ·»åŠ  ã€‚==ä¸è¡¨é”å…±äº«é”(read)åŠæ’ä»–é”(write)**éƒ½äº’æ–¥**==ï¼Œ**æ„å‘é”ä¹‹é—´ä¸ä¼šäº’æ–¥**ã€‚



> **ä¸€æ—¦äº‹åŠ¡æäº¤äº†ï¼Œæ„å‘å…±äº«é”ã€æ„å‘æ’ä»–é”ï¼Œéƒ½==ä¼šè‡ªåŠ¨é‡Šæ”¾==**ã€‚



å¯ä»¥é€šä»¥ä¸‹SQLï¼Œ**==æŸ¥çœ‹æ„å‘é”åŠè¡Œé”çš„åŠ é”==æƒ…å†µ**ï¼š

```sql
select object_schema,object_name,index_name,lock_type,lock_mode,lock_data from
performance_schema.data_locks;
```



#### â‘¢ğŸŒŸæ¼”ç¤º

**A. ==æ„å‘å…±äº«é”ä¸è¡¨è¯»é”æ˜¯å…¼å®¹çš„==**

**å®¢æˆ·ç«¯ä¸€ï¼š**

```sql
begin;

select * from tb_user where id = 1 lock in share mode;
-- lock in share mode è¡¨ç¤º ä¼šç»™è¿™ä¸€è¡Œæ·»åŠ  å…±äº«è¡Œé”
-- åŒæ—¶ï¼Œä¼šç»™è¯¥scoreè¡¨æ·»åŠ  æ„å‘å…±äº«é”

commit;
```

 **å®¢æˆ·ç«¯äºŒï¼š**

```sql
begin;

-- æ·»åŠ è¡¨é”å…±äº«é”read æˆ– è¡¨é”æ’ä»–é”write
	lock tables tb_user read; -- è¡¨é”å…±äº«é”read
	
-- é‡Šæ”¾é”
unlock tables;
	
	lock tables tb_user write; -- è¡¨é”æ’ä»–é”write
	
commit;
```



![image-20250418000100020](./Mysql-Learning-Local.assets/image-20250418000100020.png)



![image-20250417235756276](./Mysql-Learning-Local.assets/image-20250417235756276.png)

![image-20250417235932044](./Mysql-Learning-Local.assets/image-20250417235932044.png)

![image-20250418000329865](./Mysql-Learning-Local.assets/image-20250418000329865.png)

![image-20250417235543361](./Mysql-Learning-Local.assets/image-20250417235543361.png)



**B. æ„å‘æ’ä»–é”ä¸è¡¨è¯»é”ã€å†™é”==éƒ½æ˜¯äº’æ–¥çš„==**

**å®¢æˆ·ç«¯ä¸€ï¼š**

```sql
begin;

	update tb_user set name = 'å°å°é¹' where id = 1;
	
commit;
```

 **å®¢æˆ·ç«¯äºŒï¼š**

```sql
begin;

-- æ·»åŠ è¡¨é”å…±äº«é”read æˆ– è¡¨é”æ’ä»–é”write
	lock tables tb_user read; -- è¡¨é”å…±äº«é”read
	
-- é‡Šæ”¾é”
unlock tables;
	
	lock tables tb_user write; -- è¡¨é”æ’ä»–é”write
	
commit;
```

![image-20250418001028722](./Mysql-Learning-Local.assets/image-20250418001028722.png)

![image-20250418001322623](./Mysql-Learning-Local.assets/image-20250418001322623.png)

![image-20250418001412780](./Mysql-Learning-Local.assets/image-20250418001412780.png)



## 5.4 ğŸŒŸ è¡Œçº§é”

### ï¼ˆ1ï¼‰ğŸŒŸ ä»‹ç»

è¡Œçº§é”ï¼Œæ¯æ¬¡æ“ä½œ**é”ä½å¯¹åº”çš„è¡Œæ•°æ®**ã€‚**é”å®šç²’åº¦æœ€å°**ï¼Œå‘ç”Ÿé”å†²çªçš„æ¦‚ç‡æœ€ä½ï¼Œå¹¶å‘åº¦æœ€é«˜ã€‚åº”ç”¨åœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­ã€‚

InnoDBçš„**æ•°æ®æ˜¯åŸºäºç´¢å¼•ï¼ˆèšé›†ç´¢å¼•å’ŒäºŒçº§ç´¢å¼•ï¼‰ç»„ç»‡çš„**ï¼Œè¡Œé”æ˜¯**==é€šè¿‡å¯¹ç´¢å¼•ä¸Šçš„ç´¢å¼•é¡¹åŠ é”æ¥å®ç°çš„ï¼Œè€Œä¸æ˜¯å¯¹è®°å½•åŠ çš„é”==**ã€‚å¯¹äºè¡Œçº§é”ï¼Œä¸»è¦åˆ†ä¸ºä»¥ä¸‹ä¸‰ç±»ï¼š

- **è¡Œé”ï¼ˆRecord Lockï¼‰**ï¼š**é”å®šå•ä¸ªè¡Œè®°å½•çš„é”**ï¼Œé˜²æ­¢å…¶ä»–äº‹åŠ¡å¯¹æ­¤è¡Œè¿›è¡Œ**updateå’Œdelete**ã€‚åœ¨**RCï¼ˆread commit è¯»å·²æäº¤ï¼‰ã€RRï¼ˆrepeat read å¯é‡å¤è¯»ï¼‰éš”ç¦»çº§**åˆ«ä¸‹éƒ½æ”¯æŒã€‚

![image-20250418153238344](./Mysql-Learning-Local.assets/image-20250418153238344.png)

- **é—´éš™é”ï¼ˆGap Lockï¼‰**ï¼šé”å®š**ç´¢å¼•è®°å½•é—´éš™ï¼ˆä¸å«è¯¥è®°å½•ï¼‰**ï¼Œ**==ç¡®ä¿ç´¢å¼•è®°å½•é—´éš™ä¸å˜==ï¼Œé˜²æ­¢å…¶ä»–äº‹åŠ¡åœ¨è¿™ä¸ªé—´éš™è¿›è¡Œinsert**ï¼Œ==äº§ç”Ÿå¹»è¯»==ã€‚åœ¨**RRéš”ç¦»çº§åˆ«ä¸‹éƒ½æ”¯æŒ**ã€‚

![image-20250418153243896](./Mysql-Learning-Local.assets/image-20250418153243896.png)

- **ä¸´é”®é”ï¼ˆNext-Key Lockï¼‰**ï¼š**è¡Œé”å’Œé—´éš™é”ç»„åˆ**ï¼ŒåŒæ—¶é”ä½æ•°æ®ï¼Œå¹¶**é”ä½==æ•°æ®å‰é¢çš„é—´éš™Gap==**ã€‚åœ¨RRéš”ç¦»çº§åˆ«ä¸‹æ”¯æŒã€‚

![image-20250418153249001](./Mysql-Learning-Local.assets/image-20250418153249001.png)





> ##### **ğŸŒŸ==é—´éš™é”å’Œä¸´é”®é”çš„åŸºæœ¬æ¦‚å¿µï¼ˆé‡ç‚¹ï¼‰==**
>
> - é—´éš™é”ï¼šé”å®šç´¢å¼•è®°å½•é—´éš™ï¼ˆ**ä¸åŒ…å«è¯¥è®°å½•**ï¼‰ï¼Œ
>   - æ¯”å¦‚æ­¤æ—¶çš„ç´¢å¼•æ˜¯idæ—¶ï¼Œå¹¶ä¸”lock_data æ˜¾ç¤ºçš„æ˜¯8ï¼Œè¡¨ç¤ºçš„æ˜¯**==é”å®š8å‰é¢ä¸€ä¸ªçš„ä¸€ä¸ªé—´éš™==**ï¼Œå‡è®¾ç°åœ¨8å‰é¢ä¸€ä½çš„idä¸º3ï¼Œé‚£ä¹ˆæ­¤æ—¶è¯¥é—´éš™é”ï¼Œé”å®šçš„å°±æ˜¯3-8ä¹‹é—´çš„é—´éš™ï¼Œä¹Ÿå°±æ˜¯(3,8);
> - ä¸´é”®é”ï¼šè¡Œé”å’Œé—´éš™é”çš„ç»„åˆï¼Œä¼š**é”ä½æ•°æ®**ï¼ŒåŒæ—¶**é”ä½==æ•°æ®å‰é¢çš„ä¸€ä¸ªé—´éš™Gap==**
>   - å¦‚æœæœ‰è®°å½•8,9,10,20,30
>   - å¯¹20åŠ ä¸´é”®é”ï¼Œä¼š**é”å®š(10,20]è¿™ä¸ªåŒºé—´**
>   - ä¸ä¼šé”å®š(8,20]è¿™ä¸ªåŒºé—´





### ï¼ˆ2ï¼‰ğŸŒŸ è¡Œé”

#### â‘ ğŸŒŸ ä»‹ç»

InnoDBå®ç°äº†ä»¥ä¸‹ä¸¤ç§ç±»å‹çš„è¡Œé”ï¼š

**å…±äº«é”ï¼ˆSï¼‰**ï¼šå…è®¸ä¸€ä¸ªäº‹åŠ¡å»è¯»ä¸€è¡Œï¼Œ**==é˜»æ­¢å…¶ä»–äº‹åŠ¡è·å¾—ç›¸åŒæ•°æ®é›†çš„æ’å®ƒé”==**ã€‚

**æ’ä»–é”ï¼ˆXï¼‰**ï¼šå…è®¸**è·å–æ’ä»–é”çš„äº‹åŠ¡æ›´æ–°æ•°æ®**ï¼Œ**è·å–æ’å®ƒé”å**ï¼Œä¼š**é˜»æ­¢**å…¶ä»–äº‹åŠ¡**==è·å¾—ç›¸åŒæ•°æ®é›†çš„å…±äº«é”å’Œæ’ä»–é”ã€‚==**

> **==æ³¨æ„==ï¼š**
>
> â€‹	è¿™é‡Œçš„å…¼å®¹å’Œå†²çªåˆ¤æ–­çš„å‰æï¼Œæ˜¯åœ¨**å¯¹åŒä¸€ä¸ªæ•°æ®é›†è€Œè¨€çš„**ï¼Œæ¯”å¦‚æ“ä½œçš„éƒ½æ˜¯idä¸º1çš„æ•°æ®è¡Œ

![image-20250418153804951](./Mysql-Learning-Local.assets/image-20250418153804951.png)



ä¸¤ç§**è¡Œé”çš„å…¼å®¹æƒ…å†µ**å¦‚ä¸‹:

![image-20250418153837860](./Mysql-Learning-Local.assets/image-20250418153837860.png)



å¸¸è§çš„SQLè¯­å¥ï¼Œåœ¨æ‰§è¡Œæ—¶ï¼Œæ‰€åŠ çš„è¡Œé”å¦‚ä¸‹ï¼š

![image-20250418154130041](./Mysql-Learning-Local.assets/image-20250418154130041.png)



#### â‘¡ğŸŒŸ æ¼”ç¤º

é»˜è®¤æƒ…å†µä¸‹ï¼ŒInnoDBåœ¨**RR-å¯é‡å¤è¯»**=ã€‹- **REPEATABLE READäº‹åŠ¡éš”ç¦»çº§åˆ«**è¿è¡Œï¼ŒInnoDB**ä½¿ç”¨ next-key é”è¿›è¡Œæœç´¢å’Œç´¢å¼•æ‰«æï¼Œ==ä»¥é˜²æ­¢å¹»è¯»==ã€‚**

- é’ˆå¯¹**å”¯ä¸€ç´¢å¼•è¿›è¡Œæ£€ç´¢**æ—¶ï¼Œ**==å¯¹å·²å­˜åœ¨çš„è®°å½•è¿›è¡Œç­‰å€¼åŒ¹é…==æ—¶**ï¼Œå°†**ä¼š==è‡ªåŠ¨ä¼˜åŒ–ä¸ºè¡Œé”==**ã€‚
- InnoDBçš„**è¡Œé”æ˜¯é’ˆå¯¹äº==ç´¢å¼•åŠ çš„é”==**ï¼Œå¦‚æœ**==ä¸é€šè¿‡ç´¢å¼•æ¡ä»¶æ£€ç´¢æ•°æ®==**ï¼Œé‚£ä¹ˆInnoDB**å°†å¯¹è¡¨ä¸­çš„æ‰€æœ‰è®°å½•åŠ é”**ï¼Œæ­¤æ—¶ å°±ä¼š**å‡çº§ä¸º==è¡¨é”==**ã€‚



å¯ä»¥é€šè¿‡ä»¥ä¸‹SQLï¼ŒæŸ¥çœ‹**æ„å‘é”åŠè¡Œé”çš„åŠ é”æƒ…å†µ**ï¼š

```sql
select object_schema,object_name,index_name,lock_type,lock_mode,lock_data from performance_schema.data_locks;
```



#### â‘¢ç¤ºä¾‹æ¼”ç¤º-è¡Œé”

**æ•°æ®å‡†å¤‡:**

```sql
CREATE TABLE `stu` (
    `id` int NOT NULL PRIMARY KEY AUTO_INCREMENT,
    `name` varchar(255) DEFAULT NULL,
    `age` int NOT NULL
) ENGINE = InnoDB CHARACTER SET = utf8mb4;

INSERT INTO `stu` VALUES (1, 'tom', 1);
INSERT INTO `stu` VALUES (3, 'cat', 3);
INSERT INTO `stu` VALUES (8, 'rose', 8);
INSERT INTO `stu` VALUES (11, 'jetty', 11);
INSERT INTO `stu` VALUES (19, 'lily', 19);
INSERT INTO `stu` VALUES (25, 'luci', 25);

select * from stu;
```

æ¼”ç¤ºè¡Œé”çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±é€šè¿‡ä¸Šé¢è¿™å¼ è¡¨æ¥æ¼”ç¤ºä¸€ä¸‹ã€‚

<img src="./Mysql-Learning-Local.assets/image-20250418160020435.png" alt="image-20250418160020435" style="zoom: 80%;" />



##### 1ï¼‰æ™®é€šçš„selectè¯­å¥-ä¸åŠ é”

**A. æ™®é€šçš„selectè¯­å¥ï¼Œæ‰§è¡Œæ—¶ï¼Œä¸ä¼šåŠ é”ã€‚**

**å¯¹äºå®¢æˆ·ç«¯ä¸€ï¼Œæ‰§è¡Œæ™®é€šçš„selectè¯­å¥**

```sql
begin;

	select * from stu where id = 1;
	
commit;

-- æ„å‘é”åŠè¡Œé”çš„åŠ é”æƒ…å†µ
select object_schema,object_name,index_name,lock_type,lock_mode,lock_data from performance_schema.data_locks;
```

<img src="./Mysql-Learning-Local.assets/image-20250418160956572.png" alt="image-20250418160956572" style="zoom:80%;" />

![image-20250418160923222](./Mysql-Learning-Local.assets/image-20250418160923222.png)



##### 2ï¼‰å…±äº«é”å’Œå…±äº«é”ä¹‹é—´==å…¼å®¹==

**B. select...lock in share modeï¼ŒåŠ å…±äº«é”ï¼Œå…±äº«é”ä¸å…±äº«é”ä¹‹é—´å…¼å®¹ã€‚**

**å¯¹äºå®¢æˆ·ç«¯ä¸€å’ŒäºŒï¼Œ==éƒ½å°è¯•ç»™æ•°æ®è¡Œæ·»åŠ å…±äº«é”==**

```sql
begin;

	select * from stu where id = 1 lock in share mode; -- ç»™stuè¡¨ä¸­idä¸º1çš„æ•°æ®è¡Œæ·»åŠ å…±äº«é”
	
commit;
```

<img src="./Mysql-Learning-Local.assets/image-20250418161446922.png" alt="image-20250418161446922" style="zoom:80%;" />



![image-20250418161327214](./Mysql-Learning-Local.assets/image-20250418161327214.png)

<img src="./Mysql-Learning-Local.assets/image-20250418161720723.png" alt="image-20250418161720723" style="zoom:80%;" />



![image-20250418161837288](./Mysql-Learning-Local.assets/image-20250418161837288.png)



> **==æ³¨æ„==ï¼š**   åŒæ ·çš„**å½“äº‹åŠ¡commitæäº¤å**ï¼Œ**åœ¨äº‹åŠ¡ä¸­æ·»åŠ çš„è¡Œé”ç­‰å…¶ä»–é”éƒ½ä¼šè‡ªåŠ¨é‡Šæ”¾**



##### 3ï¼‰å…±äº«é”ä¸æ’ä»–é”ä¹‹é—´==äº’æ–¥==

**å¯¹äºå®¢æˆ·ç«¯ä¸€ï¼Œæ‰§è¡Œçš„è¿˜æ˜¯æ·»åŠ å…±äº«è¡Œé”æ“ä½œ**

```sql
begin;
	select * from stu where id = 1 lock in share mode; -- ç»™stuè¡¨ä¸­idä¸º1çš„æ•°æ®è¡Œæ·»åŠ å…±äº«é”
commit;
```

**å¯¹äºå®¢æˆ·ç«¯äºŒï¼Œå°è¯•ç»™æ•°æ®è¡Œæ·»åŠ æ’ä»–é”ï¼Œæ¯”å¦‚updateæ“ä½œ...**

```sql
begin;

	update stu set name = 'Java-3' where id = 3; -- ç»™stuè¡¨ä¸­idä¸º3çš„æ•°æ®è¡Œæ·»åŠ æ’ä»–é”
	
	update stu set name = 'Java-1' where id = 1; -- ç»™stuè¡¨ä¸­idä¸º1çš„æ•°æ®è¡Œæ·»åŠ æ’ä»–é”
	
commit;
```



å®¢æˆ·ç«¯ä¸€**è·å–çš„æ˜¯idä¸º1è¿™è¡Œçš„å…±äº«é”**

<img src="./Mysql-Learning-Local.assets/image-20250418162624538.png" alt="image-20250418162624538" style="zoom:67%;" />



å®¢æˆ·ç«¯äºŒæ˜¯å¯ä»¥è·å–idä¸º3è¿™è¡Œçš„æ’å®ƒé”çš„ï¼Œ**å› ä¸ºä¸æ˜¯åŒä¸€è¡Œæ•°æ®**ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯äºŒæ‰§è¡Œid=3çš„è¯­å¥æ—¶ï¼Œä¸ä¼šè¢«é˜»å¡ã€‚

![image-20250418162747031](./Mysql-Learning-Local.assets/image-20250418162747031.png)

![image-20250418162925566](./Mysql-Learning-Local.assets/image-20250418162925566.png)



 è€Œå¦‚æœå®¢æˆ·ç«¯äºŒæƒ³è·å–idä¸º1è¿™è¡Œçš„æ’ä»–é”ï¼Œä¼šå¤„äºé˜»å¡çŠ¶æ€ï¼Œå› ä¸º**å…±äº«é”ä¸æ’ä»–é”ä¹‹é—´äº’æ–¥**ã€‚

![image-20250418163012704](./Mysql-Learning-Local.assets/image-20250418163012704.png)



![image-20250418163155784](./Mysql-Learning-Local.assets/image-20250418163155784.png)



##### 3ï¼‰ æ’ä»–é”ä¸æ’ä»–é”ä¹‹é—´==äº’æ–¥==

**C. æ’ä»–é”ä¸æ’ä»–é”ä¹‹é—´äº’æ–¥**

å½“å®¢æˆ·ç«¯ä¸€ï¼Œæ‰§è¡Œupdateè¯­å¥ï¼Œä¼šä¸ºidä¸º1çš„è®°å½•åŠ æ’ä»–é”ï¼› å®¢æˆ·ç«¯äºŒï¼Œå¦‚æœä¹Ÿæ‰§è¡Œupdateè¯­å¥æ›´æ–°idä¸º1çš„æ•°æ®ï¼Œä¹Ÿè¦ä¸ºidä¸º1çš„æ•°æ®åŠ æ’ä»–é”ï¼Œä½†æ˜¯**å®¢æˆ·ç«¯äºŒä¼šå¤„äºé˜»å¡çŠ¶æ€ï¼Œå› ä¸ºæ’ä»–é”ä¹‹é—´æ˜¯äº’æ–¥çš„**ã€‚ **ç›´åˆ°å®¢æˆ·ç«¯ä¸€ï¼ŒæŠŠäº‹åŠ¡æäº¤äº†ï¼Œæ‰ä¼šæŠŠè¿™ä¸€è¡Œçš„è¡Œé”é‡Šæ”¾ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯äºŒæ‰èƒ½è·å–åˆ°è¿™ä¸€è¡Œçš„æ’ä»–é”ï¼Œè§£é™¤é˜»å¡ã€‚**

**å¯¹äºå®¢æˆ·ç«¯ä¸€ï¼Œæ‰§è¡Œupdateè¯­å¥ï¼ŒåŠ æ’å®ƒé”**

```sql
begin;
	update stu set name = 'Java-10' where id = 1; -- ç»™stuè¡¨ä¸­idä¸º1çš„æ•°æ®è¡Œæ·»åŠ æ’ä»–é”
end;
```

<img src="./Mysql-Learning-Local.assets/image-20250418163528115.png" alt="image-20250418163528115" style="zoom:80%;" />

**å¯¹äºå®¢æˆ·ç«¯äºŒï¼Œ**å¦‚æœä¹Ÿæ‰§è¡Œupdateè¯­å¥æ›´æ–°idä¸º1çš„æ•°æ®ï¼Œä¹Ÿè¦ä¸ºidä¸º1çš„æ•°æ®åŠ æ’ä»–é”

```sql
begin;
	update stu set name = 'Java-20' where id = 1; -- ç»™stuè¡¨ä¸­idä¸º1çš„æ•°æ®è¡Œæ·»åŠ æ’ä»–é” 
end;
```

![image-20250418163634638](./Mysql-Learning-Local.assets/image-20250418163634638.png)

![image-20250418163750481](./Mysql-Learning-Local.assets/image-20250418163750481.png)





##### 4ï¼‰ ==æ— ç´¢å¼•è¡Œé”å‡çº§ä¸ºè¡¨é”==

**D. æ— ç´¢å¼•è¡Œé”å‡çº§ä¸ºè¡¨é”**

**stuè¡¨ä¸­æ•°æ®å¦‚ä¸‹:**

```sql
select * from stu;
```

<img src="./Mysql-Learning-Local.assets/image-20250418165017445.png" alt="image-20250418165017445" style="zoom:80%;" />

**æˆ‘ä»¬åœ¨ä¸¤ä¸ªå®¢æˆ·ç«¯ä¸­æ‰§è¡Œå¦‚ä¸‹æ“ä½œ:**

åœ¨å®¢æˆ·ç«¯ä¸€ä¸­ï¼Œå¼€å¯äº‹åŠ¡ï¼Œå¹¶æ‰§è¡Œupdateè¯­å¥ï¼Œ**æ›´æ–°nameä¸ºLilyçš„æ•°æ®**ï¼Œä¹Ÿå°±æ˜¯idä¸º19çš„è®°å½• ã€‚ç„¶ååœ¨å®¢æˆ·ç«¯äºŒä¸­æ›´æ–°idä¸º3çš„è®°å½•ï¼Œå´ä¸èƒ½ç›´æ¥æ‰§è¡Œï¼Œä¼šå¤„äºé˜»å¡çŠ¶æ€ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ= ã€‹**æ·»åŠ äº†è¡¨é”**

åŸå› å°±æ˜¯å› ä¸ºæ­¤æ—¶ï¼Œå®¢æˆ·ç«¯ä¸€ï¼Œ**æ ¹æ®nameå­—æ®µè¿›è¡Œæ›´æ–°æ—¶ï¼Œnameå­—æ®µæ˜¯æ²¡æœ‰ç´¢å¼•çš„**ï¼Œ**å¦‚æœæ²¡æœ‰ç´¢å¼•ï¼Œæ­¤æ—¶è¡Œé”ä¼šå‡çº§ä¸ºè¡¨é”**(==å› ä¸ºè¡Œé”æ˜¯å¯¹ç´¢å¼•é¡¹åŠ çš„é”ï¼Œè€Œnameæ²¡æœ‰ç´¢å¼•==)ã€‚



**å¯¹äºå®¢æˆ·ç«¯1ï¼Œæ ¹æ®name(éç´¢å¼•å­—æ®µ)è¿›è¡Œæ¡ä»¶æŸ¥è¯¢ï¼Œä¼šè®©==è¡Œé”å‡çº§ä¸ºè¡¨é”==**

```sql
begin;
	update stu set name = 'Spring-1' where name = 'lily';
end;
```

<img src="./Mysql-Learning-Local.assets/image-20250418165503408.png" alt="image-20250418165503408" style="zoom:80%;" />

![image-20250418165627547](./Mysql-Learning-Local.assets/image-20250418165627547.png)



**æ­¤æ—¶åœ¨å®¢æˆ·ç«¯2ä¸­ï¼Œæ›´æ–°id=3çš„æ•°æ®æ—¶ï¼Œä¼šè¢«é˜»å¡**

```sql
begin;
	update stu set name = 'Spring-2' where id = 3;
end;
```

<img src="./Mysql-Learning-Local.assets/image-20250418165816618.png" alt="image-20250418165816618" style="zoom:80%;" />



æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†**é’ˆå¯¹nameå­—æ®µå»ºç«‹ç´¢å¼•**ï¼Œç´¢å¼•å»ºç«‹ä¹‹åï¼Œå†æ¬¡åšä¸€ä¸ªæµ‹è¯•ï¼š

```sql
create index idx_stu_name on stu(name);
```

<img src="./Mysql-Learning-Local.assets/image-20250418165916823.png" alt="image-20250418165916823" style="zoom:67%;" />



æ­¤æ—¶æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå®¢æˆ·ç«¯ä¸€ï¼Œå¼€å¯äº‹åŠ¡ï¼Œç„¶åä¾ç„¶æ˜¯æ ¹æ®nameè¿›è¡Œæ›´æ–°ã€‚è€Œå®¢æˆ·ç«¯äºŒï¼Œåœ¨æ›´æ–°idä¸º3çš„æ•°æ®æ—¶ï¼Œ**==æ›´æ–°æˆåŠŸï¼Œå¹¶æœªè¿›å…¥é˜»å¡çŠ¶æ€==ã€‚** è¿™æ ·å°±è¯´æ˜ï¼Œæˆ‘ä»¬**==æ ¹æ®ç´¢å¼•å­—æ®µè¿›è¡Œæ›´æ–°æ“ä½œ==ï¼Œå°±å¯ä»¥é¿å…è¡Œé”å‡çº§ä¸ºè¡¨é”çš„æƒ…å†µã€‚**

<img src="./Mysql-Learning-Local.assets/image-20250418170418914.png" alt="image-20250418170418914" style="zoom:67%;" />

![image-20250418170355080](./Mysql-Learning-Local.assets/image-20250418170355080.png)

<img src="./Mysql-Learning-Local.assets/image-20250418170522111.png" alt="image-20250418170522111" style="zoom:80%;" />



![image-20250418170743076](./Mysql-Learning-Local.assets/image-20250418170743076.png)





### ï¼ˆ3ï¼‰==é—´éš™é”&ä¸´é”®é”==

**é»˜è®¤æƒ…å†µ**ä¸‹ï¼ŒInnoDBåœ¨ REPEATABLE READäº‹åŠ¡éš”ç¦»çº§åˆ«è¿è¡Œï¼ŒInnoDB**ä½¿ç”¨ next-key é”è¿›è¡Œæœç´¢å’Œç´¢å¼•æ‰«æï¼Œ==ä»¥é˜²æ­¢å¹»è¯»==ã€‚**

- ç´¢å¼•ä¸Šçš„**ç­‰å€¼æŸ¥è¯¢(å”¯ä¸€ç´¢å¼•)**ï¼Œ**ç»™ä¸å­˜åœ¨çš„è®°å½•åŠ é”æ—¶, ==ä¼˜åŒ–ä¸ºé—´éš™é”==** ã€‚
- ç´¢å¼•ä¸Šçš„**ç­‰å€¼æŸ¥è¯¢(éå”¯ä¸€æ™®é€šç´¢å¼•)**ï¼Œ**==å‘å³éå†æ—¶==æœ€åä¸€ä¸ªå€¼ä¸æ»¡è¶³æŸ¥è¯¢éœ€æ±‚æ—¶ï¼Œ==next-keylock é€€åŒ–ä¸ºé—´éš™é”ã€‚==**
- ç´¢å¼•ä¸Šçš„**èŒƒå›´æŸ¥è¯¢(å”¯ä¸€ç´¢å¼•)**--**ä¼šè®¿é—®åˆ°ä¸æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€ä¸ªå€¼ä¸ºæ­¢**ã€‚



> **æ³¨æ„ï¼š**
>
> é—´éš™é”å”¯ä¸€ç›®çš„æ˜¯**==é˜²æ­¢å…¶ä»–äº‹åŠ¡æ’å…¥é—´éš™==ã€‚é—´éš™é”å¯ä»¥å…±å­˜ï¼Œ==ä¸€ä¸ªäº‹åŠ¡é‡‡ç”¨çš„é—´éš™é”ä¸ä¼šé˜»æ­¢å¦ä¸€ä¸ªäº‹åŠ¡åœ¨åŒä¸€é—´éš™ä¸Šé‡‡ç”¨é—´éš™é”==ã€‚**



**ğŸŒŸ==é—´éš™é”å’Œä¸´é”®é”çš„åŸºæœ¬æ¦‚å¿µï¼ˆé‡ç‚¹ï¼‰==**

- é—´éš™é”ï¼šé”å®šç´¢å¼•è®°å½•é—´éš™ï¼ˆ**ä¸åŒ…å«è¯¥è®°å½•**ï¼‰ï¼Œ
  - æ¯”å¦‚æ­¤æ—¶çš„ç´¢å¼•æ˜¯idæ—¶ï¼Œå¹¶ä¸”lock_data æ˜¾ç¤ºçš„æ˜¯8ï¼Œè¡¨ç¤ºçš„æ˜¯**==é”å®š8å‰é¢ä¸€ä¸ªçš„ä¸€ä¸ªé—´éš™==**ï¼Œå‡è®¾ç°åœ¨8å‰é¢ä¸€ä½çš„idä¸º3ï¼Œé‚£ä¹ˆæ­¤æ—¶è¯¥é—´éš™é”ï¼Œé”å®šçš„å°±æ˜¯3-8ä¹‹é—´çš„é—´éš™ï¼Œä¹Ÿå°±æ˜¯(3,8);
- ä¸´é”®é”ï¼šè¡Œé”å’Œé—´éš™é”çš„ç»„åˆï¼Œä¼š**é”ä½æ•°æ®**ï¼ŒåŒæ—¶**é”ä½==æ•°æ®å‰é¢çš„ä¸€ä¸ªé—´éš™Gap==**
  - å¦‚æœæœ‰è®°å½•8,9,10,20,30
  - å¯¹20åŠ ä¸´é”®é”ï¼Œä¼š**é”å®š(10,20]è¿™ä¸ªåŒºé—´**
  - ä¸ä¼šé”å®š(8,20]è¿™ä¸ªåŒºé—´





### ï¼ˆ4ï¼‰ğŸš€é—´éš™é”/ä¸´é”®é”-æ¼”ç¤º

![image-20250418172507512](./Mysql-Learning-Local.assets/image-20250418172507512.png)

![image-20250418173909355](./Mysql-Learning-Local.assets/image-20250418173909355.png)

#### â‘ ç­‰å€¼æŸ¥è¯¢-==å”¯ä¸€ç´¢å¼•==

**A. ç´¢å¼•ä¸Šçš„ç­‰å€¼æŸ¥è¯¢(å”¯ä¸€ç´¢å¼•)ï¼Œç»™==ä¸å­˜åœ¨çš„è®°å½•åŠ é”==æ—¶, ä¼˜åŒ–ä¸º==é—´éš™é”-GAP== ã€‚**

- ä»æœ€åè¡¨stuçš„é—´éš™é”çš„å…·ä½“ä¿¡æ¯å¯ä»¥çœ‹å‡ºï¼Œå¦‚æœä¸å­˜åœ¨çš„è®°å½•æ˜¯id = 5 çš„è®°å½•è¡Œï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™ä¼šçœ‹id = 5ç†è®ºä¸Šè¦åœ¨çš„ä½ç½®ï¼ˆ**ç´¢å¼•ç»“æ„æœ€åä¿å­˜çš„æ•°æ®æ˜¯æœ‰åºçš„**ï¼‰ï¼Œä¹Ÿå°±æ˜¯id = 3å’Œ8ä¹‹é—´ã€‚

  ä¹Ÿå°±æ˜¯ç»™è¿™é‡Œid = 8çš„ä½ç½®**æ·»åŠ é—´éš™é”Gap**ã€‚

**å®¢æˆ·ç«¯ä¸€**

```sql
begin;
	update stu set age = 10 where id = 5; -- stuè¡¨ä¸­ä¸å­˜åœ¨id = 5 çš„è®°å½•
end;
```

<img src="./Mysql-Learning-Local.assets/image-20250418173528961.png" alt="image-20250418173528961" style="zoom:80%;" />

**å®¢æˆ·ç«¯äºŒ**

```sql
begin;
	insert into stu values(7,'Ruby',7);
end;
```

<img src="./Mysql-Learning-Local.assets/image-20250418173742984.png" alt="image-20250418173742984" style="zoom:80%;" />





![image-20250418174707053](./Mysql-Learning-Local.assets/image-20250418174707053.png)



> ==**æ³¨æ„ï¼š**==
>
> è¿™é‡Œçš„GAPï¼Œæ„æ€æ˜¯é—´éš™é”Gap Lockçš„æ„æ€ï¼›é”å®šå½“å‰ç´¢å¼•ä¸ºidçš„è®°å½•é—´éš™(ä¸å«è¯¥è®°å½•)ï¼Œç¡®ä¿ç´¢å¼•è®°å½•é—´éš™ä¸å˜ã€‚**é˜²æ­¢å…¶ä»–äº‹åŠ¡åœ¨è¿™ä¸ªé—´éš™ä¸­è¿›è¡Œinsertï¼Œè¿›è€Œé˜²æ­¢å¹»è¯»**ã€‚
>
> è¿™é‡Œ**lock_dataæ˜¾ç¤ºçš„æ•°æ®ä¸º8**ï¼Œè¡¨ç¤ºçš„æ˜¯è¯¥é—´éš™é”çš„ä½ç½®ï¼›
>
> **å…·ä½“å«ä¹‰ä¸ºé”ä½ç´¢å¼•id = 8 å’Œ å‰ä¸€ä¸ªç´¢å¼•idä¹‹é—´çš„é—´éš™ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªçš„==3å’Œ8ä¹‹é—´==**
>
> - ï¼ˆ3,8ï¼‰





#### â‘¡ç­‰å€¼æŸ¥è¯¢-==éå”¯ä¸€æ™®é€šç´¢å¼•==

**B. ç´¢å¼•ä¸Šçš„ç­‰å€¼æŸ¥è¯¢(éå”¯ä¸€æ™®é€šç´¢å¼•)ï¼Œ==å‘å³éå†æ—¶æœ€åä¸€ä¸ªå€¼ä¸æ»¡è¶³æŸ¥è¯¢éœ€æ±‚æ—¶ï¼Œnext-keylock é€€åŒ–ä¸ºé—´éš™é”ã€‚==** 

å…·ä½“åˆ†æä¸€ä¸‹ï¼š

æˆ‘ä»¬çŸ¥é“InnoDBçš„B+æ ‘ç´¢å¼•ï¼Œ**å¶å­èŠ‚ç‚¹æ˜¯æœ‰åºçš„åŒå‘é“¾è¡¨**ã€‚ å‡å¦‚ï¼Œæˆ‘ä»¬è¦æ ¹æ®è¿™ä¸ª**äºŒçº§ç´¢å¼•**æŸ¥è¯¢å€¼ä¸º18çš„æ•°æ®ï¼Œå¹¶åŠ ä¸Šå…±äº«é”ï¼Œæˆ‘ä»¬æ˜¯åªé”å®š18è¿™ä¸€è¡Œå°±å¯ä»¥äº†å—ï¼Ÿ

 å¹¶ä¸æ˜¯ï¼Œå› ä¸ºæ˜¯**==éå”¯ä¸€ç´¢å¼•==ï¼Œè¿™ä¸ªç»“æ„ä¸­å¯èƒ½æœ‰==å¤šä¸ª18çš„å­˜åœ¨==**ï¼Œæ‰€ä»¥ï¼Œåœ¨åŠ é”æ—¶**ä¼šç»§ç»­å¾€åæ‰¾ï¼Œæ‰¾åˆ°ä¸€ä¸ªä¸æ»¡è¶³æ¡ä»¶çš„å€¼**ï¼ˆå½“å‰æ¡ˆä¾‹ä¸­ä¹Ÿå°±æ˜¯**21**ï¼‰ã€‚

æ­¤æ—¶**ä¼šå¯¹18åŠ ä¸´é”®é”ï¼Œå¹¶å¯¹21ä¹‹å‰çš„é—´éš™ï¼ˆè¿™ä¸ªé—´éš™è¿™æ˜¯==å¯¹å‰ä¸€ä¸ªé—´éš™è€Œè¨€==ï¼‰åŠ é”ï¼ˆæ­¤æ—¶è¿™ä¸ª`21çš„GAPé—´éš™é”`å°±æ˜¯next-keylocké€€åŒ–è€Œæ¥çš„ï¼‰**ã€‚



![image-20250419175839860](./Mysql-Learning-Local.assets/image-20250419175839860.png)



##### **ğŸŒŸ==é—´éš™é”å’Œä¸´é”®é”çš„åŸºæœ¬æ¦‚å¿µï¼ˆé‡ç‚¹ï¼‰==**

- é—´éš™é”ï¼šé”å®šç´¢å¼•è®°å½•é—´éš™ï¼ˆ**ä¸åŒ…å«è¯¥è®°å½•**ï¼‰ï¼Œ
  - æ¯”å¦‚æ­¤æ—¶çš„ç´¢å¼•æ˜¯idæ—¶ï¼Œå¹¶ä¸”lock_data æ˜¾ç¤ºçš„æ˜¯8ï¼Œè¡¨ç¤ºçš„æ˜¯**==é”å®š8å‰é¢ä¸€ä¸ªçš„ä¸€ä¸ªé—´éš™==**ï¼Œå‡è®¾ç°åœ¨8å‰é¢ä¸€ä½çš„idä¸º3ï¼Œé‚£ä¹ˆæ­¤æ—¶è¯¥é—´éš™é”ï¼Œé”å®šçš„å°±æ˜¯3-8ä¹‹é—´çš„é—´éš™ï¼Œä¹Ÿå°±æ˜¯(3,8);
- ä¸´é”®é”ï¼šè¡Œé”å’Œé—´éš™é”çš„ç»„åˆï¼Œä¼š**é”ä½æ•°æ®**ï¼ŒåŒæ—¶**é”ä½==æ•°æ®å‰é¢çš„ä¸€ä¸ªé—´éš™Gap==**
  - å¦‚æœæœ‰è®°å½•8,9,10,20,30
  - å¯¹20åŠ ä¸´é”®é”ï¼Œä¼š**é”å®š(10,20]è¿™ä¸ªåŒºé—´**
  - ä¸ä¼šé”å®š(8,20]è¿™ä¸ªåŒºé—´




**å®¢æˆ·ç«¯ä¸€ï¼Œåˆ›å»ºageçš„ éå”¯ä¸€æ™®é€šç´¢å¼•**

```sql
create index idx_syu_age on stu(age);
```

**æ ¹æ®éå”¯ä¸€æ™®é€šç´¢å¼•è¿›è¡ŒæŸ¥è¯¢ï¼Œå¹¶æ·»åŠ å…±äº«è¡Œé”**

```sql
select * from stu where age = 18 lock in share mode;
```



<img src="./Mysql-Learning-Local.assets/image-20250419180352713.png" alt="image-20250419180352713" style="zoom:80%;" />

![image-20250419180338507](./Mysql-Learning-Local.assets/image-20250419180338507.png)



![image-20250419180727875](./Mysql-Learning-Local.assets/image-20250419180727875.png)

é”ä¿¡æ¯è§£è¯»

1. **`idx_syu_age` ä¸Šçš„ S é”ï¼ˆä¸´é”®é”ï¼‰**ï¼š`18, 8`
   - é”å®šåŒºé—´ï¼š(14, 18]ï¼ˆå³ age=14 åˆ° age=18 ä¹‹é—´çš„é—´éš™ + age=18 è®°å½•æœ¬èº«ï¼‰
2. **ä¸»é”®ä¸Šçš„ S,REC_NOT_GAP é”**ï¼š`8`
   - ä»…é”å®šä¸»é”® id=8 è¿™ä¸€è¡Œè®°å½•ï¼ˆä¸é”å®šé—´éš™ï¼‰
3. **`idx_syu_age` ä¸Šçš„ S,GAP é”**ï¼š`21, 11`
   - é”å®šåŒºé—´ï¼š(18, 21)ï¼ˆå³ age=18 åˆ° age=21 ä¹‹é—´çš„é—´éš™ï¼‰

**==æœ€ç»ˆé”å®šèŒƒå›´==ï¼ˆå¼€é—­åŒºé—´è¡¨ç¤ºï¼‰**

1. **è®°å½•é”**ï¼š
   - [18, 8]ï¼ˆage=18 ä¸” id=8 çš„è®°å½•ï¼‰
2. **é—´éš™é”**ï¼š
   - (14, 18)ï¼ˆage=14 å’Œ age=18 ä¹‹é—´çš„é—´éš™ï¼‰
   - (18, 21)ï¼ˆage=18 å’Œ age=21 ä¹‹é—´çš„é—´éš™ï¼‰
3. **ç»„åˆèµ·æ¥ç›¸å½“äº**ï¼š
   - (14, 21)ï¼ˆå³ age=14 åˆ° age=21 ä¹‹é—´çš„æ‰€æœ‰é—´éš™ï¼Œä½†ä¸åŒ…æ‹¬ age=14 å’Œ age=21 çš„è®°å½•ï¼‰



#### â‘¢ğŸš€==ç‰¹æ®Šæƒ…å†µ==-éå”¯ä¸€æ™®é€šç´¢å¼•

##### **1ï¼‰==ç‰¹æ®Šæƒ…å†µ==æ¦‚è¿°**

**åŸºäºç´¢å¼•idx_syu_ageï¼Œæœ€åçš„è¡Œé”çš„é”å®šèŒƒå›´ åº”è¯¥æ˜¯ï¼š(14,18] , (18,21ï¼‰**

â€‹	å½“å®¢æˆ·ç«¯ä¸€ï¼Œå·²ç»æ‰§è¡Œäº†select * from stu where age = 18 lock in share mode;æ·»åŠ äº†å…±äº«è¡Œé”ï¼Œæ­¤æ—¶**å®¢æˆ·ç«¯äºŒè¿›è¡Œä¸‹åˆ—æ“ä½œæ—¶**ï¼Œä¼šå‡ºç°ä¸€ä¸‹ç‰¹æ®Šæƒ…å†µï¼š

- ä½†æ˜¯**åœ¨==insertæ“ä½œ==æ—¶**ï¼Œå¯¹äº**è¾¹ç•Œæƒ…å†µage = 14 å’Œage = 21æ—¶ä¼šå‡ºç°è¢«é˜»å¡çš„æƒ…å†µ**ã€‚
- åœ¨**==updateæ“ä½œ==æ—¶**ï¼Œ**é™¤äº†å½“å‰è¡Œage =18 è¢«é”ä½**ï¼Œ**å…¶ä»–çš„ageéƒ½å¯ä»¥æ‰§è¡Œé€šè¿‡ï¼Œä¸ä¼šè¢«é˜»å¡**

![image-20250419180436950](./Mysql-Learning-Local.assets/image-20250419180436950.png)

```sql
-- å®¢æˆ·ç«¯äºŒ è¿›è¡Œä¸‹åˆ—æ“ä½œæ—¶å‡ºç°çš„ç‰¹æ®Šæƒ…å†µ
begin;
	-- åŸºäºç´¢å¼•idx_syu_ageï¼Œæœ€åçš„è¡Œé”çš„é”å®šèŒƒå›´ åº”è¯¥æ˜¯ï¼š(14,18] , (18,21)
    -- è¿™äº›æ“ä½œä¼šè¢«é˜»å¡ï¼š
    INSERT INTO stu VALUES (null, 'test1', 15);  -- è½å…¥ (14,18)
    INSERT INTO stu VALUES (null, 'test2', 20);  -- è½å…¥ (18,21)

    -- è¿™äº›æ“ä½œä¸ä¼šè¢«é˜»å¡ï¼š
    INSERT INTO stu VALUES (null, 'test3', 10);  -- å°äº14
    INSERT INTO stu VALUES (null, 'test4', 22);  -- å¤§äº21
    UPDATE stu SET name='test' WHERE age=14;     -- age=14 æœ¬èº«æœªè¢«é”å®š
    UPDATE stu SET name='test' WHERE age=21;     -- age=21 æœ¬èº«æœªè¢«é”å®š
    
    
    -- ç‰¹æ®Šä¾‹å­-è¢«é˜»å¡
    insert into stu values(4,'catcat222',14); -- insertè¯­å¥çš„age=14ï¼Œè™½ç„¶ä¸åœ¨é”å®šçš„èŒƒå›´å†…ï¼Œè¿˜æ˜¯ä¼šè¢«é˜»å¡
    insert into stu values(4,'catcat222',21); -- åŒç†ä¹Ÿä¼šè¢«é˜»å¡
    
    -- å¯¹äºupdateè¯­å¥
    UPDATE stu SET name='test' WHERE age= 18 ;
    UPDATE stu SET name='test' WHERE age= xx ; -- åªæœ‰å½“age = 18æ—¶æ‰ä¼šè¢«é˜»å¡ï¼Œå…¶ä»–éƒ½ä¸è¢«é˜»å¡
    
commit;
```



##### 2ï¼‰é”èŒƒå›´æ€»ç»“ï¼ˆåŸºäº `idx_syu_age` ç´¢å¼•ï¼‰

1. **ä¸´é”®é” (Next-Key Lock)**ï¼š`(14, 18]`  
   
   - é”å®šåŒºé—´ï¼š`age > 14 ä¸” age â‰¤ 18`  
   - åŒ…å«ï¼šé—´éš™ `(14, 18)` + è®°å½• `age=18`  
   - ç›®çš„ï¼šé˜²æ­¢å…¶ä»–äº‹åŠ¡æ’å…¥ `age âˆˆ (14, 18]` çš„æ–°è®°å½•ï¼ˆå¹»è¯»ï¼‰ã€‚
   
2. **é—´éš™é” (Gap Lock)**ï¼š`(18, 21)`  
   - é”å®šåŒºé—´ï¼š`age > 18 ä¸” age < 21`  
   - ç›®çš„ï¼šé˜²æ­¢å…¶ä»–äº‹åŠ¡æ’å…¥ `age âˆˆ (18, 21)` çš„æ–°è®°å½•ã€‚

3. **ä¸»é”®è®°å½•é” (Record Lock)**ï¼š`id=8`ï¼ˆå¯¹åº” `age=18`ï¼‰  
   - ä»…é”å®šä¸»é”®ä¸º `8` çš„è¡Œï¼Œé˜²æ­¢ä¿®æ”¹æˆ–åˆ é™¤ã€‚
   
   **ç»„åˆèµ·æ¥ç›¸å½“äº**ï¼š
   
   - (14, 21)ï¼ˆå³ age=14 åˆ° age=21 ä¹‹é—´çš„æ‰€æœ‰é—´éš™ï¼Œä½†ä¸åŒ…æ‹¬ age=14 å’Œ age=21 çš„è®°å½•ï¼‰



##### 3ï¼‰ä¸ºä»€ä¹ˆæŸäº›æ“ä½œä¼šè¢«é˜»å¡ï¼Ÿ

###### 1. **INSERT è¯­å¥çš„é˜»å¡é€»è¾‘**
InnoDB åœ¨æ‰§è¡Œ `INSERT` æ—¶ï¼Œä¼š==å…ˆæ£€æŸ¥**æ’å…¥æ„å‘é”ï¼ˆInsert Intention Lockï¼‰**æ˜¯å¦ä¸ç°æœ‰é”å†²çª==ï¼š
- **æ’å…¥æ„å‘é”**æ˜¯ä¸€ç§ç‰¹æ®Šçš„é—´éš™é”ï¼Œè¡¨ç¤ºâ€œå‡†å¤‡åœ¨æŸä¸ªé—´éš™æ’å…¥æ•°æ®â€ã€‚
- å¦‚æœæ’å…¥çš„å€¼è½åœ¨è¢«é”å®šçš„é—´éš™å†…ï¼ˆæˆ–è¾¹ç•Œï¼‰ï¼Œåˆ™ä¼šè¢«é˜»å¡ã€‚

**ä½ çš„æµ‹è¯•æ¡ˆä¾‹ï¼š**
- `INSERT INTO stu VALUES (null, 'test1', 15);`  
  - æ’å…¥ `age=15`ï¼Œè½åœ¨ `(14, 18)` é—´éš™å†… â†’ **è¢«ä¸´é”®é”é˜»å¡**ã€‚
  
- `INSERT INTO stu VALUES (null, 'test2', 20);`  
  - æ’å…¥ `age=20`ï¼Œè½åœ¨ `(18, 21)` é—´éš™å†… â†’ **è¢«é—´éš™é”é˜»å¡**ã€‚

- `INSERT INTO stu VALUES (4, 'catcat222', 14);`  
  - æ’å…¥ `age=14`ï¼Œ**è™½ç„¶ `age=14` æœ¬èº«æœªè¢«é”å®š**ï¼Œä½†æ’å…¥æ“ä½œ**éœ€è¦è·å– `(11, 14]` æˆ– `(14, 18)` çš„æ’å…¥æ„å‘é”ã€‚**  
  - ==ç”±äº `(14, 18)` è¢«ä¸´é”®é”é”å®šï¼Œæ’å…¥æ„å‘é”ä¸ä¹‹å†²çª â†’ **è¢«é˜»å¡**ã€‚==  
  - **å…³é”®ç‚¹**ï¼šå³ä½¿æ’å…¥çš„å€¼æ˜¯å·²æœ‰å€¼ï¼ˆ`age=14`ï¼‰ï¼ŒInnoDB ä»ä¼šä¿å®ˆåœ°æ£€æŸ¥é—´éš™é”ã€‚

- `INSERT INTO stu VALUES (4, 'catcat222', 21);`  
  - æ’å…¥ `age=21`ï¼Œè™½ç„¶ `age=21` æœ¬èº«æœªè¢«é”å®šï¼Œä½†æ’å…¥æ“ä½œéœ€è¦æ£€æŸ¥ `(18, 21)` é—´éš™ã€‚  
  - ç”±äº `(18, 21)` è¢«é—´éš™é”é”å®š â†’ **è¢«é˜»å¡**ã€‚  

###### 2. **UPDATE è¯­å¥çš„é˜»å¡é€»è¾‘**
- `UPDATE stu SET name='test' WHERE age=18;`  
  - å‘½ä¸­ `age=18` çš„è®°å½•ï¼Œè¯¥è®°å½•è¢«ä¸´é”®é”é”å®šï¼ˆ`S` é”ï¼‰â†’ **è¢«é˜»å¡**ï¼ˆå…¶ä»–äº‹åŠ¡ä¸èƒ½ä¿®æ”¹ï¼‰ã€‚  
- `UPDATE stu SET name='test' WHERE age=14;` æˆ– `age=21;`  
  - `age=14` å’Œ `age=21` çš„**è®°å½•æœªè¢«é”å®šï¼ˆåªæœ‰é—´éš™é”ï¼‰**â†’ **ä¸ä¼šè¢«é˜»å¡**ã€‚  
- ä¸ºä»€ä¹ˆ **==UPDATE ä¸å­˜åœ¨çš„è®°å½•ä¸ä¼šè¢«é˜»å¡==**ï¼Ÿ
  - å½“æ‰§è¡Œ `UPDATE` æ—¶ï¼ŒInnoDB ä¼šï¼š
    1. **å…ˆæŸ¥æ‰¾è®°å½•**ï¼š
       - å¦‚æœè®°å½•**å­˜åœ¨**ï¼Œåˆ™å°è¯•åŠ é”ï¼ˆè¡Œé”æˆ–ä¸´é”®é”ï¼‰ã€‚
       - ==å¦‚æœè®°å½•**ä¸å­˜åœ¨**ï¼Œåˆ™ä¸ä¼šåŠ ä»»ä½•é”ï¼ˆåŒ…æ‹¬é—´éš™é”ï¼‰==ã€‚
    2. **é”çš„èŒƒå›´å–å†³äº WHERE æ¡ä»¶**ï¼š
       - å¦‚æœ `WHERE age = 15`ï¼ˆç²¾ç¡®åŒ¹é…ï¼‰ï¼Œè€Œ `age=15` ä¸å­˜åœ¨ï¼ŒInnoDB **ä¸ä¼šé”å®šä»»ä½•è®°å½•æˆ–é—´éš™**ï¼Œå› æ­¤ä¸ä¼šé˜»å¡ã€‚
       - å¦‚æœ `WHERE age BETWEEN 15 AND 17`ï¼ˆ**èŒƒå›´æŸ¥è¯¢**ï¼‰ï¼Œ**å³ä½¿è®°å½•ä¸å­˜åœ¨ï¼ŒInnoDB ä¹Ÿä¼šé”å®šç¬¦åˆæ¡ä»¶çš„é—´éš™ï¼ˆé˜²æ­¢å¹»è¯»ï¼‰**ã€‚




##### 4ï¼‰éªŒè¯é”è¡Œä¸ºçš„æ­£ç¡®å§¿åŠ¿

###### 1. **æ’å…¥æµ‹è¯•**
| æ“ä½œ                | æ˜¯å¦è¢«é˜»å¡ | åŸå›                             |
| ------------------- | ---------- | ------------------------------- |
| `INSERT ... age=10` | âŒ ä¸é˜»å¡   | `age=10 < 14`ï¼Œä¸åœ¨ä»»ä½•é”å®šåŒºé—´ |
| `INSERT ... age=15` | âœ… é˜»å¡     | `age=15 âˆˆ (14, 18)`             |
| `INSERT ... age=18` | âœ… é˜»å¡     | `age=18` è¢«ä¸´é”®é”é”å®š           |
| `INSERT ... age=20` | âœ… é˜»å¡     | `age=20 âˆˆ (18, 21)`             |
| `INSERT ... age=21` | âœ… é˜»å¡     | æ’å…¥éœ€è¦æ£€æŸ¥ `(18, 21)` é—´éš™é”  |
| `INSERT ... age=22` | âŒ ä¸é˜»å¡   | `age=22 > 21`ï¼Œä¸åœ¨ä»»ä½•é”å®šåŒºé—´ |

###### 2. **æ›´æ–°æµ‹è¯•**
| æ“ä½œ                         | æ˜¯å¦è¢«é˜»å¡   | åŸå›                              |
| ---------------------------- | ------------ | -------------------------------- |
| `UPDATE ... age=14`          | âŒ ä¸é˜»å¡     | åªæœ‰é—´éš™é”ï¼Œä¸é”å®šè®°å½•æœ¬èº«       |
| `UPDATE ... age=18`          | âœ… é˜»å¡       | `age=18` è¢«ä¸´é”®é”é”å®š            |
| `UPDATE ... age=21`          | âŒ ä¸é˜»å¡     | åªæœ‰é—´éš™é”ï¼Œä¸é”å®šè®°å½•æœ¬èº«       |
| `UPDATE ... WHERE age = 15;` | âŒ **ä¸é˜»å¡** | `age=15` ä¸å­˜åœ¨ï¼ŒInnoDB ä¸ä¼šåŠ é” |
| `UPDATE ... WHERE age = 17;` | âŒ **ä¸é˜»å¡** | `age=17` ä¸å­˜åœ¨ï¼ŒInnoDB ä¸ä¼šåŠ é” |



##### 5ï¼‰æ€»ç»“

1. **INSERT çš„é˜»å¡èŒƒå›´æ¯”æƒ³è±¡ä¸­æ›´å¹¿**ï¼š  
   - å³ä½¿æ’å…¥çš„å€¼æ˜¯å·²æœ‰å€¼ï¼ˆå¦‚ `age=14` æˆ– `age=21`ï¼‰ï¼Œä¹Ÿ**ä¼šå› ä¸ºæ’å…¥æ„å‘é”ä¸é—´éš™é”å†²çªè€Œè¢«é˜»å¡ã€‚**  
   - è¿™æ˜¯ **==InnoDB é˜²æ­¢å¹»è¯»çš„ä¿å®ˆç­–ç•¥==**ã€‚
2. **UPDATE åªé”å®šå…·ä½“è®°å½•**ï¼š  
   - åªæœ‰è¢«é”å®šçš„è®°å½•ï¼ˆå¦‚ `age=18`ï¼‰ä¼šè¢«é˜»å¡æ›´æ–°ï¼Œå…¶ä»–è®°å½•ï¼ˆå¦‚ `age=14` æˆ– `age=21`ï¼Œ`age=15ã€17è¿™äº›ä¸å­˜åœ¨è®°å½•`ï¼‰å¯ä»¥æ­£å¸¸ä¿®æ”¹ã€‚
3. **é”çš„è¾¹ç•Œè¡Œä¸º**ï¼š  
   - ä¸´é”®é” `(14, 18]` åŒ…å«å³è¾¹ç•Œï¼ˆ`age=18`ï¼‰ï¼Œä½†ä¸åŒ…å«å·¦è¾¹ç•Œï¼ˆ`age=14`ï¼‰ã€‚  
   - é—´éš™é” `(18, 21)` ä¸åŒ…å«ä»»ä½•è¾¹ç•Œã€‚  



#### â‘£==èŒƒå›´æŸ¥è¯¢==-å”¯ä¸€ç´¢å¼•

**C. ç´¢å¼•ä¸Šçš„èŒƒå›´æŸ¥è¯¢(å”¯ä¸€ç´¢å¼•)--ä¼šè®¿é—®åˆ°ä¸æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€ä¸ªå€¼ä¸ºæ­¢ã€‚**

**å¯¹äºå®¢æˆ·ç«¯ä¸€è€Œè¨€,æ‰§è¡Œ==å¯¹äºå”¯ä¸€ç´¢å¼•idçš„èŒƒå›´æŸ¥è¯¢==sqlè¯­å¥**

```sql
select * from stu where id >=19 lock in share mode;
```

<img src="./Mysql-Learning-Local.assets/image-20250419180540219.png" alt="image-20250419180540219" style="zoom:80%;" />

![image-20250419180457279](./Mysql-Learning-Local.assets/image-20250419180457279.png)

æŸ¥è¯¢çš„æ¡ä»¶ä¸ºid>=19ï¼Œå¹¶æ·»åŠ å…±äº«é”ã€‚ æ­¤æ—¶æˆ‘ä»¬å¯ä»¥æ ¹æ®æ•°æ®åº“è¡¨ä¸­ç°æœ‰çš„æ•°æ®ï¼Œå°†æ•°æ®åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š

[19]

(19,25]

(25,+âˆ]

æ‰€ä»¥**æ•°æ®åº“æ•°æ®åœ¨åŠ é”**æ˜¯ï¼Œ

- å°†19åŠ äº†è¡Œé” => [19]
- **25çš„ä¸´é”®é”**ï¼ˆåŒ…å«25åŠ25ä¹‹å‰çš„é—´éš™ï¼‰=> (19,25]
- **æ­£æ— ç©·çš„ä¸´é”®é”**(æ­£æ— ç©·åŠä¹‹å‰çš„é—´éš™)  => (25,+âˆ]





## 5.5 å°ç»“

![image-20250419180518765](./Mysql-Learning-Local.assets/image-20250419180518765.png)





# 6ã€ğŸš€ InnoDBå¼•æ“

## 6.1 ==é€»è¾‘å­˜å‚¨ç»“æ„==

InnoDBçš„é€»è¾‘å­˜å‚¨ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤º:

![image-20250419201127103](./Mysql-Learning-Local.assets/image-20250419201127103.png)

![image-20250419202038539](./Mysql-Learning-Local.assets/image-20250419202038539.png)

#### â‘  è¡¨ç©ºé—´-Tablespace

è¡¨ç©ºé—´æ˜¯InnoDBå­˜å‚¨å¼•æ“é€»è¾‘ç»“æ„çš„æœ€é«˜å±‚ï¼Œ å¦‚æœç”¨æˆ·å¯ç”¨äº†å‚æ•° innodb_file_per_table(åœ¨8.0ç‰ˆæœ¬ä¸­é»˜è®¤å¼€å¯) ï¼Œåˆ™æ¯å¼ è¡¨éƒ½ä¼šæœ‰ä¸€ä¸ªè¡¨ç©ºé—´ï¼ˆxxx.ibdï¼‰ï¼Œä¸€ä¸ªmysqlå®ä¾‹å¯ä»¥å¯¹åº”å¤šä¸ªè¡¨ç©ºé—´ï¼Œ**ç”¨äºå­˜å‚¨è®°å½•ã€ç´¢å¼•ç­‰æ•°æ®ã€‚**

#### â‘¡ æ®µ-Segment

æ®µï¼Œåˆ†ä¸ºæ•°æ®æ®µï¼ˆLeaf node segmentï¼‰ã€ç´¢å¼•æ®µï¼ˆNon-leaf node segmentï¼‰ã€å›æ»šæ®µï¼ˆRollback segmentï¼‰ï¼ŒInnoDBæ˜¯ç´¢å¼•ç»„ç»‡è¡¨ï¼Œ**æ•°æ®æ®µå°±æ˜¯B+æ ‘çš„å¶å­èŠ‚ç‚¹ï¼Œ ç´¢å¼•æ®µå³ä¸ºB+æ ‘çš„éå¶å­èŠ‚ç‚¹ã€‚**æ®µç”¨æ¥ç®¡ç†å¤šä¸ªExtentï¼ˆåŒºï¼‰ã€‚



#### â‘¢ åŒº-Extent

åŒºï¼Œ**è¡¨ç©ºé—´çš„å•å…ƒç»“æ„**ï¼Œ**æ¯ä¸ªåŒºçš„å¤§å°ä¸º1M**ã€‚ 

é»˜è®¤æƒ…å†µä¸‹ï¼Œ InnoDBå­˜å‚¨å¼•æ“**é¡µå¤§å°ä¸º16K**ï¼Œ å³ä¸€ä¸ªåŒºä¸­ä¸€**å…±æœ‰64ä¸ªè¿ç»­çš„é¡µ**ã€‚



#### â‘£ é¡µ-page

é¡µï¼Œæ˜¯InnoDB å­˜å‚¨å¼•æ“**ç£ç›˜ç®¡ç†çš„æœ€å°å•å…ƒ**ï¼Œæ¯ä¸ªé¡µçš„å¤§å°é»˜è®¤ä¸º 16KBã€‚

ä¸ºäº†ä¿è¯é¡µçš„è¿ç»­æ€§ï¼ŒInnoDB å­˜å‚¨å¼•æ“æ¯æ¬¡ä»ç£ç›˜ç”³è¯· 4-5 ä¸ªåŒºã€‚



#### â‘¤ è¡Œ-Row

è¡Œï¼ŒInnoDB å­˜å‚¨å¼•æ“æ•°æ®æ˜¯**æŒ‰è¡Œè¿›è¡Œå­˜æ”¾çš„**ã€‚

åœ¨è¡Œä¸­ï¼Œé»˜è®¤æœ‰==ä¸¤ä¸ªéšè—å­—æ®µ==ï¼š

- **Trx_id**ï¼šæ¯æ¬¡å¯¹æŸæ¡è®°å½•è¿›è¡Œæ”¹åŠ¨æ—¶ï¼Œéƒ½ä¼š**æŠŠå¯¹åº”çš„äº‹åŠ¡idèµ‹å€¼ç»™trx_idéšè—åˆ—**ã€‚
- **Roll_pointer**ï¼šæ¯æ¬¡å¯¹æŸæ¡å¼•è®°å½•è¿›è¡Œæ”¹åŠ¨æ—¶ï¼Œéƒ½ä¼š**æŠŠæ—§çš„ç‰ˆæœ¬å†™å…¥åˆ°undoæ—¥å¿—ä¸­**ï¼Œç„¶åè¿™ä¸ªéšè—åˆ—å°±**ç›¸å½“äºä¸€ä¸ªæŒ‡é’ˆ**ï¼Œå¯ä»¥é€šè¿‡å®ƒæ¥**æ‰¾åˆ°è¯¥è®°å½•ä¿®æ”¹å‰çš„ä¿¡æ¯**ã€‚



## 6.2 æ¶æ„

### ï¼ˆ1ï¼‰æ¦‚è¿°

MySQL5.5 ç‰ˆæœ¬å¼€å§‹ï¼Œé»˜è®¤ä½¿ç”¨InnoDBå­˜å‚¨å¼•æ“ï¼Œå®ƒæ“…é•¿**äº‹åŠ¡å¤„ç†ï¼Œå…·æœ‰å´©æºƒæ¢å¤ç‰¹æ€§**ï¼Œåœ¨æ—¥å¸¸å¼€å‘

ä¸­ä½¿ç”¨éå¸¸å¹¿æ³›ã€‚ä¸‹é¢æ˜¯InnoDBæ¶æ„å›¾ï¼Œ**å·¦ä¾§ä¸ºå†…å­˜ç»“æ„ï¼Œå³ä¾§ä¸ºç£ç›˜ç»“æ„**ã€‚

![image-20250419202148484](./Mysql-Learning-Local.assets/image-20250419202148484.png)



### ï¼ˆ2ï¼‰==å†…å­˜ç»“æ„==

åœ¨å·¦ä¾§çš„å†…å­˜ç»“æ„ä¸­ï¼Œä¸»è¦åˆ†ä¸ºè¿™ä¹ˆå››å¤§å—å„¿ï¼š 

Buffer Poolã€Change Bufferã€Adaptive Hash Indexã€Log Bufferã€‚ æ¥ä¸‹æ¥ä»‹ç»ä¸€ä¸‹è¿™å››ä¸ªéƒ¨åˆ†ã€‚

<img src="./Mysql-Learning-Local.assets/image-20250419202909129.png" alt="image-20250419202909129" style="zoom:80%;" />



#### â‘ Buffer Pool-==ç¼“å†²æ± ==

![image-20250419202800043](./Mysql-Learning-Local.assets/image-20250419202800043.png)

InnoDBå­˜å‚¨å¼•æ“åŸºäº==ç£ç›˜æ–‡ä»¶å­˜å‚¨==ï¼Œè®¿é—®**ç‰©ç†ç¡¬ç›˜å’Œåœ¨å†…å­˜ä¸­**è¿›è¡Œè®¿é—®ï¼Œé€Ÿåº¦ç›¸å·®å¾ˆå¤§ï¼Œä¸ºäº†å°½å¯èƒ½å¼¥è¡¥è¿™ä¸¤è€…ä¹‹é—´çš„I/Oæ•ˆç‡çš„å·®å€¼ï¼Œå°±éœ€è¦**æŠŠç»å¸¸ä½¿ç”¨çš„æ•°æ®åŠ è½½åˆ°ç¼“å†²æ± ä¸­ï¼Œé¿å…æ¯æ¬¡è®¿é—®éƒ½è¿›è¡Œç£ç›˜I/O**ã€‚

åœ¨InnoDBçš„ç¼“å†²æ± ä¸­**ä¸ä»…ç¼“å­˜äº†ç´¢å¼•é¡µå’Œæ•°æ®é¡µ**ï¼Œè¿˜åŒ…å«äº†**undoé¡µã€æ’å…¥ç¼“å­˜ã€è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•ä»¥åŠInnoDBçš„é”ä¿¡æ¯**ç­‰ç­‰ã€‚

ç¼“å†²æ±  Buffer Poolï¼Œæ˜¯ä¸»å†…å­˜ä¸­çš„ä¸€ä¸ªåŒºåŸŸï¼Œé‡Œé¢å¯ä»¥**ç¼“å­˜ç£ç›˜ä¸Šç»å¸¸æ“ä½œçš„çœŸå®æ•°æ®**ï¼Œåœ¨æ‰§è¡Œå¢åˆ æ”¹æŸ¥æ“ä½œæ—¶ï¼Œå…ˆæ“ä½œç¼“å†²æ± ä¸­çš„æ•°æ®ï¼ˆè‹¥ç¼“å†²æ± æ²¡æœ‰æ•°æ®ï¼Œåˆ™ä»ç£ç›˜åŠ è½½å¹¶ç¼“å­˜ï¼‰ï¼Œç„¶åå†ä»¥ä¸€å®šé¢‘ç‡åˆ·æ–°åˆ°ç£ç›˜ï¼Œ**ä»è€Œå‡å°‘ç£ç›˜IOï¼ŒåŠ å¿«å¤„ç†é€Ÿåº¦ã€‚** =ã€‹**å»äº†è§£==`éšæœºç£ç›˜io`å’Œ`é¡ºåºç£ç›˜io`==çš„æ¦‚å¿µ**



ç¼“å†²æ± **ä»¥Pageé¡µä¸ºå•ä½ï¼Œåº•å±‚é‡‡ç”¨é“¾è¡¨æ•°æ®ç»“æ„ç®¡ç†Page**ã€‚æ ¹æ®çŠ¶æ€ï¼Œå°†Pageåˆ†ä¸ºä¸‰ç§ç±»å‹ï¼š

- **free page**ï¼šç©ºé—²pageï¼Œæœªè¢«ä½¿ç”¨ã€‚

- **clean page**ï¼šè¢«ä½¿ç”¨pageï¼Œæ•°æ®æ²¡æœ‰è¢«ä¿®æ”¹è¿‡ã€‚

- **dirty page**ï¼šè„é¡µï¼Œè¢«ä½¿ç”¨pageï¼Œæ•°æ®è¢«ä¿®æ”¹è¿‡ï¼Œä¹Ÿä¸­**æ•°æ®ä¸ç£ç›˜çš„æ•°æ®äº§ç”Ÿäº†ä¸ä¸€è‡´**ã€‚

  

<span id = 'Buffer Poolç¼“å­˜æ± ' > </span>

åœ¨ä¸“ç”¨æœåŠ¡å™¨ä¸Šï¼Œ**é€šå¸¸å°†å¤šè¾¾80ï¼…çš„ç‰©ç†å†…å­˜åˆ†é…ç»™ç¼“å†²æ± ** ã€‚å‚æ•°è®¾ç½®ï¼š 

```sql
-- æŸ¥çœ‹ç¼“å­˜æ± çš„å¤§å°
show variables like 'innodb_buffer_pool_size';
```

![image-20250419202949404](./Mysql-Learning-Local.assets/image-20250419202949404.png)





#### â‘¡Change Buffer-æ›´æ”¹ç¼“å†²åŒº

![image-20250419203632465](./Mysql-Learning-Local.assets/image-20250419203632465.png)

Change Bufferï¼Œ**æ›´æ”¹ç¼“å†²åŒº**ï¼ˆé’ˆå¯¹äº==éå”¯ä¸€äºŒçº§ç´¢å¼•é¡µ==ï¼‰ï¼Œåœ¨æ‰§è¡ŒDMLè¯­å¥æ—¶ï¼Œå¦‚æœè¿™äº›æ•°æ®Pageæ²¡æœ‰åœ¨Buffer Poolä¸­ï¼Œä¸ä¼šç›´æ¥æ“ä½œç£ç›˜ï¼Œè€Œä¼š**å°†æ•°æ®å˜æ›´å…ˆå­˜å‚¨åœ¨æ›´æ”¹ç¼“å†²åŒº Change Buffer**ä¸­ï¼Œ==åœ¨æœªæ¥æ•°æ®è¢«è¯»å–æ—¶ï¼Œå†**å°†æ•°æ®åˆå¹¶æ¢å¤åˆ°Buffer Poolä¸­**==ï¼Œ**å†å°†åˆå¹¶åçš„æ•°æ®åˆ·æ–°åˆ°ç£ç›˜ä¸­**ã€‚



Change Bufferçš„æ„ä¹‰æ˜¯ä»€ä¹ˆå‘¢?

å…ˆæ¥çœ‹ä¸€å¹…å›¾ï¼Œè¿™ä¸ªæ˜¯äºŒçº§ç´¢å¼•çš„ç»“æ„å›¾ï¼š

![image-20250419203643784](./Mysql-Learning-Local.assets/image-20250419203643784.png)

ä¸èšé›†ç´¢å¼•ä¸åŒï¼ŒäºŒçº§ç´¢å¼•é€šå¸¸æ˜¯éå”¯ä¸€çš„ï¼Œå¹¶ä¸”ä»¥**ç›¸å¯¹éšæœºçš„é¡ºåºæ’å…¥äºŒçº§ç´¢å¼•**ã€‚åŒæ ·ï¼Œåˆ é™¤å’Œæ›´æ–°å¯èƒ½ä¼šå½±å“ç´¢å¼•æ ‘ä¸­ä¸ç›¸é‚»çš„äºŒçº§ç´¢å¼•é¡µï¼Œå¦‚æœæ¯ä¸€æ¬¡éƒ½æ“ä½œç£ç›˜ï¼Œä¼šé€ æˆå¤§é‡çš„ç£ç›˜IOã€‚æœ‰äº†ChangeBufferä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç¼“å†²æ± ä¸­è¿›è¡Œåˆå¹¶å¤„ç†ï¼Œå‡å°‘ç£ç›˜IOã€‚





#### â‘¢Adaptive Hash Index-==è‡ªé€‚åº”hashç´¢å¼•==

![image-20250419204141709](./Mysql-Learning-Local.assets/image-20250419204141709.png)

è‡ªé€‚åº”hashç´¢å¼•ï¼Œç”¨äº**ä¼˜åŒ–å¯¹Buffer Poolæ•°æ®çš„æŸ¥è¯¢**ã€‚MySQLçš„innoDBå¼•æ“ä¸­è™½ç„¶**æ²¡æœ‰ç›´æ¥æ”¯æŒhashç´¢å¼•**ï¼Œä½†æ˜¯ç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªåŠŸèƒ½å°±æ˜¯è¿™ä¸ªè‡ªé€‚åº”hashç´¢å¼•ã€‚å› ä¸ºå‰é¢æˆ‘ä»¬è®²åˆ°è¿‡ï¼Œhashç´¢å¼•åœ¨è¿›è¡Œç­‰å€¼åŒ¹é…æ—¶ï¼Œä¸€èˆ¬æ€§èƒ½æ˜¯è¦é«˜äºB+æ ‘çš„ï¼Œ**å› ä¸ºhashç´¢å¼•ä¸€èˆ¬åªéœ€è¦ä¸€æ¬¡IOå³å¯ï¼ˆåœ¨ä¸å‘ç”Ÿhashå†²çªçš„å‰æä¸‹ï¼‰**ï¼Œè€ŒB+æ ‘ï¼Œå¯èƒ½éœ€è¦å‡ æ¬¡åŒ¹é…ï¼Œæ‰€ä»¥hashç´¢å¼•çš„æ•ˆç‡è¦é«˜ï¼Œ**ä½†æ˜¯hashç´¢å¼•åˆä¸é€‚åˆåšèŒƒå›´æŸ¥è¯¢ã€æ¨¡ç³ŠåŒ¹é…ç­‰**ï¼Œ==åªé€‚åˆç­‰å€¼åŒ¹é…==ã€‚

InnoDBå­˜å‚¨å¼•æ“ä¼šç›‘æ§å¯¹è¡¨ä¸Šå„ç´¢å¼•é¡µçš„æŸ¥è¯¢ï¼Œå¦‚æœè§‚å¯Ÿåˆ°åœ¨ç‰¹å®šçš„æ¡ä»¶ä¸‹hashç´¢å¼•å¯ä»¥æå‡é€Ÿåº¦ï¼Œåˆ™å»ºç«‹hashç´¢å¼•ï¼Œç§°ä¹‹ä¸ºè‡ªé€‚åº”hashç´¢å¼•ã€‚

**è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•ï¼Œæ— éœ€äººå·¥å¹²é¢„ï¼Œæ˜¯ç³»ç»Ÿæ ¹æ®æƒ…å†µè‡ªåŠ¨å®Œæˆã€‚**

å‚æ•°ï¼š adaptive_hash_index

```sql
-- æŸ¥çœ‹InnoDBçš„è‡ªé€‚åº”hashç´¢å¼• æ˜¯å¦å¯ç”¨
show variables like '%hash_index%';
```

![image-20250419204124032](./Mysql-Learning-Local.assets/image-20250419204124032.png)



#### â‘£Log Buffer-æ—¥å¿—ç¼“å†²åŒº

![image-20250419204556969](./Mysql-Learning-Local.assets/image-20250419204556969.png)

Log Bufferï¼šæ—¥å¿—ç¼“å†²åŒºï¼Œç”¨æ¥ä¿å­˜**è¦å†™å…¥åˆ°ç£ç›˜ä¸­çš„logæ—¥å¿—æ•°æ®ï¼ˆredo log ã€undo logï¼‰**ï¼Œé»˜è®¤å¤§å°ä¸º 16MBï¼Œæ—¥å¿—ç¼“å†²åŒºçš„**æ—¥å¿—ä¼šå®šæœŸåˆ·æ–°åˆ°ç£ç›˜ä¸­**ã€‚å¦‚æœéœ€è¦æ›´æ–°ã€æ’å…¥æˆ–åˆ é™¤è®¸å¤šè¡Œçš„äº‹åŠ¡ï¼Œ**å¢åŠ æ—¥å¿—ç¼“å†²åŒºçš„å¤§å°å¯ä»¥èŠ‚çœç£ç›˜ I/O**ã€‚

å‚æ•°:

**innodb_log_buffer_size**ï¼šç¼“å†²åŒºå¤§å°

```sql
-- æŸ¥è¯¢æ—¥å¿—ç¼“å†²åŒºçš„å¤§å°
show variables like '%log_buffer_size%';
```

![image-20250419204331047](./Mysql-Learning-Local.assets/image-20250419204331047.png)



innodb_flush_log_at_trx_commitï¼š**æ—¥å¿—åˆ·æ–°åˆ°ç£ç›˜æ—¶æœº**ï¼Œå–å€¼ä¸»è¦åŒ…å«ä»¥ä¸‹ä¸‰ä¸ªï¼š

```sql
-- æ—¥å¿—åˆ·æ–°åˆ°ç£ç›˜æ—¶æœº
show variables like '%flush_log%';
```

- 1: æ—¥å¿—åœ¨**æ¯æ¬¡äº‹åŠ¡æäº¤æ—¶å†™å…¥å¹¶åˆ·æ–°åˆ°ç£ç›˜**ï¼Œé»˜è®¤å€¼ã€‚
- 0: **æ¯ç§’**å°†æ—¥å¿—å†™å…¥å¹¶åˆ·æ–°åˆ°ç£ç›˜ä¸€æ¬¡ã€‚
- 2: æ—¥å¿—åœ¨**æ¯æ¬¡äº‹åŠ¡æäº¤åå†™å…¥ï¼Œå¹¶æ¯ç§’**åˆ·æ–°åˆ°ç£ç›˜ä¸€æ¬¡ã€‚



### ï¼ˆ3ï¼‰==ç£ç›˜ç»“æ„==

æ¥ä¸‹æ¥ï¼Œå†æ¥çœ‹çœ‹InnoDBä½“ç³»ç»“æ„çš„å³è¾¹éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯ç£ç›˜ç»“æ„ï¼š

#### â‘ System Tablespace-ç³»ç»Ÿè¡¨ç©ºé—´

![image-20250419205549208](./Mysql-Learning-Local.assets/image-20250419205549208.png)

ç³»ç»Ÿè¡¨ç©ºé—´**==æ˜¯æ›´æ”¹ç¼“å†²åŒºçš„å­˜å‚¨åŒºåŸŸ==**ã€‚å¦‚æœè¡¨æ˜¯åœ¨ç³»ç»Ÿè¡¨ç©ºé—´è€Œä¸æ˜¯æ¯ä¸ªè¡¨æ–‡ä»¶æˆ–é€šç”¨è¡¨ç©ºé—´ä¸­åˆ›å»ºçš„ï¼Œå®ƒä¹Ÿå¯èƒ½åŒ…å«è¡¨å’Œç´¢å¼•æ•°æ®ã€‚(åœ¨MySQL5.xç‰ˆæœ¬ä¸­è¿˜åŒ…å«InnoDBæ•°æ®å­—å…¸ã€undologç­‰)

å‚æ•°ï¼šinnodb_data_file_path

**ç³»ç»Ÿè¡¨ç©ºé—´ï¼Œé»˜è®¤çš„æ–‡ä»¶åå« ibdata1**ã€‚

```sql
show variables like '%data_file_path%';
```

![image-20250419204958820](./Mysql-Learning-Local.assets/image-20250419204958820.png)

```bash
cd /var/lib/mysql
```

![image-20250419210220969](./Mysql-Learning-Local.assets/image-20250419210220969.png)



#### â‘¡File-Per-Table Tablespaces-æ–‡ä»¶è¡¨ç©ºé—´

![image-20250419205553841](./Mysql-Learning-Local.assets/image-20250419205553841.png)

å¦‚æœå¼€å¯äº†innodb_file_per_tableå¼€å…³ ï¼Œåˆ™**æ¯ä¸ªè¡¨çš„==æ–‡ä»¶è¡¨ç©ºé—´==åŒ…å«å•ä¸ªInnoDBè¡¨çš„æ•°æ®å’Œç´¢å¼•** ï¼Œå¹¶å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸Šçš„å•ä¸ªæ•°æ®æ–‡ä»¶ä¸­ã€‚è¯¥**æ–‡ä»¶è¡¨ç©ºé—´** =ã€‹**==åŒ…å«è¯¥è¡¨çš„æ•°æ®ã€ç´¢å¼•ã€ç»“æ„==**

**å¼€å¯åï¼Œ==æ¯ä¸€å¼ è¡¨éƒ½ä¼šç”Ÿæˆå¯¹åº”çš„æ–‡ä»¶è¡¨ç©ºé—´==ï¼Œè€Œä¸æ˜¯ç³»ç»Ÿè¡¨ç©ºé—´**

å¼€å…³å‚æ•°ï¼šinnodb_file_per_table ï¼Œè¯¥**å‚æ•°é»˜è®¤å¼€å¯**ã€‚

```sql
show variables like '%file_per_table%';
```

![image-20250419205634184](./Mysql-Learning-Local.assets/image-20250419205634184.png)

é‚£ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬**æ¯åˆ›å»ºä¸€ä¸ªè¡¨ï¼Œéƒ½ä¼šäº§ç”Ÿä¸€ä¸ªå¯¹åº”çš„è¡¨ç©ºé—´æ–‡ä»¶**ï¼Œå¦‚å›¾ï¼š

![image-20250419210256312](./Mysql-Learning-Local.assets/image-20250419210256312.png)



#### â‘¢General Tablespaces-é€šç”¨è¡¨ç©ºé—´

![image-20250419211312610](./Mysql-Learning-Local.assets/image-20250419211312610.png)

é€šç”¨è¡¨ç©ºé—´ï¼Œ**éœ€è¦æ‰‹åŠ¨**é€šè¿‡ **CREATE TABLESPACE è¯­æ³•åˆ›å»ºé€šç”¨è¡¨ç©ºé—´**ï¼Œåœ¨**åˆ›å»ºè¡¨æ—¶ï¼Œå¯ä»¥æŒ‡å®šè¯¥è¡¨ç©ºé—´**ã€‚

##### A. åˆ›å»ºè¡¨ç©ºé—´

```sql
CREATE TABLESPACE ts_name ADD DATAFILE 'file_name' ENGINE = engine_name; 
-- è¿™é‡Œçš„file_name æŒ‡çš„æ˜¯è¿™ä¸ªè¡¨ç©ºé—´å…³è”çš„ç£ç›˜ç£ç›˜æ–‡ä»¶
-- è¿™é‡Œçš„engine_name æŒ‡çš„æ˜¯å¯¹åº”çš„å­˜å‚¨å¼•æ“

create tablespace ts_itheima add datafile 'myitheima.idb' engine = innodb;
```

##### B. åˆ›å»ºè¡¨æ—¶æŒ‡å®šè¡¨ç©ºé—´

```sql
CREATE TABLE xxx ... TABLESPACE ts_name; 

create table test_a(
	id int primary key auto_increment,
    name varchar(10)
) engine = InnoDB tablespace ts_itheima;
```



#### â‘£Undo Tablespaces-æ’¤é”€è¡¨ç©ºé—´

æ’¤é”€è¡¨ç©ºé—´ï¼ŒMySQLå®ä¾‹åœ¨åˆå§‹åŒ–æ—¶ä¼š**è‡ªåŠ¨åˆ›å»ºä¸¤ä¸ªé»˜è®¤çš„undoè¡¨ç©ºé—´**ï¼ˆåˆå§‹å¤§å°16Mï¼‰ï¼Œ

ç”¨äº**å­˜å‚¨undo logæ—¥å¿—**ã€‚

- **undo_001å’Œ undo_002**

<img src="./Mysql-Learning-Local.assets/image-20250419211206961.png" alt="image-20250419211206961" style="zoom:67%;" />



#### â‘¤Temporary Tablespaces-ä¸´æ—¶è¡¨ç©ºé—´

InnoDB ä½¿ç”¨ä¼šè¯ä¸´æ—¶è¡¨ç©ºé—´å’Œå…¨å±€ä¸´æ—¶è¡¨ç©ºé—´ã€‚**å­˜å‚¨ç”¨æˆ·åˆ›å»ºçš„ä¸´æ—¶è¡¨ç­‰æ•°æ®**ã€‚



#### â‘¥Doublewrite Buffer Files-==åŒå†™ç¼“å†²åŒº==

![image-20250419211815326](./Mysql-Learning-Local.assets/image-20250419211815326.png)

åŒå†™ç¼“å†²åŒºï¼ŒinnoDBå¼•æ“**å°†æ•°æ®é¡µä»Buffer Poolåˆ·æ–°åˆ°ç£ç›˜==å‰==**ï¼Œ**å…ˆå°†æ•°æ®é¡µå†™å…¥åŒå†™ç¼“å†²åŒºæ–‡ä»¶ä¸­ï¼Œä¾¿äºç³»ç»Ÿå¼‚å¸¸æ—¶æ¢å¤æ•°æ®ã€‚**

![image-20250419211517050](./Mysql-Learning-Local.assets/image-20250419211517050.png)



#### â‘¦ Redo Log-==é‡åšæ—¥å¿—==

é‡åšæ—¥å¿—ï¼Œæ˜¯**ç”¨æ¥==å®ç°äº‹åŠ¡çš„æŒä¹…æ€§==**ã€‚è¯¥æ—¥å¿—æ–‡ä»¶ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š

**é‡åšæ—¥å¿—ç¼“å†²ï¼ˆredo logbufferï¼‰ä»¥åŠé‡åšæ—¥å¿—æ–‡ä»¶ï¼ˆredo logï¼‰**,**å‰è€…æ˜¯åœ¨å†…å­˜ä¸­ï¼Œåè€…åœ¨ç£ç›˜ä¸­**ã€‚

å½“äº‹åŠ¡æäº¤ä¹‹åä¼šæŠŠæ‰€æœ‰ä¿®æ”¹ä¿¡æ¯éƒ½ä¼šå­˜åˆ°è¯¥æ—¥å¿—ä¸­, **==ç”¨äºåœ¨åˆ·æ–°è„é¡µåˆ°ç£ç›˜æ—¶,å‘ç”Ÿé”™è¯¯æ—¶, è¿›è¡Œæ•°æ®æ¢å¤ä½¿ç”¨==**ï¼Œè¿›è€Œä¿è¯äº‹åŠ¡çš„æŒä¹…æ€§ã€‚

ä»¥**å¾ªç¯æ–¹å¼å†™å…¥é‡åšæ—¥å¿—æ–‡ä»¶**ï¼Œæ¶‰åŠä¸¤ä¸ªæ–‡ä»¶ï¼š

![image-20250419211525205](./Mysql-Learning-Local.assets/image-20250419211525205.png)

å‰é¢æˆ‘ä»¬ä»‹ç»äº†InnoDBçš„å†…å­˜ç»“æ„ï¼Œä»¥åŠç£ç›˜ç»“æ„ï¼Œé‚£ä¹ˆ**å†…å­˜ä¸­æˆ‘ä»¬æ‰€æ›´æ–°çš„æ•°æ®ï¼Œåˆæ˜¯å¦‚ä½•åˆ°ç£ç›˜ä¸­çš„å‘¢ï¼Ÿ** æ­¤æ—¶ï¼Œå°±æ¶‰åŠåˆ°ä¸€ç»„åå°çº¿ç¨‹ï¼Œæ¥ä¸‹æ¥ï¼Œå°±æ¥ä»‹ç»ä¸€äº›InnoDBä¸­æ¶‰åŠåˆ°çš„åå°çº¿ç¨‹ã€‚

![image-20250419211829731](./Mysql-Learning-Local.assets/image-20250419211829731.png)



### ï¼ˆ4ï¼‰åå°çº¿ç¨‹

åœ¨InnoDBçš„åå°çº¿ç¨‹ä¸­ï¼Œåˆ†ä¸º4ç±»ï¼Œ

åˆ†åˆ«æ˜¯ï¼šMaster Thread ã€IO Threadã€Purge Threadã€Page Cleaner Threadã€‚

![image-20250419212353191](./Mysql-Learning-Local.assets/image-20250419212353191.png)

#### â‘ Master Thread

**æ ¸å¿ƒåå°çº¿ç¨‹**ï¼Œè´Ÿè´£è°ƒåº¦å…¶ä»–çº¿ç¨‹ï¼Œè¿˜è´Ÿè´£å°†ç¼“å†²æ± ä¸­çš„æ•°æ®å¼‚æ­¥åˆ·æ–°åˆ°ç£ç›˜ä¸­, ä¿æŒæ•°æ®çš„ä¸€è‡´æ€§ï¼Œè¿˜åŒ…æ‹¬è„é¡µçš„åˆ·æ–°ã€åˆå¹¶æ’å…¥ç¼“å­˜ã€undoé¡µçš„å›æ”¶ ã€‚

  

#### â‘¡IO Thread

åœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­å¤§é‡ä½¿ç”¨äº†**AIOï¼ˆå¼‚æ­¥éé˜»å¡IOï¼‰**æ¥å¤„ç†IOè¯·æ±‚, è¿™æ ·å¯ä»¥æå¤§åœ°**æé«˜æ•°æ®åº“çš„æ€§èƒ½**ï¼Œè€ŒIOThreadä¸»è¦è´Ÿè´£è¿™äº›IOè¯·æ±‚çš„å›è°ƒã€‚

![image-20250419194605485](./Mysql-Learning-Local.assets/image-20250419194605485.png)

æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹çš„è¿™æ¡æŒ‡ä»¤ï¼ŒæŸ¥çœ‹åˆ°InnoDBçš„çŠ¶æ€ä¿¡æ¯ï¼Œå…¶ä¸­å°±åŒ…å«IO Threadä¿¡æ¯ã€‚

```sql
show engine innodb status \G;
```

![image-20250419212612210](./Mysql-Learning-Local.assets/image-20250419212612210.png)



#### â‘¢Purge Thread

ä¸»è¦ç”¨äºå›æ”¶äº‹åŠ¡å·²ç»æäº¤äº†çš„**undo logï¼ˆæ’¤é”€æ—¥å¿—ï¼‰**ï¼Œåœ¨äº‹åŠ¡æäº¤ä¹‹åï¼Œundo logå¯èƒ½ä¸ç”¨äº†ï¼Œå°±ç”¨Purge Threadæ¥å›æ”¶ã€‚



#### â‘£Page Cleaner Thread

**ååŠ© Master Thread åˆ·æ–°è„é¡µåˆ°ç£ç›˜çš„çº¿ç¨‹**ï¼Œå®ƒå¯ä»¥å‡è½» Master Thread çš„å·¥ä½œå‹åŠ›ï¼Œ**å‡å°‘é˜»å¡**ã€‚



![image-20250419212711051](./Mysql-Learning-Local.assets/image-20250419212711051.png)



## 6.3 ğŸš€ ==äº‹åŠ¡ç®¡ç†==

### ï¼ˆ1ï¼‰äº‹åŠ¡åŸºç¡€

![image-20250419213023879](./Mysql-Learning-Local.assets/image-20250419213023879.png)

#### â‘ äº‹åŠ¡

äº‹åŠ¡ æ˜¯**ä¸€ç»„æ“ä½œçš„é›†åˆï¼Œå®ƒæ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½**ã€‚

äº‹åŠ¡ä¼šæŠŠæ‰€æœ‰çš„æ“ä½œä½œä¸ºä¸€ä¸ªæ•´ä½“ä¸€èµ·å‘ç³»ç»Ÿæäº¤æˆ–æ’¤é”€æ“ä½œè¯·æ±‚ï¼Œå³è¿™äº›æ“ä½œ**è¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥**ã€‚



#### â‘¡ç‰¹æ€§

![image-20250419213126572](./Mysql-Learning-Local.assets/image-20250419213126572.png)

- åŸå­æ€§ï¼ˆAtomicityï¼‰ï¼šäº‹åŠ¡æ˜¯ä¸å¯åˆ†å‰²çš„æœ€å°æ“ä½œå•å…ƒï¼Œ**è¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥**ã€‚
- ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ï¼šäº‹åŠ¡å®Œæˆæ—¶ï¼Œå¿…é¡»ä½¿**æ‰€æœ‰çš„æ•°æ®éƒ½ä¿æŒä¸€è‡´çŠ¶æ€**ã€‚
- éš”ç¦»æ€§ï¼ˆIsolationï¼‰ï¼šæ•°æ®åº“ç³»ç»Ÿæä¾›çš„éš”ç¦»æœºåˆ¶ï¼Œ**ä¿è¯äº‹åŠ¡åœ¨ä¸å—å¤–éƒ¨å¹¶å‘æ“ä½œå½±å“çš„ç‹¬ç«‹ç¯å¢ƒä¸‹è¿è¡Œã€‚** = ã€‹å¯¹åº”**å››ç§éš”ç¦»çº§åˆ«ï¼šè¯»æœªæäº¤ï¼Œè¯»å·²æäº¤ï¼Œå¯é‡å¤è¯»(é»˜è®¤)ï¼Œä¸²è¡ŒåŒ–**
- æŒä¹…æ€§ï¼ˆDurabilityï¼‰ï¼šäº‹åŠ¡ä¸€æ—¦æäº¤æˆ–å›æ»šï¼Œå®ƒå¯¹æ•°æ®åº“ä¸­çš„æ•°æ®çš„**æ”¹å˜å°±æ˜¯æ°¸ä¹…çš„**ã€‚



é‚£å®é™…ä¸Šï¼Œæˆ‘ä»¬ç ”ç©¶äº‹åŠ¡çš„åŸç†ï¼Œå°±æ˜¯ç ”ç©¶MySQLçš„InnoDBå¼•æ“æ˜¯**å¦‚ä½•ä¿è¯äº‹åŠ¡çš„è¿™å››å¤§ç‰¹æ€§çš„**ã€‚



è€Œå¯¹äºè¿™å››å¤§ç‰¹æ€§ï¼Œå®é™…ä¸Šåˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ã€‚

-  å…¶ä¸­çš„**åŸå­æ€§ã€ä¸€è‡´æ€§ã€æŒä¹…åŒ–**ï¼Œå®é™…ä¸Šæ˜¯ç”±InnoDBä¸­çš„ä¸¤ä»½æ—¥å¿—æ¥ä¿è¯çš„ï¼Œ
  - ä¸€ä»½æ˜¯**redo logæ—¥å¿—ï¼Œä¸€ä»½æ˜¯undo logæ—¥å¿—**ã€‚ 
-  è€Œ**æŒä¹…æ€§æ˜¯é€šè¿‡æ•°æ®åº“çš„==é”==ï¼ŒåŠ ä¸Š==MVCC==æ¥ä¿è¯çš„**ã€‚

![image-20250419213159055](./Mysql-Learning-Local.assets/image-20250419213159055.png)



æˆ‘ä»¬åœ¨è®²è§£äº‹åŠ¡åŸç†çš„æ—¶å€™ï¼Œä¸»è¦å°±æ˜¯æ¥ç ”ç©¶ä¸€ä¸‹redologï¼Œundologä»¥åŠMVCCã€‚



### ï¼ˆ2ï¼‰ğŸš€ redo log

![image-20250419214618137](./Mysql-Learning-Local.assets/image-20250419214618137.png)

#### â‘ æ¦‚å¿µ

**é‡åšæ—¥å¿—ï¼Œè®°å½•çš„æ˜¯äº‹åŠ¡æäº¤æ—¶æ•°æ®é¡µçš„ç‰©ç†ä¿®æ”¹**ï¼Œæ˜¯ç”¨æ¥å®ç°**äº‹åŠ¡çš„æŒä¹…æ€§**ã€‚

è¯¥æ—¥å¿—æ–‡ä»¶ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š

é‡åšæ—¥å¿—ç¼“å†²ï¼ˆredo log bufferï¼‰ä»¥åŠé‡åšæ—¥å¿—æ–‡ä»¶ï¼ˆredo logfileï¼‰,å‰è€…æ˜¯åœ¨å†…å­˜ä¸­ï¼Œåè€…åœ¨ç£ç›˜ä¸­ã€‚

å½“**äº‹åŠ¡æäº¤ä¹‹åä¼šæŠŠæ‰€æœ‰ä¿®æ”¹ä¿¡æ¯éƒ½å­˜åˆ°è¯¥æ—¥å¿—æ–‡ä»¶ï¼ˆredo logfileï¼‰ä¸­**,

- **==ç”¨äºåœ¨åˆ·æ–°è„é¡µåˆ°ç£ç›˜,å‘ç”Ÿé”™è¯¯æ—¶, è¿›è¡Œæ•°æ®æ¢å¤ä½¿ç”¨==**ï¼Œç›¸å½“äº==åœ¨ç£ç›˜ä¸­å¤šæ·»åŠ äº†ä¸€ä¸ªå‰¯æœ¬==ã€‚



#### â‘¡æœªä½¿ç”¨redo logæ—¶

**å¦‚æœæ²¡æœ‰redolog**ï¼Œå¯èƒ½ä¼šå­˜åœ¨ä»€ä¹ˆé—®é¢˜çš„ï¼Ÿ æˆ‘ä»¬ä¸€èµ·æ¥åˆ†æä¸€ä¸‹ã€‚

![image-20250419213704596](./Mysql-Learning-Local.assets/image-20250419213704596.png)

æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨InnoDBå¼•æ“ä¸­çš„å†…å­˜ç»“æ„ä¸­ï¼Œä¸»è¦çš„**å†…å­˜åŒºåŸŸå°±æ˜¯ç¼“å†²æ± **ï¼Œåœ¨ç¼“å†²æ± ä¸­ç¼“å­˜äº†å¾ˆå¤šçš„æ•°æ®é¡µã€‚ å½“æˆ‘ä»¬åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œæ‰§è¡Œå¤šä¸ªå¢åˆ æ”¹çš„æ“ä½œæ—¶ï¼ŒInnoDBå¼•æ“ä¼šå…ˆæ“ä½œç¼“å†²æ± ä¸­çš„æ•°æ®ï¼Œå¦‚æœç¼“å†²åŒºæ²¡æœ‰å¯¹åº”çš„æ•°æ®ï¼Œä¼šé€šè¿‡åå°çº¿ç¨‹å°†ç£ç›˜ä¸­çš„æ•°æ®åŠ è½½å‡ºæ¥ï¼Œå­˜æ”¾åœ¨ç¼“å†²åŒºä¸­ï¼Œç„¶åå°†ç¼“å†²æ± ä¸­çš„æ•°æ®ä¿®æ”¹ï¼Œä¿®æ”¹åçš„æ•°æ®é¡µæˆ‘ä»¬ç§°ä¸ºè„é¡µã€‚ **è€Œè„é¡µåˆ™ä¼šåœ¨ä¸€å®šçš„æ—¶æœºï¼Œé€šè¿‡åå°çº¿ç¨‹åˆ·æ–°åˆ°ç£ç›˜ä¸­**ï¼Œä»è€Œä¿è¯ç¼“å†²åŒºä¸ç£ç›˜çš„æ•°æ®ä¸€è‡´ã€‚ è€Œç¼“å†²åŒºçš„**è„é¡µæ•°æ®å¹¶ä¸æ˜¯å®æ—¶åˆ·æ–°çš„**ï¼Œè€Œæ˜¯ä¸€æ®µæ—¶é—´ä¹‹åå°†ç¼“å†²åŒºçš„æ•°æ®åˆ·æ–°åˆ°ç£ç›˜ä¸­ï¼Œ**==å‡å¦‚åˆ·æ–°åˆ°ç£ç›˜çš„è¿‡ç¨‹å‡ºé”™äº†==**ï¼Œè€Œ**æç¤ºç»™ç”¨æˆ·äº‹åŠ¡æäº¤æˆåŠŸï¼Œè€Œæ•°æ®å´æ²¡æœ‰æŒä¹…åŒ–ä¸‹æ¥**ï¼Œè¿™å°±å‡ºç°é—®é¢˜äº†ï¼Œ**æ²¡æœ‰ä¿è¯äº‹åŠ¡çš„æŒä¹…æ€§ã€‚**



#### â‘¢ä½¿ç”¨redo log

é‚£ä¹ˆï¼Œå¦‚ä½•è§£å†³ä¸Šè¿°çš„é—®é¢˜å‘¢ï¼Ÿ åœ¨InnoDBä¸­æä¾›äº†ä¸€ä»½**æ—¥å¿— redo log**ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å†æ¥åˆ†æä¸€ä¸‹ï¼Œé€šè¿‡redologå¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

![image-20250419213955467](./Mysql-Learning-Local.assets/image-20250419213955467.png)

æœ‰äº†redologä¹‹åï¼Œå½“å¯¹ç¼“å†²åŒºçš„æ•°æ®è¿›è¡Œå¢åˆ æ”¹ä¹‹åï¼Œ**ä¼šé¦–å…ˆ==å°†æ“ä½œçš„æ•°æ®é¡µçš„å˜åŒ–ï¼Œè®°å½•åœ¨redolog bufferä¸­==ã€‚**åœ¨äº‹åŠ¡æäº¤æ—¶ï¼Œ**ä¼šå°†redo log bufferä¸­çš„æ•°æ®åˆ·æ–°åˆ°redo logç£ç›˜æ–‡ä»¶ä¸­**ã€‚è¿‡ä¸€æ®µæ—¶é—´ä¹‹åï¼Œå¦‚æœåˆ·æ–°ç¼“å†²åŒºçš„**è„é¡µåˆ°ç£ç›˜æ—¶ï¼Œå‘ç”Ÿé”™è¯¯**ï¼Œæ­¤æ—¶å°±å¯ä»¥**å€ŸåŠ©äºredo logè¿›è¡Œæ•°æ®æ¢å¤ï¼Œè¿™æ ·å°±ä¿è¯äº†äº‹åŠ¡çš„æŒä¹…æ€§**ã€‚ è€Œ**å¦‚æœè„é¡µæˆåŠŸåˆ·æ–°åˆ°ç£ç›˜** æˆ– æˆ–è€…æ¶‰åŠåˆ°çš„æ•°æ®å·²ç»è½ç›˜ï¼Œæ­¤æ—¶**redologå°±æ²¡æœ‰ä½œç”¨äº†ï¼Œå°±å¯ä»¥åˆ é™¤äº†**ï¼Œæ‰€ä»¥å­˜åœ¨çš„ä¸¤ä¸ªredologæ–‡ä»¶æ˜¯**å¾ªç¯å†™çš„**ï¼Œä¸ä¼šæ°¸ä¹…çš„ä¿å­˜ã€‚



> é‚£ä¸ºä»€ä¹ˆ**æ¯ä¸€æ¬¡æäº¤äº‹åŠ¡ï¼Œè¦åˆ·æ–°redo log åˆ°ç£ç›˜ä¸­**å‘¢ï¼Œè€Œ**ä¸æ˜¯ç›´æ¥å°†**buffer poolä¸­çš„==è„é¡µåˆ·æ–°åˆ°ç£ç›˜å‘¢==?
>
> å› ä¸ºåœ¨ä¸šåŠ¡æ“ä½œä¸­ï¼Œæˆ‘ä»¬**æ“ä½œæ•°æ®å¯èƒ½æœ‰å¤šæ¡ï¼Œå¹¶ä¸”ä¸€èˆ¬éƒ½æ˜¯éšæœºè¯»å†™ç£ç›˜çš„**ï¼Œè€Œä¸æ˜¯é¡ºåºè¯»å†™ç£ç›˜ã€‚ è€Œredo logåœ¨å¾€ç£ç›˜æ–‡ä»¶ä¸­å†™å…¥æ•°æ®ï¼Œ**==ç”±äºæ˜¯æ—¥å¿—æ–‡ä»¶ï¼Œä»¥è¿½åŠ çš„æ–¹å¼è¿›è¡Œæ·»åŠ ï¼Œæ‰€ä»¥éƒ½æ˜¯é¡ºåºå†™çš„==**ã€‚**é¡ºåºå†™çš„æ•ˆç‡ï¼Œè¦è¿œå¤§äºéšæœºå†™**ã€‚ è¿™ç§å…ˆå†™æ—¥å¿—çš„æ–¹å¼ï¼Œç§°ä¹‹ä¸º **WALï¼ˆWrite-Ahead Loggingï¼‰**ã€‚



### ï¼ˆ3ï¼‰ğŸš€ undo log

![image-20250419214942366](./Mysql-Learning-Local.assets/image-20250419214942366.png)

å›æ»šæ—¥å¿—ï¼Œç”¨äº**==è®°å½•æ•°æ®è¢«ä¿®æ”¹å‰çš„ä¿¡æ¯==** , ä½œç”¨åŒ…å«ä¸¤ä¸ª : 

**æä¾›å›æ»š(ä¿è¯äº‹åŠ¡çš„åŸå­æ€§) å’ŒMVCC(å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶) **



undo logå’Œredo logè®°å½•ç‰©ç†æ—¥å¿—ä¸ä¸€æ ·ï¼Œ**å®ƒæ˜¯==é€»è¾‘æ—¥å¿—==**ã€‚

å¯ä»¥è®¤ä¸ºå½“**deleteä¸€æ¡è®°å½•**æ—¶ï¼Œundologä¸­ä¼š**è®°å½•ä¸€æ¡å¯¹åº”çš„insertè®°å½•**ï¼Œ

åä¹‹äº¦ç„¶ï¼Œå½“updateä¸€æ¡è®°å½•æ—¶ï¼Œå®ƒ**==è®°å½•ä¸€æ¡å¯¹åº”ç›¸åçš„==updateè®°å½•**ã€‚

**å½“æ‰§è¡Œrollbackæ—¶ï¼Œå°±å¯ä»¥ä»undo logä¸­çš„é€»è¾‘è®°å½•è¯»å–åˆ°ç›¸åº”çš„å†…å®¹å¹¶è¿›è¡Œå›æ»šã€‚**



- Undo logé”€æ¯ï¼šundo logåœ¨äº‹åŠ¡æ‰§è¡Œæ—¶äº§ç”Ÿï¼Œ**äº‹åŠ¡æäº¤æ—¶ï¼Œå¹¶ä¸ä¼šç«‹å³åˆ é™¤undo logï¼Œå› ä¸ºè¿™äº›æ—¥å¿—å¯èƒ½è¿˜ç”¨äº==MVCC==ã€‚**

- Undo logå­˜å‚¨ï¼šundo logé‡‡ç”¨**æ®µçš„æ–¹å¼è¿›è¡Œç®¡ç†å’Œè®°å½•**ï¼Œ**å­˜æ”¾åœ¨å‰é¢ä»‹ç»çš„ rollback segmentå›æ»šæ®µ**ä¸­ï¼Œå†…éƒ¨åŒ…å«1024ä¸ªundo log segmentã€‚




## 6.4 ğŸš€ ==MVCC==

### ï¼ˆ1ï¼‰ğŸš€ ==åŸºæœ¬æ¦‚å¿µ==

![image-20250419221109619](./Mysql-Learning-Local.assets/image-20250419221109619.png)



#### â‘ ==å½“å‰è¯»==

**è¯»å–çš„æ˜¯è®°å½•çš„æœ€æ–°ç‰ˆæœ¬**ï¼Œè¯»å–æ—¶è¿˜è¦**ä¿è¯å…¶ä»–å¹¶å‘äº‹åŠ¡ä¸èƒ½ä¿®æ”¹å½“å‰è®°å½•ï¼Œä¼š==å¯¹è¯»å–çš„è®°å½•è¿›è¡ŒåŠ é”==**ã€‚å¯¹äºæˆ‘ä»¬æ—¥å¸¸çš„æ“ä½œï¼Œå¦‚ï¼š

- select ... lock in share mode(å…±äº«é”)
- select ...for updateï¼ˆæ’ä»–é”ï¼‰
- updateã€insertã€deleteï¼ˆæ’ä»–é”ï¼‰éƒ½æ˜¯ä¸€ç§å½“å‰è¯»ã€‚



##### æµ‹è¯•

**å®¢æˆ·ç«¯ä¸€**

```sql
begin;
	select * from stu;
	
-- å½“å‰è¯» ï¼Œå³ä½¿åœ¨å½“å‰äº‹åŠ¡å†…ï¼Œæœªæäº¤çš„æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥è·å–åˆ°æœ€æ–°æ•°æ® (å‰ææ˜¯å®¢æˆ·ç«¯äºŒçš„äº‹åŠ¡éœ€è¦å…ˆcommit)
	select * from stu lock in share mode;
commit;
```

**å®¢æˆ·ç«¯äºŒï¼Œä¹Ÿå¼€å¯äº‹åŠ¡ï¼Œä¿®æ”¹stuè¡¨ä¸­çš„å†…å®¹**ï¼ŒæŒ‰ç…§Mysqlçš„éš”ç¦»çº§åˆ«-å¯é‡å¤è¯»RRï¼Œå®¢æˆ·ç«¯ä¸€ ç›´æ¥æŸ¥è¯¢æ˜¯çœ‹ä¸åˆ°æœ€æ–°çš„æ•°æ®çš„(å®¢æˆ·ç«¯äºŒåˆšä¿®æ”¹çš„)ï¼Œå› ä¸ºéœ€è¦æ»¡è¶³å¯é‡å¤çš„çš„éš”ç¦»çº§åˆ«ï¼Œä½†æ˜¯é€šè¿‡åœ¨æŸ¥è¯¢è¯­å¥åé¢åŠ ä¸Šäº† **lock in share mode å…±äº«é”** (å‰ææ˜¯å®¢æˆ·ç«¯äºŒçš„äº‹åŠ¡**éœ€è¦å…ˆcommit**)ï¼Œæ­¤æ—¶æ˜¯å½“å‰è¯»æ“ä½œï¼Œå°±å¯ä»¥è¯»å–æœ€æ–°çš„ä¿®æ”¹åçš„æ•°æ®ã€‚

```sql
-- å®¢æˆ·ç«¯äºŒ
begin;
	update stu set name = 'JSP' where id = 1;
commit;
```

<img src="./Mysql-Learning-Local.assets/image-20250419220221367.png" alt="image-20250419220221367" style="zoom:80%;" />

<img src="./Mysql-Learning-Local.assets/image-20250419220629880.png" alt="image-20250419220629880" style="zoom: 80%;" />



åœ¨æµ‹è¯•ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ**å³ä½¿æ˜¯åœ¨é»˜è®¤çš„RRéš”ç¦»çº§åˆ«ï¼ˆå¯é‡å¤è¯»ï¼‰ä¸‹**ï¼Œ**äº‹åŠ¡Aä¸­ä¾ç„¶å¯ä»¥è¯»å–åˆ°äº‹åŠ¡Bæœ€æ–°æäº¤çš„å†…å®¹**ï¼Œå› ä¸ºåœ¨æŸ¥è¯¢è¯­å¥åé¢åŠ ä¸Šäº† **lock in share mode å…±äº«é”**ï¼Œæ­¤æ—¶æ˜¯å½“å‰è¯»æ“ä½œã€‚å½“ç„¶ï¼Œå½“æˆ‘ä»¬åŠ æ’ä»–é”çš„æ—¶å€™ï¼Œä¹Ÿæ˜¯**==å½“å‰è¯»æ“ä½œ==**ã€‚



#### â‘¡==å¿«ç…§è¯»==

**ç®€å•çš„selectï¼ˆ==ä¸åŠ é”==ï¼‰å°±æ˜¯å¿«ç…§è¯»**ï¼Œå¿«ç…§è¯»ï¼Œ**è¯»å–çš„æ˜¯è®°å½•æ•°æ®çš„å¯è§ç‰ˆæœ¬**ï¼Œ**æœ‰å¯èƒ½æ˜¯å†å²æ•°æ®ï¼Œä¸åŠ é”ï¼Œæ˜¯éé˜»å¡è¯»ã€‚**

å¿«ç…§è¯»è§£å†³äº†ä¸å¯é‡å¤è¯»çš„é—®é¢˜ï¼Œ**å³ä½¿æ•°æ®ä¿®æ”¹äº†ï¼Œé€šè¿‡å¿«ç…§è¯»ä¸¤æ¬¡è¯»å–ç»“æœä¸€è‡´**ï¼Œ**ä½†æ˜¯å‡ºç°äº†å¹»è¯»**



**ä¸‰ç§==ä¸åŒéš”ç¦»çº§åˆ«==ä¸‹çš„å¿«ç…§è¯»**

- Read Committedï¼šæ¯æ¬¡selectï¼Œéƒ½ç”Ÿæˆä¸€ä¸ªå¿«ç…§è¯»ã€‚
- **Repeatable Read**ï¼šå¼€å¯äº‹åŠ¡å**ç¬¬ä¸€ä¸ªselectè¯­å¥æ‰æ˜¯å¿«ç…§è¯»çš„åœ°æ–¹**ã€‚
  - åé¢æ‰§è¡Œç›¸åŒçš„selectè¯­å¥éƒ½æ˜¯**ä»å¿«ç…§ä¸­è·å–æ•°æ®ï¼Œå¯èƒ½ä¸æ˜¯å½“å‰çš„æœ€æ–°æ•°æ®**ï¼Œè¿™æ ·ä¹Ÿå°±==ä¿è¯äº†å¯é‡å¤è¯»==

- Serializableï¼š**å¿«ç…§è¯»ä¼šé€€åŒ–ä¸ºå½“å‰è¯»**ã€‚



æµ‹è¯•ï¼š

<img src="./Mysql-Learning-Local.assets/image-20250419221225061.png" alt="image-20250419221225061" style="zoom:67%;" />

åœ¨æµ‹è¯•ä¸­,æˆ‘ä»¬çœ‹åˆ°å³ä½¿**äº‹åŠ¡Bæäº¤äº†æ•°æ®,äº‹åŠ¡Aä¸­ä¹ŸæŸ¥è¯¢ä¸åˆ°**ã€‚ åŸå› å°±æ˜¯å› ä¸º**æ™®é€šçš„selectæ˜¯å¿«ç…§è¯»**ï¼Œè€Œåœ¨å½“å‰é»˜è®¤çš„RRéš”ç¦»çº§åˆ«ä¸‹ï¼Œå¼€å¯äº‹åŠ¡åç¬¬ä¸€ä¸ªselectè¯­å¥æ‰æ˜¯å¿«ç…§è¯»çš„åœ°æ–¹ï¼Œ**åé¢æ‰§è¡Œç›¸åŒçš„selectè¯­å¥éƒ½æ˜¯ä»å¿«ç…§ä¸­è·å–æ•°æ®ï¼Œå¯èƒ½ä¸æ˜¯å½“å‰çš„æœ€æ–°æ•°æ®ï¼Œè¿™æ ·ä¹Ÿå°±ä¿è¯äº†å¯é‡å¤è¯»**ã€‚



#### â‘¢MVCC

å…¨ç§° **Multi-Version Concurrency Control**ï¼Œ==å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶==ã€‚

**æŒ‡ç»´æŠ¤ä¸€ä¸ªæ•°æ®çš„å¤šä¸ªç‰ˆæœ¬**ï¼Œä½¿å¾—è¯»å†™æ“ä½œæ²¡æœ‰å†²çªï¼Œ**å¿«ç…§è¯»**ä¸ºMySQLå®ç°MVCCæä¾›äº†ä¸€ä¸ª**éé˜»å¡è¯»åŠŸèƒ½**ã€‚

MVCCçš„å…·ä½“å®ç°ï¼Œè¿˜éœ€è¦ä¾èµ–äº**æ•°æ®åº“è®°å½•ä¸­çš„ä¸‰ä¸ªéšå¼å­—æ®µã€undo logæ—¥å¿—ã€readView**ã€‚



æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†æ¥ä»‹ç»ä¸€ä¸‹InnoDBå¼•æ“çš„è¡¨ä¸­æ¶‰åŠåˆ°çš„éšè—å­—æ®µ ã€undolog ä»¥åŠ readviewï¼Œä»è€Œæ¥ä»‹ç»ä¸€ä¸‹MVCCçš„åŸç†ã€‚



### ï¼ˆ2ï¼‰éšè—å­—æ®µ

#### â‘ ä»‹ç»

![image-20250419221634176](./Mysql-Learning-Local.assets/image-20250419221634176.png)

å½“æˆ‘ä»¬åˆ›å»ºäº†ä¸Šé¢çš„è¿™å¼ è¡¨ï¼Œæˆ‘ä»¬åœ¨æŸ¥çœ‹è¡¨ç»“æ„çš„æ—¶å€™ï¼Œå°±å¯ä»¥æ˜¾å¼çš„çœ‹åˆ°è¿™ä¸‰ä¸ªå­—æ®µã€‚ å®é™…ä¸Šé™¤äº†è¿™ä¸‰ä¸ªå­—æ®µä»¥å¤–ï¼ŒInnoDBè¿˜ä¼šè‡ªåŠ¨çš„ç»™æˆ‘ä»¬æ·»åŠ ä¸‰ä¸ªéšè—å­—æ®µåŠå…¶å«ä¹‰åˆ†åˆ«æ˜¯ï¼š

![image-20250419195316088](./Mysql-Learning-Local.assets/image-20250419195316088.png)

è€Œä¸Šè¿°çš„å‰ä¸¤ä¸ªå­—æ®µæ˜¯è‚¯å®šä¼šæ·»åŠ çš„ï¼Œ æ˜¯å¦æ·»åŠ æœ€åä¸€ä¸ªå­—æ®µ**DB_ROW_IDï¼Œå¾—çœ‹å½“å‰è¡¨æœ‰æ²¡æœ‰ä¸»é”®ï¼Œå¦‚æœæœ‰ä¸»é”®ï¼Œåˆ™ä¸ä¼šæ·»åŠ è¯¥éšè—å­—æ®µã€‚**



#### â‘¡æµ‹è¯•

##### 1). æŸ¥çœ‹æœ‰ä¸»é”®çš„è¡¨ stu

è¿›å…¥æœåŠ¡å™¨ä¸­çš„ /var/lib/mysql/itcast/ , æŸ¥çœ‹stuçš„è¡¨ç»“æ„ä¿¡æ¯, é€šè¿‡å¦‚ä¸‹æŒ‡ä»¤:

```bash
# ä½¿ç”¨idb2sdi å‘½ä»¤æŸ¥çœ‹è¡¨ç©ºé—´æ–‡ä»¶ä¿¡æ¯
ibd2sdi stu.ibd
```

æŸ¥çœ‹åˆ°çš„è¡¨ç»“æ„ä¿¡æ¯ä¸­ï¼Œ**æœ‰ä¸€æ  columns**ï¼Œåœ¨å…¶ä¸­æˆ‘ä»¬ä¼šçœ‹åˆ°å¤„ç†æˆ‘ä»¬å»ºè¡¨æ—¶æŒ‡å®šçš„å­—æ®µä»¥å¤–ï¼Œè¿˜æœ‰é¢å¤–çš„ä¸¤ä¸ªå­—æ®µ åˆ†åˆ«æ˜¯ï¼šDB_TRX_ID ã€ DB_ROLL_PTR ï¼Œ**å› ä¸ºè¯¥è¡¨æœ‰ä¸»é”®ï¼Œæ‰€ä»¥æ²¡æœ‰DB_ROW_IDéšè—å­—æ®µ**ã€‚

<img src="./Mysql-Learning-Local.assets/image-20250419221829755.png" alt="image-20250419221829755" style="zoom: 67%;" />

<img src="./Mysql-Learning-Local.assets/image-20250419221848819.png" alt="image-20250419221848819" style="zoom: 80%;" />



##### 2). æŸ¥çœ‹æ²¡æœ‰ä¸»é”®çš„è¡¨ employee

å»ºè¡¨è¯­å¥ï¼š

```sql
create table employee (id int , name varchar(10)); 
```

æ­¤æ—¶ï¼Œæˆ‘ä»¬å†é€šè¿‡ä»¥ä¸‹æŒ‡ä»¤æ¥æŸ¥çœ‹è¡¨ç»“æ„åŠå…¶å…¶ä¸­çš„å­—æ®µä¿¡æ¯ï¼š

```sql
ibd2sdi employee.ibd 
```

æŸ¥çœ‹åˆ°çš„è¡¨ç»“æ„ä¿¡æ¯ä¸­ï¼Œæœ‰ä¸€æ  columnsï¼Œåœ¨å…¶ä¸­æˆ‘ä»¬ä¼šçœ‹åˆ°å¤„ç†æˆ‘ä»¬å»ºè¡¨æ—¶æŒ‡å®šçš„å­—æ®µä»¥å¤–ï¼Œè¿˜æœ‰é¢å¤–çš„ä¸‰ä¸ªå­—æ®µ åˆ†åˆ«æ˜¯ï¼šDB_TRX_ID ã€ DB_ROLL_PTR ã€DB_ROW_IDï¼Œ**å› ä¸ºemployeeè¡¨æ˜¯æ²¡æœ‰æŒ‡å®šä¸»é”®çš„**ã€‚

<img src="./Mysql-Learning-Local.assets/image-20250419222230464.png" alt="image-20250419222230464" style="zoom:67%;" />



### ï¼ˆ3ï¼‰ğŸš€ ==undo log==

#### â‘ ä»‹ç»

å›æ»šæ—¥å¿—ï¼Œåœ¨insertã€updateã€deleteçš„æ—¶å€™äº§ç”Ÿçš„ä¾¿äºæ•°æ®å›æ»šçš„æ—¥å¿—ã€‚

- **å½“insert**çš„æ—¶å€™ï¼Œäº§ç”Ÿçš„undo logæ—¥å¿—**åªåœ¨å›æ»šæ—¶éœ€è¦ï¼Œåœ¨äº‹åŠ¡æäº¤åï¼Œå¯è¢«ç«‹å³åˆ é™¤**ã€‚
- è€Œ**updateã€delete**çš„æ—¶å€™ï¼Œäº§ç”Ÿçš„undo logæ—¥å¿—**==ä¸ä»…åœ¨å›æ»šæ—¶éœ€è¦==**ï¼Œ**==åœ¨å¿«ç…§è¯»æ—¶ä¹Ÿéœ€è¦==ï¼Œä¸ä¼šç«‹å³è¢«åˆ é™¤ã€‚**



#### â‘¡ğŸš€ç‰ˆæœ¬é“¾

æœ‰ä¸€å¼ è¡¨**åŸå§‹æ•°æ®**ä¸ºï¼š

![image-20250419222449579](./Mysql-Learning-Local.assets/image-20250419222449579.png)



> DB_TRX_ID : ä»£è¡¨**æœ€è¿‘ä¿®æ”¹äº‹åŠ¡ID**ï¼Œè®°å½•æ’å…¥è¿™æ¡è®°å½•æˆ–æœ€åä¸€æ¬¡ä¿®æ”¹è¯¥è®°å½•çš„äº‹åŠ¡IDï¼Œæ˜¯è‡ªå¢çš„ã€‚
>
> DB_ROLL_PTR ï¼š è¡¨ç¤º**å›æ»šæŒ‡é’ˆ**ï¼Œç”±äº**è¿™æ¡æ•°æ®æ˜¯æ‰æ’å…¥çš„ï¼Œæ²¡æœ‰è¢«æ›´æ–°è¿‡ï¼Œæ‰€ä»¥è¯¥å­—æ®µå€¼ä¸ºnull**ã€‚



ç„¶åï¼Œæœ‰**å››ä¸ªå¹¶å‘äº‹åŠ¡åŒæ—¶åœ¨è®¿é—®è¿™å¼ è¡¨**ã€‚

![image-20250419223133785](./Mysql-Learning-Local.assets/image-20250419223133785.png)

##### A. ç¬¬ä¸€æ­¥

![image-20250419222630818](./Mysql-Learning-Local.assets/image-20250419222630818.png)

å½“**äº‹åŠ¡2æ‰§è¡Œç¬¬ä¸€æ¡ä¿®æ”¹è¯­å¥æ—¶ï¼Œä¼šè®°å½•undo logæ—¥å¿—**ï¼Œè®°å½•æ•°æ®å˜æ›´ä¹‹å‰çš„æ ·å­; ç„¶åæ›´æ–°è®°å½•ï¼Œå¹¶ä¸”è®°å½•æœ¬æ¬¡æ“ä½œçš„äº‹åŠ¡IDï¼Œå›æ»šæŒ‡é’ˆï¼Œå›æ»šæŒ‡é’ˆç”¨æ¥æŒ‡å®šå¦‚æœå‘ç”Ÿå›æ»šï¼Œå›æ»šåˆ°å“ªä¸€ä¸ªç‰ˆæœ¬ã€‚

![image-20250419222641261](./Mysql-Learning-Local.assets/image-20250419222641261.png)



##### B.ç¬¬äºŒæ­¥

![image-20250419222647748](./Mysql-Learning-Local.assets/image-20250419222647748.png)

å½“äº‹åŠ¡3æ‰§è¡Œç¬¬ä¸€æ¡ä¿®æ”¹è¯­å¥æ—¶ï¼Œä¹Ÿä¼šè®°å½•undo logæ—¥å¿—ï¼Œè®°å½•æ•°æ®å˜æ›´ä¹‹å‰çš„æ ·å­; ç„¶åæ›´æ–°è®°å½•ï¼Œå¹¶ä¸”è®°å½•æœ¬æ¬¡æ“ä½œçš„äº‹åŠ¡IDï¼Œå›æ»šæŒ‡é’ˆï¼Œå›æ»šæŒ‡é’ˆç”¨æ¥æŒ‡å®šå¦‚æœå‘ç”Ÿå›æ»šï¼Œå›æ»šåˆ°å“ªä¸€ä¸ªç‰ˆæœ¬ã€‚

**==æ³¨æ„==ï¼Œè¿™é‡Œäº‹åŠ¡3æ‰§è¡Œä¿®æ”¹æ“ä½œåå°±ç›´æ¥æäº¤äº†äº‹åŠ¡ï¼Œä½†æ˜¯æ­¤æ—¶==undo logä¸ä¼šç«‹é©¬åˆ é™¤==ï¼Œå› ä¸ºæ­¤æ—¶çœŸæ­£åœ¨æœ‰æ´»åŠ¨äº‹åŠ¡åœ¨ä½¿ç”¨undo logï¼Œæ‰€ä»¥å³ä½¿æäº¤äº†äº‹åŠ¡ä¹Ÿä¸ä¼šåˆ é™¤undo logæ—¥å¿—**

![image-20250419222701198](./Mysql-Learning-Local.assets/image-20250419222701198.png)



##### C. ç¬¬ä¸‰æ­¥

![image-20250419222918353](./Mysql-Learning-Local.assets/image-20250419222918353.png)

å½“äº‹åŠ¡4æ‰§è¡Œç¬¬ä¸€æ¡ä¿®æ”¹è¯­å¥æ—¶ï¼Œä¹Ÿä¼šè®°å½•undo logæ—¥å¿—ï¼Œè®°å½•æ•°æ®å˜æ›´ä¹‹å‰çš„æ ·å­; ç„¶åæ›´æ–°è®°å½•ï¼Œå¹¶ä¸”è®°å½•æœ¬æ¬¡æ“ä½œçš„äº‹åŠ¡IDï¼Œå›æ»šæŒ‡é’ˆï¼Œå›æ»šæŒ‡é’ˆç”¨æ¥æŒ‡å®šå¦‚æœå‘ç”Ÿå›æ»šï¼Œå›æ»šåˆ°å“ªä¸€ä¸ªç‰ˆæœ¬ã€‚

![image-20250419222931152](./Mysql-Learning-Local.assets/image-20250419222931152.png)



> æœ€ç»ˆæˆ‘ä»¬å‘ç°ï¼Œ**ä¸åŒäº‹åŠ¡æˆ–ç›¸åŒäº‹åŠ¡==å¯¹åŒä¸€æ¡è®°å½•è¿›è¡Œä¿®æ”¹==**ï¼Œä¼šå¯¼è‡´è¯¥è®°å½•çš„undolog**ç”Ÿæˆä¸€æ¡è®°å½•ç‰ˆæœ¬é“¾è¡¨ï¼Œé“¾è¡¨çš„==å¤´éƒ¨æ˜¯æœ€æ–°çš„æ—§è®°å½•ï¼Œé“¾è¡¨å°¾éƒ¨æ˜¯æœ€æ—©çš„æ—§è®°å½•==**ã€‚







### ï¼ˆ4ï¼‰ğŸš€ ==readview==

#### â‘ æ¦‚å¿µ

![image-20250419223359936](./Mysql-Learning-Local.assets/image-20250419223359936.png)

**ReadViewï¼ˆè¯»è§†å›¾ï¼‰**

- **å¿«ç…§è¯» SQLæ‰§è¡Œæ—¶==MVCCæå–æ•°æ®çš„ä¾æ®==**ï¼Œ
- è®°å½•å¹¶ç»´æŠ¤ç³»ç»Ÿ**å½“å‰æ´»è·ƒçš„äº‹åŠ¡ï¼ˆ==æœªæäº¤çš„==ï¼‰idã€‚**

 

ReadViewä¸­åŒ…å«äº†å››ä¸ªæ ¸å¿ƒå­—æ®µï¼š

![image-20250419195802835](./Mysql-Learning-Local.assets/image-20250419195802835.png)



#### â‘¡ç‰ˆæœ¬é“¾æ•°æ®çš„==è®¿é—®è§„åˆ™==

è€Œåœ¨readviewä¸­å°±è§„å®šäº†**ç‰ˆæœ¬é“¾æ•°æ®çš„è®¿é—®è§„åˆ™**ï¼š

==trx_id==ä»£è¡¨**å½“å‰==undologç‰ˆæœ¬é“¾å¯¹åº”äº‹åŠ¡ID==**ã€‚

![image-20250419225104769](./Mysql-Learning-Local.assets/image-20250419225104769.png)

![image-20250419195816560](./Mysql-Learning-Local.assets/image-20250419195816560.png)

ä¸åŒçš„éš”ç¦»çº§åˆ«ï¼Œç”ŸæˆReadViewçš„æ—¶æœºä¸åŒï¼š

- READ COMMITTED ï¼ˆRCéš”ç¦»çº§åˆ«ï¼‰ï¼š**åœ¨äº‹åŠ¡ä¸­æ¯ä¸€æ¬¡æ‰§è¡Œå¿«ç…§è¯»æ—¶ç”ŸæˆReadView**ã€‚
- REPEATABLE READï¼ˆRRéš”ç¦»çº§åˆ«ï¼‰ï¼š**ä»…åœ¨äº‹åŠ¡ä¸­ç¬¬ä¸€æ¬¡æ‰§è¡Œå¿«ç…§è¯»æ—¶ç”ŸæˆReadViewï¼Œ==åç»­å¤ç”¨è¯¥ReadView==**ã€‚



### ï¼ˆ5ï¼‰ğŸš€ ==åŸç†åˆ†æ==

#### â‘ RCéš”ç¦»çº§åˆ«

RCéš”ç¦»çº§åˆ«ä¸‹ï¼Œåœ¨äº‹åŠ¡ä¸­**æ¯ä¸€æ¬¡æ‰§è¡Œå¿«ç…§è¯»æ—¶ç”ŸæˆReadView**ã€‚

æˆ‘ä»¬å°±æ¥åˆ†æäº‹åŠ¡5ä¸­ï¼Œä¸¤æ¬¡å¿«ç…§è¯»è¯»å–æ•°æ®ï¼Œæ˜¯å¦‚ä½•è·å–æ•°æ®çš„?

åœ¨äº‹åŠ¡5ä¸­ï¼ŒæŸ¥è¯¢äº†ä¸¤æ¬¡idä¸º30çš„è®°å½•ï¼Œç”±äºéš”ç¦»çº§åˆ«ä¸ºRead Committedï¼Œæ‰€ä»¥æ¯ä¸€æ¬¡è¿›è¡Œå¿«ç…§è¯»éƒ½ä¼šç”Ÿæˆä¸€ä¸ªReadViewï¼Œé‚£ä¹ˆä¸¤æ¬¡ç”Ÿæˆçš„ReadViewå¦‚ä¸‹ã€‚

![image-20250419224824790](./Mysql-Learning-Local.assets/image-20250419224824790.png)

![image-20250419195802835](./Mysql-Learning-Local.assets/image-20250419195802835.png)



> é‚£ä¹ˆè¿™ä¸¤æ¬¡å¿«ç…§è¯»åœ¨è·å–æ•°æ®æ—¶ï¼Œå°±éœ€è¦**æ ¹æ®æ‰€ç”Ÿæˆçš„==ReadViewä»¥åŠReadViewçš„ç‰ˆæœ¬é“¾è®¿é—®è§„åˆ™==ï¼Œåˆ°undo logç‰ˆæœ¬é“¾ä¸­åŒ¹é…æ•°æ®ï¼Œæœ€ç»ˆå†³å®šæ­¤æ¬¡å¿«ç…§è¯»è¿”å›çš„æ•°æ®ã€‚**



#### â‘¡ğŸš€RCçº§åˆ«=> ==å¿«ç…§è¯»çš„å…·ä½“è¿‡ç¨‹==

##### A. å…ˆæ¥çœ‹==ç¬¬ä¸€æ¬¡å¿«ç…§è¯»== å…·ä½“çš„è¯»å–è¿‡ç¨‹

ç¬¬ä¸€æ¬¡å¿«ç…§è¯»æ—¶ï¼Œå¯¹åº”çš„**undo log çš„ç‰ˆæœ¬é“¾çš„ä¿¡æ¯ï¼Œcreator_trx_idç­‰ä¿¡æ¯ï¼š**

![image-20250419225152508](./Mysql-Learning-Local.assets/image-20250419225152508.png)

åœ¨è¿›è¡ŒåŒ¹é…æ—¶ï¼Œä¼š**ä»undo logçš„ç‰ˆæœ¬é“¾ï¼Œä»ä¸Šåˆ°ä¸‹è¿›è¡ŒæŒ¨ä¸ªåŒ¹é…**ï¼š

###### å…ˆåŒ¹é… è¿™æ¡è®°å½•

![image-20250419225207890](./Mysql-Learning-Local.assets/image-20250419225207890.png)



è¿™æ¡è®°å½•å¯¹åº”çš„**trx_idä¸º4**ï¼Œä¹Ÿå°±æ˜¯å°†4å¸¦å…¥å³ä¾§çš„åŒ¹é…è§„åˆ™ä¸­ã€‚

 â‘ ä¸æ»¡è¶³ â‘¡ä¸æ»¡è¶³ â‘¢ä¸æ»¡è¶³ â‘£ä¹Ÿä¸æ»¡è¶³ ï¼Œ**éƒ½ä¸æ»¡è¶³**ï¼Œåˆ™**ç»§ç»­åŒ¹é…undo logç‰ˆæœ¬é“¾çš„ä¸‹ä¸€æ¡**ã€‚



###### å†åŒ¹é…ç¬¬äºŒæ¡ 

![image-20250419225239041](./Mysql-Learning-Local.assets/image-20250419225239041.png)

è¿™æ¡è®°å½•å¯¹åº”çš„**trx_idä¸º3**ï¼Œä¹Ÿå°±æ˜¯å°†3å¸¦å…¥å³ä¾§çš„åŒ¹é…è§„åˆ™ä¸­ã€‚

â‘ ä¸æ»¡è¶³ â‘¡ä¸æ»¡è¶³ â‘¢ä¸æ»¡è¶³ â‘£ä¹Ÿä¸æ»¡è¶³ ï¼Œ**éƒ½ä¸æ»¡è¶³ï¼Œåˆ™ç»§ç»­åŒ¹é…undo logç‰ˆæœ¬é“¾çš„ä¸‹ä¸€æ¡**ã€‚



###### å†åŒ¹é…ç¬¬ä¸‰æ¡ 

![image-20250419225253560](./Mysql-Learning-Local.assets/image-20250419225253560.png)

è¿™æ¡è®°å½•å¯¹åº”çš„**trx_idä¸º2**ï¼Œä¹Ÿå°±æ˜¯å°†2å¸¦å…¥å³ä¾§çš„åŒ¹é…è§„åˆ™ä¸­ã€‚

â‘ ä¸æ»¡è¶³ **â‘¡æ»¡è¶³ ç»ˆæ­¢åŒ¹é…**ï¼Œæ­¤æ¬¡å¿«ç…§è¯»ï¼Œ**è¿”å›çš„æ•°æ®å°±æ˜¯ç‰ˆæœ¬é“¾ä¸­è®°å½•çš„è¿™æ¡æ•°æ®**ã€‚





##### B. å†æ¥çœ‹==ç¬¬äºŒæ¬¡å¿«ç…§==è¯»å…·ä½“çš„è¯»å–è¿‡ç¨‹

![image-20250419225338480](./Mysql-Learning-Local.assets/image-20250419225338480.png)

![image-20250419225343605](./Mysql-Learning-Local.assets/image-20250419225343605.png)

åœ¨è¿›è¡ŒåŒ¹é…æ—¶ï¼Œä¼š**ä»undo logçš„ç‰ˆæœ¬é“¾ï¼Œä»ä¸Šåˆ°ä¸‹è¿›è¡ŒæŒ¨ä¸ªåŒ¹é…**ï¼š

###### å…ˆåŒ¹é… 

![image-20250419225606129](./Mysql-Learning-Local.assets/image-20250419225606129.png)

è¿™æ¡è®°å½•ï¼Œè¿™æ¡è®°å½•å¯¹åº”çš„**trx_idä¸º4**ï¼Œä¹Ÿå°±æ˜¯å°†4å¸¦å…¥å³ä¾§çš„åŒ¹é…è§„åˆ™ä¸­ã€‚

 â‘ ä¸æ»¡è¶³ â‘¡ä¸æ»¡è¶³ â‘¢ä¸æ»¡è¶³ â‘£ä¹Ÿä¸æ»¡è¶³ ï¼Œ**éƒ½ä¸æ»¡è¶³ï¼Œåˆ™ç»§ç»­åŒ¹é…undo logç‰ˆæœ¬é“¾çš„ä¸‹ä¸€æ¡**ã€‚



###### å†åŒ¹é…ç¬¬äºŒæ¡ 

![image-20250419225617332](./Mysql-Learning-Local.assets/image-20250419225617332.png)

è¿™æ¡è®°å½•å¯¹åº”çš„**trx_idä¸º3**ï¼Œä¹Ÿå°±æ˜¯å°†3å¸¦å…¥å³ä¾§çš„åŒ¹é…è§„åˆ™ä¸­ã€‚

â‘ ä¸æ»¡è¶³ **â‘¡æ»¡è¶³ ã€‚ç»ˆæ­¢åŒ¹é…**ï¼Œæ­¤æ¬¡å¿«ç…§è¯»ï¼Œè¿”å›çš„æ•°æ®å°±æ˜¯ç‰ˆæœ¬é“¾ä¸­è®°å½•çš„è¿™æ¡æ•°æ®ã€‚





#### â‘¢RRéš”ç¦»çº§åˆ«

RRéš”ç¦»çº§åˆ«ä¸‹ï¼Œ**ä»…åœ¨äº‹åŠ¡ä¸­ç¬¬ä¸€æ¬¡æ‰§è¡Œå¿«ç…§è¯»æ—¶ç”ŸæˆReadViewï¼Œ==åç»­å¤ç”¨è¯¥ReadView==**ï¼Œ**è¿›è€Œä¿è¯RRéš”ç¦»çº§åˆ«å¯é‡å¤è¯»**ã€‚ è€ŒRR æ˜¯å¯é‡å¤è¯»ï¼Œåœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œ**æ‰§è¡Œä¸¤æ¬¡ç›¸åŒçš„selectè¯­å¥ï¼ŒæŸ¥è¯¢åˆ°çš„ç»“æœæ˜¯ä¸€æ ·çš„**ã€‚

é‚£MySQLæ˜¯å¦‚ä½•åšåˆ°å¯é‡å¤è¯»çš„å‘¢? æˆ‘ä»¬ç®€å•åˆ†æä¸€ä¸‹å°±çŸ¥é“äº†

![image-20250419225916426](./Mysql-Learning-Local.assets/image-20250419225916426.png)

æˆ‘ä»¬çœ‹åˆ°ï¼Œåœ¨RRéš”ç¦»çº§åˆ«ä¸‹ï¼Œåªæ˜¯åœ¨äº‹åŠ¡ä¸­ç¬¬ä¸€æ¬¡å¿«ç…§è¯»æ—¶ç”ŸæˆReadViewï¼Œ**åç»­éƒ½æ˜¯å¤ç”¨è¯¥ReadView**ï¼Œé‚£ä¹ˆæ—¢ç„¶ReadViewéƒ½ä¸€æ ·ï¼Œ ReadViewçš„ç‰ˆæœ¬é“¾åŒ¹é…è§„åˆ™ä¹Ÿä¸€æ ·ï¼Œ é‚£ä¹ˆ**æœ€ç»ˆå¿«ç…§è¯»è¿”å›çš„ç»“æœä¹Ÿæ˜¯ä¸€æ ·çš„**ï¼Œ==è¿›è€Œä¿è¯RRéš”ç¦»çº§åˆ«å¯é‡å¤è¯»==ã€‚



> ![image-20250419230319339](./Mysql-Learning-Local.assets/image-20250419230319339.png)
>
> æ‰€ä»¥å‘¢ï¼š
>
> MVCCçš„å®ç°åŸç†å°±æ˜¯é€šè¿‡ **InnoDBè¡¨çš„éšè—å­—æ®µã€UndoLog ç‰ˆæœ¬é“¾ã€ReadView**æ¥å®ç°çš„ã€‚
>
> è€Œ==MVCC + é”==ï¼Œåˆ™**å®ç°äº†äº‹åŠ¡çš„éš”ç¦»æ€§**ã€‚ 
>
> è€Œ**ä¸€è‡´æ€§åˆ™æ˜¯ç”±redo log ä¸ undo log**ä¿è¯ï¼Œä¿è¯æ•°æ®æ‰§è¡Œå‰åä¸€è‡´ã€‚



## 6.5 å°ç»“

![image-20250419230514317](./Mysql-Learning-Local.assets/image-20250419230514317.png)



# 7ã€MySQLç®¡ç†

## 7.1 ç³»ç»Ÿæ•°æ®åº“

Mysqlæ•°æ®åº“å®‰è£…å®Œæˆåï¼Œè‡ªå¸¦äº†ä¸€ä¸‹å››ä¸ªæ•°æ®åº“ï¼Œå…·ä½“ä½œç”¨å¦‚ä¸‹ï¼š

![image-20250419200214184](./Mysql-Learning-Local.assets/image-20250419200214184.png)



## 7.2 å¸¸ç”¨å·¥å…·

### ï¼ˆ1ï¼‰mysql-å®¢æˆ·ç«¯å·¥å…·

![image-20250420133549189](./Mysql-Learning-Local.assets/image-20250420133549189.png)

**è¯¥mysqlä¸æ˜¯æŒ‡mysqlæœåŠ¡**ï¼Œè€Œæ˜¯æŒ‡mysqlçš„**å®¢æˆ·ç«¯å·¥å…·**ã€‚

```sql
-- è¯­æ³• ï¼š
    mysql [options] [database]

-- é€‰é¡¹ ï¼š
    -u, --user=name 	#æŒ‡å®šç”¨æˆ·å
    -p, --password[=name] 	#æŒ‡å®šå¯†ç 
    -h, --host=name 	#æŒ‡å®šæœåŠ¡å™¨IPæˆ–åŸŸå
    -P, --port=port	 	#å¤§å†™å­—æ¯P =ã€‹æŒ‡å®šè¿æ¥ç«¯å£
    -e, --execute=name 	#æ‰§è¡ŒSQLè¯­å¥å¹¶é€€å‡º
```

**-eé€‰é¡¹å¯ä»¥åœ¨Mysqlå®¢æˆ·ç«¯æ‰§è¡ŒSQLè¯­å¥**ï¼Œè€Œä¸ç”¨è¿æ¥åˆ°MySQLæ•°æ®åº“å†æ‰§è¡Œï¼Œå¯¹äºä¸€äº›**æ‰¹å¤„ç†è„šæœ¬**ï¼Œè¿™ç§æ–¹å¼å°¤å…¶æ–¹ä¾¿ã€‚

ç¤ºä¾‹ï¼š

```sql
mysql -h192.168.88.129 -P3306 -uroot -p1234 itcast -e "select * from stu"; 

mysql -h192.168.88.129 -P3306 -uroot -p1234 itcast -e "show databases;"; 
```

![image-20250420134548726](./Mysql-Learning-Local.assets/image-20250420134548726.png)



### ï¼ˆ2ï¼‰mysqladmin-æ‰§è¡Œç®¡ç†æ“ä½œ

mysqladmin æ˜¯ä¸€ä¸ª**æ‰§è¡Œç®¡ç†æ“ä½œçš„å®¢æˆ·ç«¯ç¨‹åº**ã€‚å¯ä»¥ç”¨å®ƒæ¥**æ£€æŸ¥æœåŠ¡å™¨çš„é…ç½®å’Œå½“å‰çŠ¶æ€ã€åˆ›å»ºå¹¶åˆ é™¤æ•°æ®åº“ç­‰ã€‚**

```sql
-- é€šè¿‡å¸®åŠ©æ–‡æ¡£æŸ¥çœ‹é€‰é¡¹ï¼š
	mysqladmin --help
```

![image-20250420135805300](./Mysql-Learning-Local.assets/image-20250420135805300.png)

```sql
-- è¯­æ³•:
	mysqladmin [options] command ...

-- é€‰é¡¹:
    -u, --user=name #æŒ‡å®šç”¨æˆ·å
    -p, --password[=name] #æŒ‡å®šå¯†ç 
    -h, --host=name #æŒ‡å®šæœåŠ¡å™¨IPæˆ–åŸŸå
    -P, --port=port #æŒ‡å®šè¿æ¥ç«¯å£
```

ç¤ºä¾‹ï¼š

```sql
mysqladmin -uroot -p1234 create 'test01'; -- åˆ›å»ºæŒ‡å®šæ•°æ®åº“
mysqladmin -uroot -p1234 drop 'test01'; -- åˆ é™¤æŒ‡å®šæ•°æ®åº“
mysqladmin -uroot -p1234 version; -- æŸ¥çœ‹å½“å‰æ•°æ®åº“çš„ç‰ˆæœ¬
```

![image-20250420135153853](./Mysql-Learning-Local.assets/image-20250420135153853.png)



### ï¼ˆ3ï¼‰mysqlbinlog-äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶

ç”±äºæœåŠ¡å™¨ç”Ÿæˆçš„**äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶**ä»¥äºŒè¿›åˆ¶æ ¼å¼ä¿å­˜ï¼Œæ‰€ä»¥å¦‚æœæƒ³è¦æ£€æŸ¥è¿™äº›æ–‡æœ¬çš„æ–‡æœ¬æ ¼å¼ï¼Œå°±ä¼šä½¿ç”¨åˆ°**mysqlbinlog æ—¥å¿—ç®¡ç†å·¥å…·**ã€‚

```sql
-- è¯­æ³• ï¼š
	mysqlbinlog [options] log-files1 log-files2 ...

-- é€‰é¡¹ ï¼š
    -d, --database=name 	-- æŒ‡å®šæ•°æ®åº“åç§°ï¼Œåªåˆ—å‡ºæŒ‡å®šçš„æ•°æ®åº“ç›¸å…³æ“ä½œã€‚
    -o, --offset=#   	-- å¿½ç•¥æ‰æ—¥å¿—ä¸­çš„å‰nè¡Œå‘½ä»¤ã€‚
    -r,--result-file=name 	-- å°†è¾“å‡ºçš„æ–‡æœ¬æ ¼å¼æ—¥å¿—è¾“å‡ºåˆ°æŒ‡å®šæ–‡ä»¶ã€‚
    -s, --short-form 	-- æ˜¾ç¤ºç®€å•æ ¼å¼ï¼Œ çœç•¥æ‰ä¸€äº›ä¿¡æ¯ã€‚
    --start-datatime=date1 --stop-datetime=date2 	-- æŒ‡å®šæ—¥æœŸé—´éš”å†…çš„æ‰€æœ‰æ—¥å¿—ã€‚
    --start-position=pos1 --stop-position=pos2 		-- æŒ‡å®šä½ç½®é—´éš”å†…çš„æ‰€æœ‰æ—¥å¿—ã€‚
```

ç¤ºä¾‹:

A. æŸ¥çœ‹ binlog.000006è¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ä¸­çš„æ•°æ®ä¿¡æ¯

```sql
cd /var/lib/mysql -- æŸ¥çœ‹Mysqlçš„ç›®å½•æ–‡ä»¶
```

![image-20250420140209995](./Mysql-Learning-Local.assets/image-20250420140209995.png)



ä¸Šè¿°æŸ¥çœ‹åˆ°çš„äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶æ•°æ®ä¿¡æ¯é‡å¤ªå¤šäº†ï¼Œä¸æ–¹ä¾¿æŸ¥è¯¢ã€‚ æˆ‘ä»¬å¯ä»¥åŠ ä¸Šä¸€ä¸ªå‚æ•° -s æ¥æ˜¾ç¤ºç®€å•æ ¼å¼ã€‚

```sql
mysqlbinlog binlog.000006
mysqlbinlog -s binlog.000006 -- ç²¾ç®€æŸ¥è¯¢åçš„ä¿¡æ¯
```



### ï¼ˆ4ï¼‰mysqlshow-å¯¹è±¡æŸ¥æ‰¾

![image-20250420141055030](./Mysql-Learning-Local.assets/image-20250420141055030.png)

mysqlshow **å®¢æˆ·ç«¯å¯¹è±¡æŸ¥æ‰¾å·¥å…·**ï¼Œç”¨æ¥å¾ˆå¿«åœ°**æŸ¥æ‰¾å­˜åœ¨å“ªäº›æ•°æ®åº“ã€æ•°æ®åº“ä¸­çš„è¡¨ã€è¡¨ä¸­çš„åˆ—æˆ–è€…ç´¢å¼•**ã€‚

```sql
-- è¯­æ³• ï¼š
    mysqlshow [options] [db_name [table_name [col_name]]]

-- é€‰é¡¹ ï¼š
    --count 	-- æ˜¾ç¤ºæ•°æ®åº“åŠè¡¨çš„ç»Ÿè®¡ä¿¡æ¯ï¼ˆæ•°æ®åº“ï¼Œè¡¨ å‡å¯ä»¥ä¸æŒ‡å®šï¼‰
    -i 		-- æ˜¾ç¤ºæŒ‡å®šæ•°æ®åº“æˆ–è€…æŒ‡å®šè¡¨çš„çŠ¶æ€ä¿¡æ¯

-- ç¤ºä¾‹ï¼š
    #æŸ¥è¯¢itcaståº“ä¸­æ¯ä¸ªè¡¨ä¸­çš„ç»Ÿè®¡ä¿¡æ¯ï¼šå­—æ®µä¹¦ï¼ŒåŠè¡Œæ•°
    mysqlshow -uroot -p1234 itcast --count
    #æŸ¥è¯¢itcaståº“ä¸­bookè¡¨çš„è¯¦ç»†æƒ…å†µ
    mysqlshow -uroot -p1234 itcast stu --count
```

**`-i`æŸ¥çœ‹æŒ‡å®šæ•°æ®åº“æˆ–è€…æŒ‡å®šè¡¨/å­—æ®µçš„çŠ¶æ€ä¿¡æ¯**

```sql
mysqlshow -uroot -p1234 itcast stu -i
mysqlshow -uroot -p1234 itcast stu id -i
```



ç¤ºä¾‹ï¼š

**A. æŸ¥è¯¢æ¯ä¸ªæ•°æ®åº“çš„è¡¨çš„æ•°é‡åŠè¡¨ä¸­è®°å½•çš„æ•°é‡**

```sql
mysqlshow -uroot -p1234 --count
```

![image-20250420140912222](./Mysql-Learning-Local.assets/image-20250420140912222.png)

**B. æŸ¥çœ‹æ•°æ®åº“itcastçš„ç»Ÿè®¡ä¿¡æ¯**

```sql
mysqlshow -uroot -p1234 itcast --count
```

![image-20250420140938132](./Mysql-Learning-Local.assets/image-20250420140938132.png)

**C. æŸ¥çœ‹æ•°æ®åº“itcastä¸­çš„stuè¡¨çš„ä¿¡æ¯**

```sql
mysqlshow -uroot -p1234 itcast stu --count
```

![image-20250420141014722](./Mysql-Learning-Local.assets/image-20250420141014722.png)

**D. æŸ¥çœ‹æ•°æ®åº“itcastä¸­çš„courseè¡¨çš„idå­—æ®µçš„ä¿¡æ¯**

```sql
mysqlshow -uroot -p1234 itcast stu id --count
```

![image-20250420141026812](./Mysql-Learning-Local.assets/image-20250420141026812.png)

**E.`-i`æŸ¥çœ‹æŒ‡å®šæ•°æ®åº“æˆ–è€…æŒ‡å®šè¡¨/å­—æ®µçš„çŠ¶æ€ä¿¡æ¯**

```sql
mysqlshow -uroot -p1234 itcast stu -i
mysqlshow -uroot -p1234 itcast stu id -i
```

![image-20250420141417967](./Mysql-Learning-Local.assets/image-20250420141417967.png)

![image-20250420141443311](./Mysql-Learning-Local.assets/image-20250420141443311.png)



### ï¼ˆ5ï¼‰mysqldump-æ•°æ®å¤‡ä»½å’Œè¿ç§»

![image-20250420143539539](./Mysql-Learning-Local.assets/image-20250420143539539.png)

mysqldump å®¢æˆ·ç«¯å·¥å…·ç”¨æ¥**å¤‡ä»½æ•°æ®åº“æˆ–åœ¨ä¸åŒæ•°æ®åº“ä¹‹é—´è¿›è¡Œæ•°æ®è¿ç§»**ã€‚å¤‡ä»½å†…å®¹**åŒ…å«åˆ›å»ºè¡¨ï¼ŒåŠæ’å…¥è¡¨çš„SQLè¯­å¥ã€‚**

```sql
-- è¯­æ³• ï¼š
	mysqldump --help -- æŸ¥çœ‹æ›´å¤šçš„æŒ‡ä»¤é€‰é¡¹
    mysqldump [options] db_name [tables]
    mysqldump [options] --database/-B db1 [db2 db3...]
    mysqldump [options] --all-databases/-A

-- è¿æ¥é€‰é¡¹ ï¼š
    -u, --user=name -- æŒ‡å®šç”¨æˆ·å
    -p, --password[=name] -- æŒ‡å®šå¯†ç 
    -h, --host=name -- æŒ‡å®šæœåŠ¡å™¨ipæˆ–åŸŸå
    -P, --port=#   	-- æŒ‡å®šè¿æ¥ç«¯å£

-- è¾“å‡ºé€‰é¡¹ï¼š
    --add-drop-database 	-- åœ¨æ¯ä¸ªæ•°æ®åº“åˆ›å»ºè¯­å¥å‰åŠ ä¸Š drop database è¯­å¥
    --add-drop-table 	-- åœ¨æ¯ä¸ªè¡¨åˆ›å»ºè¯­å¥å‰åŠ ä¸Š drop table è¯­å¥ , é»˜è®¤å¼€å¯ ;
        				-- ä¸å¼€å¯ (--skip-add-drop-table)
	-R, --routines -- è½¬å­˜å­˜å‚¨ä¾‹ç¨‹ï¼ˆå‡½æ•°å’Œç¨‹åºï¼‰ã€‚

    -n, --no-create-db 		-- ä¸åŒ…å«æ•°æ®åº“çš„åˆ›å»ºè¯­å¥
    -t, --no-create-info 	-- ä¸åŒ…å«æ•°æ®è¡¨çš„åˆ›å»ºè¯­å¥
    -d --no-data 	-- ä¸åŒ…å«æ•°æ®
    -T, --tab=name -- è‡ªåŠ¨ç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶ï¼šä¸€ä¸ª.sqlæ–‡ä»¶ï¼Œåˆ›å»ºè¡¨ç»“æ„çš„è¯­å¥ï¼›ä¸€ä¸ª.txtæ–‡ä»¶ï¼Œæ•°æ®æ–‡ä»¶
```

  

ç¤ºä¾‹:

A. **å¤‡ä»½itcastæ•°æ®åº“**

```sql
mysqldump -uroot -p1234 itcast > itcast.sql
```

å¯ä»¥ç›´æ¥æ‰“å¼€itcast.sqlï¼Œæ¥æŸ¥çœ‹å¤‡ä»½å‡ºæ¥çš„æ•°æ®åˆ°åº•ä»€ä¹ˆæ ·ã€‚

<img src="./Mysql-Learning-Local.assets/image-20250420142442036.png" alt="image-20250420142442036" style="zoom:80%;" />

<img src="./Mysql-Learning-Local.assets/image-20250420142541521.png" alt="image-20250420142541521" style="zoom:67%;" />



å¤‡ä»½å‡ºæ¥çš„æ•°æ®åŒ…å«ï¼š

- **åˆ é™¤è¡¨çš„è¯­å¥**
- **åˆ›å»ºè¡¨çš„è¯­å¥**
- **æ•°æ®æ’å…¥è¯­å¥**



å¦‚æœæˆ‘ä»¬åœ¨æ•°æ®å¤‡ä»½æ—¶ï¼Œä¸éœ€è¦åˆ›å»ºè¡¨ï¼Œæˆ–è€…ä¸éœ€è¦å¤‡ä»½æ•°æ®ï¼Œ**åªéœ€è¦å¤‡ä»½è¡¨ç»“æ„**ï¼Œéƒ½å¯ä»¥é€šè¿‡å¯¹åº”çš„å‚æ•°æ¥å®ç°ã€‚

B. å¤‡ä»½db01æ•°æ®åº“ä¸­çš„è¡¨æ•°æ®ï¼Œ**==ä¸å¤‡ä»½è¡¨ç»“æ„(-t)==**

```sql
mysqldump -uroot -p1234 -t itcast > itcast2.sql
```

![image-20250420142719036](./Mysql-Learning-Local.assets/image-20250420142719036.png)



æ‰“å¼€ itcast2.sql ï¼Œæ¥æŸ¥çœ‹å¤‡ä»½çš„æ•°æ®ï¼Œ**åªæœ‰insertè¯­å¥ï¼Œæ²¡æœ‰å¤‡ä»½è¡¨ç»“æ„**ã€‚



**C. å°†itcastæ•°æ®åº“çš„è¡¨stuçš„è¡¨ç»“æ„ä¸æ•°æ®åˆ†å¼€å¤‡ä»½(-T)**

```bash
mysqldump -uroot -p1234 -T /root itcast stu
```

æ‰§è¡Œä¸Šè¿°æŒ‡ä»¤ï¼Œä¼šå‡ºé”™ï¼Œæ•°æ®ä¸èƒ½å®Œæˆå¤‡ä»½ï¼ŒåŸå› æ˜¯å› ä¸ºæˆ‘ä»¬æ‰€**æŒ‡å®šçš„æ•°æ®å­˜æ”¾ç›®å½•/root**ï¼Œ**MySQLè®¤ä¸ºæ˜¯ä¸å®‰å…¨çš„ï¼Œéœ€è¦å­˜å‚¨åœ¨MySQLä¿¡ä»»çš„ç›®å½•ä¸‹**ã€‚é‚£ä¹ˆï¼Œå“ªä¸ªç›®å½•æ‰æ˜¯MySQLä¿¡ä»»çš„ç›®å½•å‘¢ï¼Œå¯ä»¥**æŸ¥çœ‹ä¸€ä¸‹ç³»ç»Ÿå˜é‡ secure_file_priv** ã€‚æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š

![image-20250420143103335](./Mysql-Learning-Local.assets/image-20250420143103335.png)

```sql
show variables like '%secure_file_priv%';
```

![image-20250420143235755](./Mysql-Learning-Local.assets/image-20250420143235755.png)

```bash
mysqldump -uroot -p1234 -T /var/lib/mysql-files/ itcast stu
```

<img src="./Mysql-Learning-Local.assets/image-20250420143435370.png" alt="image-20250420143435370" style="zoom:67%;" />

ä¸Šè¿°çš„ä¸¤ä¸ªæ–‡ä»¶ stu.sql ä¸­è®°å½•çš„å°±æ˜¯**è¡¨ç»“æ„æ–‡ä»¶**ï¼Œè€Œ stu.txt å°±æ˜¯**è¡¨æ•°æ®æ–‡ä»¶**ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„è¡¨æ•°æ®æ–‡ä»¶ï¼Œå¹¶**ä¸æ˜¯è®°å½•ä¸€æ¡æ¡çš„insertè¯­å¥**ï¼Œè€Œæ˜¯**æŒ‰ç…§ä¸€å®šçš„æ ¼å¼è®°å½•è¡¨ç»“æ„ä¸­çš„æ•°æ®**ã€‚å¦‚ä¸‹ï¼š

![image-20250420143500129](./Mysql-Learning-Local.assets/image-20250420143500129.png)



### ï¼ˆ6ï¼‰mysqlimport/source-å¯¼å…¥æ•°æ®

#### â‘ mysqlimport

mysqlimport æ˜¯å®¢æˆ·ç«¯**æ•°æ®å¯¼å…¥å·¥å…·**ï¼Œç”¨æ¥**å¯¼å…¥mysqldump åŠ  -T å‚æ•°åå¯¼å‡ºçš„æ–‡æœ¬æ–‡ä»¶**ã€‚

```sql
-- è¯­æ³• ï¼š
	mysqlimport [options] db_name textfile1 [textfile2...]

-- ç¤ºä¾‹ ï¼š
	mysqlimport -uroot -p1234 itcast /tmp/itcast.txt
```

![image-20250420144437676](./Mysql-Learning-Local.assets/image-20250420144437676.png)

#### â‘¡source

å¦‚æœéœ€è¦**å¯¼å…¥sqlæ–‡ä»¶**,å¯ä»¥ä½¿ç”¨mysqlä¸­çš„source æŒ‡ä»¤ :

```sql
-- è¯­æ³• ï¼š
source /root/xxxxx.sql -- æ‰§è¡Œsqlè„šæœ¬-insertè¯­å¥ï¼Œåœ¨mysqlå‘½ä»¤è¡Œä¸­æ‰§è¡Œ
```

 

## 7.3 å°ç»“

<img src="./Mysql-Learning-Local.assets/image-20250420144507615.png" alt="image-20250420144507615" style="zoom:67%;" />



# ----------------------------

------



# ä¸‰ã€è¿ç»´ç¯‡

# 1ã€ğŸŒŸ ==æ—¥å¿—==

## 1.1 é”™è¯¯æ—¥å¿—

é”™è¯¯æ—¥å¿—æ˜¯ MySQL ä¸­æœ€é‡è¦çš„æ—¥å¿—ä¹‹ä¸€ï¼Œå®ƒè®°å½•äº†**å½“ mysqld å¯åŠ¨å’Œåœæ­¢æ—¶ï¼Œä»¥åŠæœåŠ¡å™¨åœ¨è¿è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿä»»ä½•ä¸¥é‡é”™è¯¯æ—¶çš„ç›¸å…³ä¿¡æ¯**ã€‚å½“æ•°æ®åº“å‡ºç°ä»»ä½•æ•…éšœå¯¼è‡´æ— æ³•æ­£å¸¸ä½¿ç”¨æ—¶ï¼Œå»ºè®®é¦–å…ˆæŸ¥çœ‹æ­¤æ—¥å¿—ã€‚

è¯¥æ—¥å¿—æ˜¯**é»˜è®¤å¼€å¯**çš„ï¼Œ**é»˜è®¤å­˜æ”¾ç›®å½• /var/log/**ï¼Œé»˜è®¤çš„æ—¥å¿—æ–‡ä»¶åä¸º **mysqld.log** ã€‚æŸ¥çœ‹æ—¥å¿—ä½ç½®ï¼š

```SQL
-- æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶æ‰€åœ¨ä½ç½®
show variables like '%log_error%'; 
```

![image-20250420172511157](./Mysql-Learning-Local.assets/image-20250420172511157.png)



```bash
tail -50 /var/log/mysqld.log #æŸ¥çœ‹é”™è¯¯æ—¥å¿—æ–‡ä»¶æœ€å50è¡Œçš„ä¿¡æ¯
tail -f /var/log/mysqld.log #å®æ—¶æŸ¥çœ‹æ—¥å¿—ä¿¡æ¯
```



## 1.2 ğŸŒŸ ==äºŒè¿›åˆ¶æ—¥å¿—==

### ï¼ˆ1ï¼‰ä»‹ç»

![image-20250420173409250](./Mysql-Learning-Local.assets/image-20250420173409250.png)

äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆBINLOGï¼‰è®°å½•äº†æ‰€æœ‰çš„ **DDLï¼ˆæ•°æ®å®šä¹‰è¯­è¨€ï¼‰**è¯­å¥å’Œ **DMLï¼ˆæ•°æ®æ“çºµè¯­è¨€ï¼‰**è¯­å¥ï¼Œä½†**ä¸åŒ…æ‹¬æ•°æ®æŸ¥è¯¢ï¼ˆSELECTã€SHOWï¼‰è¯­å¥**ã€‚

ä½œç”¨ï¼š

- â‘  ç¾éš¾æ—¶çš„**==æ•°æ®æ¢å¤==**ï¼›
- â‘¡ MySQLçš„**==ä¸»ä»å¤åˆ¶==**ï¼Œä¸»ä»å¤åˆ¶çš„åº•å±‚åŸç†å°±æ˜¯åŸºäºbinlogçš„ã€‚

åœ¨MySQL8ç‰ˆæœ¬ä¸­ï¼Œé»˜è®¤**äºŒè¿›åˆ¶æ—¥å¿—æ˜¯==å¼€å¯==ç€çš„**ï¼Œæ¶‰åŠåˆ°çš„å‚æ•°å¦‚ä¸‹ï¼š

```sql
show variables like '%log_bin%'; 
```

![image-20250420173229155](./Mysql-Learning-Local.assets/image-20250420173229155.png)

**å‚æ•°è¯´æ˜ï¼š**

- loh_bin = on ,è¡¨ç¤ºäºŒè¿›åˆ¶æ—¥å¿—æ˜¯å¼€å¯çš„ã€‚
- log_bin_basenameï¼šå½“å‰æ•°æ®åº“æœåŠ¡å™¨çš„**binlogæ—¥å¿—çš„åŸºç¡€åç§°(å‰ç¼€)**ï¼Œå…·ä½“çš„binlogæ–‡ä»¶åéœ€è¦å†è¯¥basenameçš„åŸºç¡€ä¸Š**åŠ ä¸Šç¼–å·(ç¼–å·ä»000001å¼€å§‹)**ã€‚
- log_bin_indexï¼šbinlogçš„**ç´¢å¼•æ–‡ä»¶**ï¼Œé‡Œé¢è®°å½•äº†å½“å‰æœåŠ¡å™¨å…³è”çš„binlogæ–‡ä»¶æœ‰å“ªäº›ã€‚

<img src="./Mysql-Learning-Local.assets/image-20250420173321313.png" alt="image-20250420173321313" style="zoom:67%;" />

![image-20250420173350086](./Mysql-Learning-Local.assets/image-20250420173350086.png)



### ï¼ˆ2ï¼‰æ ¼å¼

MySQLæœåŠ¡å™¨ä¸­æä¾›äº†**å¤šç§æ ¼å¼æ¥è®°å½•äºŒè¿›åˆ¶æ—¥å¿—**ï¼Œå…·ä½“æ ¼å¼åŠç‰¹ç‚¹å¦‚ä¸‹ï¼š

![image-20250420150344386](./Mysql-Learning-Local.assets/image-20250420150344386.png)

**==æ³¨æ„==**

- æŸ¥è¯¢æ˜¯ä¸ä¼šè®°å½•åœ¨äºŒè¿›åˆ¶æ–‡ä»¶ä¸­çš„ï¼Œåªä¼šè®°å½•äº†æ‰€æœ‰çš„ **DDLï¼ˆæ•°æ®å®šä¹‰è¯­è¨€ï¼‰**è¯­å¥å’Œ **DMLï¼ˆæ•°æ®æ“çºµè¯­è¨€ï¼‰**è¯­å¥ï¼Œä½†**ä¸åŒ…æ‹¬æ•°æ®æŸ¥è¯¢ï¼ˆSELECTã€SHOWï¼‰è¯­å¥**ã€‚
- STATEMENTçš„æ—¥å¿—æ ¼å¼ï¼Œé€šè¿‡mysqlbinlog binlog.00003æ—¶ä¸éœ€è¦æ·»åŠ -vé€‰é¡¹ï¼Œå› ä¸ºè¯¥æ—¥å¿—æ ¼å¼**ä¿å­˜çš„å°±æ˜¯sqlè¯­å¥**ã€‚
- å¯¹äºROWçš„æ—¥å¿—æ ¼å¼ï¼Œéœ€è¦é€šè¿‡mysqlbinlog **-v** binlog.00003æŒ‡ä»¤ï¼Œ**å°†è¡Œäº‹ä»¶(æ•°æ®å˜æ›´)é‡æ„ä¸ºSQLè¯­å¥**



```sql
show variables like '%binlog_format%';  -- æŸ¥çœ‹å½“å‰Mysqlçš„è®°å½•æ—¥å¿—çš„æ ¼å¼
```

![image-20250420173521155](./Mysql-Learning-Local.assets/image-20250420173521155.png)

å¦‚æœæˆ‘ä»¬éœ€è¦é…ç½®äºŒè¿›åˆ¶æ—¥å¿—çš„æ ¼å¼ï¼Œåªéœ€è¦**åœ¨ /etc/my.cnf ä¸­é…ç½® binlog_format å‚æ•°**å³å¯ã€‚

```bash
vim  /etc/my.cnf

#åœ¨è¯¥æ–‡ä»¶çš„æœ€åæ·»åŠ 
binlog_format = STATEMENT

# é‡æ–°å¯åŠ¨MySQLæœåŠ¡
systemctl restart mysqld
```



### ï¼ˆ3ï¼‰æŸ¥çœ‹

ç”±äºæ—¥å¿—æ˜¯ä»¥äºŒè¿›åˆ¶æ–¹å¼å­˜å‚¨çš„ï¼Œä¸èƒ½ç›´æ¥è¯»å–ï¼Œéœ€è¦é€šè¿‡**äºŒè¿›åˆ¶æ—¥å¿—æŸ¥è¯¢å·¥å…· mysqlbinlog æ¥æŸ¥çœ‹**ï¼Œå…·ä½“è¯­æ³•ï¼š

```sql
	mysqlbinlog [ å‚æ•°é€‰é¡¹ ] logfilename

-- å‚æ•°é€‰é¡¹ï¼š
    -d -- æŒ‡å®šæ•°æ®åº“åç§°ï¼Œåªåˆ—å‡ºæŒ‡å®šçš„æ•°æ®åº“ç›¸å…³æ“ä½œã€‚
    -o -- å¿½ç•¥æ‰æ—¥å¿—ä¸­çš„å‰nè¡Œå‘½ä»¤ã€‚
    -v -- å°†è¡Œäº‹ä»¶(æ•°æ®å˜æ›´)é‡æ„ä¸ºSQLè¯­å¥
    -vv -- å°†è¡Œäº‹ä»¶(æ•°æ®å˜æ›´)é‡æ„ä¸ºSQLè¯­å¥ï¼Œå¹¶è¾“å‡ºæ³¨é‡Šä¿¡æ¯ï¼Œæ³¨æ„è¿™é‡Œæ˜¯ä¸¤ä¸ªv
```



### ï¼ˆ4ï¼‰åˆ é™¤

å¯¹äºæ¯”è¾ƒç¹å¿™çš„ä¸šåŠ¡ç³»ç»Ÿï¼Œæ¯å¤©ç”Ÿæˆçš„binlogæ•°æ®å·¨å¤§ï¼Œ**å¦‚æœé•¿æ—¶é—´ä¸æ¸…é™¤ï¼Œå°†ä¼šå ç”¨å¤§é‡ç£ç›˜ç©ºé—´**ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼æ¸…ç†æ—¥å¿—ï¼š

![image-20250420150602442](./Mysql-Learning-Local.assets/image-20250420150602442.png)

#### â‘ æ—¥å¿—è¿‡æœŸæ—¶é—´

ä¹Ÿå¯ä»¥åœ¨mysqlçš„**é…ç½®æ–‡ä»¶ä¸­é…ç½®äºŒè¿›åˆ¶æ—¥å¿—çš„è¿‡æœŸæ—¶é—´**ï¼Œè®¾ç½®äº†ä¹‹åï¼Œ**äºŒè¿›åˆ¶æ—¥å¿—è¿‡æœŸä¼šè‡ªåŠ¨åˆ é™¤**ã€‚

```sql
-- æŸ¥çœ‹äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶çš„è¿‡æœŸæ—¶é—´
show variables like '%binlog_expire_logs_seconds%'; -- é»˜è®¤ä¸º30å¤©
```

<img src="./Mysql-Learning-Local.assets/image-20250420213540958.png" alt="image-20250420213540958" style="zoom:80%;" />



#### **â‘¡åˆ é™¤æŒ‡å®šç¼–ç ä¹‹å‰çš„æ‰€æœ‰æ—¥å¿—**

```sql
purge master logs to 'binlog.000002';
```

![image-20250420213930569](./Mysql-Learning-Local.assets/image-20250420213930569.png)



#### â‘¢åˆ é™¤å…¨éƒ¨binlogæ—¥å¿—

**åˆ é™¤å…¨éƒ¨binlogæ—¥å¿—ï¼Œåˆ é™¤ä¹‹åï¼Œæ—¥å¿—ç¼–å·ï¼Œå°†ä» binlog.000001é‡æ–°å¼€å§‹**

```sql
reset master;
```



#### â‘£åˆ é™¤æŒ‡å®šæ—¥æœŸä¹‹å‰çš„æ—¥å¿—

```sql
purge master logs before '2025-04-20 21:42:00';
```



## 1.3 æŸ¥è¯¢æ—¥å¿—

![image-20250420215222971](./Mysql-Learning-Local.assets/image-20250420215222971.png)

æŸ¥è¯¢æ—¥å¿—ä¸­**è®°å½•äº†å®¢æˆ·ç«¯çš„==æ‰€æœ‰æ“ä½œè¯­å¥==**ï¼Œè€Œ**äºŒè¿›åˆ¶æ—¥å¿—ä¸åŒ…å«æŸ¥è¯¢æ•°æ®çš„SQLè¯­å¥**ã€‚

**é»˜è®¤**æƒ…å†µä¸‹ï¼Œ**æŸ¥è¯¢æ—¥å¿—æ˜¯==æœªå¼€å¯==çš„**ã€‚

```sql
show variables like '%general%'; -- æŸ¥è¯¢æ—¥å¿—çš„å¼€å…³çŠ¶æ€å’ŒæŸ¥è¯¢æ—¥å¿—æ‰€åœ¨æ–‡ä»¶ç›®å½•
```

<img src="./Mysql-Learning-Local.assets/image-20250420214551431.png" alt="image-20250420214551431" style="zoom:80%;" />



å¦‚æœ**éœ€è¦å¼€å¯æŸ¥è¯¢æ—¥å¿—**ï¼Œå¯ä»¥**ä¿®æ”¹MySQLçš„é…ç½®æ–‡ä»¶ /etc/my.cnf æ–‡ä»¶**ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š

```bash
#è¯¥é€‰é¡¹ç”¨æ¥å¼€å¯æŸ¥è¯¢æ—¥å¿— ï¼Œ å¯é€‰å€¼ ï¼š 0 æˆ–è€… 1 ï¼› 0 ä»£è¡¨å…³é—­ï¼Œ 1 ä»£è¡¨å¼€å¯
general_log=1
#è®¾ç½®æ—¥å¿—çš„æ–‡ä»¶åï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œ é»˜è®¤çš„æ–‡ä»¶åä¸º host_name.log
general_log_file=mysql_query.log
```

![image-20250420215942627](./Mysql-Learning-Local.assets/image-20250420215942627.png)



```sql
-- é…ç½®å®Œæˆåï¼Œé‡å¯mysqlæœåŠ¡
systemctl restart mysqld
```

![image-20250420215010055](./Mysql-Learning-Local.assets/image-20250420215010055.png)

![image-20250420220234253](./Mysql-Learning-Local.assets/image-20250420220234253.png)

å¼€å¯äº†æŸ¥è¯¢æ—¥å¿—ä¹‹åï¼Œåœ¨**MySQLçš„æ•°æ®å­˜æ”¾ç›®å½•**ï¼Œä¹Ÿå°±æ˜¯ **/var/lib/mysql/ ç›®å½•ä¸‹å°±ä¼šå‡ºç°mysql_query.log æ–‡ä»¶**ã€‚ä¹‹å**æ‰€æœ‰çš„å®¢æˆ·ç«¯çš„å¢åˆ æ”¹æŸ¥æ“ä½œéƒ½ä¼šè®°å½•åœ¨è¯¥æ—¥å¿—æ–‡ä»¶ä¹‹ä¸­**ï¼Œé•¿æ—¶é—´è¿è¡Œåï¼Œè¯¥æ—¥å¿—æ–‡ä»¶å°†ä¼šéå¸¸å¤§ã€‚å¦‚æœä¸éœ€è¦ç”¨åˆ°è¿™ä¸ªæ–‡ä»¶å¯ä»¥`å…³é—­æŸ¥è¯¢æ—¥å¿—`ã€‚



## 1.4 ğŸŒŸ ==æ…¢æŸ¥è¯¢æ—¥å¿—==

![image-20250420221656704](./Mysql-Learning-Local.assets/image-20250420221656704.png)

æ…¢æŸ¥è¯¢æ—¥å¿—è®°å½•äº†æ‰€æœ‰**æ‰§è¡Œæ—¶é—´è¶…è¿‡å‚æ•° long_query_time è®¾ç½®å€¼**å¹¶ä¸”**æ‰«æè®°å½•æ•°ä¸å°äºmin_examined_row_limit** çš„æ‰€æœ‰çš„SQLè¯­å¥çš„æ—¥å¿—ï¼Œ**é»˜è®¤æœªå¼€å¯**ã€‚long_query_time **é»˜è®¤ä¸º10 ç§’**ï¼Œæœ€å°ä¸º 0ï¼Œ **ç²¾åº¦å¯ä»¥åˆ°å¾®ç§’**ã€‚

**é»˜è®¤æ–‡ä»¶åä¸º**ï¼šlocalhost-slow.log ï¼Œæ‰€åœ¨æ–‡ä»¶ç›®å½•ï¼š/var/lib/mysql

![image-20250420220017355](./Mysql-Learning-Local.assets/image-20250420220017355.png)

å¦‚æœéœ€è¦å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œéœ€è¦**åœ¨MySQLçš„é…ç½®æ–‡ä»¶ /etc/my.cnf ä¸­é…ç½®**å¦‚ä¸‹å‚æ•°ï¼š

```bash
#æ…¢æŸ¥è¯¢æ—¥å¿—
slow_query_log=1  # 1è¡¨ç¤ºå¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—
#æ‰§è¡Œæ—¶é—´å‚æ•°
long_query_time=2  # è®¾ç½®æ…¢æŸ¥è¯¢æ—¶é—´æ ‡å‡†çº¿ä¸º 2s
```

![image-20250420215923839](./Mysql-Learning-Local.assets/image-20250420215923839.png)



**æµ‹è¯•ï¼š**

```sql
select * from tb_sku limit 0,10;  -- ç”¨æ—¶0.01s
select * from tb_sku limit 2000000,10; -- æ‰§è¡Œæ—¶é—´è¾ƒé•¿ => 4.79s
```

![image-20250420223611874](./Mysql-Learning-Local.assets/image-20250420223611874.png)

![image-20250420223602982](./Mysql-Learning-Local.assets/image-20250420223602982.png)

```sql
-- ä½¿ç”¨ EXPLAIN ANALYZEï¼ˆMySQL 8.0+ï¼‰
-- è¿™ä¼šè¿”å› å®é™…æ‰§è¡Œè®¡åˆ’+æ—¶é—´ç»Ÿè®¡ï¼Œæ¯”æ…¢æŸ¥è¯¢æ—¥å¿—æ›´ç²¾ç¡®ã€‚
EXPLAIN ANALYZE SELECT * FROM `tb_sku` limit 2000000,10;
```

![image-20250420223727040](./Mysql-Learning-Local.assets/image-20250420223727040.png)



```sql
select count(*) from tb_sku;
```

![image-20250420222217483](./Mysql-Learning-Local.assets/image-20250420222217483.png)



é»˜è®¤æƒ…å†µä¸‹ï¼Œ**ä¸ä¼šè®°å½•ç®¡ç†è¯­å¥ï¼Œä¹Ÿä¸ä¼šè®°å½•ä¸ä½¿ç”¨ç´¢å¼•è¿›è¡ŒæŸ¥æ‰¾çš„æŸ¥è¯¢**ã€‚å¯ä»¥ä½¿ç”¨log_slow_admin_statementså’Œ æ›´æ”¹æ­¤è¡Œä¸º log_queries_not_using_indexesï¼Œå¦‚ä¸‹æ‰€è¿°ã€‚

```bash
#è®°å½•æ‰§è¡Œè¾ƒæ…¢çš„ç®¡ç†è¯­å¥
log_slow_admin_statements = 1

#è®°å½•æ‰§è¡Œè¾ƒæ…¢çš„æœªä½¿ç”¨ç´¢å¼•çš„è¯­å¥
log_queries_not_using_indexes = 1
```



> ä¸Šè¿°æ‰€æœ‰çš„å‚æ•°é…ç½®å®Œæˆä¹‹åï¼Œéƒ½éœ€è¦**é‡æ–°å¯åŠ¨MySQLæœåŠ¡å™¨**æ‰å¯ä»¥ç”Ÿæ•ˆã€‚
>
> ```bash
> -- é…ç½®å®Œæˆåï¼Œé‡å¯mysqlæœåŠ¡
> systemctl restart mysqld
> ```



------



# 2ã€==ä¸»ä»å¤åˆ¶==

## 2.1 æ¦‚è¿°

![image-20250420224309413](./Mysql-Learning-Local.assets/image-20250420224309413.png)

ä¸»ä»å¤åˆ¶æ˜¯æŒ‡**å°†ä¸»æ•°æ®åº“çš„ DDL å’Œ DML æ“ä½œ==é€šè¿‡äºŒè¿›åˆ¶æ—¥å¿—ä¼ åˆ°ä»åº“æœåŠ¡å™¨==ä¸­**ï¼Œç„¶ååœ¨ä»åº“ä¸Šå¯¹è¿™äº›æ—¥å¿—é‡æ–°æ‰§è¡Œï¼ˆä¹Ÿå«é‡åšï¼‰ï¼Œä»è€Œä½¿å¾—**ä»åº“å’Œä¸»åº“çš„æ•°æ®ä¿æŒåŒæ­¥**ã€‚

MySQLæ”¯æŒä¸€å°ä¸»åº“åŒæ—¶å‘å¤šå°ä»åº“è¿›è¡Œå¤åˆ¶ï¼Œ ä»åº“åŒæ—¶ä¹Ÿå¯ä»¥ä½œä¸ºå…¶ä»–ä»æœåŠ¡å™¨çš„ä¸»åº“ï¼Œ**å®ç°==é“¾çŠ¶å¤åˆ¶==**ã€‚



MySQL å¤åˆ¶çš„**ä¼˜ç‚¹**ä¸»è¦åŒ…å«ä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢ï¼š

- ä¸»åº“å‡ºç°é—®é¢˜ï¼Œå¯ä»¥**å¿«é€Ÿåˆ‡æ¢åˆ°ä»åº“æä¾›æœåŠ¡**ã€‚
- å®ç°**==è¯»å†™åˆ†ç¦»==ï¼Œé™ä½ä¸»åº“çš„è®¿é—®å‹åŠ›**ã€‚
- å¯ä»¥åœ¨**==ä»åº“ä¸­æ‰§è¡Œå¤‡ä»½==ï¼Œä»¥é¿å…å¤‡ä»½æœŸé—´å½±å“ä¸»åº“æœåŠ¡**ã€‚
  - ï¼ˆå› ä¸ºå¤‡ä»½éœ€è¦**æ·»åŠ å…¨å±€é”**ï¼Œä¼šå½±å“ä¸šåŠ¡æ“ä½œï¼‰




## 2.2 ==åŸç†==

MySQLä¸»ä»å¤åˆ¶çš„æ ¸å¿ƒå°±æ˜¯ **==äºŒè¿›åˆ¶æ—¥å¿—==**ï¼Œå…·ä½“çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š

![image-20250420224401343](./Mysql-Learning-Local.assets/image-20250420224401343.png)



ä»ä¸Šå›¾æ¥çœ‹ï¼Œ**å¤åˆ¶åˆ†æˆä¸‰æ­¥**ï¼š

1. Master ä¸»åº“åœ¨**äº‹åŠ¡æäº¤**æ—¶ï¼Œä¼š**æŠŠæ•°æ®å˜æ›´è®°å½•åœ¨äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ Binlog ä¸­**ã€‚

2. ä»åº“è¯»å–ä¸»åº“çš„äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ Binlog ï¼Œå†™å…¥åˆ°ä»åº“çš„**ä¸­ç»§æ—¥å¿— Relay Log** ã€‚ =ã€‹ IOthread

3. slave**é‡åš**ä¸­ç»§æ—¥å¿—ä¸­çš„äº‹ä»¶ï¼Œå°†æ”¹å˜åæ˜ å®ƒè‡ªå·±çš„æ•°æ®ã€‚ =ã€‹ SQLthread



**MySQLå¤åˆ¶è¯¦ç»†è¿‡ç¨‹åˆ†æˆä¸‰æ­¥ï¼š**

- **masterå°†æ”¹å˜è®°å½•åˆ°==äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆbinarylog)==**
- **slaveå°†masterçš„binarylogæ‹·è´åˆ°å®ƒçš„==ä¸­ç»§æ—¥å¿—ï¼ˆrelaylogï¼‰==**
  1. **é€šè¿‡å¼€å¯I/O thread çº¿ç¨‹ä»masterä¸»åº“ä¸­è¯»å–binlogï¼Œåœ¨å†™å…¥slaveä»åº“çš„ä¸­ç»§æ—¥å¿—relaylogã€‚**
  2. **åœ¨ä»åº“ä¸­åœ¨é€šè¿‡SQL threadçº¿ç¨‹è§£ææ—¥å¿—ï¼Œæ‰§è¡Œå’Œä¸»åº“ä¸€æ ·çš„sqlæ“ä½œ**
- **slaveé‡åšä¸­ç»§æ—¥å¿—ä¸­çš„äº‹ä»¶ï¼Œå°†æ”¹å˜åº”ç”¨åˆ°è‡ªå·±çš„æ•°æ®åº“ä¸­**



## 2.3 æ­å»º

<span id = 'ä¸»ä»å¤åˆ¶çš„æ­å»º' > </span>

### ï¼ˆ1ï¼‰å‡†å¤‡

![image-20250420230053577](./Mysql-Learning-Local.assets/image-20250420230053577.png)

å‡†å¤‡å¥½ä¸¤å°æœåŠ¡å™¨ä¹‹åï¼Œåœ¨ä¸Šè¿°çš„ä¸¤å°æœåŠ¡å™¨ä¸­åˆ†åˆ«å®‰è£…å¥½MySQLï¼Œå¹¶å®ŒæˆåŸºç¡€çš„åˆå§‹åŒ–å‡†å¤‡(å®‰è£…ã€å¯†ç é…ç½®ç­‰æ“ä½œ)å·¥ä½œã€‚ å…¶ä¸­ï¼š

192.168.200.200 ä½œä¸ºä¸»æœåŠ¡å™¨master = ã€‹ 	192.168.88.130 ï¼ˆè‡ªå·±çš„æœåŠ¡å™¨ipï¼‰

192.168.200.201 ä½œä¸ºä»æœåŠ¡å™¨slave  =ã€‹ 		192.168.88.131

```bash
# å¼€æ”¾æŒ‡å®šç«¯å£
firewall-cmd --zone=public --add-port=3306/tcp --permanent

# ç«‹å³ç”Ÿæ•ˆ
firewall-cmd --reload

#æŸ¥çœ‹å¼€æ”¾çš„ç«¯å£
firewall-cmd --zone=public --list-ports
```



### ï¼ˆ2ï¼‰ä¸»åº“é…ç½®

#### â‘ ä¿®æ”¹é…ç½®æ–‡ä»¶ /etc/my.cnf

**å‰ç½®æ¡ä»¶**

```bash
#æŸ¥æ‰¾my.confæ–‡ä»¶
find / -name "my.cnf"
```

<img src="./Mysql-Learning-Local.assets/image-20250420230327113.png" alt="image-20250420230327113" style="zoom: 80%;" />



```bash
log_bin = binlog # å¯ç”¨äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆBinary Logï¼‰å¹¶æŒ‡å®šæ—¥å¿—æ–‡ä»¶çš„åŸºç¡€åç§°
#mysql æœåŠ¡IDï¼Œä¿è¯æ•´ä¸ªé›†ç¾¤ç¯å¢ƒä¸­å”¯ä¸€ï¼Œå–å€¼èŒƒå›´ï¼š1 â€“ (2çš„32æ¬¡æ–¹-1)ï¼Œ é»˜è®¤ä¸º1
server-id=1  #[å¿…é¡»]æœåŠ¡å™¨å”¯ä¸€ID

#æ˜¯å¦åªè¯»,1 ä»£è¡¨åªè¯», 0 ä»£è¡¨è¯»å†™
read-only=0    #ä¸»åº“è®¾ç½®ä¸º0ï¼Œè¡¨ç¤ºå¯ä»¥è¯»å†™
#è®¾ç½®read-only = 1çš„ åªè¯» åªé’ˆå¯¹æ™®é€šç”¨æˆ·ï¼Œè‹¥æƒ³è®¾ç½®è¶…çº§ç®¡ç†å‘˜çš„æƒé™å› ä¸ºåªè¯»ï¼š
#super-read-only=1

#å¿½ç•¥çš„æ•°æ®, æŒ‡ä¸éœ€è¦åŒæ­¥çš„æ•°æ®åº“
#binlog-ignore-db=mysql

#æŒ‡å®šåŒæ­¥çš„æ•°æ®åº“
#binlog-do-db=db01
```

![image-20250420230506965](./Mysql-Learning-Local.assets/image-20250420230506965.png)



#### â‘¡é‡å¯MySQLæœåŠ¡å™¨

```bash
systemctl restart mysqld 
```



#### â‘¢ç™»å½•mysqlï¼Œåˆ›å»ºè¿œç¨‹è¿æ¥çš„è´¦å·ï¼Œå¹¶æˆäºˆä¸»ä»å¤åˆ¶æƒé™

**ç™»å½•Mysqlå®¢æˆ·ç«¯**

```bash
mysql -uroot -proot
```

****

```sql
#åˆ›å»ºitcastç”¨æˆ·ï¼Œå¹¶è®¾ç½®å¯†ç ï¼Œè¯¥ç”¨æˆ·å¯åœ¨ä»»æ„ä¸»æœºè¿æ¥è¯¥MySQLæœåŠ¡
CREATE USER 'itcast'@'%' IDENTIFIED WITH mysql_native_password BY 'Root@123456';
-- è¿™é‡Œçš„%è¡¨ç¤ºitcastç”¨æˆ·å¯ä»¥åœ¨ä»»æ„ä¸»æœºä¸Šè¿›è¡Œè®¿é—®è¯¥æ•°æ®åº“ 
-- Root@123456 è¡¨ç¤ºè¯¥ç”¨æˆ·çš„å¯†ç 

#ä¸º 'itcast'@'%' ç”¨æˆ·åˆ†é…ä¸»ä»å¤åˆ¶æƒé™
GRANT REPLICATION SLAVE ON *.* TO 'itcast'@'%';
```



#### â‘£é€šè¿‡æŒ‡ä»¤ï¼ŒæŸ¥çœ‹äºŒè¿›åˆ¶æ—¥å¿—åæ ‡

```sql
show master status ; 
-- 8.40ç‰ˆæœ¬çš„ä½¿ç”¨æ–°çš„æŒ‡ä»¤SHOW BINARY LOG STATUS.
```

![image-20250420234611819](./Mysql-Learning-Local.assets/image-20250420234611819.png)

å­—æ®µå«ä¹‰è¯´æ˜ï¼š

-  file : **ä»å“ªä¸ªæ—¥å¿—æ–‡ä»¶==å¼€å§‹æ¨é€æ—¥å¿—æ–‡ä»¶==**ï¼Œæ³¨æ„è¿™é‡Œçš„**æ–‡ä»¶åå‰ç¼€**ï¼Œåç»­ä»åº“å’Œä¸»åº“è¿›è¡Œå…³è”æ—¶ä¼šä½¿ç”¨åˆ°
   -  æ–‡ä»¶åå‰ç¼€ï¼Œé€šè¿‡log_bin = binlog è®¾ç½®ï¼š**å¯ç”¨äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆBinary Logï¼‰å¹¶æŒ‡å®šæ—¥å¿—æ–‡ä»¶çš„åŸºç¡€åç§°**

-  position ï¼š **ä»å“ªä¸ªä½ç½®å¼€å§‹æ¨é€æ—¥å¿—**
-  binlog_ignore_db : æŒ‡å®šä¸éœ€è¦åŒæ­¥çš„æ•°æ®åº“



> **==æ³¨æ„==ï¼š**
>
> ç”±äºä¸»ä»å¤åˆ¶æ˜¯é€šè¿‡äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶è¿›è¡ŒåŒæ­¥çš„ï¼Œä½†æ˜¯åªèƒ½é€‰æ‹©ä»æŸä¸ªæ—¥å¿—æ–‡ä»¶çš„æŸä¸ªä½ç½®å¼€å§‹è¿›è¡Œæ¨é€å¹¶åŒæ­¥ã€‚
>
> å¦‚æœæ­¤æ—¶ä¸»åº“åœ¨`è¯¥æ¨é€æ—¥å¿—æ–‡ä»¶`å·²ç»æœ‰äº†æ•°æ®ï¼Œç›´æ¥é€šè¿‡ä¸»ä»å¤åˆ¶æ˜¯ä¸èƒ½åŒæ­¥è¿™äº›`æ—¥å¿—æ–‡ä»¶`ä¹‹å‰çš„æ•°æ®ï¼Œå¯ä»¥é‡‡ç”¨æ ¹æ®ä¸»åº“çš„ç»“æ„å’Œæ•°æ®ï¼Œç”Ÿæˆsqlè¯­å¥ï¼Œ**å…ˆåœ¨ä»åº“ä¸­æ‰§è¡Œè¯¥ç”Ÿæˆçš„sqlåï¼Œä¿è¯ä¸»ä»çš„åˆå§‹æ•°æ®ä¸€è‡´ï¼Œå†æ¥è¿›è¡Œä¸»ä»å¤åˆ¶çš„é…ç½®**ã€‚



**å¦‚æœé‡åˆ°è¿”å›çš„æ˜¯ç©ºé›†åˆï¼š**

<img src="./Mysql-Learning-Local.assets/image-20250420233752874.png" alt="image-20250420233752874" style="zoom:80%;" />



```sql
SHOW VARIABLES LIKE 'log_bin';  -- å¦‚æœè¿”å› OFFï¼Œè¯´æ˜äºŒè¿›åˆ¶æ—¥å¿—æœªå¯ç”¨ã€‚
```

ä¿®æ”¹ MySQL é…ç½®æ–‡ä»¶ï¼ˆ`my.cnf` æˆ– `my.ini`ï¼‰ï¼š

```bash
[mysqld]
log_bin = binlog # å¯ç”¨äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆBinary Logï¼‰å¹¶æŒ‡å®šæ—¥å¿—æ–‡ä»¶çš„åŸºç¡€åç§°
server_id = 1  # ä¸»ä»å¤åˆ¶å¿…é¡»è®¾ç½® server_idï¼ˆå”¯ä¸€å€¼ï¼‰
```

é‡å¯ MySQLï¼š

```bash
sudo systemctl restart mysqld  # æˆ– mysqlï¼ˆå–å†³äºç³»ç»Ÿï¼‰
```



### ï¼ˆ3ï¼‰ä»åº“é…ç½®

#### â‘ ä¿®æ”¹é…ç½®æ–‡ä»¶ /etc/my.cnf

```bash
#mysql æœåŠ¡IDï¼Œä¿è¯æ•´ä¸ªé›†ç¾¤ç¯å¢ƒä¸­å”¯ä¸€ï¼Œå–å€¼èŒƒå›´ï¼š1 åˆ° 2^32-1ï¼Œå’Œä¸»åº“ä¸ä¸€æ ·å³å¯
server-id=2  #å’Œä¸»åº“ä¸ä¸€æ ·å³å¯

#æ˜¯å¦åªè¯»,1 ä»£è¡¨åªè¯», 0 ä»£è¡¨è¯»å†™
read-only=1  # åªé’ˆå¯¹æ™®é€šç®¡ç†å‘˜æœ‰æ•ˆ
#è®¾ç½®read-only = 1çš„ åªè¯» åªé’ˆå¯¹æ™®é€šç”¨æˆ·ï¼Œè‹¥æƒ³è®¾ç½®è¶…çº§ç®¡ç†å‘˜çš„æƒé™å› ä¸ºåªè¯»ï¼š
#super-read-only=1
```



#### â‘¡é‡æ–°å¯åŠ¨MySQLæœåŠ¡

```bash
systemctl restart mysqld
```



#### â‘¢ç™»å½•mysqlï¼Œè®¾ç½®ä¸»åº“é…ç½®

![image-20250420232315054](./Mysql-Learning-Local.assets/image-20250420232315054.png)

##### 1ï¼‰é€šè¿‡æŒ‡ä»¤ï¼ŒæŸ¥çœ‹äºŒè¿›åˆ¶æ—¥å¿—åæ ‡

```sql
show master status ; 
-- 8.40ç‰ˆæœ¬çš„ä½¿ç”¨æ–°çš„æŒ‡ä»¤SHOW BINARY LOG STATUS.
```

![image-20250420234605471](./Mysql-Learning-Local.assets/image-20250420234605471.png)

å­—æ®µå«ä¹‰è¯´æ˜ï¼š

-  file : **ä»å“ªä¸ªæ—¥å¿—æ–‡ä»¶==å¼€å§‹æ¨é€æ—¥å¿—æ–‡ä»¶==**
-  position ï¼š **ä»å“ªä¸ªä½ç½®å¼€å§‹æ¨é€æ—¥å¿—**
-  binlog_ignore_db : æŒ‡å®šä¸éœ€è¦åŒæ­¥çš„æ•°æ®åº“



##### 2ï¼‰ä»åº“å…³è”ä¸»åº“

```sql
-- ç™»å½•Mysql
mysql -uroot -proot

CHANGE REPLICATION SOURCE TO SOURCE_HOST='192.168.88.130',SOURCE_USER='itcast',SOURCE_PASSWORD='Root@123456', SOURCE_LOG_FILE='binlog.000001',SOURCE_LOG_POS=154;
```

ä¸Šè¿°æ˜¯8.0.23ä¸­çš„è¯­æ³•ã€‚å¦‚æœ**mysqlæ˜¯ 8.0.23 ä¹‹å‰çš„ç‰ˆæœ¬**ï¼Œæ‰§è¡Œå¦‚ä¸‹SQLï¼š

```sql
CHANGE MASTER TO MASTER_HOST='192.168.88.130', MASTER_USER='itcast',
MASTER_PASSWORD='Root@123456', MASTER_LOG_FILE='binlog.000001',
MASTER_LOG_POS=154;
```

![image-20250420233514878](./Mysql-Learning-Local.assets/image-20250420233514878.png)

![image-20250420232825533](./Mysql-Learning-Local.assets/image-20250420232825533.png)

![image-20250420151654229](./Mysql-Learning-Local.assets/image-20250420151654229.png)



#### â‘£å¼€å¯åŒæ­¥æ“ä½œ

```sql
start replica ; #8.0.22ä¹‹å

start slave ; #8.0.22ä¹‹å‰
```



#### â‘¤æŸ¥çœ‹ä¸»ä»åŒæ­¥çŠ¶æ€

```sql
show replica status ; #8.0.22ä¹‹å

show slave status\G; #8.0.22ä¹‹å‰
```

**å½“IO_Runningå’ŒSQL_Runningéƒ½æ˜¾ç¤ºä¸ºyesæ—¶ï¼Œè¯´æ˜é…ç½®æˆåŠŸ**

![image-20250420235029710](./Mysql-Learning-Local.assets/image-20250420235029710.png)



### ï¼ˆ4ï¼‰æµ‹è¯•

#### â‘ ä¸»åº“

åœ¨**ä¸»åº“** 192.168.88.130 ä¸Š**åˆ›å»ºæ•°æ®åº“ã€è¡¨ï¼Œå¹¶æ’å…¥æ•°æ®**

```sql
create database db01;

use db01;

create table tb_user(
    id int(11) primary key not null auto_increment,
    name varchar(50) not null,
    sex varchar(1)
)engine=innodb default charset=utf8mb4;

insert into tb_user(id,name,sex) 
    values
    (null,'Tom', '1'),
    (null,'Trigger','0'),
    (null,'Dawn','1');
```



#### â‘¡ä»åº“

åœ¨**ä»åº“** 192.168.88.131 ä¸­**æŸ¥è¯¢æ•°æ®ï¼ŒéªŒè¯ä¸»ä»æ˜¯å¦åŒæ­¥**





## 2.4 å°ç»“

![image-20250421000217678](./Mysql-Learning-Local.assets/image-20250421000217678.png)



------



# 3ã€ğŸš€ ==åˆ†åº“åˆ†è¡¨==

## 3.1 ä»‹ç»

### ï¼ˆ1ï¼‰é—®é¢˜åˆ†æ

![image-20250421000528943](./Mysql-Learning-Local.assets/image-20250421000528943.png)

éšç€äº’è”ç½‘åŠç§»åŠ¨äº’è”ç½‘çš„å‘å±•ï¼Œåº”ç”¨ç³»ç»Ÿçš„æ•°æ®é‡ä¹Ÿæ˜¯æˆæŒ‡æ•°å¼å¢é•¿ï¼Œè‹¥é‡‡ç”¨å•æ•°æ®åº“è¿›è¡Œæ•°æ®å­˜å‚¨ï¼Œå­˜åœ¨ä»¥ä¸‹æ€§èƒ½ç“¶é¢ˆï¼š

1. **IOç“¶é¢ˆ**ï¼šçƒ­ç‚¹æ•°æ®å¤ªå¤šï¼Œæ•°æ®åº“ç¼“å­˜ä¸è¶³ï¼ˆæ•°æ®åº“ç¼“å­˜éœ€è¦å ç”¨å†…å­˜ï¼‰ï¼Œ**äº§ç”Ÿå¤§é‡ç£ç›˜IO**ï¼Œæ•ˆç‡è¾ƒä½ã€‚ è¯·æ±‚æ•°æ®å¤ªå¤šï¼Œ**å¸¦å®½ä¸å¤Ÿï¼Œç½‘ç»œIOç“¶é¢ˆ**ã€‚
   1. ç»“åˆInnoDBçš„å­˜å‚¨ç»“æ„æ¥é˜è¿°ï¼šåœ¨InnoDBå­˜å‚¨å¼•æ“å½“ä¸­ï¼Œæœ‰å¾ˆå¤§ä¸€éƒ¨åˆ†çš„å­˜å‚¨å†…å­˜éƒ½åˆ†é…ç»™äº†æ•°æ®åº“çš„ç¼“å­˜åŒºï¼Œå¦‚æœçƒ­ç‚¹æ•°æ®è¿‡å¤šï¼Œä¼šå¯¼è‡´æœåŠ¡å™¨çš„å†…å­˜ä¸è¶³ï¼Œè¿›è€Œå¯¼è‡´æ•°æ®åº“åˆ†é…åˆ°çš„ç¼“å†²åŒºä¹Ÿä¸è¶³=ã€‹**ç¼“å†²åŒºå†…ç¼“å­˜çš„æ•°æ®çš„èƒ½åŠ›é™ä½ï¼Œè¿›è€Œä¼šå¯¼è‡´äº§ç”Ÿå¤§é‡çš„ç£ç›˜IO**ã€‚
   2. [è·³è½¬åˆ° =ã€‹Buffer Poolç¼“å­˜æ± ](#Buffer Poolç¼“å­˜æ± )

2. **CPUç“¶é¢ˆ**ï¼šæ’åºã€åˆ†ç»„ã€è¿æ¥æŸ¥è¯¢ã€èšåˆç»Ÿè®¡ç­‰**SQLä¼šè€—è´¹å¤§é‡çš„CPUèµ„æº**ï¼Œè¯·æ±‚æ•°å¤ªå¤šï¼ŒCPUå‡ºç°ç“¶é¢ˆã€‚



ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦å¯¹æ•°æ®åº“è¿›è¡Œ**åˆ†åº“åˆ†è¡¨å¤„ç†**ã€‚



> åˆ†åº“åˆ†è¡¨çš„ä¸­å¿ƒæ€æƒ³éƒ½æ˜¯**å°†æ•°æ®åˆ†æ•£å­˜å‚¨**ï¼Œä½¿å¾—å•ä¸€æ•°æ®åº“/è¡¨çš„æ•°æ®é‡å˜å°æ¥ç¼“è§£å•ä¸€æ•°æ®åº“çš„æ€§èƒ½é—®é¢˜ï¼Œä»è€Œè¾¾åˆ°æå‡æ•°æ®åº“æ€§èƒ½çš„ç›®çš„ã€‚





### ï¼ˆ2ï¼‰æ‹†åˆ†ç­–ç•¥

åˆ†åº“åˆ†è¡¨çš„å½¢å¼ï¼Œä¸»è¦æ˜¯ä¸¤ç§ï¼šå‚ç›´æ‹†åˆ†å’Œæ°´å¹³æ‹†åˆ†ã€‚

- æŒ‰ç…§æ‹†åˆ†çš„**åŠ›åº¦ä¸åŒ**å¯åˆ†ä¸ºï¼š**åˆ†åº“å’Œåˆ†è¡¨**
- æŒ‰ç…§æ‹†åˆ†çš„**ç»´åº¦ä¸åŒ**å¯åˆ†ä¸ºï¼š**å‚ç›´æ‹†åˆ†å’Œæ°´å¹³æ‹†åˆ†**

è€Œ**==æ‹†åˆ†çš„ç²’åº¦==**ï¼Œä¸€èˆ¬åˆåˆ†ä¸º**åˆ†åº“å’Œåˆ†è¡¨**ï¼Œæ‰€ä»¥ç»„æˆçš„æ‹†åˆ†ç­–ç•¥æœ€ç»ˆå¦‚ä¸‹ï¼š

![image-20250421125306844](./Mysql-Learning-Local.assets/image-20250421125306844.png)



### ï¼ˆ3ï¼‰==å‚ç›´æ‹†åˆ†==

![image-20250421125824281](./Mysql-Learning-Local.assets/image-20250421125824281.png)

#### â‘ å‚ç›´åˆ†åº“

![image-20250421125607719](./Mysql-Learning-Local.assets/image-20250421125607719.png)

å‚ç›´åˆ†åº“ï¼š**ä»¥==è¡¨==ä¸ºä¾æ®ï¼Œæ ¹æ®==ä¸šåŠ¡å°†ä¸åŒè¡¨æ‹†åˆ†åˆ°ä¸åŒåº“ä¸­==**ã€‚



**ç‰¹ç‚¹ï¼š**

- æ¯ä¸ªåº“çš„è¡¨ç»“æ„éƒ½ä¸ä¸€æ ·ã€‚
- æ¯ä¸ªåº“çš„æ•°æ®ä¹Ÿä¸ä¸€æ ·ã€‚
- **æ‰€æœ‰åº“çš„å¹¶é›†æ˜¯å…¨é‡æ•°æ®**ã€‚



#### â‘¡å‚ç›´åˆ†è¡¨

<img src="./Mysql-Learning-Local.assets/image-20250421125807607.png" alt="image-20250421125807607" style="zoom:80%;" />

å‚ç›´åˆ†è¡¨ï¼š**ä»¥==å­—æ®µ==ä¸ºä¾æ®**ï¼Œæ ¹æ®**å­—æ®µå±æ€§å°†==ä¸åŒå­—æ®µæ‹†åˆ†åˆ°ä¸åŒè¡¨==ä¸­**ã€‚

â€‹	æ‹†åˆ†ä¾æ®  =ã€‹å¯ä»¥æŒ‰ç…§**å†·çƒ­æ•°æ®åˆ†ç¦»**çš„æ€æƒ³å»æ‹†åˆ†



**ç‰¹ç‚¹ï¼š**

- æ¯ä¸ªè¡¨çš„ç»“æ„éƒ½ä¸ä¸€æ ·ã€‚
- æ¯ä¸ªè¡¨çš„æ•°æ®ä¹Ÿä¸ä¸€æ ·ï¼Œä¸€èˆ¬**é€šè¿‡ä¸€åˆ—ï¼ˆä¸»é”®/å¤–é”®ï¼‰å…³è”**ã€‚
- **æ‰€æœ‰è¡¨çš„å¹¶é›†æ˜¯å…¨é‡æ•°æ®**ã€‚



### ï¼ˆ4ï¼‰==æ°´å¹³æ‹†åˆ†==

![image-20250421130405425](./Mysql-Learning-Local.assets/image-20250421130405425.png)

#### â‘ æ°´å¹³åˆ†åº“

<img src="./Mysql-Learning-Local.assets/image-20250421130312719.png" alt="image-20250421130312719" style="zoom:80%;" />

æ°´å¹³åˆ†åº“ï¼š**ä»¥å­—æ®µä¸ºä¾æ®**ï¼ŒæŒ‰ç…§ä¸€å®šç­–ç•¥ï¼Œ**å°†==ä¸€ä¸ªåº“çš„æ•°æ®==æ‹†åˆ†åˆ°å¤šä¸ªåº“ä¸­**ã€‚= ã€‹ ç±»ä¼¼äº `åˆ†é¡µçš„æ€æƒ³`



ç‰¹ç‚¹ï¼š

- æ¯ä¸ªåº“çš„**è¡¨ç»“æ„éƒ½ä¸€æ ·**ã€‚

- æ¯ä¸ª**åº“**çš„**æ•°æ®éƒ½ä¸ä¸€æ ·**ã€‚
- æ‰€æœ‰åº“çš„å¹¶é›†æ˜¯å…¨é‡æ•°æ®ã€‚



####  â‘¡æ°´å¹³åˆ†è¡¨

<img src="./Mysql-Learning-Local.assets/image-20250421130320877.png" alt="image-20250421130320877" style="zoom:80%;" />

æ°´å¹³åˆ†è¡¨ï¼šä»¥å­—æ®µä¸ºä¾æ®ï¼ŒæŒ‰ç…§ä¸€å®šç­–ç•¥ï¼Œ**å°†==ä¸€ä¸ªè¡¨çš„æ•°æ®==æ‹†åˆ†åˆ°å¤šä¸ªè¡¨ä¸­**ã€‚

ç‰¹ç‚¹ï¼š

- æ¯ä¸ªè¡¨çš„è¡¨ç»“æ„éƒ½ä¸€æ ·ã€‚
- **æ¯ä¸ªè¡¨çš„æ•°æ®éƒ½ä¸ä¸€æ ·**ã€‚
- æ‰€æœ‰è¡¨çš„å¹¶é›†æ˜¯å…¨é‡æ•°æ®ã€‚



> åœ¨ä¸šåŠ¡ç³»ç»Ÿä¸­ï¼Œä¸ºäº†ç¼“è§£ç£ç›˜IOåŠCPUçš„æ€§èƒ½ç“¶é¢ˆï¼Œåˆ°åº•æ˜¯å‚ç›´æ‹†åˆ†ï¼Œè¿˜æ˜¯æ°´å¹³æ‹†åˆ†ï¼›å…·ä½“æ˜¯åˆ†åº“ï¼Œè¿˜æ˜¯åˆ†è¡¨ï¼Œéƒ½éœ€è¦**æ ¹æ®å…·ä½“çš„ä¸šåŠ¡éœ€æ±‚**å…·ä½“åˆ†æã€‚



### ï¼ˆ5ï¼‰å®ç°æŠ€æœ¯

![image-20250421130628119](./Mysql-Learning-Local.assets/image-20250421130628119.png)



- shardingJDBCï¼š**åŸºäº==AOPåŸç†==**ï¼Œåœ¨åº”ç”¨ç¨‹åºä¸­å¯¹æœ¬åœ°æ‰§è¡Œçš„SQLè¿›è¡Œæ‹¦æˆªï¼Œè§£æã€æ”¹å†™ã€è·¯ç”±å¤„ç†ã€‚éœ€è¦è‡ªè¡Œç¼–ç é…ç½®å®ç°ï¼Œåªæ”¯æŒjavaè¯­è¨€ï¼Œ**æ€§èƒ½è¾ƒé«˜**ã€‚
- MyCatï¼šæ•°æ®åº“**åˆ†åº“åˆ†è¡¨ä¸­é—´ä»¶**ï¼Œ**ä¸ç”¨è°ƒæ•´ä»£ç å³å¯å®ç°åˆ†åº“åˆ†è¡¨**ï¼Œæ”¯æŒå¤šç§è¯­è¨€ï¼Œæ€§èƒ½ä¸åŠå‰è€…ã€‚
  - ä¸éœ€è¦å¯¹åº”ç”¨ç¨‹åºåšä»»ä½•çš„é…ç½®å’Œå¯¼å…¥ä»»ä½•çš„ä¾èµ–




æœ¬æ¬¡è¯¾ç¨‹ï¼Œæˆ‘ä»¬é€‰æ‹©äº†æ˜¯**MyCatæ•°æ®åº“ä¸­é—´ä»¶**ï¼Œé€šè¿‡MyCatä¸­é—´ä»¶æ¥å®Œæˆåˆ†åº“åˆ†è¡¨æ“ä½œã€‚



## 3.2 MyCatæ¦‚è¿°

### ï¼ˆ1ï¼‰ä»‹ç»

Mycatæ˜¯å¼€æºçš„ã€æ´»è·ƒçš„ã€**åŸºäºJavaè¯­è¨€ç¼–å†™çš„MySQLæ•°æ®åº“ä¸­é—´ä»¶**ã€‚å¯ä»¥åƒä½¿ç”¨mysqlä¸€æ ·æ¥ä½¿ç”¨mycatï¼Œå¯¹äºå¼€å‘äººå‘˜æ¥è¯´æ ¹æœ¬æ„Ÿè§‰ä¸åˆ°mycatçš„å­˜åœ¨ã€‚= ã€‹ MyCat è¿›è¡Œäº† "ä¼ªè£…åè®®"

å¼€å‘äººå‘˜**åªéœ€è¦è¿æ¥MyCatå³å¯**ï¼Œè€Œå…·ä½“åº•å±‚ç”¨åˆ°å‡ å°æ•°æ®åº“ï¼Œæ¯ä¸€å°æ•°æ®åº“æœåŠ¡å™¨é‡Œé¢å­˜å‚¨äº†ä»€ä¹ˆæ•°æ®ï¼Œéƒ½æ— éœ€å…³å¿ƒã€‚ å…·ä½“çš„åˆ†åº“åˆ†è¡¨çš„ç­–ç•¥ï¼Œåªéœ€è¦**åœ¨MyCatä¸­é…ç½®**å³å¯ã€‚

<img src="./Mysql-Learning-Local.assets/image-20250421131045597.png" alt="image-20250421131045597" style="zoom:80%;" />

ä¼˜åŠ¿ï¼š

- æ€§èƒ½å¯é ç¨³å®š
- å¼ºå¤§çš„æŠ€æœ¯å›¢é˜Ÿ
- ä½“ç³»å®Œå–„
- ç¤¾åŒºæ´»è·ƒ



### ï¼ˆ2ï¼‰ä¸‹è½½

ä¸‹è½½åœ°å€ï¼š**http://mycat.org.cn/**

**æœ¬æ¬¡è¯¾ï¼Œä½¿ç”¨1.6.7.3-releaseç‰ˆæœ¬**

![image-20250421131055378](./Mysql-Learning-Local.assets/image-20250421131055378.png)



### ï¼ˆ3ï¼‰å®‰è£…

Mycatæ˜¯é‡‡ç”¨**javaè¯­è¨€å¼€å‘**çš„å¼€æºçš„æ•°æ®åº“ä¸­é—´ä»¶ï¼Œ**æ”¯æŒWindowså’ŒLinuxè¿è¡Œç¯å¢ƒ**ï¼Œä¸‹é¢ä»‹ç»MyCatçš„Linuxä¸­çš„ç¯å¢ƒæ­å»ºã€‚æˆ‘ä»¬éœ€è¦åœ¨å‡†å¤‡å¥½çš„æœåŠ¡å™¨ä¸­å®‰è£…å¦‚ä¸‹è½¯ä»¶ã€‚

- **MySQL**
- **JDK**
- **Mycat**

![image-20250420153053631](./Mysql-Learning-Local.assets/image-20250420153053631.png)

**æˆ‘çš„æœåŠ¡å™¨åˆ†é…æ–¹æ¡ˆï¼š**

- 192.168.88.130 =ã€‹JDKã€MyCat
- 192.168.88.130 =ã€‹ Mysql åˆ†ç‰‡æœåŠ¡å™¨ä¸€ , åŒæ—¶ä¹Ÿæ˜¯ä¹‹å‰å­¦ä¹ çš„ä¸»åº“
- 192.168.88.131 =ã€‹ Mysql åˆ†ç‰‡æœåŠ¡å™¨äºŒï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¹‹å‰å­¦ä¹ çš„ä»åº“
- 192.168.88.129 =ã€‹ Mysql åˆ†ç‰‡æœåŠ¡å™¨ä¸‰

![image-20250421144733511](./Mysql-Learning-Local.assets/image-20250421144733511.png)

å…·ä½“çš„å®‰è£…æ­¥éª¤ï¼š å‚è€ƒèµ„æ–™ä¸­æä¾›çš„ ã€ŠMyCatå®‰è£…æ–‡æ¡£ã€‹å³å¯ï¼Œé‡Œé¢æœ‰è¯¦ç»†çš„å®‰è£…åŠé…ç½®æ­¥éª¤ã€‚



#### â‘ JDKå®‰è£…å¹¶é…ç½®ç¯å¢ƒå˜é‡

JDKå…·ä½“å®‰è£…æ­¥éª¤å¦‚ä¸‹ï¼š 

##### 1. ä¸Šä¼ å®‰è£…åŒ…

ä½¿ç”¨FinalShellè‡ªå¸¦çš„ä¸Šä¼ å·¥å…·å°†jdkçš„äºŒè¿›åˆ¶å‘å¸ƒåŒ…ä¸Šä¼ åˆ°Linux 

ç”±äºä¸Šè¿°åœ¨è¿›è¡Œæ–‡ä»¶ä¸Šä¼ æ—¶ï¼Œé€‰æ‹©çš„ä¸Šä¼ ç›®å½•ä¸ºæ ¹ç›®å½• /ï¼Œä¸Šä¼ å®Œæ¯•åï¼Œæˆ‘ä»¬æ‰§è¡ŒæŒ‡ä»¤ cd / åˆ‡æ¢åˆ°æ ¹ç›®å½•ä¸‹ï¼ŒæŸ¥çœ‹ä¸Šä¼ çš„å®‰è£…åŒ…ã€‚

![image-20210814180702071](./Mysql-Learning-Local.assets/image-20210814180702071.png) 



##### 2. è§£å‹å®‰è£…åŒ…

æ‰§è¡Œå¦‚ä¸‹æŒ‡ä»¤ï¼Œå°†ä¸Šä¼ ä¸Šæ¥çš„å‹ç¼©åŒ…è¿›è¡Œè§£å‹ï¼Œå¹¶é€šè¿‡-Cå‚æ•°æŒ‡å®šè§£å‹æ–‡ä»¶å­˜æ”¾ç›®å½•ä¸º /usr/localã€‚

```
tar -zxvf jdk-8u171-linux-x64.tar.gz -C /usr/local
```

![image-20210814181014481](./Mysql-Learning-Local.assets/image-20210814181014481.png) 



##### 3. é…ç½®ç¯å¢ƒå˜é‡

ä½¿ç”¨vimå‘½ä»¤ä¿®æ”¹/etc/profileæ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶æœ«å°¾åŠ å…¥å¦‚ä¸‹é…ç½®

```
JAVA_HOME=/usr/local/jdk1.8.0_171
PATH=$JAVA_HOME/bin:$PATH
```

å…·ä½“æ“ä½œæŒ‡ä»¤å¦‚ä¸‹: 

```
1). ç¼–è¾‘/etc/profileæ–‡ä»¶ï¼Œè¿›å…¥å‘½ä»¤æ¨¡å¼
	vim /etc/profile

2). åœ¨å‘½ä»¤æ¨¡å¼ä¸­ï¼Œè¾“å…¥æŒ‡ä»¤ G ï¼Œ åˆ‡æ¢åˆ°æ–‡ä»¶æœ€å
	G

3). åœ¨å‘½ä»¤æ¨¡å¼ä¸­è¾“å…¥ i/a/o è¿›å…¥æ’å…¥æ¨¡å¼ï¼Œç„¶ååˆ‡æ¢åˆ°æ–‡ä»¶æœ€åä¸€è¡Œ
	i

4). å°†ä¸Šè¿°çš„é…ç½®æ‹·è´åˆ°æ–‡ä»¶ä¸­
	export JAVA_HOME=/usr/local/jdk1.8.0_171
	export PATH=$JAVA_HOME/bin:$PATH
	
5). ä»æ’å…¥æ¨¡å¼ï¼Œåˆ‡æ¢åˆ°æŒ‡ä»¤æ¨¡å¼
	ESC
	
6). æŒ‰:è¿›å…¥åº•è¡Œæ¨¡å¼ï¼Œç„¶åè¾“å…¥wqï¼Œå›è½¦ä¿å­˜
	:wq
```



##### 4. é‡æ–°åŠ è½½profileæ–‡ä»¶

ä¸ºäº†ä½¿æ›´æ”¹çš„é…ç½®ç«‹å³ç”Ÿæ•ˆï¼Œéœ€è¦é‡æ–°åŠ è½½profileæ–‡ä»¶ï¼Œæ‰§è¡Œå‘½ä»¤:

```
source /etc/profile
```



##### 5. æ£€æŸ¥å®‰è£…æ˜¯å¦æˆåŠŸ

```
java -version
```

![image-20210814182327675](./Mysql-Learning-Local.assets/image-20210814182327675.png) 



#### â‘¡MyCatå®‰è£…

##### 1. ä¸Šä¼ Mycatå‹ç¼©åŒ…åˆ°æœåŠ¡å™¨

Mycat-server-1.6.7.3-release-20210913163959-linux.tar.gz 



##### 2. è§£å‹MyCatçš„å‹ç¼©åŒ…

```bash
tar -zxvf Mycat-server-1.6.7.3-release-20210913163959-linux.tar.gz -C /usr/local/
```

<img src="./Mysql-Learning-Local.assets/image-20250421142355296.png" alt="image-20250421142355296" style="zoom:80%;" />



### ï¼ˆ4ï¼‰ç›®å½•ç»“æ„

- bin : å­˜æ”¾å¯æ‰§è¡Œæ–‡ä»¶ï¼Œç”¨äºå¯åŠ¨åœæ­¢mycat
- confï¼šå­˜æ”¾mycatçš„é…ç½®æ–‡ä»¶
- libï¼šå­˜æ”¾mycatçš„é¡¹ç›®ä¾èµ–åŒ…ï¼ˆjarï¼‰
- logsï¼šå­˜æ”¾mycatçš„æ—¥å¿—æ–‡ä»¶

![image-20250421142550041](./Mysql-Learning-Local.assets/image-20250421142550041.png)

```bash
cd lib/ # æŸ¥çœ‹mycatçš„é¡¹ç›®ä¾èµ–åŒ…
```

![image-20250421142953194](./Mysql-Learning-Local.assets/image-20250421142953194.png)

```bash
rm -rf mysql-connector-java-5.1.35.jar

chmod 777 mysql-connector-java-8.0.22.jar
```

![image-20250421143225917](./Mysql-Learning-Local.assets/image-20250421143225917.png)

![image-20250421143333110](./Mysql-Learning-Local.assets/image-20250421143333110.png)



### ï¼ˆ5ï¼‰æ¦‚å¿µä»‹ç»

åœ¨MyCatçš„æ•´ä½“ç»“æ„ä¸­ï¼Œåˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼šä¸Šé¢çš„**é€»è¾‘ç»“æ„**ã€ä¸‹é¢çš„**ç‰©ç†ç»“æ„**ã€‚

![image-20250421143432824](./Mysql-Learning-Local.assets/image-20250421143432824.png)

åœ¨MyCatçš„é€»è¾‘ç»“æ„ä¸»è¦è´Ÿè´£**é€»è¾‘åº“ã€é€»è¾‘è¡¨ã€åˆ†ç‰‡è§„åˆ™ã€åˆ†ç‰‡èŠ‚ç‚¹ç­‰é€»è¾‘ç»“æ„çš„å¤„ç†**ï¼Œè€Œå…·ä½“çš„æ•°æ®å­˜å‚¨è¿˜æ˜¯åœ¨ç‰©ç†ç»“æ„ï¼Œä¹Ÿå°±æ˜¯æ•°æ®åº“æœåŠ¡å™¨ä¸­å­˜å‚¨çš„ã€‚

åœ¨åé¢è®²è§£MyCatå…¥é—¨ä»¥åŠMyCatåˆ†ç‰‡æ—¶ï¼Œè¿˜ä¼šè®²åˆ°ä¸Šé¢æ‰€æåˆ°çš„æ¦‚å¿µã€‚



## 3.3 ==MyCatå…¥é—¨==

### ï¼ˆ1ï¼‰éœ€æ±‚

ç”±äº tb_order è¡¨ä¸­æ•°æ®é‡å¾ˆå¤§ï¼Œç£ç›˜IOåŠå®¹é‡éƒ½åˆ°è¾¾äº†ç“¶é¢ˆï¼Œç°åœ¨éœ€è¦å¯¹ tb_order è¡¨è¿›è¡Œæ•°æ®åˆ†ç‰‡ï¼Œ**åˆ†ä¸ºä¸‰ä¸ªæ•°æ®èŠ‚ç‚¹**ï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹ä¸»æœºä½äºä¸åŒçš„æœåŠ¡å™¨ä¸Š, å…·ä½“çš„ç»“æ„ï¼Œå‚è€ƒä¸‹å›¾ï¼š

![image-20250421143635462](./Mysql-Learning-Local.assets/image-20250421143635462.png)

**å¯¹åº”æ°´å¹³æ‹†åˆ†ä¸­çš„ï¼šæ°´å¹³åˆ†è¡¨**

ç‰¹ç‚¹ï¼š

- æ¯ä¸ªè¡¨çš„è¡¨ç»“æ„éƒ½ä¸€æ ·ã€‚
- **æ¯ä¸ªè¡¨çš„æ•°æ®éƒ½ä¸ä¸€æ ·**ã€‚
- æ‰€æœ‰è¡¨çš„å¹¶é›†æ˜¯å…¨é‡æ•°æ®ã€‚



### ï¼ˆ2ï¼‰ç¯å¢ƒé…ç½®

<img src="./Mysql-Learning-Local.assets/image-20250421144030655.png" alt="image-20250421144030655" style="zoom: 67%;" />

å‡†å¤‡3å°æœåŠ¡å™¨ï¼š

- 192.168.200.210ï¼šMyCatä¸­é—´ä»¶æœåŠ¡å™¨ï¼ŒåŒæ—¶ä¹Ÿæ˜¯**ç¬¬ä¸€ä¸ªåˆ†ç‰‡æœåŠ¡å™¨**ã€‚

- 192.168.200.213ï¼š**ç¬¬äºŒä¸ªåˆ†ç‰‡æœåŠ¡å™¨**ã€‚

- 192.168.200.214ï¼š**ç¬¬ä¸‰ä¸ªåˆ†ç‰‡æœåŠ¡å™¨**ã€‚å¹¶ä¸”åœ¨ä¸Šè¿°3å°æ•°æ®åº“ä¸­åˆ›å»ºæ•°æ®åº“ db01 ã€‚

  

**æˆ‘çš„æœåŠ¡å™¨åˆ†é…æ–¹æ¡ˆï¼š**

- 192.168.88.130 =ã€‹JDKã€MyCat
- 192.168.88.130 =ã€‹ Mysql åˆ†ç‰‡æœåŠ¡å™¨ä¸€ , åŒæ—¶ä¹Ÿæ˜¯ä¹‹å‰å­¦ä¹ çš„ä¸»åº“
- 192.168.88.131 =ã€‹ Mysql åˆ†ç‰‡æœåŠ¡å™¨äºŒï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¹‹å‰å­¦ä¹ çš„ä»åº“
- 192.168.88.129 =ã€‹ Mysql åˆ†ç‰‡æœåŠ¡å™¨ä¸‰

![image-20250421144733511](./Mysql-Learning-Local.assets/image-20250421144733511.png)

å¹¶ä¸”åœ¨ä¸Šè¿°3å°æ•°æ®åº“ä¸­**åˆ›å»ºæ•°æ®åº“ db01** ã€‚



### ï¼ˆ3ï¼‰==é…ç½®==

```bash
cd /usr/local/mycat/conf
```

#### â‘ schema.xml

![image-20250421145729895](./Mysql-Learning-Local.assets/image-20250421145729895.png)

åœ¨schema.xmlä¸­é…ç½®**é€»è¾‘åº“ã€åˆ†ç‰‡è§„åˆ™ã€é€»è¾‘è¡¨ã€æ•°æ®èŠ‚ç‚¹ã€èŠ‚ç‚¹ä¸»æœº**ç­‰ç›¸å…³ä¿¡æ¯ã€‚å…·ä½“çš„é…ç½®å¦‚ä¸‹ï¼š

```xml
<?xml version="1.0"?>
<!DOCTYPE mycat:schema SYSTEM "schema.dtd">
<mycat:schema xmlns:mycat="http://io.mycat/">
    <schema name="DB01" checkSQLschema="true" sqlMaxLimit="100">
        <table name="TB_ORDER" dataNode="dn1,dn2,dn3" rule="auto-sharding-long"
               />
    </schema>
    <dataNode name="dn1" dataHost="dhost1" database="db01" />
    <dataNode name="dn2" dataHost="dhost2" database="db01" />
    <dataNode name="dn3" dataHost="dhost3" database="db01" />
    <dataHost name="dhost1" maxCon="1000" minCon="10" balance="0"
              writeType="0" dbType="mysql" dbDriver="jdbc" switchType="1"
              slaveThreshold="100">
        <heartbeat>select user()</heartbeat>
        <writeHost host="master" url="jdbc:mysql://192.168.88.130:3306?useSSL=false&amp;serverTimezone=Asia/Shanghai&amp;characterEncoding=utf8"
                   user="root" password="root" />
    </dataHost>
    <dataHost name="dhost2" maxCon="1000" minCon="10" balance="0"
              writeType="0" dbType="mysql" dbDriver="jdbc" switchType="1"
              slaveThreshold="100">
        <heartbeat>select user()</heartbeat>
        <writeHost host="master" url="jdbc:mysql://192.168.88.131:3306?useSSL=false&amp;serverTimezone=Asia/Shanghai&amp;characterEncoding=utf8"
                   user="root" password="root" />
    </dataHost>
    <dataHost name="dhost3" maxCon="1000" minCon="10" balance="0"
              writeType="0" dbType="mysql" dbDriver="jdbc" switchType="1"
              slaveThreshold="100">
        <heartbeat>select user()</heartbeat>
        <writeHost host="master" url="jdbc:mysql://192.168.88.129:3306?useSSL=false&amp;serverTimezone=Asia/Shanghai&amp;characterEncoding=utf8"
                   user="root" password="1234" />
    </dataHost>
</mycat:schema>
```



#### â‘¡server.xml

![image-20250421145714382](./Mysql-Learning-Local.assets/image-20250421145714382.png)

éœ€è¦åœ¨server.xmlä¸­é…ç½®ç”¨æˆ·åã€å¯†ç ï¼Œä»¥åŠç”¨æˆ·çš„è®¿é—®æƒé™ä¿¡æ¯ï¼Œå…·ä½“çš„é…ç½®å¦‚ä¸‹ï¼š

```xml
<user name="root" defaultAccount="true">
    <property name="password">123456</property>
    <property name="schemas">DB01</property>
    <!-- è¡¨çº§ DML æƒé™è®¾ç½® -->
    <!--
<privileges check="true">
<schema name="DB01" dml="0110" >
<table name="TB_ORDER" dml="1110"></table>
</schema>
</privileges>
-->
</user>
<user name="user">
    <property name="password">123456</property>
    <property name="schemas">DB01</property>
    <property name="readOnly">true</property>
</user>
```

ä¸Šè¿°çš„é…ç½®è¡¨ç¤ºï¼Œå®šä¹‰äº†**ä¸¤ä¸ªç”¨æˆ· root å’Œ user** ï¼Œè¿™ä¸¤ä¸ªç”¨æˆ·éƒ½å¯ä»¥è®¿é—® **DB01 è¿™ä¸ªé€»è¾‘åº“**ï¼Œè®¿é—®å¯†ç éƒ½æ˜¯123456ï¼Œä½†æ˜¯rootç”¨æˆ·è®¿é—®DB01é€»è¾‘åº“ï¼Œæ—¢å¯ä»¥è¯»ï¼Œåˆå¯ä»¥å†™ï¼Œä½†æ˜¯ userç”¨æˆ·è®¿é—®DB01é€»è¾‘åº“æ˜¯åªè¯»çš„ã€‚





### ï¼ˆ4ï¼‰==æµ‹è¯•==

#### â‘ å¯åŠ¨

é…ç½®å®Œæ¯•åï¼Œå…ˆå¯åŠ¨æ¶‰åŠåˆ°çš„3å°åˆ†ç‰‡æœåŠ¡å™¨ï¼Œç„¶åå¯åŠ¨MyCatæœåŠ¡å™¨ã€‚åˆ‡æ¢åˆ°Mycatçš„å®‰è£…ç›®å½•ï¼Œæ‰§è¡Œå¦‚ä¸‹æŒ‡ä»¤ï¼Œå¯åŠ¨Mycatï¼š

```bash
#å¯åŠ¨
bin/mycat start

#åœæ­¢
bin/mycat stop
```

![image-20250421145952527](./Mysql-Learning-Local.assets/image-20250421145952527.png)

Mycatå¯åŠ¨ä¹‹åï¼Œ**å ç”¨ç«¯å£å· 8066ã€‚**

å¯åŠ¨å®Œæ¯•ä¹‹åï¼Œå¯ä»¥**æŸ¥çœ‹logsç›®å½•ä¸‹çš„å¯åŠ¨æ—¥å¿—**ï¼ŒæŸ¥çœ‹Mycatæ˜¯å¦å¯åŠ¨å®Œæˆã€‚

```bash
tail -f logs/wrapper.log
```

![image-20250421150028290](./Mysql-Learning-Local.assets/image-20250421150028290.png)



#### â‘¡æµ‹è¯•

#### â‘ è¿æ¥MyCat

é€šè¿‡å¦‚ä¸‹æŒ‡ä»¤ï¼Œå°±å¯ä»¥è¿æ¥å¹¶ç™»é™†MyCatã€‚

```bash
mysql -h 192.168.200.210 -P 8066 -uroot -p123456

mysql -h 192.168.88.130 -P 8066 -uroot -p123456
```

æˆ‘ä»¬çœ‹åˆ°æˆ‘ä»¬æ˜¯é€šè¿‡MySQLçš„æŒ‡ä»¤æ¥è¿æ¥çš„MyCatï¼Œå› ä¸ºMyCatåœ¨åº•å±‚å®é™…ä¸Šæ˜¯æ¨¡æ‹Ÿäº†MySQLçš„åè®®ã€‚

![image-20250421150339609](./Mysql-Learning-Local.assets/image-20250421150339609.png)

 ![image-20250421150641697](./Mysql-Learning-Local.assets/image-20250421150641697.png)



#### â‘¡æ•°æ®æµ‹è¯•

ç„¶åå°±å¯ä»¥åœ¨MyCatä¸­æ¥åˆ›å»ºè¡¨ï¼Œå¹¶**å¾€è¡¨ç»“æ„ä¸­æ’å…¥æ•°æ®**ï¼ŒæŸ¥çœ‹æ•°æ®åœ¨MySQLä¸­çš„åˆ†å¸ƒæƒ…å†µã€‚

åœ¨Mycatä¸­åˆ›å»ºäº†tb_orderè¡¨ï¼Œ**==å…³è”çš„ä¸‰ä¸ªæ•°æ®èŠ‚ç‚¹ä¼šè‡ªåŠ¨åŒæ­¥åˆ›å»º==**

```sql
CREATE TABLE TB_ORDER (
    id BIGINT(20) NOT NULL,
    title VARCHAR(100) NOT NULL ,
    PRIMARY KEY (id)
) ENGINE=INNODB DEFAULT CHARSET=utf8 ;

INSERT INTO TB_ORDER(id,title) VALUES(1,'goods1');
INSERT INTO TB_ORDER(id,title) VALUES(2,'goods2');
INSERT INTO TB_ORDER(id,title) VALUES(3,'goods3');
INSERT INTO TB_ORDER(id,title) VALUES(1,'goods1');
INSERT INTO TB_ORDER(id,title) VALUES(2,'goods2');
INSERT INTO TB_ORDER(id,title) VALUES(3,'goods3');
INSERT INTO TB_ORDER(id,title) VALUES(5000000,'goods5000000');
INSERT INTO TB_ORDER(id,title) VALUES(10000000,'goods10000000');
INSERT INTO TB_ORDER(id,title) VALUES(10000001,'goods10000001');
INSERT INTO TB_ORDER(id,title) VALUES(15000000,'goods15000000');
INSERT INTO TB_ORDER(id,title) VALUES(15000001,'goods15000001');
```



ç»è¿‡æµ‹è¯•ï¼Œæˆ‘ä»¬å‘ç°ï¼Œåœ¨å¾€ TB_ORDER è¡¨ä¸­æ’å…¥æ•°æ®æ—¶ï¼š

- å¦‚æœ**idçš„å€¼åœ¨1-500wä¹‹é—´**ï¼Œæ•°æ®å°†ä¼šå­˜å‚¨åœ¨**ç¬¬ä¸€ä¸ªåˆ†ç‰‡æ•°æ®åº“**ä¸­ã€‚
- å¦‚æœidçš„å€¼åœ¨**500w-1000wä¹‹é—´**ï¼Œæ•°æ®å°†ä¼šå­˜å‚¨åœ¨**ç¬¬äºŒä¸ªåˆ†ç‰‡æ•°æ®åº“**ä¸­ã€‚
- å¦‚æœidçš„å€¼åœ¨**1000w-1500wä¹‹é—´**ï¼Œæ•°æ®å°†ä¼šå­˜å‚¨åœ¨**ç¬¬ä¸‰ä¸ªåˆ†ç‰‡æ•°æ®åº“**ä¸­ã€‚
- å¦‚æœidçš„å€¼è¶…å‡º1500wï¼Œåœ¨æ’å…¥æ•°æ®æ—¶ï¼Œå°†ä¼šæŠ¥é”™ã€‚

[å¯¹åº”-èŒƒå›´åˆ†ç‰‡è§„åˆ™](#èŒƒå›´åˆ†ç‰‡è§„åˆ™)

ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ç§ç°è±¡ï¼Œæ•°æ®åˆ°åº•è½åœ¨å“ªä¸€ä¸ªåˆ†ç‰‡æœåŠ¡å™¨åˆ°åº•æ˜¯å¦‚ä½•å†³å®šçš„å‘¢ï¼Ÿ è¿™æ˜¯ç”±é€»è¾‘è¡¨é…ç½®æ—¶çš„ä¸€ä¸ªå‚æ•° rule å†³å®šçš„ï¼Œè€Œè¿™ä¸ª**å‚æ•°é…ç½®çš„å°±æ˜¯åˆ†ç‰‡è§„åˆ™**ï¼Œå…³äºåˆ†ç‰‡è§„åˆ™çš„é…ç½®ï¼Œåœ¨åé¢çš„è¯¾ç¨‹ä¸­ä¼šè¯¦ç»†è®²è§£ã€‚



## 3.4 ==MyCaté…ç½®==

### ï¼ˆ1ï¼‰schema.xml

schema.xml ä½œä¸ºMyCatä¸­æœ€é‡è¦çš„é…ç½®æ–‡ä»¶ä¹‹ä¸€ , æ¶µç›–äº†MyCatçš„**é€»è¾‘åº“ ã€ é€»è¾‘è¡¨ ã€ åˆ†ç‰‡è§„åˆ™ã€åˆ†ç‰‡èŠ‚ç‚¹åŠæ•°æ®æºçš„é…ç½®**ã€‚

![image-20250421194221976](./Mysql-Learning-Local.assets/image-20250421194221976.png)

ä¸»è¦åŒ…å«ä»¥ä¸‹ä¸‰ç»„æ ‡ç­¾ï¼š

- schemaæ ‡ç­¾
- datanodeæ ‡ç­¾
- datahostæ ‡ç­¾



#### â‘ schemaæ ‡ç­¾

##### 1). schema å®šä¹‰==é€»è¾‘åº“==

![image-20250421194229014](./Mysql-Learning-Local.assets/image-20250421194229014.png)

schema æ ‡ç­¾ç”¨äºå®šä¹‰ MyCatå®ä¾‹ä¸­çš„é€»è¾‘åº“ , **ä¸€ä¸ªMyCatå®ä¾‹ä¸­, å¯ä»¥æœ‰å¤šä¸ªé€»è¾‘åº“** , å¯ä»¥é€šè¿‡ schema æ ‡ç­¾æ¥åˆ’åˆ†ä¸åŒçš„é€»è¾‘åº“ã€‚MyCatä¸­çš„é€»è¾‘åº“çš„æ¦‚å¿µï¼Œ**ç­‰åŒäºMySQLä¸­çš„databaseæ¦‚å¿µ**, éœ€è¦æ“ä½œæŸä¸ªé€»è¾‘åº“ä¸‹çš„è¡¨æ—¶, ä¹Ÿéœ€è¦**åˆ‡æ¢é€»è¾‘åº“(use xxx)**ã€‚



æ ¸å¿ƒå±æ€§ï¼š

- nameï¼šæŒ‡å®šè‡ªå®šä¹‰çš„**é€»è¾‘åº“åº“å** ï¼Œæ³¨æ„å¤§å°å†™é—®é¢˜
- checkSQLschemaï¼šåœ¨SQLè¯­å¥æ“ä½œæ—¶æŒ‡å®šäº†æ•°æ®åº“åç§°ï¼Œæ‰§è¡Œæ—¶æ˜¯å¦è‡ªåŠ¨å»é™¤ï¼›trueï¼šè‡ªåŠ¨å»é™¤ï¼Œfalseï¼šä¸è‡ªåŠ¨å»é™¤
  - è‹¥checkSQLschema = trueï¼Œè¡¨ç¤ºå¯ä»¥ç›´æ¥é€šè¿‡select * from **DB01.TB_ORDER**è¿›è¡ŒæŸ¥è¯¢ï¼Œä¸ç”¨å…ˆä½¿ç”¨use xxï¼Œè¿›è¡Œåˆ‡æ¢ï¼Œå†è¿›è¡ŒæŸ¥è¯¢

- sqlMaxLimitï¼šå¦‚æœæœªæŒ‡å®šlimitè¿›è¡ŒæŸ¥è¯¢ï¼Œåˆ—è¡¨æŸ¥è¯¢æ¨¡å¼**æœ€å¤šæŸ¥è¯¢å¤šå°‘æ¡è®°å½•**



##### 2). schema ä¸­çš„tableå®šä¹‰==é€»è¾‘è¡¨==

![image-20250421194246543](./Mysql-Learning-Local.assets/image-20250421194246543.png)

table æ ‡ç­¾å®šä¹‰äº†MyCatä¸­é€»è¾‘åº“schemaä¸‹çš„é€»è¾‘è¡¨ , **æ‰€æœ‰éœ€è¦æ‹†åˆ†çš„è¡¨éƒ½éœ€è¦åœ¨tableæ ‡ç­¾ä¸­å®šä¹‰** ã€‚

æ ¸å¿ƒå±æ€§ï¼š

- nameï¼šå®šä¹‰é€»è¾‘è¡¨è¡¨åï¼Œåœ¨è¯¥é€»è¾‘åº“ä¸‹å”¯ä¸€
- dataNodeï¼šå®šä¹‰é€»è¾‘è¡¨æ‰€å±çš„dataNodeï¼Œ**è¯¥å±æ€§éœ€è¦ä¸dataNodeæ ‡ç­¾ä¸­nameå¯¹åº”**ï¼›å¤šä¸ªdataNodeé€—å·åˆ†éš”
- ruleï¼šåˆ†ç‰‡è§„åˆ™çš„åå­—ï¼Œ**åˆ†ç‰‡è§„åˆ™åå­—æ˜¯åœ¨rule.xmlä¸­å®šä¹‰çš„**
- primaryKeyï¼šé€»è¾‘è¡¨å¯¹åº”çœŸå®è¡¨çš„ä¸»é”®
- typeï¼šé€»è¾‘è¡¨çš„ç±»å‹ï¼Œç›®å‰é€»è¾‘è¡¨åªæœ‰å…¨å±€è¡¨å’Œæ™®é€šè¡¨ï¼Œ**å¦‚æœæœªé…ç½®ï¼Œå°±æ˜¯æ™®é€šè¡¨**ï¼›å…¨å±€è¡¨ï¼Œé…ç½®ä¸º global



#### â‘¡datanodeæ ‡ç­¾

![image-20250421194434132](./Mysql-Learning-Local.assets/image-20250421194434132.png)

æ ¸å¿ƒå±æ€§ï¼š

- nameï¼šå®šä¹‰æ•°æ®èŠ‚ç‚¹åç§°
- dataHostï¼š**æ•°æ®åº“å®ä¾‹ä¸»æœºåç§°**ï¼Œå¼•ç”¨è‡ª dataHost æ ‡ç­¾ä¸­nameå±æ€§
- databaseï¼šå®šä¹‰åˆ†ç‰‡**æ‰€å±æ•°æ®åº“**



#### â‘¢datahostæ ‡ç­¾

![image-20250421194521482](./Mysql-Learning-Local.assets/image-20250421194521482.png)

è¯¥æ ‡ç­¾åœ¨MyCaté€»è¾‘åº“ä¸­ä½œä¸º**åº•å±‚æ ‡ç­¾å­˜åœ¨**, ç›´æ¥å®šä¹‰äº†**å…·ä½“çš„æ•°æ®åº“å®ä¾‹ã€è¯»å†™åˆ†ç¦»ã€å¿ƒè·³è¯­å¥**ã€‚

æ ¸å¿ƒå±æ€§ï¼š

- nameï¼šå”¯ä¸€æ ‡è¯†ï¼Œä¾›ä¸Šå±‚æ ‡ç­¾ä½¿ç”¨
- maxCon/minConï¼šæœ€å¤§è¿æ¥æ•°/æœ€å°è¿æ¥æ•°
- balanceï¼š**è´Ÿè½½å‡è¡¡ç­–ç•¥**ï¼Œå–å€¼ 0,1,2,3
- writeTypeï¼š**å†™æ“ä½œåˆ†å‘æ–¹å¼**
  - 0ï¼šå†™æ“ä½œè½¬å‘åˆ°ç¬¬ä¸€ä¸ªwriteHostï¼Œç¬¬ä¸€ä¸ªæŒ‚äº†ï¼Œåˆ‡æ¢åˆ°ç¬¬äºŒä¸ªï¼›
  - 1ï¼šå†™æ“ä½œéšæœºåˆ†å‘åˆ°é…ç½®çš„writeHost

- dbDriverï¼š**æ•°æ®åº“é©±åŠ¨**ï¼Œæ”¯æŒ nativeã€jdbc



### ï¼ˆ2ï¼‰rule.xml

rule.xmlä¸­**å®šä¹‰æ‰€æœ‰æ‹†åˆ†è¡¨çš„è§„åˆ™**, åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­å¯ä»¥çµæ´»çš„ä½¿ç”¨åˆ†ç‰‡ç®—æ³•, æˆ–è€…å¯¹åŒä¸€ä¸ªåˆ†ç‰‡ç®—æ³•ä½¿ç”¨ä¸åŒçš„å‚æ•°, å®ƒ**è®©åˆ†ç‰‡è¿‡ç¨‹å¯é…ç½®åŒ–**ã€‚ä¸»è¦åŒ…å«ä¸¤ç±»æ ‡ç­¾ï¼š**tableRuleã€Function**ã€‚

 ![image-20250421194852181](./Mysql-Learning-Local.assets/image-20250421194852181.png)



### ï¼ˆ3ï¼‰server.xml

server.xmlé…ç½®æ–‡ä»¶åŒ…å«äº†**MyCatçš„ç³»ç»Ÿé…ç½®ä¿¡æ¯**ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªé‡è¦çš„æ ‡ç­¾ï¼š**systemã€user**ã€‚

#### â‘  systemæ ‡ç­¾

<img src="./Mysql-Learning-Local.assets/image-20250421195021824.png" alt="image-20250421195021824" style="zoom:80%;" />

ä¸»è¦é…ç½®MyCatä¸­çš„ç³»ç»Ÿé…ç½®ä¿¡æ¯ï¼Œå¯¹åº”çš„ç³»ç»Ÿé…ç½®é¡¹åŠå…¶å«ä¹‰ï¼Œå¦‚ä¸‹ï¼š

![image-20250420154432101](./Mysql-Learning-Local.assets/image-20250420154432101.png)



![image-20250420154450239](./Mysql-Learning-Local.assets/image-20250420154450239.png)



![image-20250420154502890](./Mysql-Learning-Local.assets/image-20250420154502890.png)



#### â‘¡ useræ ‡ç­¾

é…ç½®MyCatä¸­çš„ç”¨æˆ·ã€è®¿é—®å¯†ç ï¼Œä»¥åŠç”¨æˆ·é’ˆå¯¹äºé€»è¾‘åº“ã€é€»è¾‘è¡¨çš„**æƒé™ä¿¡æ¯**ï¼Œå…·ä½“çš„æƒé™æè¿°æ–¹å¼åŠé…ç½®è¯´æ˜å¦‚ä¸‹ï¼š

![image-20250421195035542](./Mysql-Learning-Local.assets/image-20250421195035542.png)

åœ¨æµ‹è¯•æƒé™æ“ä½œæ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦å°† privileges æ ‡ç­¾çš„æ³¨é‡Šæ”¾å¼€ã€‚

1.  åœ¨ privileges ä¸‹çš„**schemaæ ‡ç­¾**ä¸­**é…ç½®çš„dmlå±æ€§é…ç½®çš„æ˜¯é€»è¾‘åº“çš„æƒé™**ã€‚
2.  åœ¨privilegesçš„schemaä¸‹çš„**tableæ ‡ç­¾**çš„dmlå±æ€§ä¸­**é…ç½®é€»è¾‘è¡¨çš„æƒé™**ã€‚
3.  dml => å¯¹åº”4ä½äºŒè¿›åˆ¶æ•°ï¼Œåˆ†åˆ«**å¯¹åº”IUSDï¼ˆå¢ã€æ”¹ã€æŸ¥ã€åˆ ï¼‰çš„æƒé™**ã€‚





## 3.5 ğŸš€ ==MyCatåˆ†ç‰‡==-åˆ†åº“/åˆ†è¡¨

è¿™é‡Œçš„åˆ†ç‰‡æŒ‡çš„å°±æ˜¯åˆ†åº“åˆ†è¡¨

### ï¼ˆ1ï¼‰å‚ç›´æ‹†åˆ†

#### â‘ åœºæ™¯

åœ¨ä¸šåŠ¡ç³»ç»Ÿä¸­, æ¶‰åŠä»¥ä¸‹è¡¨ç»“æ„ ,ä½†æ˜¯ç”±äºç”¨æˆ·ä¸è®¢å•æ¯å¤©éƒ½ä¼šäº§ç”Ÿå¤§é‡çš„æ•°æ®, å•å°æœåŠ¡å™¨çš„æ•°æ®å­˜å‚¨åŠå¤„ç†èƒ½åŠ›æ˜¯æœ‰é™çš„, å¯ä»¥å¯¹**æ•°æ®åº“è¡¨è¿›è¡Œæ‹†åˆ†**, åŸæœ‰çš„æ•°æ®åº“è¡¨å¦‚ä¸‹ã€‚

<img src="./Mysql-Learning-Local.assets/image-20250421195819684.png" alt="image-20250421195819684" style="zoom: 80%;" />

ç°åœ¨è€ƒè™‘å°†å…¶è¿›è¡Œ**å‚ç›´åˆ†åº“æ“ä½œ**ï¼Œå°†å•†å“ç›¸å…³çš„è¡¨æ‹†åˆ†åˆ°ä¸€ä¸ªæ•°æ®åº“æœåŠ¡å™¨ï¼Œè®¢å•è¡¨æ‹†åˆ†çš„ä¸€ä¸ªæ•°æ®åº“æœåŠ¡å™¨ï¼Œç”¨æˆ·åŠçœå¸‚åŒºè¡¨æ‹†åˆ†åˆ°ä¸€ä¸ªæœåŠ¡å™¨ã€‚æœ€ç»ˆç»“æ„å¦‚ä¸‹ï¼š

<img src="./Mysql-Learning-Local.assets/image-20250421195853304.png" alt="image-20250421195853304" style="zoom:80%;" />



#### â‘¡å‡†å¤‡

å‡†å¤‡ä¸‰å°æœåŠ¡å™¨ï¼ŒIPåœ°å€å¦‚å›¾æ‰€ç¤ºï¼š

<img src="./Mysql-Learning-Local.assets/image-20250421200056668.png" alt="image-20250421200056668" style="zoom: 67%;" />

å¹¶ä¸”åœ¨192.168.200.210ï¼Œ192.168.200.213, 192.168.200.214ä¸Šé¢**æ‰‹åŠ¨å…ˆåˆ›å»ºæ•°æ®åº“shopping**ã€‚

<img src="./Mysql-Learning-Local.assets/image-20250421200413381.png" alt="image-20250421200413381" style="zoom: 80%;" />



#### â‘¢é…ç½®

##### 1). schema.xml

```bash
cd /usr/local/mycat/conf
```

```xml
<?xml version="1.0"?>
<!DOCTYPE mycat:schema SYSTEM "schema.dtd">
<mycat:schema xmlns:mycat="http://io.mycat/">
    <schema name="SHOPPING" checkSQLschema="true" sqlMaxLimit="100">
        <table name="tb_goods_base" dataNode="dn1" primaryKey="id" />
        <table name="tb_goods_brand" dataNode="dn1" primaryKey="id" />
        <table name="tb_goods_cat" dataNode="dn1" primaryKey="id" />
        <table name="tb_goods_desc" dataNode="dn1" primaryKey="goods_id" />
        <table name="tb_goods_item" dataNode="dn1" primaryKey="id" />

        <table name="tb_order_item" dataNode="dn2" primaryKey="id" />
        <table name="tb_order_master" dataNode="dn2" primaryKey="order_id" />
        <table name="tb_order_pay_log" dataNode="dn2" primaryKey="out_trade_no" />

        <table name="tb_user" dataNode="dn3" primaryKey="id" />
        <table name="tb_user_address" dataNode="dn3" primaryKey="id" />
        <table name="tb_areas_provinces" dataNode="dn3" primaryKey="id"/>
        <table name="tb_areas_city" dataNode="dn3" primaryKey="id"/>
        <table name="tb_areas_region" dataNode="dn3" primaryKey="id"/>
    </schema>

    <dataNode name="dn1" dataHost="dhost1" database="shopping" />
    <dataNode name="dn2" dataHost="dhost2" database="shopping" />
    <dataNode name="dn3" dataHost="dhost3" database="shopping" />

    <dataHost name="dhost1" maxCon="1000" minCon="10" balance="0"
              writeType="0" dbType="mysql" dbDriver="jdbc" switchType="1"
              slaveThreshold="100">
        <heartbeat>select user()</heartbeat>
        <writeHost host="master" url="jdbc:mysql://192.168.88.130:3306?useSSL=false&amp;serverTimezone=Asia/Shanghai&amp;characterEncoding=utf8"
                   user="root" password="root" />
    </dataHost>

    <dataHost name="dhost2" maxCon="1000" minCon="10" balance="0"
              writeType="0" dbType="mysql" dbDriver="jdbc" switchType="1"
              slaveThreshold="100">
        <heartbeat>select user()</heartbeat>
        <writeHost host="master" url="jdbc:mysql://192.168.88.131:3306?useSSL=false&amp;serverTimezone=Asia/Shanghai&amp;characterEncoding=utf8"
                   user="root" password="root" />
    </dataHost>

    <dataHost name="dhost3" maxCon="1000" minCon="10" balance="0"
              writeType="0" dbType="mysql" dbDriver="jdbc" switchType="1"
              slaveThreshold="100">
        <heartbeat>select user()</heartbeat>
        <writeHost host="master" url="jdbc:mysql://192.168.88.129:3306?useSSL=false&amp;serverTimezone=Asia/Shanghai&amp;characterEncoding=utf8"
                   user="root" password="1234" />
    </dataHost>
</mycat:schema>
```



##### 2). server.xml

```xml
<user name="root" defaultAccount="true">
    <property name="password">123456</property>
    <property name="schemas">SHOPPING</property>
    <!-- è¡¨çº§ DML æƒé™è®¾ç½® -->
    <!--
<privileges check="true">
<schema name="DB01" dml="0110" >
<table name="TB_ORDER" dml="1110"></table>
</schema>
</privileges>
-->
</user>
<user name="user">
    <property name="password">123456</property>
    <property name="schemas">SHOPPING</property>
    <property name="readOnly">true</property>
</user>
```



é…ç½®å®Œæ¯•åï¼Œ**é‡æ–°å¯åŠ¨MyCat**ã€‚

```bash
#å¯åŠ¨
bin/mycat start

#åœæ­¢
bin/mycat stop
```





#### â‘£æµ‹è¯•

![image-20250421201910524](./Mysql-Learning-Local.assets/image-20250421201910524.png)

##### 1). ä¸Šä¼ æµ‹è¯•SQLè„šæœ¬åˆ°æœåŠ¡å™¨çš„/rootç›®å½•

![image-20250421200951043](./Mysql-Learning-Local.assets/image-20250421200951043.png)

**ç™»å½•Mycat**

```bash
mysql -h 192.168.200.210 -P 8066 -uroot -p123456
```



**å…·ä½“çš„è„šæœ¬å¯åœ¨`è¿ç»´ç¯‡çš„SQLè„šæœ¬çš„å‚ç›´æ‹†åˆ†`ä¸­æ‰¾åˆ°**

```sql
source /root/shopping-table.sql;
source /root/shopping-insert.sql;
```



##### 2). æ‰§è¡ŒæŒ‡ä»¤å¯¼å…¥æµ‹è¯•æ•°æ®

é‡æ–°å¯åŠ¨MyCatåï¼Œåœ¨mycatçš„å‘½ä»¤è¡Œä¸­ï¼Œ**é€šè¿‡sourceæŒ‡ä»¤å¯¼å…¥è¡¨ç»“æ„ï¼Œä»¥åŠå¯¹åº”çš„æ•°æ®**ï¼ŒæŸ¥çœ‹æ•°æ®åˆ†å¸ƒæƒ…å†µã€‚

```sql
source /root/shopping-table.sql

source /root/shopping-insert.sql
```

å°†è¡¨ç»“æ„åŠå¯¹åº”çš„æµ‹è¯•æ•°æ®å¯¼å…¥ä¹‹åï¼Œå¯ä»¥æ£€æŸ¥ä¸€ä¸‹**å„ä¸ªæ•°æ®åº“æœåŠ¡å™¨ä¸­çš„è¡¨ç»“æ„åˆ†å¸ƒæƒ…å†µ**ã€‚ æ£€æŸ¥æ˜¯å¦å’Œæˆ‘ä»¬å‡†å¤‡å·¥ä½œä¸­è§„åˆ’çš„æœåŠ¡å™¨ä¸€è‡´ã€‚

![image-20250421201418015](./Mysql-Learning-Local.assets/image-20250421201418015.png)





##### 3). æŸ¥è¯¢ç”¨æˆ·çš„æ”¶ä»¶äººåŠæ”¶ä»¶äººåœ°å€ä¿¡æ¯(åŒ…å«çœã€å¸‚ã€åŒº)ã€‚

åœ¨**MyCatçš„å‘½ä»¤è¡Œ**ä¸­ï¼Œå½“æˆ‘ä»¬**æ‰§è¡Œä»¥ä¸‹==å¤šè¡¨è”æŸ¥==çš„SQLè¯­å¥**æ—¶ï¼Œå¯ä»¥æ­£å¸¸æŸ¥è¯¢å‡ºæ•°æ®ã€‚

```sql
select ua.user_id, ua.contact, p.province, c.city, r.area , ua.address 
from
tb_user_address ua ,tb_areas_city c , tb_areas_provinces p ,tb_areas_region r
where ua.province_id = p.provinceid and ua.city_id = c.cityid and ua.town_id =
r.areaid ;
```

<img src="./Mysql-Learning-Local.assets/image-20250421211014536.png" alt="image-20250421211014536" style="zoom:67%;" />



##### 4). æŸ¥è¯¢æ¯ä¸€ç¬”è®¢å•åŠè®¢å•çš„æ”¶ä»¶åœ°å€ä¿¡æ¯(åŒ…å«çœã€å¸‚ã€åŒº)ã€‚

å®ç°è¯¥éœ€æ±‚å¯¹åº”çš„SQLè¯­å¥å¦‚ä¸‹ï¼š

```sql
SELECT order_id , payment ,receiver, province , city , area 
FROM tb_order_master o
, tb_areas_provinces p , tb_areas_city c , tb_areas_region r 
WHERE o.receiver_province = p.provinceid AND o.receiver_city = c.cityid AND
o.receiver_region = r.areaid;
```

ä½†æ˜¯ç°åœ¨å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œè®¢å•ç›¸å…³çš„è¡¨ç»“æ„æ˜¯åœ¨ 192.168.200.213 æ•°æ®åº“æœåŠ¡å™¨ä¸­ï¼Œè€Œçœå¸‚åŒºçš„æ•°æ®åº“è¡¨æ˜¯åœ¨ 192.168.200.214 æ•°æ®åº“æœåŠ¡å™¨ä¸­ã€‚é‚£ä¹ˆåœ¨MyCatä¸­æ‰§è¡Œæ˜¯å¦å¯ä»¥æˆåŠŸå‘¢ï¼Ÿ



ç»è¿‡æµ‹è¯•ï¼Œæˆ‘ä»¬çœ‹åˆ°ï¼ŒSQLè¯­å¥æ‰§è¡ŒæŠ¥é”™ã€‚åŸå› å°±æ˜¯å› ä¸ºMyCatåœ¨æ‰§è¡Œè¯¥SQLè¯­å¥æ—¶ï¼Œéœ€è¦å¾€å…·ä½“çš„æ•°æ®åº“æœåŠ¡å™¨ä¸­è·¯ç”±ï¼Œè€Œå½“å‰æ²¡æœ‰ä¸€ä¸ªæ•°æ®åº“æœåŠ¡å™¨å®Œå…¨åŒ…å«äº†è®¢å•ä»¥åŠçœå¸‚åŒºçš„è¡¨ç»“æ„ï¼Œ**é€ æˆSQLè¯­å¥å¤±è´¥ï¼ŒæŠ¥é”™**ã€‚



å¯¹äºä¸Šè¿°çš„è¿™ç§ç°è±¡ï¼Œæˆ‘ä»¬å¦‚ä½•æ¥è§£å†³å‘¢ï¼Ÿ ä¸‹é¢æˆ‘ä»¬ä»‹ç»çš„**å…¨å±€è¡¨**ï¼Œå°±å¯ä»¥è½»æ¾è§£å†³è¿™ä¸ªé—®é¢˜ã€‚



#### â‘¤==å…¨å±€è¡¨==

å¯¹äºçœã€å¸‚ã€åŒº/å¿è¡¨tb_areas_provinces , tb_areas_city , tb_areas_regionï¼Œæ˜¯å±äºæ•°æ®å­—å…¸è¡¨ï¼Œåœ¨å¤šä¸ªä¸šåŠ¡æ¨¡å—ä¸­éƒ½å¯èƒ½ä¼šé‡åˆ°ï¼Œå¯ä»¥**å°†å…¶è®¾ç½®ä¸ºå…¨å±€è¡¨ï¼Œåˆ©äºä¸šåŠ¡æ“ä½œ**ã€‚

ä¿®æ”¹schema.xmlä¸­çš„é€»è¾‘è¡¨çš„é…ç½®ï¼Œä¿®æ”¹ tb_areas_provincesã€tb_areas_cityã€tb_areas_region ä¸‰ä¸ªé€»è¾‘è¡¨ï¼Œ**==æ·»åŠ å…³è”çš„dataNodeï¼Œå¹¶å¢åŠ  type å±æ€§ï¼Œé…ç½®ä¸ºglobal==**ï¼Œå°±ä»£è¡¨è¯¥è¡¨æ˜¯å…¨å±€è¡¨ï¼Œå°±ä¼šåœ¨æ‰€æ¶‰åŠåˆ°çš„dataNodeä¸­åˆ›å»ºè¯¥è¡¨ã€‚å¯¹äºå½“å‰é…ç½®æ¥è¯´ï¼Œä¹Ÿå°±æ„å‘³ç€**æ‰€æœ‰çš„èŠ‚ç‚¹ä¸­éƒ½æœ‰è¯¥è¡¨**äº†ã€‚

```xml
<table name="tb_areas_provinces" dataNode="dn1,dn2,dn3" primaryKey="id" type="global"/>
<table name="tb_areas_city" dataNode="dn1,dn2,dn3" primaryKey="id" type="global"/>
<table name="tb_areas_region" dataNode="dn1,dn2,dn3" primaryKey="id" type="global"/>
```

<img src="./Mysql-Learning-Local.assets/image-20250421201952688.png" alt="image-20250421201952688" style="zoom: 67%;" />

é…ç½®å®Œæ¯•åï¼Œ**é‡æ–°å¯åŠ¨MyCat**ã€‚

```bash
#å¯åŠ¨
bin/mycat start

#åœæ­¢
bin/mycat stop
```



**1). åˆ é™¤åŸæ¥æ¯ä¸€ä¸ªæ•°æ®åº“æœåŠ¡å™¨ä¸­çš„æ‰€æœ‰è¡¨ç»“æ„**

**2). é€šè¿‡sourceæŒ‡ä»¤ï¼Œå¯¼å…¥è¡¨åŠæ•°æ®**

```sql
source /root/shopping-table.sql

source /root/shopping-insert.sql
```

**3). æ£€æŸ¥æ¯ä¸€ä¸ªæ•°æ®åº“æœåŠ¡å™¨ä¸­çš„è¡¨åŠæ•°æ®åˆ†å¸ƒï¼Œçœ‹åˆ°ä¸‰ä¸ªèŠ‚ç‚¹ä¸­éƒ½æœ‰è¿™ä¸‰å¼ å…¨å±€è¡¨**

**4). ç„¶åå†æ¬¡æ‰§è¡Œä¸Šé¢çš„å¤šè¡¨è”æŸ¥çš„SQLè¯­å¥**

```sql
SELECT order_id , payment ,receiver, province , city , area FROM tb_order_master o
, tb_areas_provinces p , tb_areas_city c , tb_areas_region r WHERE
o.receiver_province = p.provinceid AND o.receiver_city = c.cityid AND
o.receiver_region = r.areaid ;
```

<img src="./Mysql-Learning-Local.assets/image-20250421210840765.png" alt="image-20250421210840765" style="zoom:80%;" />

æ˜¯å¯ä»¥æ­£å¸¸æ‰§è¡ŒæˆåŠŸçš„ã€‚

**5). å½“åœ¨MyCatä¸­æ›´æ–°å…¨å±€è¡¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ‰€æœ‰åˆ†ç‰‡èŠ‚ç‚¹ä¸­çš„æ•°æ®éƒ½å‘ç”Ÿäº†å˜åŒ–ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„å…¨å±€è¡¨æ•°æ®æ—¶åˆ»ä¿æŒä¸€è‡´ã€‚**



### ï¼ˆ2ï¼‰æ°´å¹³æ‹†åˆ†

#### â‘ åœºæ™¯

åœ¨ä¸šåŠ¡ç³»ç»Ÿä¸­, æœ‰ä¸€å¼ è¡¨(æ—¥å¿—è¡¨), ä¸šåŠ¡ç³»ç»Ÿæ¯å¤©éƒ½ä¼šäº§ç”Ÿå¤§é‡çš„**æ—¥å¿—æ•°æ®** , å•å°æœåŠ¡å™¨çš„æ•°æ®å­˜å‚¨åŠå¤„ç†èƒ½åŠ›æ˜¯æœ‰é™çš„, å¯ä»¥å¯¹**æ•°æ®åº“è¡¨è¿›è¡Œæ‹†åˆ†**ã€‚

![image-20250421211034417](./Mysql-Learning-Local.assets/image-20250421211034417.png)

#### â‘¡å‡†å¤‡

å‡†å¤‡ä¸‰å°æœåŠ¡å™¨ï¼Œå…·ä½“çš„ç»“æ„å¦‚ä¸‹ï¼š

<img src="./Mysql-Learning-Local.assets/image-20250421211054718.png" alt="image-20250421211054718" style="zoom: 50%;" />

å¹¶ä¸”ï¼Œåœ¨ä¸‰å°æ•°æ®åº“æœåŠ¡å™¨ä¸­**åˆ†åˆ«åˆ›å»ºä¸€ä¸ªæ•°æ®åº“itcast**ã€‚



#### â‘¢é…ç½®

##### 1). schema.xml

```xml
<schema name="ITCAST" checkSQLschema="true" sqlMaxLimit="100">
    <table name="tb_log" dataNode="dn4,dn5,dn6" primaryKey="id" rule="mod-long" />
</schema>

<dataNode name="dn4" dataHost="dhost1" database="itcast" />
<dataNode name="dn5" dataHost="dhost2" database="itcast" />
<dataNode name="dn6" dataHost="dhost3" database="itcast" />
```

tb_logè¡¨æœ€ç»ˆè½åœ¨3ä¸ªèŠ‚ç‚¹ä¸­ï¼Œåˆ†åˆ«æ˜¯ dn4ã€dn5ã€dn6 ï¼Œè€Œå…·ä½“çš„æ•°æ®åˆ†åˆ«å­˜å‚¨åœ¨ dhost1ã€dhost2ã€dhost3çš„itcastæ•°æ®åº“ä¸­ã€‚

**åˆ†ç‰‡è§„åˆ™ä¸ºï¼šmod-long**ï¼Œå–æ¨¡åˆ†ç‰‡ï¼Œé»˜è®¤mod 3



##### 2). server.xml

é…ç½®rootç”¨æˆ·æ—¢å¯ä»¥è®¿é—® SHOPPING é€»è¾‘åº“ï¼Œåˆå¯ä»¥è®¿é—®ITCASTé€»è¾‘åº“ã€‚

```xml
<user name="root" defaultAccount="true">
    <property name="password">123456</property>
    <property name="schemas">SHOPPING,ITCAST</property>
    <!-- è¡¨çº§ DML æƒé™è®¾ç½® -->
    <!--
		<privileges check="true">
		<schema name="DB01" dml="0110" >
		<table name="TB_ORDER" dml="1110"></table>
		</schema>
		</privileges>
	-->
</user>
```



#### â‘£æµ‹è¯•

é…ç½®å®Œæ¯•åï¼Œé‡æ–°å¯åŠ¨MyCatï¼Œç„¶ååœ¨mycatçš„å‘½ä»¤è¡Œä¸­ï¼Œæ‰§è¡Œå¦‚ä¸‹SQLåˆ›å»ºè¡¨ã€å¹¶æ’å…¥æ•°æ®ï¼ŒæŸ¥çœ‹æ•°æ®åˆ†å¸ƒæƒ…å†µã€‚

```sql
CREATE TABLE tb_log (
    id bigint(20) NOT NULL COMMENT 'ID',
    model_name varchar(200) DEFAULT NULL COMMENT 'æ¨¡å—å',
    model_value varchar(200) DEFAULT NULL COMMENT 'æ¨¡å—å€¼',
    return_value varchar(200) DEFAULT NULL COMMENT 'è¿”å›å€¼',
    return_class varchar(200) DEFAULT NULL COMMENT 'è¿”å›å€¼ç±»å‹',
    operate_user varchar(20) DEFAULT NULL COMMENT 'æ“ä½œç”¨æˆ·',
    operate_time varchar(20) DEFAULT NULL COMMENT 'æ“ä½œæ—¶é—´',
    param_and_value varchar(500) DEFAULT NULL COMMENT 'è¯·æ±‚å‚æ•°ååŠå‚æ•°å€¼',
    operate_class varchar(200) DEFAULT NULL COMMENT 'æ“ä½œç±»',
    operate_method varchar(200) DEFAULT NULL COMMENT 'æ“ä½œæ–¹æ³•',
    cost_time bigint(20) DEFAULT NULL COMMENT 'æ‰§è¡Œæ–¹æ³•è€—æ—¶, å•ä½ ms',
    source int(1) DEFAULT NULL COMMENT 'æ¥æº : 1 PC , 2 Android , 3 IOS',
    PRIMARY KEY (id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

**Insertè¯­å¥**

```sql
    INSERT INTO tb_log (id, model_name, model_value, return_value, return_class, operate_user, operate_time, param_and_value, operate_class, operate_method, cost_timeï¼Œsource) VALUES('1','user','insert','success','java.lang.String','10001','2022-01-06 18:12:28','{\"age\":\"20\",\"name\":\"Tom\",\"gender\":\"1\"}','cn.itcast.controller.UserController','insert','10',1);
    INSERT INTO tb_log (id, model_name, model_value, return_value, return_class, operate_user, operate_time, param_and_value, operate_class, operate_method, cost_timeï¼Œsource) VALUES('2','user','insert','success','java.lang.String','10001','2022-01-06 18:12:27','{\"age\":\"20\",\"name\":\"Tom\",\"gender\":\"1\"}','cn.itcast.controller.UserController','insert','23',1);
    INSERT INTO tb_log (id, model_name, model_value, return_value, return_class, operate_user, operate_time, param_and_value, operate_class, operate_method, cost_timeï¼Œsource) VALUES('3','user','update','success','java.lang.String','10001','2022-01-06 18:16:45','{\"age\":\"20\",\"name\":\"Tom\",\"gender\":\"1\"}','cn.itcast.controller.UserController','update','34',1);
    INSERT INTO tb_log (id, model_name, model_value, return_value, return_class, operate_user, operate_time, param_and_value, operate_class, operate_method, cost_timeï¼Œsource) VALUES('4','user','update','success','java.lang.String','10001','2022-01-06 18:16:45','{\"age\":\"20\",\"name\":\"Tom\",\"gender\":\"1\"}','cn.itcast.controller.UserController','update','13',2);
    INSERT INTO tb_log (id, model_name, model_value, return_value, return_class, operate_user, operate_time, param_and_value, operate_class, operate_method, cost_timeï¼Œsource) VALUES('5','user','insert','success','java.lang.String','10001','2022-01-06 18:30:31','{\"age\":\"200\",\"name\":\"TomCat\",\"gender\":\"0\"}','cn.itcast.controller.UserController','insert','29',3);
    INSERT INTO tb_log (id, model_name, model_value, return_value, return_class, operate_user, operate_time, param_and_value, operate_class, operate_method, cost_timeï¼Œsource) VALUES('6','user','find','success','java.lang.String','10001','2022-01-06 18:30:31','{\"age\":\"200\",\"name\":\"TomCat\",\"gender\":\"0\"}','cn.itcast.controller.UserController','find','29',2);
```



### ï¼ˆ3ï¼‰==åˆ†ç‰‡è§„åˆ™==

#### â‘ èŒƒå›´åˆ†ç‰‡

<span id = "èŒƒå›´åˆ†ç‰‡è§„åˆ™" > </span>

##### 1). ä»‹ç»

æ ¹æ®**æŒ‡å®šçš„å­—æ®µåŠå…¶é…ç½®çš„èŒƒå›´**ä¸æ•°æ®èŠ‚ç‚¹çš„å¯¹åº”æƒ…å†µï¼Œ æ¥å†³å®šè¯¥æ•°æ®å±äºå“ªä¸€ä¸ªåˆ†ç‰‡ã€‚

<img src="./Mysql-Learning-Local.assets/image-20250421212247311.png" alt="image-20250421212247311" style="zoom:67%;" />

##### 2). é…ç½®

![image-20250421212427081](./Mysql-Learning-Local.assets/image-20250421212427081.png)

schema.xmlé€»è¾‘è¡¨é…ç½®ï¼š

```xml
<table name="TB_ORDER" dataNode="dn1,dn2,dn3" rule="auto-sharding-long" />
```

schema.xmlæ•°æ®èŠ‚ç‚¹é…ç½®ï¼š

```xml
<dataNode name="dn1" dataHost="dhost1" database="db01" />
<dataNode name="dn2" dataHost="dhost2" database="db01" />
<dataNode name="dn3" dataHost="dhost3" database="db01" />
```

rule.xmlåˆ†ç‰‡è§„åˆ™é…ç½®ï¼š

```xml
<tableRule name="auto-sharding-long">
    <rule>
        <columns>id</columns>
        <algorithm>rang-long</algorithm>
    </rule>
</tableRule>

<function name="rang-long" class="io.mycat.route.function.AutoPartitionByLong">
    <property name="mapFile">autopartition-long.txt</property>
    <property name="defaultNode">0</property>
</function>
```

åˆ†ç‰‡è§„åˆ™é…ç½®å±æ€§å«ä¹‰ï¼š

![image-20250420160936630](./Mysql-Learning-Local.assets/image-20250420160936630.png)

åœ¨rule.xmlä¸­é…ç½®åˆ†ç‰‡è§„åˆ™æ—¶ï¼Œå…³è”äº†ä¸€ä¸ªæ˜ å°„é…ç½®æ–‡ä»¶ autopartition-long.txtï¼Œè¯¥é…ç½®æ–‡ä»¶çš„é…ç½®å¦‚ä¸‹ï¼š

```bash
# range start-end ,data node index
# K=1000,M=10000.
0-500M=0
500M-1000M=1
1000M-1500M=2
```

å«ä¹‰ï¼š0-500ä¸‡ä¹‹é—´çš„å€¼ï¼Œå­˜å‚¨åœ¨0å·æ•°æ®èŠ‚ç‚¹(æ•°æ®èŠ‚ç‚¹çš„ç´¢å¼•ä»0å¼€å§‹) ï¼› 500ä¸‡-1000ä¸‡ä¹‹é—´çš„æ•°æ®å­˜å‚¨åœ¨1å·æ•°æ®èŠ‚ç‚¹ ï¼› 1000ä¸‡-1500ä¸‡çš„æ•°æ®èŠ‚ç‚¹å­˜å‚¨åœ¨2å·èŠ‚ç‚¹ ï¼›

å¦‚æœ**è¶…å‡ºäº†1500w**ï¼Œæ¯”å¦‚1500w 01ï¼Œåˆ™ä¼šæŠ¥é”™ï¼Œéœ€è¦æ·»åŠ æ–°çš„æ•°æ®èŠ‚ç‚¹

![image-20250421151802849](./Mysql-Learning-Local.assets/image-20250421151802849.png)



è¯¥åˆ†ç‰‡è§„åˆ™ï¼Œä¸»è¦æ˜¯é’ˆå¯¹äºæ•°å­—ç±»å‹çš„å­—æ®µé€‚ç”¨ã€‚ åœ¨MyCatçš„å…¥é—¨ç¨‹åºä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„å°±æ˜¯è¯¥åˆ†ç‰‡è§„åˆ™ã€‚



#### â‘¡å–æ¨¡åˆ†ç‰‡

##### 1). ä»‹ç»

æ ¹æ®**æŒ‡å®šçš„å­—æ®µå€¼ä¸==èŠ‚ç‚¹æ•°é‡è¿›è¡Œæ±‚æ¨¡==è¿ç®—**ï¼Œæ ¹æ®è¿ç®—ç»“æœï¼Œ æ¥å†³å®šè¯¥æ•°æ®å±äºå“ªä¸€ä¸ªåˆ†ç‰‡ã€‚

<img src="./Mysql-Learning-Local.assets/image-20250421212459138.png" alt="image-20250421212459138" style="zoom:67%;" />

##### 2). é…ç½®

![image-20250421212625728](./Mysql-Learning-Local.assets/image-20250421212625728.png)

schema.xmlé€»è¾‘è¡¨é…ç½®ï¼š

```xml
<!-- å–æ¨¡åˆ†ç‰‡ -->
<table name="tb_log" dataNode="dn4,dn5,dn6" primaryKey="id" rule="mod-long" />
```

schema.xmlæ•°æ®èŠ‚ç‚¹é…ç½®ï¼š

```xml
<dataNode name="dn4" dataHost="dhost1" database="itcast" />
<dataNode name="dn5" dataHost="dhost2" database="itcast" />
<dataNode name="dn6" dataHost="dhost3" database="itcast" />
```

rule.xmlåˆ†ç‰‡è§„åˆ™é…ç½®ï¼š

```xml
<tableRule name="mod-long">
    <rule>
        <columns>id</columns>
        <algorithm>mod-long</algorithm>
    </rule>
</tableRule>
<function name="mod-long" class="io.mycat.route.function.PartitionByMod">
    <property name="count">3</property>
</function>
```

åˆ†ç‰‡è§„åˆ™å±æ€§è¯´æ˜å¦‚ä¸‹ï¼š

![image-20250420161501109](./Mysql-Learning-Local.assets/image-20250420161501109.png)

è¯¥åˆ†ç‰‡è§„åˆ™ï¼Œä¸»è¦æ˜¯é’ˆå¯¹äºæ•°å­—ç±»å‹çš„å­—æ®µé€‚ç”¨ã€‚ åœ¨å‰é¢æ°´å¹³æ‹†åˆ†çš„æ¼”ç¤ºä¸­ï¼Œæˆ‘ä»¬é€‰æ‹©çš„å°±æ˜¯å–æ¨¡åˆ†ç‰‡ã€‚



##### 3). æµ‹è¯•

é…ç½®å®Œæ¯•åï¼Œé‡æ–°å¯åŠ¨MyCatï¼Œç„¶ååœ¨mycatçš„å‘½ä»¤è¡Œä¸­ï¼Œæ‰§è¡Œå¦‚ä¸‹SQLåˆ›å»ºè¡¨ã€å¹¶æ’å…¥æ•°æ®ï¼ŒæŸ¥çœ‹æ•°æ®åˆ†å¸ƒæƒ…å†µã€‚



#### â‘¢ä¸€è‡´æ€§hashåˆ†ç‰‡

##### 1). ä»‹ç»

æ‰€è°“ä¸€è‡´æ€§å“ˆå¸Œï¼Œ**==ç›¸åŒçš„å“ˆå¸Œå› å­è®¡ç®—å€¼==æ€»æ˜¯è¢«åˆ’åˆ†åˆ°ç›¸åŒçš„åˆ†åŒºè¡¨ä¸­**ï¼Œä¸ä¼šå› ä¸ºåˆ†åŒºèŠ‚ç‚¹çš„å¢åŠ è€Œæ”¹å˜åŸæ¥æ•°æ®çš„åˆ†åŒºä½ç½®ï¼Œæœ‰æ•ˆçš„è§£å†³äº†åˆ†å¸ƒå¼æ•°æ®çš„æ‹“å®¹é—®é¢˜ã€‚

- ä¸€è‡´hashè¯´çš„æ˜¯**èŠ‚ç‚¹å¢åŠ ä¸å½±å“hashç®—æ³•å€¼**

<img src="./Mysql-Learning-Local.assets/image-20250421212656441.png" alt="image-20250421212656441" style="zoom: 80%;" />



##### 2). é…ç½®

![image-20250421212825170](./Mysql-Learning-Local.assets/image-20250421212825170.png)

schema.xmlä¸­é€»è¾‘è¡¨é…ç½®ï¼š

```xml
<!-- ä¸€è‡´æ€§hash -->
<table name="tb_order" dataNode="dn4,dn5,dn6" rule="sharding-by-murmur" />
```

schema.xmlä¸­æ•°æ®èŠ‚ç‚¹é…ç½®ï¼š

```xml
<dataNode name="dn4" dataHost="dhost1" database="itcast" />
<dataNode name="dn5" dataHost="dhost2" database="itcast" />
<dataNode name="dn6" dataHost="dhost3" database="itcast" />
```

rule.xmlä¸­åˆ†ç‰‡è§„åˆ™é…ç½®ï¼š

```xml
<tableRule name="sharding-by-murmur">
    <rule>
        <columns>id</columns>
        <algorithm>murmur</algorithm>
    </rule>
</tableRule>
<function name="murmur" class="io.mycat.route.function.PartitionByMurmurHash">
    <property name="seed">0</property><!-- é»˜è®¤æ˜¯0 -->
    <property name="count">3</property>
    <property name="virtualBucketTimes">160</property>
</function>
```

åˆ†ç‰‡è§„åˆ™å±æ€§å«ä¹‰ï¼š

![image-20250420161703182](./Mysql-Learning-Local.assets/image-20250420161703182.png)



##### 3). æµ‹è¯•

é…ç½®å®Œæ¯•åï¼Œé‡æ–°å¯åŠ¨MyCatï¼Œç„¶ååœ¨mycatçš„å‘½ä»¤è¡Œä¸­ï¼Œæ‰§è¡Œå¦‚ä¸‹SQLåˆ›å»ºè¡¨ã€å¹¶æ’å…¥æ•°æ®ï¼ŒæŸ¥çœ‹æ•°æ®åˆ†å¸ƒæƒ…å†µã€‚

```sql
create table tb_order(
    id  varchar(100) not null primary key,
    money   int null,
    content varchar(200) null
);

INSERT INTO tb_order (id, money, content) VALUES ('b92fdaaf-6fc4-11ec-b831-482ae33c4a2d', 10, 'b92fdaf8-6fc4-11ec-b831-482ae33c4a2d');
INSERT INTO tb_order (id, money, content) VALUES ('b93482b6-6fc4-11ec-b831-482ae33c4a2d', 20, 'b93482d5-6fc4-11ec-b831-482ae33c4a2d');
INSERT INTO tb_order (id, money, content) VALUES ('b937e246-6fc4-11ec-b831-482ae33c4a2d', 50, 'b937e25d-6fc4-11ec-b831-482ae33c4a2d');
INSERT INTO tb_order (id, money, content) VALUES ('b93be2dd-6fc4-11ec-b831-482ae33c4a2d', 100, 'b93be2f9-6fc4-11ec-b831-482ae33c4a2d');
INSERT INTO tb_order (id, money, content) VALUES ('b93f2d68-6fc4-11ec-b831-482ae33c4a2d', 130, 'b93f2d7d-6fc4-11ec-b831-482ae33c4a2d');
INSERT INTO tb_order (id, money, content) VALUES ('b9451b98-6fc4-11ec-b831-482ae33c4a2d', 30, 'b9451bcc-6fc4-11ec-b831-482ae33c4a2d');
INSERT INTO tb_order (id, money, content) VALUES ('b9488ec1-6fc4-11ec-b831-482ae33c4a2d', 560, 'b9488edb-6fc4-11ec-b831-482ae33c4a2d');
INSERT INTO tb_order (id, money, content) VALUES ('b94be6e6-6fc4-11ec-b831-482ae33c4a2d', 10, 'b94be6ff-6fc4-11ec-b831-482ae33c4a2d');
INSERT INTO tb_order (id, money, content) VALUES ('b94ee10d-6fc4-11ec-b831-482ae33c4a2d', 123, 'b94ee12c-6fc4-11ec-b831-482ae33c4a2d');
INSERT INTO tb_order (id, money, content) VALUES ('b952492a-6fc4-11ec-b831-482ae33c4a2d', 145, 'b9524945-6fc4-11ec-b831-482ae33c4a2d');
INSERT INTO tb_order (id, money, content) VALUES ('b95553ac-6fc4-11ec-b831-482ae33c4a2d', 543, 'b95553c8-6fc4-11ec-b831-482ae33c4a2d');
INSERT INTO tb_order (id, money, content) VALUES ('b9581cdd-6fc4-11ec-b831-482ae33c4a2d', 17, 'b9581cfa-6fc4-11ec-b831-482ae33c4a2d');
INSERT INTO tb_order (id, money, content) VALUES ('b95afc0f-6fc4-11ec-b831-482ae33c4a2d', 18, 'b95afc2a-6fc4-11ec-b831-482ae33c4a2d');
INSERT INTO tb_order (id, money, content) VALUES ('b95daa99-6fc4-11ec-b831-482ae33c4a2d', 134, 'b95daab2-6fc4-11ec-b831-482ae33c4a2d');
INSERT INTO tb_order (id, money, content) VALUES ('b9667e3c-6fc4-11ec-b831-482ae33c4a2d', 156, 'b9667e60-6fc4-11ec-b831-482ae33c4a2d');
INSERT INTO tb_order (id, money, content) VALUES ('b96ab489-6fc4-11ec-b831-482ae33c4a2d', 175, 'b96ab4a5-6fc4-11ec-b831-482ae33c4a2d');
INSERT INTO tb_order (id, money, content) VALUES ('b96e2942-6fc4-11ec-b831-482ae33c4a2d', 180, 'b96e295b-6fc4-11ec-b831-482ae33c4a2d');
INSERT INTO tb_order (id, money, content) VALUES ('b97092ec-6fc4-11ec-b831-482ae33c4a2d', 123, 'b9709306-6fc4-11ec-b831-482ae33c4a2d');
INSERT INTO tb_order (id, money, content) VALUES ('b973727a-6fc4-11ec-b831-482ae33c4a2d', 230, 'b9737293-6fc4-11ec-b831-482ae33c4a2d');
INSERT INTO tb_order (id, money, content) VALUES ('b978840f-6fc4-11ec-b831-482ae33c4a2d', 560, 'b978843c-6fc4-11ec-b831-482ae33c4a2d');
```



#### â‘£æšä¸¾åˆ†ç‰‡

##### 1). ä»‹ç»

é€šè¿‡åœ¨é…ç½®æ–‡ä»¶ä¸­**é…ç½®å¯èƒ½çš„æšä¸¾å€¼**, æŒ‡å®šæ•°æ®åˆ†å¸ƒåˆ°ä¸åŒæ•°æ®èŠ‚ç‚¹ä¸Š, æœ¬è§„åˆ™é€‚ç”¨äº**æŒ‰ç…§çœä»½ã€æ€§åˆ«ã€çŠ¶æ€æ‹†åˆ†æ•°æ®**ç­‰ä¸šåŠ¡ ã€‚

<img src="./Mysql-Learning-Local.assets/image-20250422144941855.png" alt="image-20250422144941855" style="zoom:67%;" />

##### 2). é…ç½®

![image-20250422145040200](./Mysql-Learning-Local.assets/image-20250422145040200.png)

**è¿™é‡ŒæŒ‰ç…§tb_userè¡¨çš„ statuså­—æ®µ è¿›è¡Œæšä¸¾åˆ†ç‰‡ï¼Œè¯¥statuså¯¹åº”ä¸‰ä¸ªçŠ¶æ€1,2,3**

schema.xmlä¸­é€»è¾‘è¡¨é…ç½®ï¼š

```xml
<!-- æšä¸¾ -->
        <table name="tb_user" dataNode="dn4,dn5,dn6" rule="sharding-by-intfile-enumstatus"/>
        <!-- è‡ªå·±å¢åŠ  tableRule: "sharding-by-intfile-enumstatus" -->
```

schema.xmlä¸­æ•°æ®èŠ‚ç‚¹é…ç½®ï¼š

```xml
<dataNode name="dn4" dataHost="dhost1" database="itcast" />
<dataNode name="dn5" dataHost="dhost2" database="itcast" />
<dataNode name="dn6" dataHost="dhost3" database="itcast" />
```

rule.xmlä¸­åˆ†ç‰‡è§„åˆ™é…ç½®ï¼š

```xml
<tableRule name="sharding-by-intfile">
    <rule>
        <columns>sharding_id</columns>
        <algorithm>hash-int</algorithm>
    </rule>
</tableRule>
<!-- è‡ªå·±å¢åŠ  tableRule -->
<tableRule name="sharding-by-intfile-enumstatus">
    <rule>
        <columns>status</columns>
        <algorithm>hash-int</algorithm>
    </rule>
</tableRule>

<function name="hash-int" class="io.mycat.route.function.PartitionByFileMap">
    <!-- defaultNodeè¡¨ç¤ºï¼Œè‹¥æ²¡æœ‰æ‰¾åˆ°å¯¹åº”åŒ¹é…çš„æšä¸¾ï¼Œåˆ™ä½¿ç”¨é»˜è®¤é…ç½®çš„æ•°æ®èŠ‚ç‚¹ -->
    <property name="defaultNode">2</property>
    <property name="mapFile">partition-hash-int.txt</property>
</function>
```

partition-hash-int.txt ï¼Œå†…å®¹å¦‚ä¸‹ :

```bash
1=0
2=1
3=2
```

åˆ†ç‰‡è§„åˆ™å±æ€§å«ä¹‰ï¼š

![image-20250420162034067](./Mysql-Learning-Local.assets/image-20250420162034067.png)

##### 3). æµ‹è¯•

é…ç½®å®Œæ¯•åï¼Œé‡æ–°å¯åŠ¨MyCatï¼Œç„¶ååœ¨mycatçš„å‘½ä»¤è¡Œä¸­ï¼Œæ‰§è¡Œå¦‚ä¸‹SQLåˆ›å»ºè¡¨ã€å¹¶æ’å…¥æ•°æ®ï¼Œ**æŸ¥çœ‹æ•°æ®åˆ†å¸ƒæƒ…å†µã€‚**

```sql
CREATE TABLE tb_user (
    id bigint(20) NOT NULL COMMENT 'ID',
    username varchar(200) DEFAULT NULL COMMENT 'å§“å',
    status int(2) DEFAULT '1' COMMENT '1: æœªå¯ç”¨, 2: å·²å¯ç”¨, 3: å·²å…³é—­',
    PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

insert into tb_user (id,username ,status) values(1,'Tom',1);
insert into tb_user (id,username ,status) values(2,'Cat',2);
insert into tb_user (id,username ,status) values(3,'Rose',3);
insert into tb_user (id,username ,status) values(4,'Coco',2);
insert into tb_user (id,username ,status) values(5,'Lily',1);
insert into tb_user (id,username ,status) values(6,'Tom',1);
insert into tb_user (id,username ,status) values(7,'Cat',2);
insert into tb_user (id,username ,status) values(8,'Rose',3);
insert into tb_user (id,username ,status) values(9,'Coco',2);
insert into tb_user (id,username ,status) values(10,'Lily',1);
```



#### â‘¤åº”ç”¨æŒ‡å®šç®—æ³•

##### 1). ä»‹ç»

è¿è¡Œé˜¶æ®µç”±åº”ç”¨è‡ªä¸»å†³å®šè·¯ç”±åˆ°é‚£ä¸ªåˆ†ç‰‡ , **ç›´æ¥æ ¹æ®å­—ç¬¦å­ä¸²ï¼ˆå¿…é¡»æ˜¯æ•°å­—ï¼‰è®¡ç®—åˆ†ç‰‡å·**ã€‚

<img src="./Mysql-Learning-Local.assets/image-20250422150321510.png" alt="image-20250422150321510" style="zoom:67%;" />

##### 2). é…ç½®

![image-20250422150708305](./Mysql-Learning-Local.assets/image-20250422150708305.png)

schema.xmlä¸­é€»è¾‘è¡¨é…ç½®ï¼š

```xml
<!-- åº”ç”¨æŒ‡å®šç®—æ³• -->
<table name="tb_app" dataNode="dn4,dn5,dn6" rule="sharding-by-substring" />
```

schema.xmlä¸­æ•°æ®èŠ‚ç‚¹é…ç½®ï¼š

```xml
<dataNode name="dn4" dataHost="dhost1" database="itcast" />
<dataNode name="dn5" dataHost="dhost2" database="itcast" />
<dataNode name="dn6" dataHost="dhost3" database="itcast" />
```

rule.xmlä¸­åˆ†ç‰‡è§„åˆ™é…ç½®ï¼š

```xml
<tableRule name="sharding-by-substring">
    <rule>
        <columns>id</columns>
        <algorithm>sharding-by-substring</algorithm>
    </rule>
</tableRule>

<function name="sharding-by-substring"
          class="io.mycat.route.function.PartitionDirectBySubString">
    <property name="startIndex">0</property> <!-- zero-based -->
    <property name="size">2</property>
    <property name="partitionCount">3</property>
    <property name="defaultPartition">0</property>
</function>
```

åˆ†ç‰‡è§„åˆ™å±æ€§å«ä¹‰ï¼š

![image-20250420162353834](./Mysql-Learning-Local.assets/image-20250420162353834.png)

ç¤ºä¾‹è¯´æ˜ :

id=05-100000002 , åœ¨æ­¤é…ç½®ä¸­ä»£è¡¨æ ¹æ®idä¸­ä» startIndex=0ï¼Œå¼€å§‹ï¼Œæˆªå–siz=2ä½æ•°å­—å³05ï¼Œ05å°±æ˜¯è·å–çš„åˆ†åŒºï¼Œ**å¦‚æœæ²¡æ‰¾åˆ°å¯¹åº”çš„åˆ†ç‰‡åˆ™é»˜è®¤åˆ†é…åˆ°defaultPartition** ã€‚



##### 3). æµ‹è¯•

é…ç½®å®Œæ¯•åï¼Œé‡æ–°å¯åŠ¨MyCatï¼Œç„¶ååœ¨mycatçš„å‘½ä»¤è¡Œä¸­ï¼Œæ‰§è¡Œå¦‚ä¸‹SQLåˆ›å»ºè¡¨ã€å¹¶æ’å…¥æ•°æ®ï¼ŒæŸ¥çœ‹æ•°æ®åˆ†å¸ƒæƒ…å†µã€‚

```sql
CREATE TABLE tb_app (
    id varchar(10) NOT NULL COMMENT 'ID',
    name varchar(200) DEFAULT NULL COMMENT 'åç§°',
    PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

insert into tb_app (id,name) values('0000001','Testx00001');
insert into tb_app (id,name) values('0100001','Test100001');
insert into tb_app (id,name) values('0100002','Test200001');
insert into tb_app (id,name) values('0200001','Test300001');
insert into tb_app (id,name) values('0200002','TesT400001');
```





#### â‘¥å›ºå®šåˆ†ç‰‡hashç®—æ³•

##### 1). ä»‹ç»

è¯¥ç®—æ³•ç±»ä¼¼äºåè¿›åˆ¶çš„æ±‚æ¨¡è¿ç®—ï¼Œä½†æ˜¯ä¸ºäºŒè¿›åˆ¶çš„æ“ä½œã€‚

ä¾‹å¦‚ï¼Œ**å– id çš„äºŒè¿›åˆ¶ä½ 10 ä½ ä¸1111111111 è¿›è¡Œä½ & è¿ç®—**

- ä½ä¸è¿ç®—æœ€å°å€¼ä¸º 0000000000ï¼Œæœ€å¤§å€¼ä¸º1111111111ï¼Œè½¬æ¢ä¸ºåè¿›åˆ¶ï¼Œä¹Ÿå°±æ˜¯ä½äº**0-1023ä¹‹é—´**ã€‚

![image-20250422151259810](./Mysql-Learning-Local.assets/image-20250422151259810.png)

ç‰¹ç‚¹ï¼š

- å¦‚æœæ˜¯æ±‚æ¨¡ï¼Œè¿ç»­çš„å€¼ï¼Œåˆ†åˆ«åˆ†é…åˆ°å„ä¸ªä¸åŒçš„åˆ†ç‰‡ï¼›ä½†æ˜¯æ­¤ç®—æ³•**==ä¼šå°†è¿ç»­çš„å€¼å¯èƒ½åˆ†é…åˆ°ç›¸åŒçš„åˆ†ç‰‡ï¼Œé™ä½äº‹åŠ¡å¤„ç†çš„éš¾åº¦==ã€‚**
- å¯ä»¥å‡åŒ€åˆ†é…ï¼Œä¹Ÿå¯ä»¥éå‡åŒ€åˆ†é…ã€‚
- **åˆ†ç‰‡å­—æ®µå¿…é¡»ä¸ºæ•°å­—ç±»å‹**ã€‚



##### 2). é…ç½®

![image-20250422151530296](./Mysql-Learning-Local.assets/image-20250422151530296.png)

schema.xmlä¸­é€»è¾‘è¡¨é…ç½®ï¼š

```xml
<!-- å›ºå®šåˆ†ç‰‡hashç®—æ³• -->
<table name="tb_longhash" dataNode="dn4,dn5,dn6" rule="sharding-by-long-hash" />
```

schema.xmlä¸­æ•°æ®èŠ‚ç‚¹é…ç½®ï¼š

```xml
<dataNode name="dn4" dataHost="dhost1" database="itcast" />
<dataNode name="dn5" dataHost="dhost2" database="itcast" />
<dataNode name="dn6" dataHost="dhost3" database="itcast" />
```

rule.xmlä¸­åˆ†ç‰‡è§„åˆ™é…ç½®ï¼š

```xml
<tableRule name="sharding-by-long-hash">
    <rule>
        <columns>id</columns>
        <algorithm>sharding-by-long-hash</algorithm>
    </rule>
</tableRule>

<!-- åˆ†ç‰‡æ€»é•¿åº¦ä¸º1024ï¼Œcountä¸lengthæ•°ç»„é•¿åº¦å¿…é¡»ä¸€è‡´ï¼› -->
<function name="sharding-by-long-hash"
          class="io.mycat.route.function.PartitionByLong">
    <property name="partitionCount">2,1</property>
    <property name="partitionLength">256,512</property>
</function>
```

åˆ†ç‰‡è§„åˆ™å±æ€§å«ä¹‰ï¼š

![image-20250420162636313](./Mysql-Learning-Local.assets/image-20250420162636313.png)

çº¦æŸ :

- 1). åˆ†ç‰‡é•¿åº¦ : é»˜è®¤æœ€å¤§2^10 , ä¸º 1024 ;
- 2). count, lengthçš„æ•°ç»„é•¿åº¦å¿…é¡»æ˜¯ä¸€è‡´çš„ ;

ä»¥ä¸Š**åˆ†ä¸ºä¸‰ä¸ªåˆ†åŒº:0-255,256-511,512-1023**



ç¤ºä¾‹è¯´æ˜ :

![image-20250422151546846](./Mysql-Learning-Local.assets/image-20250422151546846.png)



##### 3). æµ‹è¯•

é…ç½®å®Œæ¯•åï¼Œé‡æ–°å¯åŠ¨MyCatï¼Œç„¶ååœ¨mycatçš„å‘½ä»¤è¡Œä¸­ï¼Œæ‰§è¡Œå¦‚ä¸‹SQLåˆ›å»ºè¡¨ã€å¹¶æ’å…¥æ•°æ®ï¼ŒæŸ¥çœ‹æ•°æ®åˆ†å¸ƒæƒ…å†µã€‚

```sql
CREATE TABLE tb_longhash (
    id int(11) NOT NULL COMMENT 'ID',
    name varchar(200) DEFAULT NULL COMMENT 'åç§°',
    firstChar char(1) COMMENT 'é¦–å­—æ¯',
    PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

insert into tb_longhash (id,name,firstChar) values(1,'ä¸ƒåŒ¹ç‹¼','Q');
insert into tb_longhash (id,name,firstChar) values(2,'å…«åŒ¹ç‹¼','B');
insert into tb_longhash (id,name,firstChar) values(3,'ä¹åŒ¹ç‹¼','J');
insert into tb_longhash (id,name,firstChar) values(4,'ååŒ¹ç‹¼','S');
insert into tb_longhash (id,name,firstChar) values(5,'å…­åŒ¹ç‹¼','L');
insert into tb_longhash (id,name,firstChar) values(6,'äº”åŒ¹ç‹¼','W');
insert into tb_longhash (id,name,firstChar) values(7,'å››åŒ¹ç‹¼','S');
insert into tb_longhash (id,name,firstChar) values(8,'ä¸‰åŒ¹ç‹¼','S');
insert into tb_longhash (id,name,firstChar) values(9,'ä¸¤åŒ¹ç‹¼','L');
```



#### â‘¦å­—ç¬¦ä¸²hashè§£æç®—æ³•

##### 1). ä»‹ç»

**æˆªå–å­—ç¬¦ä¸²ä¸­çš„æŒ‡å®šä½ç½®çš„å­å­—ç¬¦ä¸², è¿›è¡Œhashç®—æ³•**ï¼Œ ç®—å‡ºåˆ†ç‰‡ã€‚

![image-20250422152153707](./Mysql-Learning-Local.assets/image-20250422152153707.png)

##### 2). é…ç½®

![image-20250422152506430](./Mysql-Learning-Local.assets/image-20250422152506430.png)

schema.xmlä¸­é€»è¾‘è¡¨é…ç½®ï¼š

```xml
<!-- å­—ç¬¦ä¸²hashè§£æç®—æ³• -->
<table name="tb_strhash" dataNode="dn4,dn5" rule="sharding-by-stringhash" />
```

schema.xmlä¸­æ•°æ®èŠ‚ç‚¹é…ç½®ï¼š

```xml
<dataNode name="dn4" dataHost="dhost1" database="itcast" />
<dataNode name="dn5" dataHost="dhost2" database="itcast" />
```

rule.xmlä¸­åˆ†ç‰‡è§„åˆ™é…ç½®ï¼š

```xml
<tableRule name="sharding-by-stringhash">
    <rule>
        <columns>name</columns>
        <algorithm>sharding-by-stringhash</algorithm>
    </rule>
</tableRule>

<function name="sharding-by-stringhash"
          class="io.mycat.route.function.PartitionByString">
    <property name="partitionLength">512</property> <!-- zero-based -->
    <property name="partitionCount">2</property>
    <property name="hashSlice">0:2</property>
</function>
```

åˆ†ç‰‡è§„åˆ™å±æ€§å«ä¹‰ï¼š

![image-20250420162916474](./Mysql-Learning-Local.assets/image-20250420162916474.png)

ç¤ºä¾‹è¯´æ˜ï¼š

![image-20250422152857435](./Mysql-Learning-Local.assets/image-20250422152857435.png)

##### 3). æµ‹è¯•

é…ç½®å®Œæ¯•åï¼Œé‡æ–°å¯åŠ¨MyCatï¼Œç„¶ååœ¨mycatçš„å‘½ä»¤è¡Œä¸­ï¼Œæ‰§è¡Œå¦‚ä¸‹SQLåˆ›å»ºè¡¨ã€å¹¶æ’å…¥æ•°æ®ï¼ŒæŸ¥çœ‹æ•°æ®åˆ†å¸ƒæƒ…å†µã€‚

```sql
create table tb_strhash(
    name varchar(20) primary key,
    content varchar(100)
)engine=InnoDB DEFAULT CHARSET=utf8mb4;

INSERT INTO tb_strhash (name,content) VALUES('T1001', UUID());
INSERT INTO tb_strhash (name,content) VALUES('ROSE', UUID());
INSERT INTO tb_strhash (name,content) VALUES('JERRY', UUID());
INSERT INTO tb_strhash (name,content) VALUES('CRISTINA', UUID());
INSERT INTO tb_strhash (name,content) VALUES('TOMCAT', UUID());
```



#### â‘§æŒ‰å¤©åˆ†ç‰‡ç®—æ³•

##### 1). ä»‹ç»

æŒ‰ç…§**æ—¥æœŸåŠå¯¹åº”çš„æ—¶é—´å‘¨æœŸ**æ¥åˆ†ç‰‡ã€‚

![image-20250422152913057](./Mysql-Learning-Local.assets/image-20250422152913057.png)

##### 2). é…ç½®

![image-20250422153250429](./Mysql-Learning-Local.assets/image-20250422153250429.png)

schema.xmlä¸­é€»è¾‘è¡¨é…ç½®ï¼š

```xml
<!-- æŒ‰å¤©åˆ†ç‰‡ -->
<table name="tb_datepart" dataNode="dn4,dn5,dn6" rule="sharding-by-date" />
```

schema.xmlä¸­æ•°æ®èŠ‚ç‚¹é…ç½®ï¼š

```xml
<dataNode name="dn4" dataHost="dhost1" database="itcast" />
<dataNode name="dn5" dataHost="dhost2" database="itcast" />
<dataNode name="dn6" dataHost="dhost3" database="itcast" /
```

rule.xmlä¸­åˆ†ç‰‡è§„åˆ™é…ç½®ï¼š

```xml
<tableRule name="sharding-by-date">
    <rule>
        <columns>create_time</columns>
        <algorithm>sharding-by-date</algorithm>
    </rule>
</tableRule>

<function name="sharding-by-date"
          class="io.mycat.route.function.PartitionByDate">
    <property name="dateFormat">yyyy-MM-dd</property>
    <property name="sBeginDate">2022-01-01</property>
    <property name="sEndDate">2022-01-30</property>
    <property name="sPartionDay">10</property>
</function>
	<!--
		ä»å¼€å§‹æ—¶é—´å¼€å§‹ï¼Œæ¯10å¤©ä¸ºä¸€ä¸ªåˆ†ç‰‡ï¼Œåˆ°è¾¾ç»“æŸæ—¶é—´ä¹‹åï¼Œä¼šé‡å¤å¼€å§‹åˆ†ç‰‡æ’å…¥ã€‚
		é…ç½®è¡¨çš„ dataNode çš„åˆ†ç‰‡ï¼Œå¿…é¡»å’Œåˆ†ç‰‡è§„åˆ™æ•°é‡ä¸€è‡´ï¼Œ
		ä¾‹å¦‚ 2022-01-01 åˆ° 2022-12-31 ï¼Œæ¯10å¤©ä¸€ä¸ªåˆ†ç‰‡ï¼Œä¸€å…±éœ€è¦37ä¸ªåˆ†ç‰‡ã€‚
	-->
```

åˆ†ç‰‡è§„åˆ™å±æ€§å«ä¹‰ï¼š

![image-20250420163104665](./Mysql-Learning-Local.assets/image-20250420163104665.png)



##### 3). æµ‹è¯•

é…ç½®å®Œæ¯•åï¼Œé‡æ–°å¯åŠ¨MyCatï¼Œç„¶ååœ¨mycatçš„å‘½ä»¤è¡Œä¸­ï¼Œæ‰§è¡Œå¦‚ä¸‹SQLåˆ›å»ºè¡¨ã€å¹¶æ’å…¥æ•°æ®ï¼ŒæŸ¥çœ‹æ•°æ®åˆ†å¸ƒæƒ…å†µã€‚

```sql
create table tb_datepart(
    id bigint not null comment 'ID' primary key,
    name varchar(100) null comment 'å§“å',
    create_time date null
)engine=InnoDB DEFAULT CHARSET=utf8mb4;

insert into tb_datepart(id,name ,create_time) values(1,'Tom','2022-01-01');
insert into tb_datepart(id,name ,create_time) values(2,'Cat','2022-01-10');
insert into tb_datepart(id,name ,create_time) values(3,'Rose','2022-01-11');
insert into tb_datepart(id,name ,create_time) values(4,'Coco','2022-01-20');
insert into tb_datepart(id,name ,create_time) values(5,'Rose2','2022-01-21');
insert into tb_datepart(id,name ,create_time) values(6,'Coco2','2022-01-30');
insert into tb_datepart(id,name ,create_time) values(7,'Coco3','2022-01-31');
```



#### â‘¨è‡ªç„¶æœˆåˆ†ç‰‡

##### 1). ä»‹ç»

ä½¿ç”¨åœºæ™¯ä¸º**æŒ‰ç…§æœˆä»½æ¥åˆ†ç‰‡**, æ¯ä¸ªè‡ªç„¶æœˆä¸ºä¸€ä¸ªåˆ†ç‰‡ã€‚

<img src="./Mysql-Learning-Local.assets/image-20250422154053125.png" alt="image-20250422154053125" style="zoom:67%;" />

##### 2). é…ç½®

![image-20250422154629732](./Mysql-Learning-Local.assets/image-20250422154629732.png)

schema.xmlä¸­é€»è¾‘è¡¨é…ç½®ï¼š

```xml
<!-- æŒ‰è‡ªç„¶æœˆåˆ†ç‰‡ -->
<table name="tb_monthpart" dataNode="dn4,dn5,dn6" rule="sharding-by-month" />
```

schema.xmlä¸­æ•°æ®èŠ‚ç‚¹é…ç½®ï¼š

```xml
<dataNode name="dn4" dataHost="dhost1" database="itcast" />
<dataNode name="dn5" dataHost="dhost2" database="itcast" />
<dataNode name="dn6" dataHost="dhost3" database="itcast" />
```

rule.xmlä¸­åˆ†ç‰‡è§„åˆ™é…ç½®ï¼š

```xml
<tableRule name="sharding-by-month">
    <rule>
        <columns>create_time</columns>
        <algorithm>partbymonth</algorithm>
    </rule>
</tableRule>

<function name="partbymonth" class="io.mycat.route.function.PartitionByMonth">
    <property name="dateFormat">yyyy-MM-dd</property>
    <property name="sBeginDate">2022-01-01</property>
    <property name="sEndDate">2022-03-31</property>
</function>
	<!--
		ä»å¼€å§‹æ—¶é—´å¼€å§‹ï¼Œä¸€ä¸ªæœˆä¸ºä¸€ä¸ªåˆ†ç‰‡ï¼Œåˆ°è¾¾ç»“æŸæ—¶é—´ä¹‹åï¼Œä¼šé‡å¤å¼€å§‹åˆ†ç‰‡æ’å…¥
		é…ç½®è¡¨çš„ dataNode çš„åˆ†ç‰‡ï¼Œå¿…é¡»å’Œåˆ†ç‰‡è§„åˆ™æ•°é‡ä¸€è‡´ï¼Œä¾‹å¦‚ 2022-01-01 åˆ° 2022-12-31 ï¼Œä¸€
		å…±éœ€è¦12ä¸ªåˆ†ç‰‡ã€‚

		è¿™é‡Œå°±æ˜¯è¯´åˆ†ç‰‡çš„æ®µæ•°ä¸€å®šä¸èƒ½å°‘äºæ—¶é—´çš„é—´éš”ï¼Œä½†æ˜¯æ—¶é—´çš„é—´éš”å¯ä»¥å¤§äºåˆ†ç‰‡çš„é•¿åº¦
	-->
```

åˆ†ç‰‡è§„åˆ™å±æ€§å«ä¹‰ï¼š

![image-20250420163310864](./Mysql-Learning-Local.assets/image-20250420163310864.png)



##### 3). æµ‹è¯•

é…ç½®å®Œæ¯•åï¼Œé‡æ–°å¯åŠ¨MyCatï¼Œç„¶ååœ¨mycatçš„å‘½ä»¤è¡Œä¸­ï¼Œæ‰§è¡Œå¦‚ä¸‹SQLåˆ›å»ºè¡¨ã€å¹¶æ’å…¥æ•°æ®ï¼ŒæŸ¥çœ‹æ•°æ®åˆ†å¸ƒæƒ…å†µã€‚

```sql
create table tb_monthpart(
    id bigint not null comment 'ID' primary key,
    name varchar(100) null comment 'å§“å',
    create_time date null
)engine=InnoDB DEFAULT CHARSET=utf8mb4;

insert into tb_monthpart(id,name ,create_time) values(1,'Tom','2022-01-01');
insert into tb_monthpart(id,name ,create_time) values(2,'Cat','2022-01-10');
insert into tb_monthpart(id,name ,create_time) values(3,'Rose','2022-01-31');
insert into tb_monthpart(id,name ,create_time) values(4,'Coco','2022-02-20');
insert into tb_monthpart(id,name ,create_time) values(5,'Rose2','2022-02-25');
insert into tb_monthpart(id,name ,create_time) values(6,'Coco2','2022-03-10');
insert into tb_monthpart(id,name ,create_time) values(7,'Coco3','2022-03-31');
insert into tb_monthpart(id,name ,create_time) values(8,'Coco4','2022-04-10');
insert into tb_monthpart(id,name ,create_time) values(9,'Coco5','2022-04-30');
```



### ï¼ˆ4ï¼‰æœ€ç»ˆé…ç½®æ–‡ä»¶æ¡ˆä¾‹

#### â‘ schema.xml

```xml
<?xml version="1.0"?>
<!DOCTYPE mycat:schema SYSTEM "schema.dtd">
<mycat:schema xmlns:mycat="http://io.mycat/">
    <schema name="SHOPPING" checkSQLschema="true" sqlMaxLimit="100">
        <table name="tb_goods_base" dataNode="dn1" primaryKey="id" />
        <table name="tb_goods_brand" dataNode="dn1" primaryKey="id" />
        <table name="tb_goods_cat" dataNode="dn1" primaryKey="id" />
        <table name="tb_goods_desc" dataNode="dn1" primaryKey="goods_id" />
        <table name="tb_goods_item" dataNode="dn1" primaryKey="id" />
        
        <table name="tb_order_item" dataNode="dn2" primaryKey="id" />
        <table name="tb_order_master" dataNode="dn2" primaryKey="order_id" />
        <table name="tb_order_pay_log" dataNode="dn2" primaryKey="out_trade_no" />
        
        <table name="tb_user" dataNode="dn3" primaryKey="id" />
        <table name="tb_user_address" dataNode="dn3" primaryKey="id" />
     
        <table name="tb_areas_provinces" dataNode="dn1,dn2,dn3" primaryKey="id" type="global"/>
        <table name="tb_areas_city" dataNode="dn1,dn2,dn3" primaryKey="id" type="global"/>
        <table name="tb_areas_region" dataNode="dn1,dn2,dn3" primaryKey="id" type="global"/>
    </schema>

    <schema name="ITCAST" checkSQLschema="true" sqlMaxLimit="100">
        <!-- å–æ¨¡åˆ†ç‰‡ -->
        <table name="tb_log" dataNode="dn4,dn5,dn6" primaryKey="id" rule="mod-long" />
        <!-- ä¸€è‡´æ€§hash -->
        <table name="tb_order" dataNode="dn4,dn5,dn6" rule="sharding-by-murmur" />

        <!-- æšä¸¾ -->
        <table name="tb_user" dataNode="dn4,dn5,dn6" rule="sharding-by-intfile-enumstatus"/>
        <!-- è‡ªå·±å¢åŠ  tableRule: "sharding-by-intfile-enumstatus" -->

        <!-- åº”ç”¨æŒ‡å®šç®—æ³• -->
        <table name="tb_app" dataNode="dn4,dn5,dn6" rule="sharding-by-substring" />

        <!-- å›ºå®šåˆ†ç‰‡hashç®—æ³• -->
        <table name="tb_longhash" dataNode="dn4,dn5,dn6" rule="sharding-by-long-hash" />

        <!-- å­—ç¬¦ä¸²hashè§£æç®—æ³• -->
        <table name="tb_strhash" dataNode="dn4,dn5" rule="sharding-by-stringhash" />

        <!-- æŒ‰å¤©åˆ†ç‰‡ -->
        <table name="tb_datepart" dataNode="dn4,dn5,dn6" rule="sharding-by-date" />


        <!-- æŒ‰è‡ªç„¶æœˆåˆ†ç‰‡ -->
        <table name="tb_monthpart" dataNode="dn4,dn5,dn6" rule="sharding-by-month" />
        
    </schema>

    <dataNode name="dn1" dataHost="dhost1" database="shopping" />
    <dataNode name="dn2" dataHost="dhost2" database="shopping" />
    <dataNode name="dn3" dataHost="dhost3" database="shopping" />

    <dataNode name="dn4" dataHost="dhost1" database="itcast" />
    <dataNode name="dn5" dataHost="dhost2" database="itcast" />
    <dataNode name="dn6" dataHost="dhost3" database="itcast" />
    
    <dataHost name="dhost1" maxCon="1000" minCon="10" balance="0"
              writeType="0" dbType="mysql" dbDriver="jdbc" switchType="1"
              slaveThreshold="100">
        <heartbeat>select user()</heartbeat>
        <writeHost host="master" url="jdbc:mysql://192.168.88.130:3306?useSSL=false&amp;serverTimezone=Asia/Shanghai&amp;characterEncoding=utf8"
                   user="root" password="root" />
    </dataHost>
    
    <dataHost name="dhost2" maxCon="1000" minCon="10" balance="0"
              writeType="0" dbType="mysql" dbDriver="jdbc" switchType="1"
              slaveThreshold="100">
        <heartbeat>select user()</heartbeat>
        <writeHost host="master" url="jdbc:mysql://192.168.88.131:3306?useSSL=false&amp;serverTimezone=Asia/Shanghai&amp;characterEncoding=utf8"
                   user="root" password="root" />
    </dataHost>
    
    <dataHost name="dhost3" maxCon="1000" minCon="10" balance="0"
              writeType="0" dbType="mysql" dbDriver="jdbc" switchType="1"
              slaveThreshold="100">
        <heartbeat>select user()</heartbeat>
        <writeHost host="master" url="jdbc:mysql://192.168.88.129:3306?useSSL=false&amp;serverTimezone=Asia/Shanghai&amp;characterEncoding=utf8"
                   user="root" password="1234" />
    </dataHost>
</mycat:schema>
```



#### â‘¡rule.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!-- - - Licensed under the Apache License, Version 2.0 (the "License"); 
	- you may not use this file except in compliance with the License. - You 
	may obtain a copy of the License at - - http://www.apache.org/licenses/LICENSE-2.0 
	- - Unless required by applicable law or agreed to in writing, software - 
	distributed under the License is distributed on an "AS IS" BASIS, - WITHOUT 
	WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. - See the 
	License for the specific language governing permissions and - limitations 
	under the License. -->
<!DOCTYPE mycat:rule SYSTEM "rule.dtd">
<mycat:rule xmlns:mycat="http://io.mycat/">
	<tableRule name="rule1">
		<rule>
			<columns>id</columns>
			<algorithm>func1</algorithm>
		</rule>
	</tableRule>

	<tableRule name="rule2">
		<rule>
			<columns>user_id</columns>
			<algorithm>func1</algorithm>
		</rule>
	</tableRule>

	<tableRule name="sharding-by-intfile">
		<rule>
			<columns>sharding_id</columns>
			<algorithm>hash-int</algorithm>
		</rule>
	</tableRule>

	<!-- è‡ªå·±å¢åŠ  tableRule -->
	<tableRule name="sharding-by-intfile-enumstatus">
		<rule>
			<columns>status</columns>
			<algorithm>hash-int</algorithm>
		</rule>
	</tableRule>

	<tableRule name="auto-sharding-long">
		<rule>
			<columns>id</columns>
			<algorithm>rang-long</algorithm>
		</rule>
	</tableRule>
	<tableRule name="mod-long">
		<rule>
			<columns>id</columns>
			<algorithm>mod-long</algorithm>
		</rule>
	</tableRule>
	<tableRule name="sharding-by-murmur">
		<rule>
			<columns>id</columns>
			<algorithm>murmur</algorithm>
		</rule>
	</tableRule>
	<tableRule name="crc32slot">
		<rule>
			<columns>id</columns>
			<algorithm>crc32slot</algorithm>
		</rule>
	</tableRule>

	<tableRule name="sharding-by-month">
		<rule>
			<columns>create_time</columns>
			<algorithm>partbymonth</algorithm>
		</rule>
	</tableRule>

	<tableRule name="latest-month-calldate">
		<rule>
			<columns>calldate</columns>
			<algorithm>latestMonth</algorithm>
		</rule>
	</tableRule>
	
	<tableRule name="auto-sharding-rang-mod">
		<rule>
			<columns>id</columns>
			<algorithm>rang-mod</algorithm>
		</rule>
	</tableRule>
	
	<tableRule name="jch">
		<rule>
			<columns>id</columns>
			<algorithm>jump-consistent-hash</algorithm>
		</rule>
	</tableRule>


	<tableRule name="sharding-by-substring">
		<rule>
			<columns>id</columns>
			<algorithm>sharding-by-substring</algorithm>
		</rule>
	</tableRule>

	<tableRule name="sharding-by-long-hash">
		<rule>
			<columns>id</columns>
			<algorithm>sharding-by-long-hash</algorithm>
		</rule>
	</tableRule>

	<tableRule name="sharding-by-stringhash">
		<rule>
			<columns>name</columns>
			<algorithm>sharding-by-stringhash</algorithm>
		</rule>
	</tableRule>

	<tableRule name="sharding-by-date">
		<rule>
			<columns>create_time</columns>
			<algorithm>sharding-by-date</algorithm>
		</rule>
	</tableRule>

	<function name="murmur"
		class="io.mycat.route.function.PartitionByMurmurHash">
		<property name="seed">0</property><!-- é»˜è®¤æ˜¯0 -->
		<property name="count">2</property><!-- è¦åˆ†ç‰‡çš„æ•°æ®åº“èŠ‚ç‚¹æ•°é‡ï¼Œå¿…é¡»æŒ‡å®šï¼Œå¦åˆ™æ²¡æ³•åˆ†ç‰‡ -->
		<property name="virtualBucketTimes">160</property><!-- ä¸€ä¸ªå®é™…çš„æ•°æ®åº“èŠ‚ç‚¹è¢«æ˜ å°„ä¸ºè¿™ä¹ˆå¤šè™šæ‹ŸèŠ‚ç‚¹ï¼Œé»˜è®¤æ˜¯160å€ï¼Œä¹Ÿå°±æ˜¯è™šæ‹ŸèŠ‚ç‚¹æ•°æ˜¯ç‰©ç†èŠ‚ç‚¹æ•°çš„160å€ -->
		<!-- <property name="weightMapFile">weightMapFile</property> èŠ‚ç‚¹çš„æƒé‡ï¼Œæ²¡æœ‰æŒ‡å®šæƒé‡çš„èŠ‚ç‚¹é»˜è®¤æ˜¯1ã€‚ä»¥propertiesæ–‡ä»¶çš„æ ¼å¼å¡«å†™ï¼Œä»¥ä»0å¼€å§‹åˆ°count-1çš„æ•´æ•°å€¼ä¹Ÿå°±æ˜¯èŠ‚ç‚¹ç´¢å¼•ä¸ºkeyï¼Œä»¥èŠ‚ç‚¹æƒé‡å€¼ä¸ºå€¼ã€‚æ‰€æœ‰æƒé‡å€¼å¿…é¡»æ˜¯æ­£æ•´æ•°ï¼Œå¦åˆ™ä»¥1ä»£æ›¿ -->
		<!-- <property name="bucketMapPath">/etc/mycat/bucketMapPath</property> 
			ç”¨äºæµ‹è¯•æ—¶è§‚å¯Ÿå„ç‰©ç†èŠ‚ç‚¹ä¸è™šæ‹ŸèŠ‚ç‚¹çš„åˆ†å¸ƒæƒ…å†µï¼Œå¦‚æœæŒ‡å®šäº†è¿™ä¸ªå±æ€§ï¼Œä¼šæŠŠè™šæ‹ŸèŠ‚ç‚¹çš„murmur hashå€¼ä¸ç‰©ç†èŠ‚ç‚¹çš„æ˜ å°„æŒ‰è¡Œè¾“å‡ºåˆ°è¿™ä¸ªæ–‡ä»¶ï¼Œæ²¡æœ‰é»˜è®¤å€¼ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œå°±ä¸ä¼šè¾“å‡ºä»»ä½•ä¸œè¥¿ -->
	</function>

	<function name="crc32slot"
			  class="io.mycat.route.function.PartitionByCRC32PreSlot">
	</function>

	<function name="hash-int" class="io.mycat.route.function.PartitionByFileMap">
		<!-- defaultNodeè¡¨ç¤ºï¼Œè‹¥æ²¡æœ‰æ‰¾åˆ°å¯¹åº”åŒ¹é…çš„æšä¸¾ï¼Œåˆ™ä½¿ç”¨é»˜è®¤é…ç½®çš„æ•°æ®èŠ‚ç‚¹ -->
		<property name="defaultNode">2</property>
		<property name="mapFile">partition-hash-int.txt</property>
	</function>

	<function name="rang-long"
		class="io.mycat.route.function.AutoPartitionByLong">
		<property name="mapFile">autopartition-long.txt</property>
	</function>
	<function name="mod-long" class="io.mycat.route.function.PartitionByMod">
		<!-- how many data nodes -->
		<property name="count">3</property>
	</function>

	<function name="func1" class="io.mycat.route.function.PartitionByLong">
		<property name="partitionCount">8</property>
		<property name="partitionLength">128</property>
	</function>
	<function name="latestMonth"
		class="io.mycat.route.function.LatestMonthPartion">
		<property name="splitOneDay">24</property>
	</function>

	
	<function name="rang-mod" class="io.mycat.route.function.PartitionByRangeMod">
        	<property name="mapFile">partition-range-mod.txt</property>
	</function>
	
	<function name="jump-consistent-hash" class="io.mycat.route.function.PartitionByJumpConsistentHash">
		<property name="totalBuckets">3</property>
	</function>


	<function name="sharding-by-substring" class="io.mycat.route.function.PartitionDirectBySubString">
		<property name="startIndex">0</property> <!-- zero-based -->
		<property name="size">2</property>
		<property name="partitionCount">3</property>
		<property name="defaultPartition">0</property>
	</function>
	
	<!-- åˆ†ç‰‡æ€»é•¿åº¦ä¸º1024ï¼Œcountä¸lengthæ•°ç»„é•¿åº¦å¿…é¡»ä¸€è‡´ï¼› -->
	<function name="sharding-by-long-hash" class="io.mycat.route.function.PartitionByLong">
		<property name="partitionCount">2,1</property>
		<property name="partitionLength">256,512</property>
	</function>

	<function name="sharding-by-stringhash" class="io.mycat.route.function.PartitionByString">
    	<property name="partitionLength">512</property> <!-- zero-based -->
   	 	<property name="partitionCount">2</property>
    	<property name="hashSlice">0:2</property>
	</function>


	<function name="sharding-by-date" class="io.mycat.route.function.PartitionByDate">
		<property name="dateFormat">yyyy-MM-dd</property>
		<property name="sBeginDate">2022-01-01</property>
		<property name="sEndDate">2022-01-30</property>
		<property name="sPartionDay">10</property>
	</function>
		<!--
			ä»å¼€å§‹æ—¶é—´å¼€å§‹ï¼Œæ¯10å¤©ä¸ºä¸€ä¸ªåˆ†ç‰‡ï¼Œåˆ°è¾¾ç»“æŸæ—¶é—´ä¹‹åï¼Œä¼šé‡å¤å¼€å§‹åˆ†ç‰‡æ’å…¥ã€‚
			é…ç½®è¡¨çš„ dataNode çš„åˆ†ç‰‡ï¼Œå¿…é¡»å’Œåˆ†ç‰‡è§„åˆ™æ•°é‡ä¸€è‡´ï¼Œ
			ä¾‹å¦‚ 2022-01-01 åˆ° 2022-12-31 ï¼Œæ¯10å¤©ä¸€ä¸ªåˆ†ç‰‡ï¼Œä¸€å…±éœ€è¦37ä¸ªåˆ†ç‰‡ã€‚
		-->


	<function name="partbymonth" class="io.mycat.route.function.PartitionByMonth">
		<property name="dateFormat">yyyy-MM-dd</property>
		<property name="sBeginDate">2022-01-01</property>
		<property name="sEndDate">2022-03-31</property>
	</function>
		<!--
			ä»å¼€å§‹æ—¶é—´å¼€å§‹ï¼Œä¸€ä¸ªæœˆä¸ºä¸€ä¸ªåˆ†ç‰‡ï¼Œåˆ°è¾¾ç»“æŸæ—¶é—´ä¹‹åï¼Œä¼šé‡å¤å¼€å§‹åˆ†ç‰‡æ’å…¥
			é…ç½®è¡¨çš„ dataNode çš„åˆ†ç‰‡ï¼Œå¿…é¡»å’Œåˆ†ç‰‡è§„åˆ™æ•°é‡ä¸€è‡´ï¼Œä¾‹å¦‚ 2022-01-01 åˆ° 2022-12-31 ï¼Œä¸€
			å…±éœ€è¦12ä¸ªåˆ†ç‰‡ã€‚
	
			è¿™é‡Œå°±æ˜¯è¯´åˆ†ç‰‡çš„æ®µæ•°ä¸€å®šä¸èƒ½å°‘äºæ—¶é—´çš„é—´éš”ï¼Œä½†æ˜¯æ—¶é—´çš„é—´éš”å¯ä»¥å¤§äºåˆ†ç‰‡çš„é•¿åº¦
		-->

</mycat:rule>
```



#### â‘¢server.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!-- - - Licensed under the Apache License, Version 2.0 (the "License"); 
	- you may not use this file except in compliance with the License. - You 
	may obtain a copy of the License at - - http://www.apache.org/licenses/LICENSE-2.0 
	- - Unless required by applicable law or agreed to in writing, software - 
	distributed under the License is distributed on an "AS IS" BASIS, - WITHOUT 
	WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. - See the 
	License for the specific language governing permissions and - limitations 
	under the License. -->
<!DOCTYPE mycat:server SYSTEM "server.dtd">
<mycat:server xmlns:mycat="http://io.mycat/">
	<system>
	<property name="nonePasswordLogin">0</property> <!-- 0ä¸ºéœ€è¦å¯†ç ç™»é™†ã€1ä¸ºä¸éœ€è¦å¯†ç ç™»é™† ,é»˜è®¤ä¸º0ï¼Œè®¾ç½®ä¸º1åˆ™éœ€è¦æŒ‡å®šé»˜è®¤è´¦æˆ·-->
	<property name="useHandshakeV10">1</property>
	<property name="useSqlStat">1</property>  <!-- 1ä¸ºå¼€å¯å®æ—¶ç»Ÿè®¡ã€0ä¸ºå…³é—­ -->
	<property name="useGlobleTableCheck">0</property>  <!-- 1ä¸ºå¼€å¯å…¨åŠ ç­ä¸€è‡´æ€§æ£€æµ‹ã€0ä¸ºå…³é—­ -->
		<property name="sqlExecuteTimeout">300</property>  <!-- SQL æ‰§è¡Œè¶…æ—¶ å•ä½:ç§’-->
		<property name="sequnceHandlerType">2</property>
		<!--<property name="sequnceHandlerPattern">(?:(\s*next\s+value\s+for\s*MYCATSEQ_(\w+))(,|\)|\s)*)+</property>-->
		<!--å¿…é¡»å¸¦æœ‰MYCATSEQ_æˆ–è€… mycatseq_è¿›å…¥åºåˆ—åŒ¹é…æµç¨‹ æ³¨æ„MYCATSEQ_æœ‰ç©ºæ ¼çš„æƒ…å†µ-->
		<property name="sequnceHandlerPattern">(?:(\s*next\s+value\s+for\s*MYCATSEQ_(\w+))(,|\)|\s)*)+</property>
	<property name="subqueryRelationshipCheck">false</property> <!-- å­æŸ¥è¯¢ä¸­å­˜åœ¨å…³è”æŸ¥è¯¢çš„æƒ…å†µä¸‹,æ£€æŸ¥å…³è”å­—æ®µä¸­æ˜¯å¦æœ‰åˆ†ç‰‡å­—æ®µ .é»˜è®¤ false -->
      <!--  <property name="useCompression">1</property>--> <!--1ä¸ºå¼€å¯mysqlå‹ç¼©åè®®-->
        <!--  <property name="fakeMySQLVersion">5.6.20</property>--> <!--è®¾ç½®æ¨¡æ‹Ÿçš„MySQLç‰ˆæœ¬å·-->
	<!-- <property name="processorBufferChunk">40960</property> -->
	<!-- 
	<property name="processors">1</property> 
	<property name="processorExecutor">32</property> 
	 -->
        <!--é»˜è®¤ä¸ºtype 0: DirectByteBufferPool | type 1 ByteBufferArena | type 2 NettyBufferPool -->
		<property name="processorBufferPoolType">0</property>
		<!--é»˜è®¤æ˜¯65535 64K ç”¨äºsqlè§£ææ—¶æœ€å¤§æ–‡æœ¬é•¿åº¦ -->
		<!--<property name="maxStringLiteralLength">65535</property>-->
		<!--<property name="sequnceHandlerType">0</property>-->
		<!--<property name="backSocketNoDelay">1</property>-->
		<!--<property name="frontSocketNoDelay">1</property>-->
		<!--<property name="processorExecutor">16</property>-->
		<!--
			<property name="serverPort">8066</property> <property name="managerPort">9066</property> 
			<property name="idleTimeout">300000</property> <property name="bindIp">0.0.0.0</property>
			<property name="dataNodeIdleCheckPeriod">300000</property> 5 * 60 * 1000L; //è¿æ¥ç©ºé—²æ£€æŸ¥
			<property name="frontWriteQueueSize">4096</property> <property name="processors">32</property> -->
		<!--åˆ†å¸ƒå¼äº‹åŠ¡å¼€å…³ï¼Œ0ä¸ºä¸è¿‡æ»¤åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œ1ä¸ºè¿‡æ»¤åˆ†å¸ƒå¼äº‹åŠ¡ï¼ˆå¦‚æœåˆ†å¸ƒå¼äº‹åŠ¡å†…åªæ¶‰åŠå…¨å±€è¡¨ï¼Œåˆ™ä¸è¿‡æ»¤ï¼‰ï¼Œ2ä¸ºä¸è¿‡æ»¤åˆ†å¸ƒå¼äº‹åŠ¡,ä½†æ˜¯è®°å½•åˆ†å¸ƒå¼äº‹åŠ¡æ—¥å¿—-->
		<property name="handleDistributedTransactions">0</property>
		
			<!--
			off heap for merge/order/group/limit      1å¼€å¯   0å…³é—­
		-->
		<property name="useOffHeapForMerge">0</property>

		<!--
			å•ä½ä¸ºm
		-->
        <property name="memoryPageSize">64k</property>

		<!--
			å•ä½ä¸ºk
		-->
		<property name="spillsFileBufferSize">1k</property>

		<property name="useStreamOutput">0</property>

		<!--
			å•ä½ä¸ºm
		-->
		<property name="systemReserveMemorySize">384m</property>


		<!--æ˜¯å¦é‡‡ç”¨zookeeperåè°ƒåˆ‡æ¢  -->
		<property name="useZKSwitch">false</property>

		<!-- XA Recovery Logæ—¥å¿—è·¯å¾„ -->
		<!--<property name="XARecoveryLogBaseDir">./</property>-->

		<!-- XA Recovery Logæ—¥å¿—åç§° -->
		<!--<property name="XARecoveryLogBaseName">tmlog</property>-->
		<!--å¦‚æœä¸º trueçš„è¯ ä¸¥æ ¼éµå®ˆéš”ç¦»çº§åˆ«,ä¸ä¼šåœ¨ä»…ä»…åªæœ‰selectè¯­å¥çš„æ—¶å€™åœ¨äº‹åŠ¡ä¸­åˆ‡æ¢è¿æ¥-->
		<property name="strictTxIsolation">false</property>
		
		<property name="useZKSwitch">true</property>
		

	</system>
	
	<!-- å…¨å±€SQLé˜²ç«å¢™è®¾ç½® -->
	<!--ç™½åå•å¯ä»¥ä½¿ç”¨é€šé…ç¬¦%æˆ–ç€*-->
	<!--ä¾‹å¦‚<host host="127.0.0.*" user="root"/>-->
	<!--ä¾‹å¦‚<host host="127.0.*" user="root"/>-->
	<!--ä¾‹å¦‚<host host="127.*" user="root"/>-->
	<!--ä¾‹å¦‚<host host="1*7.*" user="root"/>-->
	<!--è¿™äº›é…ç½®æƒ…å†µä¸‹å¯¹äº127.0.0.1éƒ½èƒ½ä»¥rootè´¦æˆ·ç™»å½•-->
	<!--
	<firewall>
	   <whitehost>
	      <host host="1*7.0.0.*" user="root"/>
	   </whitehost>
       <blacklist check="false">
       </blacklist>
	</firewall>
	-->

	<user name="root" defaultAccount="true">
		<property name="password">123456</property>
		<property name="schemas">SHOPPING,ITCAST</property>
		<!-- è¡¨çº§ DML æƒé™è®¾ç½® -->
		<!--
	<privileges check="true">
	<schema name="DB01" dml="0110" >
	<table name="TB_ORDER" dml="1110"></table>
	</schema>
	</privileges>
	-->
	</user>
	<user name="user">
		<property name="password">123456</property>
		<property name="schemas">SHOPPING</property>
		<property name="readOnly">true</property>
	</user>

</mycat:server>
```



## 3.6 MyCatç®¡ç†åŠç›‘æ§

### ï¼ˆ1ï¼‰MyCatåŸç†

![image-20250422155430952](./Mysql-Learning-Local.assets/image-20250422155430952.png)

åœ¨MyCatä¸­ï¼Œå½“æ‰§è¡Œä¸€æ¡SQLè¯­å¥æ—¶ï¼ŒMyCatéœ€è¦è¿›è¡Œ**SQLè§£æã€åˆ†ç‰‡åˆ†æã€è·¯ç”±åˆ†æã€è¯»å†™åˆ†ç¦»åˆ†æ**ç­‰æ“ä½œï¼Œæœ€ç»ˆç»è¿‡ä¸€ç³»åˆ—çš„åˆ†æå†³å®šå°†å½“å‰çš„SQLè¯­å¥åˆ°åº•è·¯ç”±åˆ°é‚£å‡ ä¸ª(æˆ–å“ªä¸€ä¸ª)èŠ‚ç‚¹æ•°æ®åº“ï¼Œæ•°æ®åº“å°†æ•°æ®æ‰§è¡Œå®Œæ¯•åï¼Œå¦‚æœæœ‰è¿”å›çš„ç»“æœï¼Œåˆ™å°†ç»“æœè¿”å›ç»™MyCatï¼Œæœ€ç»ˆè¿˜éœ€è¦åœ¨MyCatä¸­è¿›è¡Œ**ç»“æœåˆå¹¶ã€èšåˆå¤„ç†ã€æ’åºå¤„ç†ã€åˆ†é¡µå¤„ç†ç­‰æ“ä½œ**ï¼Œæœ€ç»ˆå†å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚

è€Œåœ¨MyCatçš„ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼ŒMyCatå®˜æ–¹ä¹Ÿæä¾›äº†ä¸€ä¸ª**ç®¡ç†ç›‘æ§å¹³å°MyCat-Webï¼ˆMyCat-eyeï¼‰**ã€‚Mycat-web æ˜¯ Mycat å¯è§†åŒ–è¿ç»´çš„ç®¡ç†å’Œç›‘æ§å¹³å°ï¼Œå¼¥è¡¥äº† Mycat åœ¨ç›‘æ§ä¸Šçš„ç©ºç™½ã€‚å¸® Mycatåˆ†æ‹…ç»Ÿè®¡ä»»åŠ¡å’Œé…ç½®ç®¡ç†ä»»åŠ¡ã€‚Mycat-web å¼•å…¥äº† **==ZooKeeper ä½œä¸ºé…ç½®ä¸­å¿ƒ==ï¼Œå¯ä»¥ç®¡ç†å¤šä¸ªèŠ‚ç‚¹**ã€‚

Mycat-web ä¸»è¦ç®¡ç†å’Œç›‘æ§ Mycat çš„æµé‡ã€è¿æ¥ã€æ´»åŠ¨çº¿ç¨‹å’Œå†…å­˜ç­‰ï¼Œå…·å¤‡ IP ç™½åå•ã€é‚®ä»¶å‘Šè­¦ç­‰æ¨¡å—ï¼Œè¿˜å¯ä»¥**ç»Ÿè®¡ SQL å¹¶åˆ†ææ…¢ SQL å’Œé«˜é¢‘ SQL** ç­‰ã€‚ä¸ºä¼˜åŒ– SQL æä¾›ä¾æ®ã€‚



### ï¼ˆ2ï¼‰MyCatç®¡ç†

Mycaté»˜è®¤å¼€é€š2ä¸ªç«¯å£ï¼Œå¯ä»¥åœ¨server.xmlä¸­è¿›è¡Œä¿®æ”¹ã€‚

- **8066 æ•°æ®è®¿é—®ç«¯å£**ï¼Œå³è¿›è¡Œ DML å’Œ DDL æ“ä½œã€‚
- **9066 æ•°æ®åº“ç®¡ç†ç«¯å£**ï¼Œå³ mycat æœåŠ¡ç®¡ç†æ§åˆ¶åŠŸèƒ½ï¼Œç”¨äºç®¡ç†mycatçš„æ•´ä¸ªé›†ç¾¤çŠ¶æ€

è¿æ¥MyCatçš„ç®¡ç†æ§åˆ¶å°ï¼š

```bash
mysql -h 192.168.200.210 -p 9066 -uroot -p123456 

mysql -h 192.168.88.130 -p 9066 -uroot -p123456 
```

![image-20250420163547918](./Mysql-Learning-Local.assets/image-20250420163547918.png)



### ï¼ˆ3ï¼‰==MyCat-eye==

#### â‘ ä»‹ç»

Mycat-web(Mycat-eye)æ˜¯å¯¹mycat-server**æä¾›ç›‘æ§æœåŠ¡**ï¼ŒåŠŸèƒ½ä¸å±€é™äºå¯¹mycat-serverä½¿ç”¨ã€‚ä»–é€šè¿‡JDBCè¿æ¥å¯¹Mycatã€Mysqlç›‘æ§ï¼Œç›‘æ§è¿œç¨‹æœåŠ¡å™¨(ç›®å‰ä»…é™äºlinuxç³»ç»Ÿ)çš„cpuã€å†…å­˜ã€ç½‘ç»œã€ç£ç›˜ã€‚

Mycat-eyeè¿è¡Œè¿‡ç¨‹ä¸­**éœ€è¦ä¾èµ–zookeeper**ï¼Œå› æ­¤éœ€è¦å…ˆå®‰è£…zookeeperã€‚



#### â‘¡å®‰è£…

##### 1). zookeeperå®‰è£…

**A. ä¸Šä¼ å®‰è£…åŒ…** 

```bash
zookeeper-3.4.6.tar.gz
```

â€‹	

 **B. è§£å‹**

```bash
tar -zxvf zookeeper-3.4.6.tar.gz -C /usr/local/
```



**C. åˆ›å»ºæ•°æ®å­˜æ”¾ç›®å½•**

```bash
cd /usr/local/zookeeper-3.4.6/
mkdir data

cd data
pwd #å¤åˆ¶dataçš„æ–‡ä»¶å¤¹è·¯å¾„
```

â€‹	

**D. ä¿®æ”¹é…ç½®æ–‡ä»¶åç§°å¹¶é…ç½®**

```bash
cd conf
mv zoo_sample.cfg zoo.cfg  # é‡å‘½å
```

â€‹	

**E. é…ç½®æ•°æ®å­˜æ”¾ç›®å½•**

```bash
vim zoo.cfg
dataDir=/usr/local/zookeeper-3.4.6/data
```


â€‹	**F. å¯åŠ¨Zookeeper**

```bash
bin/zkServer.sh start
bin/zkServer.sh status
```




##### 2). Mycat-webå®‰è£…

**A. ä¸Šä¼ å®‰è£…åŒ…** 

- â€‹	Mycat-web.tar.gz

â€‹	

**B. è§£å‹**

```bash
tar -zxvf Mycat-web.tar.gz -C /usr/local/
```

â€‹	

**C. ç›®å½•ä»‹ç»**

- â€‹    etc         ----> jettyé…ç½®æ–‡ä»¶
- â€‹    lib         ----> ä¾èµ–jaråŒ…
- â€‹    mycat-web   ----> mycat-webé¡¹ç›®
- â€‹    readme.txt
- â€‹    start.jar   ----> å¯åŠ¨jar
- â€‹    start.sh    ----> linuxå¯åŠ¨è„šæœ¬

â€‹	

**D. å¯åŠ¨**

```bash
cd /usr/local/mycat-web
sh start.sh
```

â€‹	**å¼€æ”¾ç«¯å£ï¼š**

- **==å¼€æ”¾æŒ‡å®š==ç«¯å£(firewall-cmd --zone=public --add-port=8080/tcp --permanent)**
- **å…³é—­æŒ‡å®šç«¯å£(firewall-cmd --zone=public --remove-port=8080/tcp --permanent)**

- **==ç«‹å³ç”Ÿæ•ˆ==(firewall-cmd --reload)ï¼Œ==å¼€æ”¾æˆ–è€…å…³é—­ç«¯å£å==éœ€è¦æ‰§è¡Œç«‹å³ç”Ÿæ•ˆå‘½ä»¤**
- **æŸ¥çœ‹å¼€æ”¾çš„ç«¯å£(firewall-cmd --zone=public --list-ports)**



**E. è®¿é—®**
	

```bash
# å¼€æ”¾8082ç«¯å£
firewall-cmd --zone=public --add-port=8082/tcp --permanent
firewall-cmd --reload
```

â€‹	

> å¤‡æ³¨: 
>
> â€‹	å¦‚æœZookeeperä¸Mycat-webä¸åœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Š , **éœ€è¦è®¾ç½®Zookeeperçš„åœ°å€** ; åœ¨/usr/local/mycat-web/mycat-web/WEB-INF/classes/mycat.propertiesæ–‡ä»¶ä¸­é…ç½® : 
>
> â€‹	![image-20220105003433870](./Mysql-Learning-Local.assets/image-20220105003433870.png)

å…·ä½“çš„å®‰è£…æ­¥éª¤ï¼Œè¯·å‚è€ƒèµ„æ–™ä¸­æä¾›çš„ã€ŠMyCat-Webå®‰è£…æ–‡æ¡£ã€‹



#### â‘¢è®¿é—®

**http://192.168.88.130:8082/mycat**



<img src="./Mysql-Learning-Local.assets/image-20250422162028801.png" alt="image-20250422162028801" style="zoom:80%;" />



#### â‘£é…ç½®

##### 1). å¼€å¯MyCatçš„å®æ—¶ç»Ÿè®¡åŠŸèƒ½(server.xml)

```xml
<property name="useSqlStat">1</property> <!-- 1ä¸ºå¼€å¯å®æ—¶ç»Ÿè®¡ã€0ä¸ºå…³é—­ -->
```



##### 2). åœ¨Mycatç›‘æ§ç•Œé¢é…ç½®æœåŠ¡åœ°å€

<img src="./Mysql-Learning-Local.assets/image-20250422162105865.png" alt="image-20250422162105865" style="zoom:67%;" />

<img src="./Mysql-Learning-Local.assets/image-20250422162011638.png" alt="image-20250422162011638" style="zoom: 67%;" />



#### â‘¤æµ‹è¯•

é…ç½®å¥½äº†ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡MyCatæ‰§è¡Œä¸€ç³»åˆ—çš„å¢åˆ æ”¹æŸ¥çš„æµ‹è¯•ï¼Œç„¶åè¿‡ä¸€æ®µæ—¶é—´ä¹‹åï¼Œæ‰“å¼€mycat-eyeçš„ç®¡ç†ç•Œé¢ï¼ŒæŸ¥çœ‹mycat-eyeç›‘æ§åˆ°çš„æ•°æ®ä¿¡æ¯ã€‚

##### A. æ€§èƒ½ç›‘æ§

<img src="./Mysql-Learning-Local.assets/image-20250422162510986.png" alt="image-20250422162510986" style="zoom:80%;" />

##### B. ç‰©ç†èŠ‚ç‚¹

![image-20250422162456969](./Mysql-Learning-Local.assets/image-20250422162456969.png)

##### C. SQLç»Ÿè®¡

<img src="./Mysql-Learning-Local.assets/image-20250422162534286.png" alt="image-20250422162534286" style="zoom:80%;" />

##### D. SQLè¡¨åˆ†æ

<img src="./Mysql-Learning-Local.assets/image-20250422162600515.png" alt="image-20250422162600515" style="zoom: 67%;" />

##### E. SQLç›‘æ§

![image-20250422162631551](./Mysql-Learning-Local.assets/image-20250422162631551.png)

##### F. é«˜é¢‘SQL

![image-20250422162653461](./Mysql-Learning-Local.assets/image-20250422162653461.png)

**G.SQLè§£æ**

<img src="./Mysql-Learning-Local.assets/image-20250422163230277.png" alt="image-20250422163230277" style="zoom:67%;" />

<img src="./Mysql-Learning-Local.assets/image-20250422163301828.png" alt="image-20250422163301828" style="zoom:67%;" />

------



## 3.7 å°ç»“

![image-20250422163706967](./Mysql-Learning-Local.assets/image-20250422163706967.png)



# 4ã€è¯»å†™åˆ†ç¦»

## 4.1 ä»‹ç»

è¯»å†™åˆ†ç¦»,ç®€å•åœ°è¯´æ˜¯æŠŠå¯¹æ•°æ®åº“çš„è¯»å’Œå†™æ“ä½œåˆ†å¼€,ä»¥å¯¹åº”ä¸åŒçš„æ•°æ®åº“æœåŠ¡å™¨ã€‚ä¸»æ•°æ®åº“æä¾›å†™æ“ä½œï¼Œä»æ•°æ®åº“æä¾›è¯»æ“ä½œï¼Œè¿™æ ·èƒ½æœ‰æ•ˆåœ°å‡è½»å•å°æ•°æ®åº“çš„å‹åŠ›ã€‚

é€šè¿‡MyCatå³å¯è½»æ˜“å®ç°ä¸Šè¿°åŠŸèƒ½ï¼Œä¸ä»…**å¯ä»¥æ”¯æŒMySQLï¼Œä¹Ÿå¯ä»¥æ”¯æŒOracleå’ŒSQL Server**ã€‚

![image-20250422163732693](./Mysql-Learning-Local.assets/image-20250422163732693.png)

## 4.2 ä¸€ä¸»ä¸€ä»

### ï¼ˆ1ï¼‰åŸç†

MySQLçš„**ä¸»ä»å¤åˆ¶ï¼Œæ˜¯åŸºäº==äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆbinlogï¼‰==å®ç°çš„**ã€‚

![image-20250422164539450](./Mysql-Learning-Local.assets/image-20250422164539450.png)

### ï¼ˆ2ï¼‰å‡†å¤‡

![image-20250420164119339](./Mysql-Learning-Local.assets/image-20250420164119339.png)

> å¤‡æ³¨ï¼š**ä¸»ä»å¤åˆ¶çš„æ­å»º**ï¼Œå¯ä»¥å‚è€ƒå‰é¢è¯¾ç¨‹ä¸­ **ä¸»ä»å¤åˆ¶** ç« èŠ‚è®²è§£çš„æ­¥éª¤æ“ä½œã€‚

**[ä¸»ä»å¤åˆ¶çš„æ­å»º](#ä¸»ä»å¤åˆ¶çš„æ­å»º)**



## 4.3 ä¸€ä¸»ä¸€ä»è¯»å†™åˆ†ç¦»

MyCatæ§åˆ¶åå°æ•°æ®åº“çš„è¯»å†™åˆ†ç¦»å’Œè´Ÿè½½å‡è¡¡ç”±schema.xmlæ–‡ä»¶datahostæ ‡ç­¾çš„balanceå±æ€§æ§åˆ¶ã€‚

### ï¼ˆ1ï¼‰schema.xmlé…ç½®

![image-20250422165744291](./Mysql-Learning-Local.assets/image-20250422165744291.png)

![image-20250422165723964](./Mysql-Learning-Local.assets/image-20250422165723964.png)

```xml
<!-- é…ç½®é€»è¾‘åº“ -->
<schema name="ITCAST_RW" checkSQLschema="true" sqlMaxLimit="100" dataNode="dn7">
	<!-- ä¼šè‡ªåŠ¨åŠ è½½å¯¹åº”æ•°æ®èŠ‚ç‚¹çš„æ•°æ®åº“ï¼Œç„¶åå†è‡ªåŠ¨ç”Ÿæˆé€»è¾‘è¡¨ -->
</schema>

<dataNode name="dn7" dataHost="dhost7" database="itcast" />

<dataHost name="dhost7" maxCon="1000" minCon="10" balance="1" writeType="0" dbType="mysql" dbDriver="jdbc" switchType="1" slaveThreshold="100">
    <heartbeat>select user()</heartbeat>
    <writeHost host="master1" url="jdbc:mysql://192.168.200.211:3306?useSSL=false&amp;serverTimezone=Asia/Shanghai&amp;characterEncoding=utf8" user="root" password="1234" >
        <readHost host="slave1" url="jdbc:mysql://192.168.200.212:3306? useSSL=false&amp;serverTimezone=Asia/Shanghai&amp;characterEncoding=utf8" user="root" password="1234" />
    </writeHost>
</dataHost>
```

ä¸Šè¿°é…ç½®çš„å…·ä½“å…³è”å¯¹åº”æƒ…å†µå¦‚ä¸‹ï¼š



**writeHostä»£è¡¨çš„æ˜¯å†™æ“ä½œå¯¹åº”çš„æ•°æ®åº“ï¼ŒreadHostä»£è¡¨çš„æ˜¯è¯»æ“ä½œå¯¹åº”çš„æ•°æ®åº“ã€‚**

 æ‰€ä»¥æˆ‘ä»¬è¦æƒ³å®ç°è¯»å†™åˆ†ç¦»ï¼Œå°±å¾—é…ç½®writeHostå…³è”çš„æ˜¯ä¸»åº“ï¼ŒreadHostå…³è”çš„æ˜¯ä»åº“ã€‚è€Œä»…ä»…é…ç½®å¥½äº†writeHostä»¥åŠreadHostè¿˜ä¸èƒ½å®Œæˆè¯»å†™åˆ†ç¦»ï¼Œè¿˜éœ€è¦é…ç½®ä¸€ä¸ªéå¸¸é‡è¦çš„**==è´Ÿè´£å‡è¡¡çš„å‚æ•° balance==**ï¼Œå–å€¼æœ‰4ç§ï¼Œå…·ä½“å«ä¹‰å¦‚ä¸‹ï¼š

![image-20250420164249035](./Mysql-Learning-Local.assets/image-20250420164249035.png)

æ‰€ä»¥ï¼Œåœ¨ä¸€ä¸»ä¸€ä»æ¨¡å¼çš„è¯»å†™åˆ†ç¦»ä¸­ï¼Œ**balanceé…ç½®1æˆ–3éƒ½æ˜¯å¯ä»¥å®Œæˆè¯»å†™åˆ†ç¦»çš„**ã€‚



### ï¼ˆ2ï¼‰server.xmlé…ç½®

**é…ç½®rootç”¨æˆ·å¯ä»¥è®¿é—®**SHOPPINGã€ITCAST ä»¥åŠ **ITCAST_RWé€»è¾‘åº“**ã€‚

```xml
<user name="root" defaultAccount="true">
    <property name="password">123456</property>
    <property name="schemas">SHOPPING,ITCAST,ITCAST_RW</property>
    <!-- è¡¨çº§ DML æƒé™è®¾ç½® -->
    <!--
    <privileges check="true">
    <schema name="DB01" dml="0110" >
    <table name="TB_ORDER" dml="1110"></table>
    </schema>
    </privileges>
	-->
</user>
```



### ï¼ˆ3ï¼‰æµ‹è¯•

é…ç½®å®Œæ¯•MyCatåï¼Œé‡æ–°å¯åŠ¨MyCatã€‚

```bash
bin/mycat stop

bin/mycat start
```

ç„¶åè§‚å¯Ÿï¼Œåœ¨æ‰§è¡Œå¢åˆ æ”¹æ“ä½œæ—¶ï¼Œå¯¹åº”çš„ä¸»åº“åŠä»åº“çš„æ•°æ®å˜åŒ–ã€‚ åœ¨æ‰§è¡ŒæŸ¥è¯¢æ“ä½œæ—¶ï¼Œæ£€æŸ¥ä¸»åº“åŠä»åº“å¯¹åº”çš„æ•°æ®å˜åŒ–ã€‚

åœ¨æµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°**å½“ä¸»èŠ‚ç‚¹Masterå®•æœºä¹‹åï¼Œä¸šåŠ¡ç³»ç»Ÿå°±åªèƒ½å¤Ÿè¯»ï¼Œè€Œä¸èƒ½å†™å…¥æ•°æ®äº†**ã€‚

![image-20250422165947510](./Mysql-Learning-Local.assets/image-20250422165947510.png)

é‚£å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¾—é€šè¿‡å¦å¤–ä¸€ç§ä¸»ä»å¤åˆ¶ç»“æ„æ¥è§£å†³äº†ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ¥ä¸‹æ¥è®²è§£çš„**åŒä¸»åŒä»**ã€‚



## 4.4 ==åŒä¸»åŒä»==

### ï¼ˆ1ï¼‰ä»‹ç»

ä¸€ä¸ªä¸»æœº Master1 ç”¨äºå¤„ç†æ‰€æœ‰å†™è¯·æ±‚ï¼Œå®ƒçš„ä»æœº Slave1 å’Œå¦ä¸€å°ä¸»æœº Master2 è¿˜æœ‰å®ƒçš„ä»æœº Slave2 è´Ÿè´£æ‰€æœ‰è¯»è¯·æ±‚ã€‚**å½“ Master1 ä¸»æœºå®•æœºåï¼ŒMaster2 ä¸»æœºè´Ÿè´£å†™è¯·æ±‚**ï¼ŒMaster1 ã€Master2 **äº’ä¸ºå¤‡æœº**ã€‚æ¶æ„å›¾å¦‚ä¸‹:

![image-20250422165958548](./Mysql-Learning-Local.assets/image-20250422165958548.png)

### ï¼ˆ2ï¼‰å‡†å¤‡

æˆ‘ä»¬éœ€è¦å‡†å¤‡5å°æœåŠ¡å™¨ï¼Œå…·ä½“çš„æœåŠ¡å™¨åŠè½¯ä»¶å®‰è£…æƒ…å†µå¦‚ä¸‹ï¼š

![image-20250420164606902](./Mysql-Learning-Local.assets/image-20250420164606902.png)



> **å…³é—­ä»¥ä¸Šæ‰€æœ‰æœåŠ¡å™¨çš„é˜²ç«å¢™**æˆ–è€…**å¼€æ”¾3306çš„ç«¯å£**ï¼š
>
> - systemctl stop firewalld
>
> - systemctl disable firewalld



### ï¼ˆ3ï¼‰æ­å»º

#### â‘ ä¸»åº“é…ç½®

##### 1). Master1(192.168.200.211)

<img src="./Mysql-Learning-Local.assets/image-20250422170317277.png" alt="image-20250422170317277" style="zoom:67%;" />

A. ä¿®æ”¹é…ç½®æ–‡ä»¶ /etc/my.cnf

```bash
#mysql æœåŠ¡IDï¼Œä¿è¯æ•´ä¸ªé›†ç¾¤ç¯å¢ƒä¸­å”¯ä¸€ï¼Œå–å€¼èŒƒå›´ï¼š1 â€“ 2^32-1ï¼Œé»˜è®¤ä¸º1
server-id=1
#åªåŒæ­¥æŒ‡å®šçš„æ•°æ®åº“
binlog-do-db=db01
binlog-do-db=db02
binlog-do-db=db03
# åœ¨ä½œä¸ºä»æ•°æ®åº“çš„æ—¶å€™ï¼Œæœ‰å†™å…¥æ“ä½œä¹Ÿè¦æ›´æ–°äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶
log-slave-updates
```

B. é‡å¯MySQLæœåŠ¡å™¨

```bash
systemctl restart mysqld
```

C. åˆ›å»ºè´¦æˆ·å¹¶æˆæƒ

```sql
#åˆ›å»ºitcastç”¨æˆ·ï¼Œå¹¶è®¾ç½®å¯†ç ï¼Œè¯¥ç”¨æˆ·å¯åœ¨ä»»æ„ä¸»æœºè¿æ¥è¯¥MySQLæœåŠ¡
CREATE USER 'itcast'@'%' IDENTIFIED WITH mysql_native_password BY 'Root@123456';

#ä¸º 'itcast'@'%' ç”¨æˆ·åˆ†é…ä¸»ä»å¤åˆ¶æƒé™
GRANT REPLICATION SLAVE ON *.* TO 'itcast'@'%';
```

é€šè¿‡æŒ‡ä»¤ï¼ŒæŸ¥çœ‹ä¸¤å°ä¸»åº“çš„äºŒè¿›åˆ¶æ—¥å¿—åæ ‡

```sql
show master status ;
```





##### **2). Master2(192.168.200.213)**

<img src="./Mysql-Learning-Local.assets/image-20250422170741971.png" alt="image-20250422170741971" style="zoom:67%;" />

A. ä¿®æ”¹é…ç½®æ–‡ä»¶ /etc/my.cnf

```bash
#mysql æœåŠ¡IDï¼Œä¿è¯æ•´ä¸ªé›†ç¾¤ç¯å¢ƒä¸­å”¯ä¸€ï¼Œå–å€¼èŒƒå›´ï¼š1 â€“ 2^32-1ï¼Œé»˜è®¤ä¸º1
server-id=3
#æŒ‡å®šåŒæ­¥çš„æ•°æ®åº“
binlog-do-db=db01
binlog-do-db=db02
binlog-do-db=db03
# åœ¨ä½œä¸ºä»æ•°æ®åº“çš„æ—¶å€™ï¼Œæœ‰å†™å…¥æ“ä½œä¹Ÿè¦æ›´æ–°äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶
log-slave-updates
```

B. é‡å¯MySQLæœåŠ¡å™¨

```bash
systemctl restart mysqld
```

C. åˆ›å»ºè´¦æˆ·å¹¶æˆæƒ

```sql
#åˆ›å»ºitcastç”¨æˆ·ï¼Œå¹¶è®¾ç½®å¯†ç ï¼Œè¯¥ç”¨æˆ·å¯åœ¨ä»»æ„ä¸»æœºè¿æ¥è¯¥MySQLæœåŠ¡
CREATE USER 'itcast'@'%' IDENTIFIED WITH mysql_native_password BY 'Root@123456';
#ä¸º 'itcast'@'%' ç”¨æˆ·åˆ†é…ä¸»ä»å¤åˆ¶æƒé™
GRANT REPLICATION SLAVE ON *.* TO 'itcast'@'%';
```

é€šè¿‡æŒ‡ä»¤ï¼ŒæŸ¥çœ‹ä¸¤å°ä¸»åº“çš„äºŒè¿›åˆ¶æ—¥å¿—åæ ‡

```sql
show master status ;
```



#### â‘¡ä»åº“é…ç½®

##### **1). Slave1(192.168.200.212)**

<img src="./Mysql-Learning-Local.assets/image-20250422170751107.png" alt="image-20250422170751107" style="zoom:67%;" />

A. ä¿®æ”¹é…ç½®æ–‡ä»¶ /etc/my.cnf

```bash
#mysql æœåŠ¡IDï¼Œä¿è¯æ•´ä¸ªé›†ç¾¤ç¯å¢ƒä¸­å”¯ä¸€ï¼Œå–å€¼èŒƒå›´ï¼š1 â€“ 232-1ï¼Œé»˜è®¤ä¸º1
server-id=2
```

B. é‡æ–°å¯åŠ¨MySQLæœåŠ¡å™¨

```bash
systemctl restart mysqld
```



##### **2). Slave2(192.168.200.214)**

<img src="./Mysql-Learning-Local.assets/image-20250422170758508.png" alt="image-20250422170758508" style="zoom:67%;" />

A. ä¿®æ”¹é…ç½®æ–‡ä»¶ /etc/my.cnf

```bash
#mysql æœåŠ¡IDï¼Œä¿è¯æ•´ä¸ªé›†ç¾¤ç¯å¢ƒä¸­å”¯ä¸€ï¼Œå–å€¼èŒƒå›´ï¼š1 â€“ 232-1ï¼Œé»˜è®¤ä¸º1
server-id=4
```

B. é‡æ–°å¯åŠ¨MySQLæœåŠ¡å™¨

```bash
systemctl restart mysqld
```



#### â‘¢ä»åº“å…³è”ä¸»åº“

##### 1). ä¸¤å°ä»åº“é…ç½®å…³è”çš„ä¸»åº“

> éœ€è¦æ³¨æ„**slave1å¯¹åº”çš„æ˜¯master1**ï¼Œ**slave2å¯¹åº”çš„æ˜¯master2**ã€‚

<img src="./Mysql-Learning-Local.assets/image-20250422170806712.png" alt="image-20250422170806712" style="zoom:67%;" />

A. åœ¨ slave1(192.168.200.212)ä¸Šæ‰§è¡Œ

```sql
CHANGE MASTER TO MASTER_HOST='192.168.200.211', MASTER_USER='itcast',
MASTER_PASSWORD='Root@123456', MASTER_LOG_FILE='binlog.000002',
MASTER_LOG_POS=663;
```

B. åœ¨ slave2(192.168.200.214)ä¸Šæ‰§è¡Œ

```sql
CHANGE MASTER TO MASTER_HOST='192.168.200.213', MASTER_USER='itcast',
MASTER_PASSWORD='Root@123456', MASTER_LOG_FILE='binlog.000002',
MASTER_LOG_POS=663;
```

C. å¯åŠ¨ä¸¤å°ä»åº“ä¸»ä»å¤åˆ¶ï¼ŒæŸ¥çœ‹ä»åº“çŠ¶æ€

```sql
start slave;
show slave status \G;
```

<img src="./Mysql-Learning-Local.assets/image-20250422170911279.png" alt="image-20250422170911279" style="zoom: 80%;" />



##### 2). ==ä¸¤å°ä¸»åº“ç›¸äº’å¤åˆ¶==

<img src="./Mysql-Learning-Local.assets/image-20250422171002922.png" alt="image-20250422171002922" style="zoom:67%;" />

```txt
Master2 å¤åˆ¶ Master1ï¼ŒMaster1 å¤åˆ¶ Master2ã€‚ 
```

A. åœ¨ Master1(192.168.200.211)ä¸Šæ‰§è¡Œ

```sql
CHANGE MASTER TO MASTER_HOST='192.168.200.213', MASTER_USER='itcast',
MASTER_PASSWORD='Root@123456', MASTER_LOG_FILE='binlog.000002',
MASTER_LOG_POS=663;
```

B. åœ¨ Master2(192.168.200.213)ä¸Šæ‰§è¡Œ

```sql
CHANGE MASTER TO MASTER_HOST='192.168.200.211', MASTER_USER='itcast',
MASTER_PASSWORD='Root@123456', MASTER_LOG_FILE='binlog.000002',
MASTER_LOG_POS=663;
```

C. å¯åŠ¨ä¸¤å°ä»åº“ä¸»ä»å¤åˆ¶ï¼ŒæŸ¥çœ‹ä»åº“çŠ¶æ€

```sql
start slave;
show slave status \G;
```



ç»è¿‡ä¸Šè¿°çš„ä¸‰æ­¥é…ç½®ä¹‹åï¼ŒåŒä¸»åŒä»çš„å¤åˆ¶ç»“æ„å°±å·²ç»æ­å»ºå®Œæˆäº†ã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥æ¥æµ‹è¯•éªŒè¯ä¸€ä¸‹ã€‚



### ï¼ˆ4ï¼‰æµ‹è¯•

åˆ†åˆ«åœ¨ä¸¤å°ä¸»åº“Master1ã€Master2ä¸Šæ‰§è¡ŒDDLã€DMLè¯­å¥ï¼ŒæŸ¥çœ‹æ¶‰åŠåˆ°çš„æ•°æ®åº“æœåŠ¡å™¨çš„æ•°æ®åŒæ­¥æƒ…å†µã€‚

```sql
create database db01;
use db01;
create table tb_user(
    id int(11) not null primary key ,
    name varchar(50) not null,
    sex varchar(1)
)engine=innodb default charset=utf8mb4;
insert into tb_user(id,name,sex) values(1,'Tom','1');
insert into tb_user(id,name,sex) values(2,'Trigger','0');
insert into tb_user(id,name,sex) values(3,'Dawn','1');
insert into tb_user(id,name,sex) values(4,'Jack Ma','1');
insert into tb_user(id,name,sex) values(5,'Coco','0');
insert into tb_user(id,name,sex) values(6,'Jerry','1');
```

- åœ¨Master1ä¸­æ‰§è¡ŒDMLã€DDLæ“ä½œï¼Œçœ‹çœ‹æ•°æ®æ˜¯å¦å¯ä»¥åŒæ­¥åˆ°å¦å¤–çš„ä¸‰å°æ•°æ®åº“ä¸­ã€‚
- åœ¨Master2ä¸­æ‰§è¡ŒDMLã€DDLæ“ä½œï¼Œçœ‹çœ‹æ•°æ®æ˜¯å¦å¯ä»¥åŒæ­¥åˆ°å¦å¤–çš„ä¸‰å°æ•°æ®åº“ä¸­ã€‚

å®Œæˆäº†ä¸Šè¿°åŒä¸»åŒä»çš„ç»“æ„æ­å»ºä¹‹åï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹å¦‚ä½•å®Œæˆè¿™ç§**åŒä¸»åŒä»çš„è¯»å†™åˆ†ç¦»**ã€‚



## 4.5 åŒä¸»åŒä»==è¯»å†™åˆ†ç¦»==

### ï¼ˆ1ï¼‰é…ç½®

MyCatæ§åˆ¶åå°æ•°æ®åº“çš„è¯»å†™åˆ†ç¦»å’Œè´Ÿè½½å‡è¡¡ç”±schema.xmlæ–‡ä»¶datahostæ ‡ç­¾çš„balanceå±æ€§æ§åˆ¶ï¼Œé€šè¿‡writeTypeåŠswitchTypeæ¥å®Œæˆå¤±è´¥è‡ªåŠ¨åˆ‡æ¢çš„ã€‚

#### â‘ schema.xml

![image-20250422171917666](./Mysql-Learning-Local.assets/image-20250422171917666.png)

é…ç½®é€»è¾‘åº“ï¼š

```xml
<schema name="ITCAST_RW2" checkSQLschema="true" sqlMaxLimit="100" dataNode="dn7">
</schema>
```

é…ç½®æ•°æ®èŠ‚ç‚¹ï¼š

```xml
<dataNode name="dn7" dataHost="dhost7" database="db01" />
```

é…ç½®èŠ‚ç‚¹ä¸»æœºï¼š

```xml
<dataHost name="dhost7" maxCon="1000" minCon="10" balance="1" writeType="0"
          dbType="mysql" dbDriver="jdbc" switchType="1" slaveThreshold="100">
    <heartbeat>select user()</heartbeat>
    <writeHost host="master1" url="jdbc:mysql://192.168.200.211:3306?  useSSL=false&amp;serverTimezone=Asia/Shanghai&amp;characterEncoding=utf8"
               user="root" password="1234" >
        <readHost host="slave1" url="jdbc:mysql://192.168.200.212:3306?useSSL=false&amp;serverTimezone=Asia/Shanghai&amp;characterEncoding=utf8"
                  user="root" password="1234" />
    </writeHost>
    <writeHost host="master2" url="jdbc:mysql://192.168.200.213:3306?useSSL=false&amp;serverTimezone=Asia/Shanghai&amp;characterEncoding=utf8"
               user="root" password="1234" >
        <readHost host="slave2" url="jdbc:mysql://192.168.200.214:3306?useSSL=false&amp;serverTimezone=Asia/Shanghai&amp;characterEncoding=utf8"
                  user="root" password="1234" />
    </writeHost>
</dataHost>
```

å…·ä½“çš„å¯¹åº”æƒ…å†µå¦‚ä¸‹ï¼š

![image-20250422171413578](./Mysql-Learning-Local.assets/image-20250422171413578.png)

å±æ€§è¯´æ˜ï¼š

![image-20250422171839245](./Mysql-Learning-Local.assets/image-20250422171839245.png)

> **balance="1"**
>
> ä»£è¡¨å…¨éƒ¨çš„ readHost ä¸ stand by writeHost å‚ä¸ select è¯­å¥çš„è´Ÿè½½å‡è¡¡ï¼Œç®€å•çš„è¯´ï¼Œ**å½“åŒä¸»åŒä»æ¨¡å¼(M1->S1ï¼ŒM2->S2ï¼Œå¹¶ä¸” M1 ä¸ M2 äº’ä¸ºä¸»å¤‡)ï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼ŒM2,S1,S2 éƒ½å‚ä¸ select è¯­å¥çš„è´Ÿè½½å‡è¡¡** 	
>
> **writeType**
>
> â€‹	0 : å†™æ“ä½œéƒ½è½¬å‘åˆ°ç¬¬1å°writeHost, writeHost1æŒ‚äº†, ä¼šåˆ‡æ¢åˆ°writeHost2ä¸Š;
>
> â€‹	1 : æ‰€æœ‰çš„å†™æ“ä½œéƒ½éšæœºåœ°å‘é€åˆ°é…ç½®çš„writeHostä¸Š ;
>
> **switchType**
>
> â€‹	-1 : ä¸è‡ªåŠ¨åˆ‡æ¢
>
> â€‹	1 : è‡ªåŠ¨åˆ‡æ¢ï¼Œå½“ç¬¬1å°writeHostå®•æœºåï¼Œä¼šä¸ä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°writeHost2ä¸Š





#### â‘¡server.xml

é…ç½®rootç”¨æˆ·ä¹Ÿå¯ä»¥è®¿é—®åˆ°**é€»è¾‘åº“ ITCAST_RW2**ã€‚

```xml
<user name="root" defaultAccount="true">
    <property name="password">123456</property>
    <property name="schemas">SHOPPING,ITCAST,ITCAST_RW2</property>
    <!-- è¡¨çº§ DML æƒé™è®¾ç½® -->
    <!--
		<privileges check="true">
		<schema name="DB01" dml="0110" >
		<table name="TB_ORDER" dml="1110"></table>
		</schema>
		</privileges>
	-->
</user>
```





### ï¼ˆ2ï¼‰æµ‹è¯•

ç™»å½•MyCatï¼Œæµ‹è¯•æŸ¥è¯¢åŠæ›´æ–°æ“ä½œï¼Œåˆ¤å®šæ˜¯å¦èƒ½å¤Ÿè¿›è¡Œè¯»å†™åˆ†ç¦»ï¼Œä»¥åŠè¯»å†™åˆ†ç¦»çš„ç­–ç•¥æ˜¯å¦æ­£ç¡®ã€‚

**å½“ä¸»åº“æŒ‚æ‰ä¸€ä¸ªä¹‹åï¼Œæ˜¯å¦èƒ½å¤Ÿè‡ªåŠ¨åˆ‡æ¢**ã€‚



## 4.6 å°ç»“

![image-20250422172432219](./Mysql-Learning-Local.assets/image-20250422172432219.png)

